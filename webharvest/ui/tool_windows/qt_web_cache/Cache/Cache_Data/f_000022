/*! For license information please see player-8.466ac1b2.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).xss={})}(this,function(t){"use strict";var e=function(){return(e=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function n(t,e,n){if(n||2==arguments.length)for(var r,i=0,a=e.length;i<a;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}var r=/[^a-zA-Z0-9\\_:.-]/gim,i=/</g,a=/>/g,o=/&#([a-zA-Z0-9]*);?/gim,s=/&quot;/g,c=/&colon;?/gim,l=/&newline;?/gim,u=/((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a):/gi,d=/u\s*r\s*l\s*\(.*/gi,f=/e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi,h=/"/g,p=function(t){return t.replace(i,"&lt;").replace(a,"&gt;")},g={indexOf:function(t,e){var n,r;for(n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return -1},forEach:function(t,e,n){var r,i;for(r=0,i=t.length;r<i;r++)e.call(n,t[r],r,t)},some:function(t,e,n){var r,i;for(r=0,i=t.length;r<i;r++)if(e.call(n,t[r],r,t))return!0;return!1},trim:function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},includes:function(t,e){if("string"==typeof t)return -1!==t.indexOf(e);for(var n=0;n<t.length;n++)if(t[n]===e)return!0;return!1},spaceIndex:function(t){var e=/\s|\n|\t/.exec(t);return e?e.index:-1},uniq:function(t){for(var e={},n=[],r=0;r<t.length;r++)e[t[r]]||(n.push(t[r]),e[t[r]]=!0);return n},from:function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},keys:function(t){var e=[];for(var n in t)e.push(n);return e}};function m(t){return null==t}function v(t){var e;return'"'===(e=t)[0]&&'"'===e[e.length-1]||"'"===e[0]&&"'"===e[e.length-1]?t.substr(1,t.length-2):t}function y(t){var e,n,r,i,a,o,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",u=0;for(t=function(t){t=t.replace(/rn/g,"n");for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e+=String.fromCharCode(r):r>127&&r<2048?e+=String.fromCharCode(r>>6|192)+String.fromCharCode(63&r|128):e+=String.fromCharCode(r>>12|224)+String.fromCharCode(r>>6&63|128)+String.fromCharCode(63&r|128)}return e}(t);u<t.length;)i=(e=t.charCodeAt(u++))>>2,a=(3&e)<<4|(n=t.charCodeAt(u++))>>4,o=(15&n)<<2|(r=t.charCodeAt(u++))>>6,s=63&r,isNaN(n)?o=s=64:isNaN(r)&&(s=64),l=l+c.charAt(i)+c.charAt(a)+c.charAt(o)+c.charAt(s);return l}function b(t){var e,n,r,i,a,o,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",l=0;for(t=t.replace(/[^A-Za-z0-9+/=]/g,"");l<t.length;)e=s.indexOf(t.charAt(l++))<<2|(i=s.indexOf(t.charAt(l++)))>>4,n=(15&i)<<4|(a=s.indexOf(t.charAt(l++)))>>2,r=(3&a)<<6|(o=s.indexOf(t.charAt(l++))),c+=String.fromCharCode(e),64!==a&&(c+=String.fromCharCode(n)),64!==o&&(c+=String.fromCharCode(r));return function(t){for(var e="",n=0,r=0,i=0,a=0;n<t.length;)(r=t.charCodeAt(n))<128?(e+=String.fromCharCode(r),n++):r>191&&r<224?(e+=String.fromCharCode((31&r)<<6|63&(a=t.charCodeAt(n+1))),n+=2):(a=t.charCodeAt(n+1),e+=String.fromCharCode((15&r)<<12|(63&a)<<6|63&(i=t.charCodeAt(n+2))),n+=3);return e}(c)}function _(t,e,n){var r="",i=0,a=!1,o=!1,s=0,c=t.length,l="",u="";t:for(s=0;s<c;s++){var d=t.charAt(s);if(!1===a){if("<"===d){a=s;continue}}else if(!1===o){if("<"===d){r+=n(t.slice(i,s)),a=s,i=s;continue}if(">"===d||s===c-1){r+=n(t.slice(i,a)),l=function(t){var e,n=g.spaceIndex(t);return e=-1===n?t.slice(1,-1):t.slice(1,n+1),"/"===(e=g.trim(e).toLowerCase()).slice(0,1)&&(e=e.slice(1)),"/"===e.slice(-1)&&(e=e.slice(0,-1)),e}(u=t.slice(a,s+1)),r+=e(a,r.length,l,u,"</"===u.slice(0,2)),i=s+1,a=!1;continue}if('"'===d||"'"===d)for(var f=1,h=t.charAt(s-f);""===h.trim()||"="===h;){if("="===h){o=d;continue t}h=t.charAt(s-++f)}}else if(d===o){o=!1;continue}}return i<c&&(r+=n(t.substr(i))),r}function x(t,e){var n=0,i=0,a=[],o=!1,s=t.length;function c(t,n){if(!((t=(t=g.trim(t)).replace(r,"").toLowerCase()).length<1)){var i=e(t,n||"");i&&a.push(i)}}for(var l=0;l<s;l++){var u=t.charAt(l),d=void 0;if(!1!==o||"="!==u){if(!1===o||l!==i){if(/\s|\n|\t/.test(u)){if(t=t.replace(/\s|\n|\t/g," "),!1===o){if(-1===(d=function(t,e){for(;e<t.length;e++){var n=t[e];if(" "!==n)return"="===n?e:-1}return -1}(t,l))){c(g.trim(t.slice(n,l))),o=!1,n=l+1;continue}l=d-1;continue}if(-1===(d=function(t,e){for(;e>0;e--){var n=t[e];if(" "!==n)return"="===n?e:-1}return -1}(t,l-1))){c(o,v(g.trim(t.slice(n,l)))),o=!1,n=l+1;continue}}}else{if(-1===(d=t.indexOf(u,l+1)))break;c(o,g.trim(t.slice(i+1,d))),o=!1,n=(l=d)+1}}else o=t.slice(n,l),n=l+1,i='"'===t.charAt(n)||"'"===t.charAt(n)?n:function(t,e){for(;e<t.length;e++){var n=t[e];if(" "!==n)return"'"===n||'"'===n?e:-1}return -1}(t,l+1)}return n<t.length&&(!1===o?c(t.slice(n)):c(o,v(g.trim(t.slice(n))))),g.trim(a.join(" "))}function k(t,e,n){if(n=function(t){return t=function(t){for(var e="",n=0,r=t.length;n<r;n++)e+=32>t.charCodeAt(n)?" ":t.charAt(n);return g.trim(e)}(t=(t=(t=t.replace(s,'"')).replace(o,function(t,e){return"x"===e[0]||"X"===e[0]?String.fromCharCode(parseInt(e.substr(1),16)):String.fromCharCode(parseInt(e,10))})).replace(c,":").replace(l," "))}(n),"href"===e||"src"===e){if("#"===(n=g.trim(n)))return"#";if("http://"!==n.substr(0,7)&&"https://"!==n.substr(0,8)&&"mailto:"!==n.substr(0,7)&&"tel:"!==n.substr(0,4)&&"data:image/"!==n.substr(0,11)&&"ftp://"!==n.substr(0,6)&&"./"!==n.substr(0,2)&&"../"!==n.substr(0,3)&&"#"!==n[0]&&"/"!==n[0])return""}else if("background"===e){if(u.lastIndex=0,u.test(n))return""}else if("style"===e&&(f.lastIndex=0,f.test(n)||(d.lastIndex=0,d.test(n)&&(u.lastIndex=0,u.test(n)))))return"";return n=function(t){return t=p(t=t.replace(h,"&quot;"))}(n)}var S=function(t){return"string"==typeof t?t.replace(/'/g,'"').replace('=""',"").replace(/\s+/g,"").toLowerCase():""},L=function(){function t(t){var e=function(t){var e={};for(var n in t)e[n]=t[n];return e}(t||{});e.stripIgnoreTag&&(e.onIgnoreTag,e.onIgnoreTag=function(){return""}),e.whiteList={},e.onTag=function(){},e.onTagAttr=function(){},e.onIgnoreTag=function(){},e.onIgnoreTagAttr=function(){},e.safeAttrValue=k,e.escapeHtml=p,this.options=Object.assign(e,t)}return t.prototype.process=function(t){if(!(t=(t=t||"").toString()))return"";var e,n,r,i,a,o,s=this.options,c=s.whiteList,l=s.onTag,u=s.onIgnoreTag,d=s.onTagAttr,f=s.onIgnoreTagAttr,h=s.safeAttrValue,p=s.escapeHtml;s.stripBlankChar&&(t=(e=(e=t.split("")).filter(function(t){var e=t.charCodeAt(0);return!(127===e||e<=31&&10!==e&&13!==e)})).join("")),s.allowCommentTag||(t=function(t){for(var e="",n=0;n<t.length;){var r=t.indexOf("\x3c!--",n);if(-1===r){e+=t.slice(n);break}e+=t.slice(n,r);var i=t.indexOf("--\x3e",r);if(-1===i)break;n=i+3}return e}(t));var m=!1;s.stripIgnoreTagBody&&(n=s.stripIgnoreTagBody,"function"!=typeof(r=u)&&(r=function(){}),i=!Array.isArray(n),a=[],o=!1,u=(m={onIgnoreTag:function(t,e,s){var c;if(c=t,i||-1!==g.indexOf(n,c)){if(s.isClosing){var l="[/removed]",u=s.position+l.length;return a.push([!1!==o?o:s.position,u]),o=!1,l}return o||(o=s.position),"[removed]"}return r(t,e,s)},remove:function(t){var e="",n=0;return g.forEach(a,function(r){e+=t.slice(n,r[0]),n=r[1]}),e+=t.slice(n)}}).onIgnoreTag);var v=_(t,function(t,e,n,r,i){var a={sourcePosition:t,position:e,isClosing:i,isWhite:Object.prototype.hasOwnProperty.call(c,n)},o=l(n,r,a);if(null!=o)return o;if(a.isWhite){if(a.isClosing)return"</".concat(n,">");var s=function(t){var e=g.spaceIndex(t);if(-1===e)return{html:"",closing:"/"===t[t.length-2]};var n="/"===(t=g.trim(t.slice(e+1,-1)))[t.length-1];return n&&(t=g.trim(t.slice(0,-1))),{html:t,closing:n}}(r),m=c[n],v=x(s.html,function(t,e){var r=-1!==g.indexOf(m,t),i=d(n,t,e,r);return null==i?r?(e=h(n,t,e,null))?"".concat(t,'="').concat(e,'"'):t:null==(i=f(n,t,e,r))?void 0:i:i});return r="<".concat(n),v&&(r+=" ".concat(v)),s.closing&&(r+=" /"),r+=">"}return null==(o=u(n,r,a))?p(r):o},p);return m&&(v=m.remove(v)),v},t}(),R=Function("\nvar _checkXSS = function (it) {\n  return it && it.Math == Math && it;\n};\nreturn _checkXSS(typeof globalThis === 'object' && globalThis) ||\n_checkXSS(typeof window === 'object' && window) ||\n_checkXSS(typeof self === 'object' && self) ||\n_checkXSS(typeof global === 'object' && global) ||\nFunction('return this')();\n")(),O=new(function(){function t(){var t=this;this.batchData=[],this.uniqKeys=new Set,this.timeout=2e3,this.lock=!1,this.getSlardarBid=function(){var e,n,r="douyin_web";if(!g.includes(r,"bid"))return r;if(t.config&&t.config.bid)return t.config.bid;if(R&&R._xssBid)return R._xssBid;if(R&&R.slardar&&"function"==typeof R.slardar.config){var i=(R.slardar.config()||{}).bid;if(i)return i}if(R&&R.Slardar&&"function"==typeof R.Slardar.config){var a=(R.Slardar.config()||{}).bid;if(a)return a}return(null===(n=null===(e=null==R?void 0:R.Slardar)||void 0===e?void 0:e._baseParams)||void 0===n?void 0:n.bid)||"argus"},this.getConfigRegion=function(){var e;return g.includes("cn","region")?t.config&&t.config.region?t.config.region:((null===(e=null==R?void 0:R.gfdatav1)||void 0===e?void 0:e.region)||"cn").toLowerCase():"cn"},this.gerReportUrl=function(){var e={cn:b("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boe:b("aHR0cHM6Ly9tb24uemlqaWVhcGkuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),ttp:b("aHR0cHM6Ly9tb24udXMudGlrdG9rdi5jb20vbW9uaXRvcl9icm93c2VyL2NvbGxlY3QvYmF0Y2gvc2VjdXJpdHkvP2JpZD0="),va:b("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),maliva:b("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),sg:b("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9"),boei18n:b("aHR0cHM6Ly9tb24tdmEuYnl0ZW92ZXJzZWEuY29tL21vbml0b3JfYnJvd3Nlci9jb2xsZWN0L2JhdGNoL3NlY3VyaXR5Lz9iaWQ9")}[t.getConfigRegion()];if(e)return e+t.getSlardarBid()}}return t.prototype.setConfig=function(t){this.config=t},t.prototype.upload=function(){var t=this,e=this.gerReportUrl();!this.lock&&e&&0!==this.batchData.length&&(this.lock=!0,setTimeout(function(){var n=t.batchData.slice(0,100);t.batchData=t.batchData.slice(100),R.fetch(e,{method:"post",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).catch(function(t){}),t.lock=!1,t.upload()},this.timeout))},t.prototype.generateKey=function(t){return t.collectKey?[t.collectMode,t.collectKey].join("___"):""},t.prototype.push=function(t){this.batchData.push(t),this.upload()},t.prototype.report=function(t){var e=this.generateKey(t);if(R.fetch&&t.collectKey){var n="object"==typeof window?window.location.href:"SSR";t.documentUrl=n;var r={age:Math.floor(Date.now()),type:"xss",url:n,body:t,"user-agent":""};"enforce"===t.disposition&&"SSR"!==n||(r.url=e),"SSR"===n&&(r.url="SSR___".concat(r.url),r.body.ssr=!0),this.push(r)}},t}()),T=function(t){for(var e=0,n=function(n){Array.isArray(t[n])?0===t[n].length?delete t[n]:(t[n]=g.from(g.uniq(t[n])),e+=t[n].length):0===g.keys(t[n]).length?delete t[n]:g.keys(t[n]).forEach(function(r){t[n][r]=g.from(g.uniq(t[n][r])),e+=t[n][r].length})},r=0,i=g.keys(t);r<i.length;r++)n(i[r]);return{count:e,ret:t}};function w(t,e){return O.setConfig(e),new L(e).process(t)}function D(t){var e,n=(e=/\s|\n|\t/.exec(t))?e.index:-1;if(-1===n)return{html:"",closing:"/"===t[t.length-2]};var r="/"===(t=t.slice(n+1,-1).trim())[t.length-1];return r&&(t=t.slice(0,-1).trim()),{html:t,closing:r}}var P=function(t){return -1===(t=(t=(t=(t=t.replace(/&colon;/gi,":")).replace(/&tab;/gi,"")).replace(/&newline;/gi,"")).replace(/(\t|\n|\r)/g,"")).indexOf("&#")?t.trim().toLowerCase():t.trim().replace(/&#(?:(x)([0-9a-f]+)|([0-9]+));?/gi,function(t,e,n,r){return String.fromCharCode(e?parseInt(n,16):parseInt(r))}).replace(/(\t|\n|\r)/g,"").toLowerCase()};function I(t,e){if(void 0===t&&(t=""),"string"!=typeof t)return!0;if(t=P(t),g.includes(t,"base64")&&!function(t){if(""===t||""===t.trim())return!0;try{return!g.includes(t,"data:text/html;base64")}catch(t){return!0}}(t))return e&&e("data:text/html;base64"),!1;var n=["expression(","behavior:","view-source:"];if(g.some(n,function(e){return -1!==t.indexOf(e)}))return g.forEach(n,function(n){-1!==t.indexOf(n)&&e&&e(n)}),!1;var r=["data:application","data:javascript","data:text/html","data:texthtml"];if(g.some(r,function(e){return -1!==t.indexOf(e)}))return g.forEach(r,function(n){-1!==t.indexOf(n)&&e&&e(n)}),!1;if(t.indexOf("javascript:")>0)return e&&e("javascript:"),!1;if(/^javascript:/i.test(t)){var i=t.slice(11).replace(/\s/g,"").trim();return!!g.some(["void","void(0)","void0","false","undefined",";"],function(t){return t===i})||(e&&e("javascript:"),!1)}return!0}var C=function(t,e){var n,r,i="<%= isSaveValidUrl =>";if("string"!=typeof t||(r=Number("<%= urlLimit =>"),void 0!==n&&(r=n),"NaN"!==t.toString()&&-1!==r&&t.length>=r)||I(t,e))return t;try{if(!0===(i=JSON.parse(i))||"true"===i){var a=new URL(t);return a.origin+a.pathname}}catch(t){}return"#"};function E(t,e,r){if(void 0===t&&(t=""),void 0===e&&(e=[]),"string"!=typeof t)return!0;if(!I(t=P(t)))return!1;var i,a={url:(i=t.match(/^(?:([A-Za-z]+):)?(\/{0,3})([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/)||[])[0],scheme:i[1],slash:i[2],host:i[3],port:i[4],path:i[5],query:i[6],hash:i[7]},o=a.scheme,s=a.host;return r?!!r(t):!(!o||!s)&&(!g.includes(["http","https","file"],o)||("object"==typeof window&&window&&(e=n(n([],e,!0),[location.host],!1)),g.some(e,function(t){return!!(t instanceof RegExp&&t.test(s))||t===s})))}var N={a:["target","title","spellcheck","rel"],canvas:[],abbr:["title"],address:[],area:["shape","coords","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:["dir"],dl:[],dt:[],em:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["alt","title","width","height","decoding"],ins:["datetime"],li:[],mark:[],nav:[],ol:["start"],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],sup:[],delete:[],form:[],strong:[],mask:["maskunits","x","y","width","height","fill"],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],wbr:[],video:["autoplay","controls","loop","preload","height","width"],svg:["viewBox","version","xmlns","fill","width","height","stroke","stroke-width","style"],path:["d","fill","opacity","stroke","p-id","fill-rule","clip-rule","stroke-width","stroke-linecap","stroke-linejoin","fill-opacity","mask"],rect:["x","y","width","height","fill","stroke","rx"],g:[]},M={collect:null,initCollect:function(){this.collect={whiteList:{},filterProtocol:[]}},removeCollect:function(){var t=T(this.collect),e=t.count,n=t.ret;return this.collect=null,{collectKey:0===e?null:JSON.stringify(n),collectMode:"white"}},onIgnoreTagAttr:function(t,e,r){return t&&g.indexOf(["href","src"],e)>-1?M.domainWhiteList&&Array.isArray(M.domainWhiteList)&&M.domainWhiteList.length>0&&!E(r,n([],M.domainWhiteList,!0))?"":"".concat(e,'="').concat(C(r,function(t){var e;null===(e=M.collect)||void 0===e||e.filterProtocol.push(t)}),'"'):t&&(g.indexOf(["style","class","id"],e)>-1||e.indexOf("data-")>-1)?"".concat(e,'="').concat(r,'"'):(M.collect.whiteList[t]=M.collect.whiteList[t]||[],void M.collect.whiteList[t].push(e))},onIgnoreTag:function(t,e){if("style"===t)return e;_(e,function(t,e,n,r){x(D(r).html.replace("/",""),function(t){M.collect.whiteList[n]=M.collect.whiteList[n]||[],M.collect.whiteList[n].push(t)})},p)},whiteList:N,mergeWhiteList:function(t){for(var e,n={},r=0,i=g.keys(N);r<i.length;r++)n[e=i[r]]=g.from(N[e]);for(var a=0,o=g.keys(t);a<o.length;a++)n[e=o[a]]=e in N?N[e].concat(t[e]):g.from(t[e]);return n},setWhiteList:function(t){for(var e=0,n=g.keys(t);e<n.length;e++){var r=n[e];this.whiteList[r]=r in N?N[r].concat(t[r]):g.from(t[r])}}};try{var A={},j="merge";g.includes(j,"override")&&(M.whiteList=A.whiteList),g.includes(j,"merge")&&M.setWhiteList(A.whiteList)}catch(t){}var G=function(t,e){for(var n={},r=0,i=g.keys(t);r<i.length;r++){var a=i[r];Array.isArray(t[a])?n[a]=g.from(t[a]):n[a]=G({},t[a])}for(var o=0,s=g.keys(e);o<s.length;o++)(a=s[o])in t?Array.isArray(t[a])?n[a]=t[a].concat(e[a]):n[a]=G(t[a],e[a]):Array.isArray(e[a])?n[a]=g.from(e[a]):n[a]=G({},e[a]);return n},F={blackList:{a:["folder"],meta:["content"],iframe:["srcdoc"],input:["pattern"],vmlframe:["xmlns"]},blackTags:["script","xml","embed","isindex","object","base","set","handler","animate","payload","import"],blackAttrs:["charset","ns","namespace","formaction","xlink:href","xmlns:xlink","handler","repeat","repeat-start","repeat-end"],blackAttrRegExps:[/^on/],filterList:{param:["value"],video:["poster"],form:["action"]},filterAttrs:["href","src","background","style","dynsrc","lowsrc","content"]};try{var B={};B.blackAttrRegExps&&(B.blackAttrRegExps=B.blackAttrRegExps.map(function(t){return new RegExp(t.toString().slice(1,t.toString().length-1))}));var U="merge";g.includes(U,"override")&&(F=B),g.includes(U,"merge")&&(F=G(F,B))}catch(t){}var H={mode:"black",whiteList:{},blackConfig:F,collect:null,initCollect:function(){H.collect={blackList:{},blackTags:[],blackAttrs:[],blackAttrRegExps:[],filterAttrs:[],filterList:{},filterProtocol:[]}},removeCollect:function(){var t=T(H.collect),e=t.count,n=t.ret;return H.collect=null,{collectKey:0===e?null:JSON.stringify(n),collectMode:"black"}},onIgnoreTag:function(t,e){var n;if(!g.includes(F.blackTags,t))return _(e,function(t,e,n,r,i){if(-1!==n.indexOf("/"))return p(r);if(i)return"</".concat(n,">");var a=D(r),o=x(a.html,function(t,e){var r,i=0;if(F.blackList[n]&&g.includes(F.blackList[n],t)&&(H.collect.blackList[n]=H.collect.blackList[n]||[],H.collect.blackList[n].push(t),i++),F.blackAttrRegExps.length&&F.blackAttrRegExps.some(function(e){return e.test(t)})&&g.forEach(F.blackAttrRegExps,function(e){e.test(t)&&(H.collect.blackAttrRegExps.push("".concat(e.toString(),"->").concat(t)),i++)}),F.blackAttrs.length&&g.includes(F.blackAttrs,t)&&(F.blackAttrs.push(t),i++),!i){if(F.filterList&&F.filterList[n]&&g.includes(F.filterList[n],t)){var a=C(e,function(t){var e;null===(e=H.collect)||void 0===e||e.filterProtocol.push(t)});return a!==e&&(H.collect.filterList[n]=H.collect.filterList[n]||[],H.collect.filterList[n].push(t)),e?"".concat(t,"='").concat(a,"'"):t}return F.filterAttrs&&g.includes(F.filterAttrs,t)?((a=C(e,function(t){var e;null===(e=H.collect)||void 0===e||e.filterProtocol.push(t)}))!==e&&(null===(r=H.collect)||void 0===r||r.filterAttrs.push(t)),e?"".concat(t,"='").concat(a,"'"):t):e?"".concat(t,"='").concat(e,"'"):t}});return r="<".concat(n),o&&(r+=" ".concat(o)),a.closing&&(r+=" /"),r+=">"},p);null===(n=H.collect)||void 0===n||n.blackTags.push(t)}},Z=function(t){var e=t.reportOnly,n=void 0===e||e,r=t.block;return n&&"all"===n?"report":("string"==typeof n&&("true"===n&&(n=!0),"false"===n&&(n=!1)),r?"enforce":n?"report":"enforce")},W=function(t){return function(n,r,i){if(!n||"string"!=typeof n)return n;var a=r;t===w&&(a=M).initCollect();var o=t(n,a);if(S(o)===S(n))return n;if(!i)return o;var s=i.logType,c=Z(i),l=a.removeCollect();return O.report(e(e({type:s,disposition:c},l),{sourceText:y(n),filterText:y(o)})),"enforce"===c?o:n}},J=W(function(t,e){return void 0===e&&(e={}),e&&e.whiteList||(e.whiteList={a:["target","href","title"],abbr:["title"],address:[],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","crossorigin","loop","muted","preload","src"],b:[],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite"],br:[],caption:[],center:[],cite:[],code:[],col:["align","valign","span","width"],colgroup:["align","valign","span","width"],dd:[],del:["datetime"],details:["open"],div:[],dl:[],dt:[],em:[],figcaption:[],figure:[],font:["color","size","face"],footer:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],header:[],hr:[],i:[],img:["src","alt","title","width","height"],ins:["datetime"],li:[],mark:[],nav:[],ol:[],p:[],pre:[],s:[],section:[],small:[],span:[],sub:[],summary:[],sup:[],strong:[],strike:[],table:["width","border","align","valign"],tbody:["align","valign"],td:["width","rowspan","colspan","align","valign"],tfoot:["align","valign"],th:["width","rowspan","colspan","align","valign"],thead:["align","valign"],tr:["rowspan","align","valign"],tt:[],u:[],ul:[],video:["autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"]}),new L(e).process(t)}),z=W(w),V=function(t,e,n){var r=[],i=C(t,function(t){r.push(t)});if(i===t)return t;r=g.from(g.uniq(r));var a=e||n||{};if(!a)return i;var o=a.logType,s=Z(n);return O.report({type:o,disposition:s,collectKey:r.join("___"),collectData:JSON.stringify(r),collectMode:"black",sourceText:y(t),filterText:y(i)}),"enforce"===s?i:t},q=R._xssProject||{},X=R.xssNamespace||{},Y="3.0.26",K={FilterXSS:L,version:Y,webpackPluginVersion:"<%= webpackPluginVersion =>",reportOnly:"<%= reportOnly =>",filterXSS:J,_filterXSS:z,filterUrl:V,Config:M,BlackConfig:H,project:q,setProjectName:function(t){q[t]=this,R._xssProjectName=t}};X.douyin_web=K,R.xssNamespace=X,R.Math&&!R.Math.xssNamespace&&(R.Math.xssNamespace=X),q[Y]=K,R.globalThis=R,R.getFilterXss=function(){return void 0!==this._xssProjectName?this._xssProject[this._xssProjectName]:K},R.xss=K,R.isSafeUrl=E,R.isSafeDomain=E,R.isSafeProtocol=I,R._xssProject=q,R._xssProjectName&&(q[R._xssProjectName]=K);var Q=K.setProjectName.bind(K);t.BlackConfig=H,t.Config=M,t.FilterXSS=L,t._filterXSS=z,t.filterUrl=V,t.filterXSS=J,t.isSafeDomain=E,t.isSafeProtocol=I,t.isSafeUrl=E,t.project=q,t.setProjectName=Q,t.setXssNamespace=function(t){var e=t.appId,n=t.bid,r=t.region;X[e]=K;M.bid=n,M.region=r,M.enabled=!0},t.xssNamespace=X,Object.defineProperty(t,"__esModule",{value:!0})});"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["99794"],{239127:function(t,e,n){n.d(e,{Cy:function(){return f},G9:function(){return l},ZP:function(){return c},_M:function(){return u}}),n(819875),n(602157),n(836654),n(743465),n(464135),n(47513),n(110617),n(675373),n(826893);var r=n(738712),i=[{key:"Wexin",reg:/(micromessenger)\/([\d.]+)/},{key:"Openlanguage",reg:/(openlanguage)\/([\d.]+)/},{key:"NewsArticle",reg:/(newsarticle)\/([\d.]+)/},{key:"VideoArticle",reg:/(videoarticle)\/([\d.]+)/},{key:"Hotsoon",reg:/(live_stream)_([\d.]+)/},{key:"Aweme",reg:/(aweme)_([\d.]+)/},{key:"Lark",reg:/(lark)\/([\d.]+)/},{key:"PlayStation",reg:/(playstation)/},{key:"BingPreview",reg:/(bingpreview)\/([\d.]+)/}],a=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],o=["Baiduspider","YandexBot"],s=["Baiduspider","googlebot","360Spider","haosouspider","YoudaoBot","Sogou News Spider","Yisouspider","Googlebot","Headless","Applebot","Bingbot","PetalBot"],c="undefined"!=typeof navigator&&function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e={},n=t.toLowerCase();try{var c,l,u=new r.UAParser(t).getResult();e.browser=u.browser,e.os=u.os,e.device=u.device,e.isIOS="iOS"===u.os.name,e.isAndroid="Android"===u.os.name,e.isWP="Windows Phone"===u.os.name,e.isPad="tablet"===u.device.type,e.isMobile="mobile"===u.device.type||"tablet"===u.device.type||e.isIOS||e.isAndroid||e.isWP,e.isPC=!e.isMobile;var d=function(){var t={isSupport:!1,mime:""};if("undefined"==typeof document)return t;var e=document.createElement("video");return"function"==typeof e.canPlayType?(a.map(function(n){"probably"===e.canPlayType('video/mp4; codecs="'.concat(n,'"'))&&(t.isSupport=!0,t.mime+="||".concat(n))}),t):(e=null,t)}();e.isSupportMP4=d.isSupport,e.mime=d.mime;for(var f=(null===(c=u.browser)||void 0===c?void 0:c.name)||"",h=(null===(l=u.browser)||void 0===l?void 0:l.version)||"",p=null,g=0;g<i.length;g++)if(p=i[g].reg.exec(n)){f=i[g].key,h=p.length>2?p[2]:"";break}!p&&function(){if("undefined"==typeof navigator)return!1;var t=navigator.mimeTypes;if(t){for(var e=0;e<t.length;e++)if(t[e].type&&t[e].type.indexOf("360")>-1||t[e].type&&t[e].type.indexOf("application/vnd.chromium.remoting-viewer")>-1||t[e].description&&t[e].description.indexOf("360")>-1)return!0;return!1}}()&&(f="360EE"),("IE"===u.browser.name||"IEMobile"===u.browser.name)&&(f="Trident"),f&&(e["is".concat(f)]=!0,e.name=f,e.appVersion=h),e.name&&"Trident"!==e.name&&/(trident)/.exec(n)&&(e.name=e.name?"".concat(e.name,"_Trident"):"Trident"),e.isSpider=function(t,e){var n=!1;o.forEach(function(e){e===t&&(n=!0)});for(var r=0;r<s.length;r++){var i=s[r];if(-1!==e.indexOf(i)){n=!0;break}}return n}(e.name,n)}catch(t){}return e}(navigator.userAgent);function l(){return"undefined"!=typeof MediaSource&&!!MediaSource.isTypeSupported&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))}function u(){if("undefined"==typeof MediaSource||!MediaSource.isTypeSupported)return{support:!1,message:"MediaSource API not support"};for(var t=!1,e="",n=0;n<a.length;n++){var r='video/mp4; codecs="'.concat(a[n],'"'),i=MediaSource.isTypeSupported(r);e+="".concat(r," is ").concat(i," "),i&&(t=!0)}return{support:t,message:e}}var d=[1,1,1,1,1];function f(){return parseInt(d.join(""),10)}d[0]=c.isSupportMP4?d[1]+1:d[1],d[1]=l()?d[1]+1:d[1],(function(t){var e={supported:!1,smooth:!1,powerEfficient:!1};if(!t||"undefined"==typeof navigator)return Promise.resolve(e);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(t);var n=t.video||{},r=t.audio||{};try{var i=MediaSource.isTypeSupported(n.contentType),a=MediaSource.isTypeSupported(r.contentType);return Promise.resolve({supported:i&&a,smooth:!1,powerEfficient:!1})}catch(t){return Promise.resolve(e)}})({type:"file",video:{contentType:'video/mp4;codecs="hev1.1.6.L120.90"',width:1920,height:1080,bitrate:1e4,framerate:30}}).then(function(t){t&&t.supported?d[2]=d[2]+1:d[2]=1}).catch(function(){d[2]=d[2]-1})},235879:function(t,e,n){n.d(e,{Tw:function(){return k},Yx:function(){return L},_R:function(){return _},kL:function(){return b},oy:function(){return x}});var r,i=n(452006);n(836654),n(691842),n(465132),n(511141),n(464135),n(891555),n(469577),n(206642),n(721911),n(98601),n(110617),n(914613),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(271692),n(296702),n(828514),n(187562),n(166613),n(801402),n(862956),n(703327),n(573545),n(170399),n(544805),n(463724),n(279651),n(874386);var a=n(879146),o=n.n(a),s=n(750367),c=n(336397),l=n(259296),u=n(727771),d=n(13457),f=n(73988),h=n(19815),p=n(446215),g=n(843544),m=n(855381),v=n(422533),y=n(298028),b={ERROR:"error",META_READY:"metaReady",META_REQ_DONE:"meta_request_done",MOOV_REQ_PROGRESS:"moov_request_progress",TASK_PROGRESS:"progress_event",REMOVE_URL:"remove_url",FRAGMENT:"fragment",UPDATE_EME:"update_eme",INIT_MSE:"init_mse",CHANGE_URL:"change_url",UPDATE_LOAD_IDX:"update_load_fragmentIdx",REMOVE_PCDN_NODE:"remove_pcdn_node",LOAD_ERROR:"load_error",CANCEL_LOADED_LEN:"cancel_loaded_len"},_={CDN:"cdn",PCDN:"pcdn"};var x=((r=x||{}).CLOSE="close",r.OPEN="open",r.FORBIDDEN="forbidden",r),k={},S=function(t){var e,n,r,a,o,x,L,R,O,T,w,D,P;function I(t,e,n,r,a){var o,l,u;return(0,i.PA)(this,I),(l=(0,i.$w)(this,I)).timeRange=[],l.adaptTimeRange=[],l.meta=null,l.preloadCache=null,l.videoTrak=void 0,l.audioTrak=void 0,l._loadSuccessCallBack=null,l._isPending=!1,l.metaLoading=!1,l.MP4Demuxer=null,l.FMP4Remuxer=null,l._needInitSegment=!0,l._bitRateInfoMap=new Map,l._switchBitRate=!1,l._segmentToBitRateMap=new Map,l.useEME=!1,l.secretKey=null,l.decryptKey=null,l.keyValue=null,l.seekTime=-1,l.changeBitRateTime=-1,l._PCDNState="close",l._pcdnNodeList=[],l.loadInfo={},l.pcdnTraceInfo=null,l._loadedDataState=!1,l._PCDNSwitchCnt=0,l._isUseCDN=!0,l._curLoadSegIdx=0,l._receiveDataPos=-1,l._optionDataLenInfo={},l._lastPCDNUrl="",l.pSCCancelCnt=0,l.lastDemuxSampleIdxRange={video:-1,audio:-1},l._mediaEndTime=-1,l.lastMuxRemainBufferInfo=null,l.firstMetMuxNotContinue=!1,l.lastTargetDur=0,l.markErrHost=function(t){t&&(k[t]=!0,l.log(c._.WARN,"[mp4loader markErrHost]",t))},l.onprogressDataArrive=(u=(0,i.x)((0,i.l5)().mark(function t(e,n,r,a){var o,s,u,f,h,m,v,x,k;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(u=null===(o=r.priOptions)||void 0===o?void 0:o.range,f=(null===(s=r.priOptions)||void 0===s?void 0:s.type)||_.CDN,l.checkResponse(a,r.priOptions)){t.next=7;break}return t.next=6,l.notVailRangeResError(a,r.priOptions,r.index);case 6:return t.abrupt("return");case 7:if(h=e&&e.byteLength>0,l.log(c._.LOG,"[DataArrive] rev data","index: ".concat(r.index,", range: ").concat(JSON.stringify(r.range),", dataLen: ").concat(null==e?void 0:e.byteLength),"loadType: ".concat(f,", state: ").concat(n)),!n){t.next=29;break}if(l._optionDataLenInfo[f]=0,!((null==u?void 0:u.length)>=0&&(!Number(u[1])||Number(u[1])&&(null==r?void 0:r.range[1])===u[1]+1))){t.next=17;break}l.adaptTimeRange[r.index].downloaded=!0,l.log(c._.LOG,"[FragLoadDowned],fragmentIdx,",r.index,",rangeEnd,",r.range[1]),t.next=29;break;case 17:return m=(0,g.xj)(a.headers),t.next=20,l.cancelLoading();case 20:if(v=f===_.CDN?l.url:l._pcdnNodeList[0].url,x=p.Z.getHostFromUrl(v),l.emit(b.LOAD_ERROR,{src:v,host:x,errorCode:d.O1.lenNotMatch,message:y.Z1,range:JSON.stringify(u),headers:m}),k=[null==r?void 0:r.range[1],u[1]],l.log(c._.LOG,"".concat(y.Z1),"fragmentIdx: ".concat(r.index),"rangeEnd: ".concat(r.range[1],", ").concat(JSON.stringify(u)),"headers: ".concat(JSON.stringify(m),", url: ").concat(v,", ").concat(null==a?void 0:a.url),"retryRange: ".concat(JSON.stringify(k))),!((null==r?void 0:r.range[1])<u[1]+1)){t.next=29;break}return l.startMux(e,f,r,n),t.next=29,l.loadAllFragmentData(l._curLoadSegIdx,l._loadSuccessCallBack,null,!1,k);case 29:h&&l.startMux(e,f,r,n);case 30:case"end":return t.stop()}},t)})),function(t,e,n,r){return u.apply(this,arguments)}),r=r||[],l.updateUrl(t,r||[]),l._bitRate=e||0,l.options=S.getDefaultConfig(),Object.keys(n).map(function(t){void 0!==n[t]&&null!==n[t]&&(l.options[t]=n[t])}),l.logger=n.logger,l.fileSize=null==n?void 0:n.fileSize,l.CHUNK_SIZE=(null===(o=l.options)||void 0===o?void 0:o.firstLoadSize)||(0,f.T)(n.duration,l.options.chunkSize,l.fileSize),l._firstLoadSize=l.CHUNK_SIZE,l.log(c._.LOG,"[getFirstLoadSize], firstLoadSize ".concat(l._firstLoadSize),"dur ".concat(n.duration,", chunkSize ").concat(l.CHUNK_SIZE,",fileSize ").concat(l.fileSize)),l.repeatInfo={startPos:-1,curDataPos:0,usedPos:0,data:p.Z.newUint8Array(1048576)},l.MP4Loader=new s.b((0,i.Zj)((0,i.Zj)({url:t,vid:"".concat(n.vid,"-").concat(e),retry:n.retryCount,retryDelay:n.retryDelay,timeout:n.timeout,segmentDuration:n.segmentDuration,audioGroupingStrategy:n.audioGroupingStrategy,fixEditListOffset:n.fixEditListOffset,fixEditListOffsetThreshold:n.fixEditListOffsetThreshold},n.reqOptions),{},{memoryOpt:n.memoryOpt,loaderType:n.loaderType,retryCheckFunc:n.loadRangeType===y.TJ.SIZE?h.mH:h.Wp,openLog:m.i5,processMaxGapTime:n.processMaxGapTime})),l.initTransMuxWorker(),l.pcdnVVStat=l.resetPcdnVVStat(),l}return(0,i.XW)(I,t),(0,i.qH)(I,[{key:"size",get:function(){return this.fileSize}},{key:"bufferTimeFuncCallBack",set:function(t){this.getbufferTimeFunc=t}},{key:"fillFirSeg",set:function(t){this.fillFirstSegment=t}},{key:"setLastMuxRemainBufferInfo",value:function(t,e){this.lastMuxRemainBufferInfo={data:t,pos:e}}},{key:"initTransMuxWorker",value:function(){var t=this,e=this.options;if(this.enableWorker=e.enableWorker&&("h265"!==e.codecType||e.supportHevc),this.enableWorker&&"undefined"!=typeof Worker){try{this.workerSequence=0,this.transmuxerWorkerControl=new v.Z({id:this.workerSequence,codecType:e.codecType,supportHevc:this.options.supportHevc,openLog:m.i5,memoryOpt:e.memoryOpt}),this.transmuxerWorkerControl.on("transmux",function(e){var n=e.args,r=n.context;t.log(c._.LOG,"[transmuxerWorker end], range: ".concat(JSON.stringify(n.range)),"dataLen: ".concat(n.buffer.byteLength),JSON.stringify(n.context)),t.updateDemuxSampleIdxRange(null==r?void 0:r.videoSampleIdxRange,null==r?void 0:r.audioSampleIdxRange),t._loadSuccessCallBack&&t._loadSuccessCallBack(n)})}catch(t){this.log(c._.ERROR,"Error in worker:",t),this.enableWorker=!1,this.transmuxerWorkerControl=null}!this.enableWorker&&(this.MP4Demuxer=null,this.FMP4Remuxer=null)}}},{key:"updateSecretKey",value:function(t,e,n,r){var i;this.useEME=t,!t&&e?(this.log(c._.LOG,"[updateSecretKey] ,force enableWorker"),this.options.enableWorker=!0,!this.transmuxerWorkerControl&&this.initTransMuxWorker()):!t&&r&&(this.keyValue=r),this.log(c._.LOG,"[updateSecretKey] ,useEME, ",t,",secretKey,",e,",decryptKey",n),null===(i=this.transmuxerWorkerControl)||void 0===i||i.updateValue({secretKey:e,decryptKey:n})}},{key:"updateLoadedDataDone",value:function(){this._loadedDataState=!0}},{key:"PCDNSwitchCnt",get:function(){return this._PCDNSwitchCnt}},{key:"updateLoadInfo",value:function(t,e){!this.loadInfo&&(this.loadInfo={}),!this.loadInfo[t]&&(this.loadInfo[t]={},this.loadInfo[t].loadLen=0),this.loadInfo[t].loadLen+=e}},{key:"updatePCDNState",value:(e=(0,i.x)((0,i.l5)().mark(function t(e){var n,r,a;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("forbidden"!==this._PCDNState&&this._PCDNState!==e&&this.log(c._.LOG,"[pcdn state update]",this._PCDNState," - ",e),"forbidden"!==e){t.next=5;break}this._PCDNState=e,t.next=25;break;case 5:if(!("forbidden"!==this._PCDNState&&this._PCDNState!==e)){t.next=25;break}if(!(!this._isUseCDN&&"close"===e)){t.next=23;break}if(this._PCDNState=e,!(this.adaptTimeRange[this._curLoadSegIdx].downloaded||this._switchBitRate)){t.next=11;break}return this.log(c._.LOG,"[pcdn] switch cdn ",this._curLoadSegIdx,"downloaded",",switchBitRate, ",this._switchBitRate),t.abrupt("return");case 11:return t.next=13,this.cancelLoading();case 13:return this.pSCCancelCnt++,n=this._curLoadSegIdx,this.log(c._.LOG,"[pcdn] cancelLoading ",n,"switch cdn load"),r=this.getFragRange(n),this._receiveDataPos&&r&&this._receiveDataPos>=r[0]&&this._receiveDataPos<=r[1]&&(a=[this._receiveDataPos,r[1]],this.log(c._.LOG,"[pcdn] switch cdn, adjust range",n,JSON.stringify(a),",oldRange,","".concat(r[0]," - ").concat(r[1]))),this._receiveDataPos=-1,t.next=21,this.startLoad(a||r,n);case 21:t.next=24;break;case 23:this._PCDNState=e;case 24:this.log(c._.LOG,"[pcdn] openPCDN ",e);case 25:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"updateNode",value:function(t){if(t&&t.length>0){var e=t.filter(function(t){if(!Object.prototype.hasOwnProperty.call(k,p.Z.getHostFromUrl(null==t?void 0:t.url)))return t});this._pcdnNodeList=e}}},{key:"clearPCDNNodeList",value:function(){this.log(c._.LOG,"[pcdn] clearPCDNNodeList"),this._pcdnNodeList=[]}},{key:"isUpdateNode",get:function(){return!this._pcdnNodeList||!this._pcdnNodeList.length}},{key:"isUsePCDN",value:function(){var t;return"open"===this._PCDNState&&(null===(t=this._pcdnNodeList)||void 0===t?void 0:t.length)>0}},{key:"readyToChangeBitrate",value:function(t){this._switchBitRate=!0,this.changeBitrateInfo=t}},{key:"changeBitRate",value:(n=(0,i.x)((0,i.l5)().mark(function t(){var e;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!((e=this.changeBitrateInfo).bitrate!==this._bitRate)){t.next=11;break}return this.updateUrl(e._mainURL,e._backupURL),this._bitRate=e.bitrate,this._receiveDataPos=-1,t.next=7,this.MP4Loader.changeUrl(this.url,"".concat(this.options.vid,"-").concat(this._bitRate),this.CHUNK_SIZE);case 7:this._pcdnNodeList=[],this.emit(b.CHANGE_URL,this.url),this._mediaEndTime=-1,this.log(c._.LOG,"[switchBitrate] changeUrl, bitRate,",this._bitRate,"url",this.url);case 11:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"_getByPreload",value:function(t,e,n,r){try{if(t&&t.byteLength>=e){var i={endTime:new Date().getTime(),startTime:new Date().getTime(),index:r,range:[],vid:this.options.vid,from:"local",state:!1};if(n<=t.byteLength){var a=t.slice(e,n);return i.range=[e,n],i.state=!0,{buffer:a,context:i,state:!0}}var o=t.byteLength-1,s=t.slice(e,o);return i.range=[e,o],{context:i,buffer:s,state:!1}}return null}catch(t){return null}}},{key:"log",value:function(t,e){for(var n=this.options,r=n&&n.vid?"[MP4]".concat(this.logTag," ").concat(n.vid," ").concat(e):"[MP4]".concat(this.logTag," ").concat(e),i=arguments.length,a=Array(i>2?i-2:0),o=2;o<i;o++)a[o-2]=arguments[o];m.cM.apply(void 0,[this.logger,t,r].concat(a))}},{key:"errorHandler",value:(r=(0,i.x)((0,i.l5)().mark(function t(e,n){var r,a,o,s,l,u,f,h,p,g,m,v,y,_=arguments;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=_.length>2&&void 0!==_[2]?_[2]:{},a=e.response,o=e.message,s=e.headers,l=this.options?this.options.vid:"",u=null,this._isPending=!0,!a){t.next=38;break}if(u=new d.oO("network",a.status,{httpText:a.httpText,message:o,url:a.url,range:r.range,headers:s}),this.log(c._.LOG,"[MP4] [".concat(l,"] errorHandler error state:[").concat(n,"],\n          _isPending:[").concat(this._isPending,"] "),null==a?void 0:a.status,o),!(1e3*(p=null===(f=this.getbufferTimeFunc)||void 0===f?void 0:f.call(this))>=this.options.timeout||(null===(h=this.backUrl)||void 0===h?void 0:h.length)>0)){t.next=32;break}if(!((null===(m=this.backUrl)||void 0===m?void 0:m.length)>0)){t.next=19;break}return g=this.backUrl.shift(),t.next=14,this.updateUrl(g,this.backUrl);case 14:if(this._isPending=!1,!this.MP4Loader){t.next=19;break}return t.next=18,this.MP4Loader.changeUrl(this.url,"".concat(this.url,"-").concat(this._bitRate),this.CHUNK_SIZE);case 18:this.emit(b.CHANGE_URL,this.url);case 19:if(this._isPending=!1,this.log(c._.LOG,"[".concat(l,"] errorHandler retry,backUrlLen:").concat(this.backUrl.length,", buffer:").concat(p,",").concat(g)),this.emit(b.TASK_PROGRESS,{type:"error",error:e}),"getMetaInfo"!==n){t.next=27;break}return this.getMetaInfo(),t.abrupt("return");case 27:if("loadFragment"!==n){t.next=32;break}if(v=r.fragIndex,y=r.range,!(null!==v&&v>=0&&y)){t.next=32;break}return this.startLoad(y,v),t.abrupt("return");case 32:u.context=r,u.response=a,this.log(c._.LOG,"errorHandler end, ".concat(JSON.stringify(r))),this.emit(b.ERROR,u,n),t.next=42;break;case 38:this.log(c._.LOG,"errorHandler other end, ".concat(n,",").concat(null==a?void 0:a.status,", ").concat(o)),(u=e)&&(u.context=r),this.emit(b.ERROR,u,n);case 42:case"end":return t.stop()}},t,this)})),function(t,e){return r.apply(this,arguments)})},{key:"init",value:(a=(0,i.x)((0,i.l5)().mark(function t(e){var n,r,a,o,s,l,u,d,f,h,g,m,v,_,x,k;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e&&(e={}),!(this.options.loadRangeType===y.TJ.SIZE&&this.MP4Loader.url!==this.url)){t.next=4;break}return t.next=4,this.MP4Loader.changeUrl(this.url,"".concat(this.options.vid,"-").concat(this._bitRate),this.CHUNK_SIZE);case 4:if(this.emit(b.CHANGE_URL,this.url),this.meta=null,r=(n=e).meta,a=n.mediaSegList,o=n.buffer,s=n.fileSize,l=n.initSeg,u=n.bitrate,d=n.adaptTimeRange,f=n.repeatData,h=n.repeatDataStartPos,g=n.generateBy,!(r&&r.ext)){t.next=24;break}if(s&&(this.fileSize=s),this.meta=r,this.videoTrak=r.ext.videoTrak,this.audioTrak=r.ext.audioTrak,this._bitRate=u,this.timeRange=this.getTimeRange(),this.adaptTimeRange=p.Z.ArrayCopy(d),a?(this.preloadCache={segList:a||[],initSeg:l},(null===(m=this.adaptTimeRange)||void 0===m?void 0:m.length)>0&&(null==f?void 0:f.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].repeatRange,this.adaptTimeRange[0].repeatRange,f),h>0&&(null==f?void 0:f.byteLength)>0&&(this.lastMuxRemainBufferInfo={data:f,pos:h})):o&&(null===(v=this.adaptTimeRange)||void 0===v?void 0:v.length)>0&&(null==o?void 0:o.byteLength)>0&&this.cacheRepeatData(this.adaptTimeRange[0].range,this.adaptTimeRange[0].range,o),"preloader"!==g&&(this.adaptTimeRange.map(function(t){t.downloaded=!1,t.isLoading=!1}),this.log(c._.LOG,"[mp4.init] reset adaptTimeRange")),this.options.loadRangeType===y.TJ.GOP)for(_=0;_<(null===(x=this.adaptTimeRange)||void 0===x?void 0:x.length);_++)this.updateTimeRangeInAdaptTimeRangeIdx(this.adaptTimeRange[_].timeRangeIdx,_);k={meta:r,videoSegments:r.ext.videoTrak,audioSegments:r.ext.audioTrak,bufferLoaded:o||null},this.log(c._.LOG,"preloadCache init done, emit meta ready"),this._bitRateInfoMap.set(this._bitRate,k),this.emit(b.META_READY,this.meta,this),t.next=26;break;case 24:return t.next=26,this.getMetaInfo();case 26:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"updateTimeRangeInAdaptTimeRangeIdx",value:function(t,e){if(!!(null!=t&&t.length))for(var n=t[0];n<t[1];n++)n<this.timeRange.length&&(this.timeRange[n].adaptTimeRangeIdx=e)}},{key:"getTimeRange",value:function(){for(var t,e=[],n=null,r=0;this.videoTrak&&r<this.videoTrak.length;r++){var i=this.videoTrak[r].startTime,a=this.videoTrak[r].endTime;n={startTime:i,endTime:a,duration:a-i,downloaded:!1,isLoading:!1},e.push(n)}if(this.audioTrak&&this.audioTrak.length>e.length)for(var o=e.length;o<this.audioTrak.length;o++){var s=Math.max(this.audioTrak[o].startTime,n?n.endTime:0),c=Math.max(this.audioTrak[o].endTime,n?n.endTime:0);n={startTime:s,endTime:c,duration:c-s,downloaded:!1,isLoading:!1},e.push(n)}return null!==(t=this.options)&&void 0!==t&&t.emitMediaListControl&&this._emitMediaList(e),e}},{key:"_emitMediaList",value:function(t){if(!!this.videoTrak||!!this.audioTrak){for(var e=[],n=0;n<t.length;n++){var r=t[n].startTime,a=this.getFragmentIdx(r),o=p.Z.getFragRange(a,this.videoTrak,this.audioTrak);e.push((0,i.Zj)((0,i.Zj)({},t[n]),{},{range:o,url:this._addRangeToUrl(this.url,o)}))}this.emit(y.fD.MEDIA_LIST,e)}}},{key:"_addRangeToUrl",value:function(t,e){return this.options.isAddRange?p.Z.extUrl(t,{range:"".concat(e[0],"-").concat(e[1])}):t}},{key:"getMetaInfo",value:(o=(0,i.x)((0,i.l5)().mark(function t(){var e=this,n,r,a,o,s=arguments;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!(s.length>0)||void 0===s[0]||s[0],t.prev=1,r=-1,this.metaLoading=!0,this.log(c._.LOG,"getMetaInfo start, bitRate: ".concat(this._bitRate,", firstLoadSize: ").concat(this._firstLoadSize),"url: ".concat(this.MP4Loader.url)),this.resetRepeatInfo(),a=function(){var t=(0,i.x)((0,i.l5)().mark(function t(a,o,s,l,u){var f,h,m,v,y,x,k;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!l){t.next=6;break}return t.next=3,e.cancelLoading();case 3:return h=new d.zO(d.iR.DEMUX,d.O1.metaError,{msg:JSON.stringify(l)}),e.errorHandler(h,"getMetaInfo",{range:[0,e._firstLoadSize]}),t.abrupt("return");case 6:m=(null==s||null===(f=s.priOptions)||void 0===f?void 0:f.type)||_.CDN,a&&(null!==(v=e.options)&&void 0!==v&&v.memoryOpt?r>0?(e.partCacheRepeatData(r),e.cacheRepeatData([r,e._firstLoadSize],s.range,a)):(e.resetRepeatInfo(),e.cacheRepeatData(s.range,s.range,a)):e.cacheRepeatData([0,e._firstLoadSize],s.range,a),e._optionDataLenInfo[m]||(e._optionDataLenInfo[m]=0),e._optionDataLenInfo[m]+=a.byteLength),s.meta&&!e.meta&&(x=s.meta,e.videoTrak=x.videoSegments,e.audioTrak=x.audioSegments,null!==(y=e.options)&&void 0!==y&&y.memoryOpt&&(r=p.Z.getFirstFrameStartRange(e.videoTrak,e.audioTrak)),e.fileSize=Number((0,g.Xz)(u.headers)),!e.fileSize&&(e.fileSize=p.Z.getEndFramePos(e.videoTrak,e.audioTrak)),e.log(c._.LOG," getFirstFrameStartRange ".concat(r)),e.timeRange=e.getTimeRange(),e.meta=(0,i.Zj)((0,i.Zj)({},x.meta),{},{ext:{videoTrak:e.videoTrak,audioTrak:e.audioTrak},fileSize:e.fileSize}),e._bitRateInfoMap.set(e._bitRate,(0,i.Zj)((0,i.Zj)({},x),{},{fileSize:e.fileSize})),e.log(c._.LOG,"meta reach, bitRate,",e._bitRate,e.repeatInfo.curDataPos),n&&e.emit(b.META_READY,e.meta,e)),e.meta&&o&&(e.log(c._.LOG,"[getMetaInfo req end]",e.repeatInfo.curDataPos),e.metaLoading=!1),o&&(e._optionDataLenInfo[m]&&(e._optionDataLenInfo[m]=0),e.emit(b.META_REQ_DONE,e)),e._loadedDataState?(k=!1,e.repeatInfo.curDataPos-e.repeatInfo.usedPos>=e.options.afterLoadeddataCallBackLen&&(k=!0),e.meta&&(k||o)&&(e.log(c._.LOG,"emit moov_req_progress loadeddata after",JSON.stringify(s.range)),e.emit(b.MOOV_REQ_PROGRESS))):e.meta&&(a||o)&&(e.log(c._.LOG,"emit moov_req_progress loadeddata before",JSON.stringify(s.range)),e.emit(b.MOOV_REQ_PROGRESS));case 12:case"end":return t.stop()}},t)}));return function(e,n,r,i,a){return t.apply(this,arguments)}}(),t.next=9,this.MP4Loader.loadMetaProcess(this.MP4Loader.cache,[0,this._firstLoadSize],a);case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(1),this.log(c._.ERROR,"[MP4] trigger errorHandler getMetaInfo",null===t.t0||void 0===t.t0||null===(o=t.t0.response)||void 0===o?void 0:o.status,null===t.t0||void 0===t.t0?void 0:t.t0.message),this.loadError(t.t0,"getMetaInfo",!1,{url:t.t0.url||this.url,range:[0,this._firstLoadSize]});case 15:case"end":return t.stop()}},t,this,[[1,11]])})),function(){return o.apply(this,arguments)})},{key:"getFragmentIdx",value:function(t){if(!(null!==(e=this.videoTrak)&&void 0!==e&&e.length))return(r=null===(i=this.audioTrak)||void 0===i?void 0:i.find(function(e){return e.startTime<=t&&e.endTime>t}))?r.index:0;if(n=null===(a=this.videoTrak)||void 0===a?void 0:a.find(function(e){return e.startTime<=t&&e.endTime>t}),r=null===(o=this.audioTrak)||void 0===o?void 0:o.find(function(e){return e.startTime<=t&&e.endTime>t}),n&&r)return Math.min(n.index,r.index);if(n||r)return n?n.index:r.index;else{var e,n,r,i,a,o,s=Number.MAX_VALUE;return this.videoTrak&&this.videoTrak.length>0&&(s=this.videoTrak.length-1),this.audioTrak&&this.audioTrak.length>0&&(s=Math.min(this.audioTrak.length-1,s)),s}}},{key:"_checkHasMeta",value:(x=(0,i.x)((0,i.l5)().mark(function t(){var e,n,r,a,o,s,l;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=this._bitRateInfoMap.get(this._bitRate)){t.next=20;break}return this.log(c._.LOG,"[switchBitrate], need load InitSegment, bitRate, ",this._bitRate),this.metaLoading=!0,t.next=6,this.MP4Loader.loadMeta(this.MP4Loader.cache,Math.round(this.CHUNK_SIZE/2));case 6:r=t.sent,this.log(c._.LOG,"[switchBitrate], loadMeta end, ",this._bitRate),this.metaLoading=!1,a=Number((0,g.Xz)(null==r||null===(n=r.responses)||void 0===n||null===(n=n[0])||void 0===n||null===(n=n.response)||void 0===n?void 0:n.headers)),this.fileSize=a,o=r.videoSegments,s=r.audioSegments,!this.fileSize&&(this.fileSize=p.Z.getEndFramePos(o,s)),this.log(c._.LOG,"[switchBitrate], fileSize set , ",a),this.meta=(0,i.Zj)((0,i.Zj)({},r.meta),{},{ext:{videoTrak:o,audioTrak:s},fileSize:this.fileSize}),(e=r).fileSize=this.fileSize,this._bitRateInfoMap.set(this._bitRate,r),t.next=22;break;case 20:this.log(c._.LOG,"[switchBitrate], not need load InitSegment, bitRate, ",this._bitRate),this.meta=e.meta;case 22:if(this.videoTrak=e.videoSegments,this.audioTrak=e.audioSegments,this.fileSize=e.fileSize,this.emit(b.UPDATE_EME,this.meta),this.emit(b.INIT_MSE,this.meta),this.timeRange=this.getTimeRange(),this.options.loadRangeType===y.TJ.GOP)for(l=0;l<this.adaptTimeRange.length;l++)this.updateTimeRangeInAdaptTimeRangeIdx(this.adaptTimeRange[l].timeRangeIdx,l);return this._firstLoadSize=0,t.abrupt("return",!0);case 31:case"end":return t.stop()}},t,this)})),function(){return x.apply(this,arguments)})},{key:"load",value:(L=(0,i.x)((0,i.l5)().mark(function t(e,n){var r,a,o,s,l,u,d,f,h,p,g,m,v,_;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._loadSuccessCallBack=n,!(this._switchBitRate&&!this.metaLoading)){t.next=29;break}if(this.log(c._.LOG,"[switchBitrate], switch bitRate start load, bitRate,",this._bitRate,", fragIndex,",e),this.fillGopDataInfo){t.next=29;break}return this.log(c._.LOG,"[switchBitrate] changeBitrate~~"),t.next=7,this.changeBitRate();case 7:return t.next=9,this._checkHasMeta();case 9:if(r=t.sent,!(this.changeBitRateTime>0)){t.next=26;break}if(this.resetFragmentLoadState(e,!0),this.resetRepeatInfo(),this.resetDemuxSampleIdx(this.changeBitRateTime),a=this.getFragmentIdx(this.changeBitRateTime),o=e,!((e=this.getAdaptIdxBySrcIdx(a))<0)){t.next=20;break}return this.log(c._.ERROR,"[switchBitrate] start new bitrate fragIndex error"),t.abrupt("return");case 20:o!==e&&this.resetFragmentLoadState(e),this._curLoadSegIdx=e,this.log(c._.LOG,"[switchBitrate], need update load fragIndex: ".concat(e,"/").concat(o),"stTime: ".concat(this.changeBitRateTime),"adaptTimeRange: ".concat(this.adaptTimeRange[e].startTime,"-").concat(this.adaptTimeRange[e].endTime)),this.emit(b.UPDATE_LOAD_IDX,e),this.seekTime=this.changeBitRateTime,this.changeBitRateTime=-1;case 26:this._needInitSegment=!0,this.resetTransmuxer(),r&&(this._switchBitRate=!1);case 29:if(!(!this.fillGopDataInfo&&this._switchBitRate&&this.metaLoading)){t.next=31;break}return t.abrupt("return");case 31:s=this.getFragRange(e),(l=this.getFragmentFromCache(e,s))&&this._needInitSegment&&!l.initSeg&&(l=null,this.log(c._.LOG,"[mp4.load] fragIndex ".concat(e,", Data In Cache but not has init, so not use cacheData"))),(this.seekTime<0||this.options.loadRangeType===y.TJ.GOP)&&l?(d=(u=l.muxSampleIdxRange).video,f=u.audio,this.lastDemuxSampleIdxRange.video=d,this.lastDemuxSampleIdxRange.audio=f,this.log(c._.LOG,"[mp4.load] fragIndex: ".concat(e," Data In Cache"),"needInit: ".concat(this._needInitSegment,", muxSampleIdxRange: ").concat(JSON.stringify(l.muxSampleIdxRange)),JSON.stringify(s)),this.adaptTimeRange[e].downloaded=!0,this.adaptTimeRange[e].isLoading=!0,this._needInitSegment=!1,this._loadSuccessCallBack&&this._loadSuccessCallBack(l)):(h=s?[s[0],s[1]]:void 0,p=this.seekTime,this.fillGopDataInfo&&s&&s[0]<this.fillGopDataInfo.endRange&&(s[1]=this.fillGopDataInfo.endRange,this.log(c._.LOG,"[switchBitrate] fillGopDataInfo fix load range ~~")),this.log(c._.LOG,"loadFragment ".concat(e),"bitRate: ".concat(this._bitRate,", range: ").concat(JSON.stringify(s)),"fillGopDataInfo: ".concat(JSON.stringify(this.fillGopDataInfo),", srcRange: ").concat(h,", seekTime: ").concat(p)),p>=0?(_=this.getSubRange(e,p,s),null!==(g=this.options)&&void 0!==g&&g.enableMsePatches&&(this.seekTime=-1),null===(m=this.resetDemuxSampleIdx)||void 0===m||m.call(this,p),this.repeatInfo.usedPos=0,this.loadFragment(e,_),this.repeatInfo.curDataPos=0,!(null!==(v=this.options)&&void 0!==v&&v.enableMsePatches)&&(this.seekTime=-1)):this.loadFragment(e,s));case 35:case"end":return t.stop()}},t,this)})),function(t,e){return L.apply(this,arguments)})},{key:"getFragmentFromCache",value:function(t,e){var n=this.preloadCache;if(!n||!n.segList)return null;for(var r=-1,i=n.segList,a=n.initSeg,o=0;o<i.length;o++)if(i[o].index===t){r=o;break}if(r<0)return null;var s=i[r];if(!(s.range[1]>=e[1]))return null;var c=[this.adaptTimeRange[t].startTime,this.adaptTimeRange[t].endTime];return{buffer:s.buffer,range:e,muxSampleIdxRange:s.muxSampleIdxRange,context:{range:e,fragIndex:t,state:!0,adaptTimeRange:[c[0],c[1]]},state:!0,initSeg:this._needInitSegment?a:void 0}}},{key:"notVailRangeResError",value:(R=(0,i.x)((0,i.l5)().mark(function t(e,n,r){var a,o=arguments;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o.length>3&&void 0!==o[3]&&o[3]){t.next=4;break}return t.next=4,this.cancelLoading();case 4:a=(null==n?void 0:n.load_type)===_.PCDN,this.loadError({response:e,message:(null==e?void 0:e.status)!==206?"responseCode not 206":"datalen not match"},"loadFragment",a,{range:null==n?void 0:n.range,fragIndex:r});case 6:case"end":return t.stop()}},t,this)})),function(t,e,n){return R.apply(this,arguments)})},{key:"checkResponse",value:function(t,e){if(t.hasCheck)return!0;t.hasCheck=!0;var n=e.range?e.range[1]-e.range[0]+1:-1,r=Number((0,g.He)(t.headers));return(null==t?void 0:t.status)===206&&(!(n>0)||!(r>0)||n===r)||(this.log(c._.LOG,"[DataArrive] response code, ".concat(t.status,",\n        contentLength: ").concat(r,",\n        reqLen: ").concat(n)),!1)}},{key:"startMux",value:function(t,e,n,r){if(!!(null!=t&&t.byteLength))this._optionDataLenInfo[e]||(this._optionDataLenInfo[e]=0),this._optionDataLenInfo[e]+=t.byteLength,this._receiveDataPos=null==n?void 0:n.range[1],this.cacheRepeatData(this.adaptTimeRange[n.index].repeatRange,n.range,t),this._mux(t,n.range[0],n.index,r)}},{key:"partCacheRepeatData",value:function(t){if(!this.repeatInfo)return;var e=this.repeatInfo,n=e.curDataPos,r=e.startPos,i=e.usedPos;if(!(n<=0)&&!(r>t)&&!(r+n<r)&&t!==r)this.log(c._.LOG,"[partCacheRepeatData bebore],startPos: ".concat(r),",usedPos: ".concat(this.repeatInfo.usedPos),"curDataPos: ".concat(n)),this.repeatInfo.data.set(this.repeatInfo.data.subarray(t-r,r+n),0),this.repeatInfo.usedPos=Math.max(r+i-t,0),this.repeatInfo.curDataPos=r+n-t,this.repeatInfo.startPos=t,this.log(c._.LOG,"[partCacheRepeatData after],startPos: ".concat(this.repeatInfo.startPos),",usedPos: ".concat(this.repeatInfo.usedPos),"curDataPos: ".concat(this.repeatInfo.curDataPos))}},{key:"cacheRepeatData",value:function(t,e,n){var r;if(!!t&&!!(null!=t&&t.length)&&!!(null!==(r=this.repeatInfo.data)&&void 0!==r&&r.byteLength)&&!this.options.disableRepeatRange){if(this.repeatInfo.startPos<0&&e[0]+n.byteLength>=t[0]&&e[0]+n.byteLength<=t[1]+1&&(this.repeatInfo.startPos=t[0]),this.repeatInfo.startPos>=0&&e[0]+n.byteLength>=t[0]&&e[0]+n.byteLength<=t[1]+1){var i=this.repeatInfo.startPos+this.repeatInfo.curDataPos-e[0];if(i<0)return;var a=n.subarray(i);if(this.repeatInfo.curDataPos+a.byteLength<this.repeatInfo.data.byteLength){try{this.repeatInfo.data.set(a,this.repeatInfo.curDataPos),this.repeatInfo.curDataPos+=a.byteLength}catch(t){}this.log(c._.LOG,"repeatInfo pos: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos),"curAppendLen: ".concat(a.byteLength))}else try{var o=2*n.byteLength,s=Math.max(this.repeatInfo.data.byteLength+o,t[1]-t[0]+o),l=p.Z.newUint8Array(s);if(!l)return;l.set(this.repeatInfo.data.slice(0,this.repeatInfo.curDataPos),0),l.set(a,this.repeatInfo.curDataPos),this.repeatInfo.curDataPos+=a.byteLength,delete this.repeatInfo.data,this.repeatInfo.data=l,this.log(c._.LOG,"exp repeatInfo pos: ".concat(this.repeatInfo.startPos,", curDataPos: ").concat(this.repeatInfo.curDataPos,", capacity: ").concat(s))}catch(t){}}}}},{key:"_mux",value:function(t,e,n,r){var a=this.getSamplesRange(n,"video"),o=this.getSamplesRange(n,"audio");if(this.fillFirstSegment&&(this.log(c._.LOG,"mux sampleRange, fillFirstSegment",r),a&&(a[1]=1/0),o&&(o[1]=1/0),r&&(this.fillFirstSegment=!1)),this.fillGopDataInfo){this.log(c._.LOG,"mux sampleRange, fillGopDataInfo",JSON.stringify(this.fillGopDataInfo));var s=this.fillGopDataInfo,f=s.endVFrameIdx,h=s.endAFrameIdx;f>=0&&a&&(null==a?void 0:a[1])>f&&(null==a?void 0:a[0])<=f&&a[1]&&(a[1]=f),h>=0&&o&&(null==o?void 0:o[1])>h&&(null==o?void 0:o[0])<=h&&o[1]&&(o[1]=h)}this.log(c._.LOG,"mux sampleRange:",JSON.stringify(a),JSON.stringify(o));var g=[e,e+t.byteLength];if(this.transmuxerWorkerControl){var v,b,_={range:g,state:r,fragIndex:n};this.log(c._.LOG,"[transmuxerWorker start] range: ".concat(JSON.stringify(g)),",dataLen: ".concat(t.byteLength),_);var x=null!==(v=this.lastMuxRemainBufferInfo)&&void 0!==v&&v.data?new Uint8Array(this.lastMuxRemainBufferInfo.data):null,k=null===(b=this.lastMuxRemainBufferInfo)||void 0===b?void 0:b.pos;this.lastMuxRemainBufferInfo=null;var S=this.transmuxerWorkerHasTrak;!this.transmuxerWorkerHasTrak&&(this.transmuxerWorkerHasTrak=!0),this.transmuxerWorkerControl.transmux(this.workerSequence,t,e,a,o,this.meta.moov,this.useEME,this.secretKey,_,S?null:this.videoTrak,S?null:this.audioTrak,x,k)}else{var L=this.options,R=L.memoryOpt,O=L.softDecode;try{!this.MP4Demuxer&&(this.MP4Demuxer=new l._(this.videoTrak,this.audioTrak,null,{openLog:m.i5,memoryOpt:R})),this.lastMuxRemainBufferInfo&&(this.MP4Demuxer.setLastRemainBufferInfo(this.lastMuxRemainBufferInfo.data,this.lastMuxRemainBufferInfo.pos),this.lastMuxRemainBufferInfo=null);var T,w,D,P,I=this.MP4Demuxer.demuxPart(t,e,a,o,this.meta.moov,this.useEME,this.keyValue);!this.FMP4Remuxer&&!O&&(!this.checkCodecH265()||this.options.supportHevc)&&(this.FMP4Remuxer=new u.N(this.MP4Demuxer.videoTrack,this.MP4Demuxer.audioTrack,{openLog:m.i5}));var C=I.videoTrack,E=I.audioTrack,N=I.lastRemainBufferInfo,M=null==C?void 0:C.samples,A=(null==M?void 0:M.length)>0?M[0].sampleOffset:-1,j=(null==M?void 0:M.length)>0?M[M.length-1].sampleOffset:-1,G=null==E?void 0:E.samples,F=(null==G?void 0:G.length)>0?G[0].sampleOffset:-1,B=(null==G?void 0:G.length)>0?G[G.length-1].sampleOffset:-1,U=this.meta.videoTimescale,H=(null==M?void 0:M.length)>0?M[0].dts/U:-1,Z=(null==M?void 0:M.length)>0?M[M.length-1].dts/U:-1,W=r||(null==G?void 0:G.length)>0?null==I||null===(T=I.audioTrack)||void 0===T?void 0:T.startPts:-1,J=r||(null==G?void 0:G.length)>0?null==I||null===(w=I.audioTrack)||void 0===w?void 0:w.endPts:-1;if(this.log(c._.LOG,"[mux] ".concat(n),",videoTimeRange: ".concat(H,"-").concat(Z),",videoSampleIdx: ".concat(A,"-").concat(j),",audioTimeRange: ".concat(W,"-").concat(J),",audioSampleIdx: ".concat(F,"-").concat(B),JSON.stringify(g),r),A>=0&&A!==(null==a?void 0:a[0])||F>=0&&F!==(null==o?void 0:o[0])){this.log(c._.LOG,"mux sample is not continue, so abandon"),!this.firstMetMuxNotContinue&&(this.firstMetMuxNotContinue=!0,this.log(c._.LOG,"emit firstMetMuxNotContinue"),this.emit(y.fD.FIRST_MET_MUX_NOT_CONTINUE));return}this.updateDemuxSampleIdxRange([A,j],[F,B]);var z=[Math.min.apply(Math,(0,i.u)([H,W].filter(function(t){return -1!==t}))),Math.max.apply(Math,(0,i.u)([Z,J].filter(function(t){return -1!==t})))];if(this.FMP4Remuxer){var V=this.FMP4Remuxer.remux(this._needInitSegment,{initMerge:!0,range:g});V.initSegment&&(this._needInitSegment=!1),P={buffer:p.Z.concatData(V.audioSegment,V.videoSegment),range:g,state:r,context:{range:g,fragIndex:n,timeRange:z},initSeg:V.initSegment,lastRemainBufferInfo:N,mp4:this}}else P={videoTrack:I.videoTrack,audioTrack:I.audioTrack,buffer:null,range:g,state:r,context:{range:g,fragIndex:n,timeRange:z},lastRemainBufferInfo:N,mp4:this};(null==g?void 0:g[1])>=(null===(D=this.fillGopDataInfo)||void 0===D?void 0:D.endRange)&&(this.fillGopDataInfo=null,this.log(c._.LOG,"clear fillGopDataInfo")),this._loadSuccessCallBack&&this._loadSuccessCallBack(P)}catch(r){var q=null==r?void 0:r.message;this.log(c._.ERROR,"mux err:",q);var X=new d.zO(d.iR.REMUX,d.O1.muxError,{msg:q});this.errorHandler(X,"mux",{fragIndex:n,range:[e,e+t.byteLength]})}}}},{key:"updateDemuxSampleIdxRange",value:function(t,e){t&&t[1]>=0&&(this.lastDemuxSampleIdxRange.video=t[1]),e&&e[1]>=0&&(this.lastDemuxSampleIdxRange.audio=e[1]),this.log(c._.LOG,"updateDemuxSampleIdxRange",JSON.stringify(this.lastDemuxSampleIdxRange))}},{key:"resetDemuxSampleIdx",value:function(t){if(t){var e=this.videoTrak,n=this.audioTrak;if(e&&(null==e?void 0:e.length)>0){var r=e.find(function(e){return e.startTime<=t&&e.endTime>t});if(r){var i=r.frames;this.lastDemuxSampleIdxRange.video=i[0].index-1}}if(n&&(null==n?void 0:n.length)>0){var a=n.find(function(e){return e.startTime<=t&&e.endTime>t});if(a){var o=a.frames;this.lastDemuxSampleIdxRange.audio=o[0].index-1}}}else this.lastDemuxSampleIdxRange={video:-1,audio:-1};this.log(c._.LOG,"resetDemuxSampleIdx",t,JSON.stringify(this.lastDemuxSampleIdxRange))}},{key:"loadFragment",value:(O=(0,i.x)((0,i.l5)().mark(function t(e,n){var r,a,o,s,l,u,d,f,h,p,g,m,v,y,b,_,x;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._curLoadSegIdx=e,!(this._isPending||(null==n?void 0:n[1])===0||!this.adaptTimeRange[e]||this.adaptTimeRange[e].isLoading||(null==n?void 0:n.length)===0)){t.next=3;break}return t.abrupt("return");case 3:if(this.log(c._.LOG,"[MP4.loadFragment] fragIndex: ".concat(e),",range: ".concat(JSON.stringify(n),", len: ").concat(n[1]-n[0],","),"repeatInfo: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos)),this._segmentToBitRateMap.set(e,this._bitRate),!(n.length>=2&&n[1]&&n[1]>0&&n[0]>=this.repeatInfo.startPos&&n[1]<this.repeatInfo.startPos+this.repeatInfo.curDataPos)){t.next=16;break}this.adaptTimeRange[e].isLoading=!0,r=Math.max(n[0],this.repeatInfo.startPos+this.repeatInfo.usedPos),a=new Uint8Array(this.repeatInfo.data.slice(r-this.repeatInfo.startPos,n[1]-this.repeatInfo.startPos+1)),this.log(c._.LOG,"[mp4.loadFragment] fragIndex: ".concat(e),"has all data: ".concat(r,", ").concat(n[1]),"repeatInfo: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.usedPos),"curDataPos: ".concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos)),this.adaptTimeRange[e].downloaded=!0,o=this.adaptTimeRange[e].range,!this.metaLoading&&0!==this.repeatInfo.startPos&&o?(s=o[0]-this.repeatInfo.startPos,l=o[1]+1-this.repeatInfo.startPos,u=new Uint8Array(this.repeatInfo.data.slice(s,l)),this.resetRepeatInfo(),this.cacheRepeatData(this.adaptTimeRange[e].repeatRange,o,u)):(this.repeatInfo.usedPos=0,this.log(c._.LOG,"[mp4.loadFragment] has all data set repeatInfo.usedPos = 0")),this._mux(a,r,e,!0),t.next=43;break;case 16:if(!(n.length>=2&&n[0]&&n[0]>=this.repeatInfo.startPos&&n[0]<=this.repeatInfo.startPos+this.repeatInfo.curDataPos)){t.next=37;break}if(this.adaptTimeRange[e].isLoading){t.next=35;break}if(d=Math.max(n[0],this.repeatInfo.startPos+this.repeatInfo.usedPos),f=Math.min(n[1]+1,this.repeatInfo.startPos+this.repeatInfo.curDataPos),!((h=new Uint8Array(this.repeatInfo.data.slice(d-this.repeatInfo.startPos,f-this.repeatInfo.startPos))).byteLength>0)){t.next=27;break}return this.repeatInfo.usedPos=f-this.repeatInfo.startPos,this.log(c._.LOG,"[mp4.loadFragment] has part data: ",d,d+h.byteLength),this.log(c._.LOG,"[mp4.loadFragment] ","repeatInfo, pos: ".concat(this.repeatInfo.startPos,"-").concat(this.repeatInfo.startPos+this.repeatInfo.usedPos),",curDataPos: ".concat(this.repeatInfo.startPos+this.repeatInfo.curDataPos,", usedPos: ").concat(this.repeatInfo.usedPos)),this._mux(h,d,e,n[1]<=this.repeatInfo.startPos+this.repeatInfo.usedPos),t.abrupt("return");case 27:if(!(!this.metaLoading&&!this.adaptTimeRange[e].isLoading)){t.next=35;break}return this.log(c._.LOG,"[mp4.loadFragment] load part data >>> ",this.repeatInfo.startPos+this.repeatInfo.curDataPos,n[1]),this.adaptTimeRange[e].isLoading=!0,g=[this.repeatInfo.startPos+this.repeatInfo.usedPos,n[1]],(m=null===(p=this.adaptTimeRange[e])||void 0===p?void 0:p.repeatRange)&&m[0]<g[0]?(v=[m[0],g[0]],b=(y=this.repeatInfo).startPos,_=y.curDataPos,x=y.data.slice(v[0]-b,_),this.resetRepeatInfo(),this.cacheRepeatData(this.adaptTimeRange[e].repeatRange,v,x)):this.resetRepeatInfo(),t.next=35,this.startLoad(g,e);case 35:t.next=43;break;case 37:if(!((!this.metaLoading||n[0]>this.repeatInfo.startPos)&&!this.adaptTimeRange[e].isLoading)){t.next=43;break}return this.adaptTimeRange[e].isLoading=!0,this.log(c._.LOG,"[mp4.loadFragment] ready to load all data ,fragIdx: ".concat(e,", range: ").concat(n)),this.resetRepeatInfo(),t.next=43,this.startLoad(n,e);case 43:case"end":return t.stop()}},t,this)})),function(t,e){return O.apply(this,arguments)})},{key:"resetRepeatInfo",value:function(){this.log(c._.LOG,", resetRepeatInfo"),this.repeatInfo.startPos=-1,this.repeatInfo.curDataPos=0,this.repeatInfo.usedPos=0}},{key:"setSwitchPCDNCallBack",value:function(t){this._switchPCDNCallBack=t}},{key:"updateChangeBitRateTime",value:function(t){this.changeBitRateTime=t}},{key:"startLoad",value:(T=(0,i.x)((0,i.l5)().mark(function t(e,n){var r,a,o,s,l,u,d,f,h,p,g=arguments;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=g.length>2&&void 0!==g[2]&&g[2],o=(a=this.selectedPCDN(r))||this.url,o=this._addRangeToUrl(o,e),this.log(c._.LOG,"[startLoad], ",n,JSON.stringify(e),o),t.prev=5,s={index:n,onProgress:this.onprogressDataArrive,onProcessMinLen:this.options.onProcessMinLen,url:o,priOptions:{type:a?_.PCDN:_.CDN,range:e},headers:{}},a&&(s.headers["X-Origin-Server-Host"]=this._domain),t.next=10,this.MP4Loader.loadData(e,this.MP4Loader.cache,s);case 10:t.next=29;break;case 12:if(t.prev=12,t.t0=t.catch(5),u=(null===t.t0||void 0===t.t0||null===(l=t.t0.options)||void 0===l||null===(l=l.priOptions)||void 0===l?void 0:l.type)===_.PCDN||!!a,d=null,f=t.t0.url||(u?a:this.url),!u){t.next=27;break}return this.pcdnVVStat.conn_fail_num++,S.pcdn_download_failed_cnt++,d=this._pcdnNodeList.shift(),this.emit(b.REMOVE_PCDN_NODE,d),this.log(c._.ERROR,"pcdn load err, retry use cdn, fragIndex: ".concat(n),"range: ".concat(JSON.stringify(e),", err: ").concat(null===t.t0||void 0===t.t0?void 0:t.t0.message,", ").concat((null===t.t0||void 0===t.t0?void 0:t.t0.isTimeout)||(null===t.t0||void 0===t.t0||null===(h=t.t0.response)||void 0===h?void 0:h.status)),"url: ".concat(f)),t.next=25,this.startLoad(e,n,!0);case 25:t.next=28;break;case 27:this.log(c._.ERROR,"cdn load err, fragIndex: ".concat(n),"range: ".concat(JSON.stringify(e),", err: ").concat(null===t.t0||void 0===t.t0?void 0:t.t0.message,", ").concat((null===t.t0||void 0===t.t0?void 0:t.t0.isTimeout)||(null===t.t0||void 0===t.t0||null===(p=t.t0.response)||void 0===p?void 0:p.status)),"url: ".concat(f));case 28:this.loadError(t.t0,"loadFragment",u,{range:e,fragIndex:n,url:f});case 29:case"end":return t.stop()}},t,this,[[5,12]])})),function(t,e){return T.apply(this,arguments)})},{key:"loadError",value:function(t,e,n,r){t.response||(t.response={}),t.isTimeout?t.response.status=d.O1.timeout:!(null!=t&&null!==(i=t.response)&&void 0!==i&&i.status)&&(t.response.status=d.O1.networkError);var i,a,o,s=p.Z.getHostFromUrl(null==r?void 0:r.url);this.markErrHost(s);var l=t.response.headers?(0,g.xj)(t.response.headers):null;l&&(t.headers=l),this.log(c._.ERROR,"load err, headers: ".concat(JSON.stringify(l),",\n      errC: ").concat(null==t||null===(a=t.response)||void 0===a?void 0:a.status,",\n      errM: ").concat(null==t?void 0:t.message)),this.emit(b.LOAD_ERROR,{src:null==r?void 0:r.url,host:s,errorCode:null==t||null===(o=t.response)||void 0===o?void 0:o.status,message:null==t?void 0:t.message,range:(null==r?void 0:r.range)&&JSON.stringify(r.range),headers:l}),!n&&this.errorHandler(t,e,r)}},{key:"loadAllFragmentData",value:(w=(0,i.x)((0,i.l5)().mark(function t(e,n,r){var a,o,s,l,u,d,f,h,g,m,v,y,b,x,k,L,R=arguments;return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=R.length>3&&void 0!==R[3]&&R[3],s=R.length>4&&void 0!==R[4]?R[4]:null,!this.hasDestroyed){t.next=4;break}return t.abrupt("return");case 4:return this.resetRepeatInfo(),l=s||(null===(a=this.adaptTimeRange[e])||void 0===a?void 0:a.range)||this.getFragRange(e),this._curLoadSegIdx=e,u=this.selectedPCDN(o),d=p.Z.extUrl(u||this.url,(0,i.Zj)({__rand:new Date().getTime()},this.options.reqParams)),t.prev=9,this.log(c._.LOG,"loadAllFragmentData before, index: ".concat(e),"range: ".concat(JSON.stringify(l)),"use-pcdn: ".concat(!!u)),f={index:e,url:d,priOptions:{type:u?_.PCDN:_.CDN,range:l},headers:{}},u&&(f.headers["X-Origin-Server-Host"]=this._domain),t.next=15,this.MP4Loader.loadData(l,this.MP4Loader.cache,f);case 15:if(h=t.sent,this.log(c._.LOG,"loadAllFragmentData after, index: ".concat(e),"range: ".concat(JSON.stringify(l))),g=h.options.priOptions,this.checkResponse(null==h?void 0:h.response,g)){t.next=22;break}return this.notVailRangeResError(null==h?void 0:h.response,g,null===(m=h.options)||void 0===m?void 0:m.index,!0),t.abrupt("return");case 22:if(this.log(c._.LOG,"loadAllFragmentData after, index: ".concat(e),"range: ".concat(JSON.stringify(l))),!(!h||!h.data)){t.next=27;break}return v=Error("response null"),r?r(v):this.loadError(v,"loadFragment",!!u,{range:l,fragIndex:e,url:u||this.url}),t.abrupt("return");case 27:(y=h.data)&&l&&l.length>=2&&(null==y?void 0:y.byteLength)===l[1]-l[0]+1&&(this._receiveDataPos=l[0]+(null==y?void 0:y.byteLength),this._loadSuccessCallBack=n,this.adaptTimeRange[e].downloaded=!0,this.cacheRepeatData(this.adaptTimeRange[e].repeatRange,l,y),this._mux(y,l[0],e,!0)),t.next=44;break;case 31:if(t.prev=31,t.t0=t.catch(9),!(x=(null===t.t0||void 0===t.t0||null===(b=t.t0.options)||void 0===b||null===(b=b.priOptions)||void 0===b?void 0:b.type)===_.PCDN||!!u)){t.next=42;break}return S.pcdn_download_failed_cnt++,this._pcdnNodeList.shift(),this.log(c._.ERROR,"[loadAllFragmentData], pcdn load err, retry use cdn","fragIndex: ".concat(e,", ").concat((null===t.t0||void 0===t.t0?void 0:t.t0.isTimeout)||(null===t.t0||void 0===t.t0||null===(k=t.t0.response)||void 0===k?void 0:k.status),", ").concat(null===t.t0||void 0===t.t0?void 0:t.t0.message)),t.next=40,this.loadAllFragmentData(e,n,r,!0);case 40:t.next=43;break;case 42:this.log(c._.ERROR,"[MP4] loadAllFragmentData error: ".concat(JSON.stringify({fragIndex:e,range:l})),(null===t.t0||void 0===t.t0?void 0:t.t0.isTimeout)||(null===t.t0||void 0===t.t0||null===(L=t.t0.response)||void 0===L?void 0:L.status),null===t.t0||void 0===t.t0?void 0:t.t0.message);case 43:this.loadError(t.t0,"loadFragment",x,{range:l,fragIndex:e,url:t.t0.url||(x?u:this.url)});case 44:case"end":return t.stop()}},t,this,[[9,31]])})),function(t,e,n){return w.apply(this,arguments)})},{key:"currentLoadUseUrl",value:function(){var t;if(this._isUseCDN)return this.url;return(null===(t=this._pcdnNodeList)||void 0===t?void 0:t.length)>0?this._pcdnNodeList[0].url:""}},{key:"getCurSwitchPCDNCnt",value:function(){return this._PCDNSwitchCnt}},{key:"selectedPCDN",value:function(t){if("forbidden"===this._PCDNState||t){this._isUseCDN=!0;return}if(this.isUsePCDN()){if(this._isUseCDN){if(this._switchPCDNCallBack){var e,n=this._switchPCDNCallBack();n>0&&(this.options.switchPCDNMaxCnt=n)}if(this._PCDNSwitchCnt>=this.options.switchPCDNMaxCnt)return this._isUseCDN=!0,this.log(c._.LOG,"cdn switch pcdn out limit, curSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt)),null;this._PCDNSwitchCnt++;this.log(c._.LOG,"cdn switch pcdn, curSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt))}this._isUseCDN=!1,e=p.Z.extUrl(this._pcdnNodeList[0].url,(0,i.Zj)({__vid:this.options.vid},this.options.reqParams)),this._lastPCDNUrl!==e&&(this.emit(b.CHANGE_URL,e),this._lastPCDNUrl=e,this.pcdnVVStat.conn_req_num+=1),S.pcdn_download_request_cnt++}else!this._isUseCDN&&(this.log(c._.LOG,"pcdn switch cdn PCDNSwitchCnt: ".concat(this._PCDNSwitchCnt,", maxCnt: ").concat(this.options.switchPCDNMaxCnt)),this.pcdnVVStat.conn_jump_num+=1),this._isUseCDN=!0;return e}},{key:"cancelLoading",value:(D=(0,i.x)((0,i.l5)().mark(function t(){return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.MP4Loader){t.next=3;break}return t.next=3,this.MP4Loader.cancel();case 3:this._optionDataLenInfo[_.PCDN]&&this._optionDataLenInfo[_.PCDN]>0&&(this.emit(b.CANCEL_LOADED_LEN,{load_type:_.PCDN,len:this._optionDataLenInfo[_.PCDN]}),this._optionDataLenInfo[_.PCDN]=0),this._optionDataLenInfo[_.CDN]&&this._optionDataLenInfo[_.CDN]>0&&(this.emit(b.CANCEL_LOADED_LEN,{load_type:_.CDN,len:this._optionDataLenInfo[_.CDN]}),this._optionDataLenInfo[_.CDN]=0);case 5:case"end":return t.stop()}},t,this)})),function(){return D.apply(this,arguments)})},{key:"updateUrl",value:function(t,e){var n=p.Z.getHostFromUrl(t);!this._defaultDomain&&(this._defaultDomain=n),0>n.indexOf("www.")?this._domain=n:this._domain=this._defaultDomain,this.url=t,this.backUrl=e||[]}},{key:"getDataBitRate",value:function(t){return this._segmentToBitRateMap.get(t)}},{key:"checkCodecH265",value:function(){return this.meta&&(this.meta.videoCodec.indexOf("hvc1")>-1||this.meta.videoCodec.indexOf("hev1")>-1)}},{key:"checkCodecH266",value:function(){return this.meta&&this.meta.videoCodec.indexOf("bvc2")>-1}},{key:"destroy",value:(P=(0,i.x)((0,i.l5)().mark(function t(){return(0,i.l5)().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.hasDestroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.resetTransmuxer(),this.transmuxerWorkerControl&&this.transmuxerWorkerControl.destroy(),this.fileSize=0,this._isPending=!1,this.metaLoading=!1,this.resetRepeatInfo(),delete this.repeatInfo.data,this._bitRateInfoMap.clear(),this._segmentToBitRateMap.clear(),!this.MP4Loader){t.next=15;break}return t.next=14,this.MP4Loader.cancel();case 14:this.MP4Loader.destroy();case 15:this.removeAllListeners(),this.hasDestroyed=!0,this.pcdnVVStat=this.resetPcdnVVStat();case 18:case"end":return t.stop()}},t,this)})),function(){return P.apply(this,arguments)})},{key:"resetPcdnVVStat",value:function(){return{try_req_node:0,req_node_succ:0,has_ret_node:0,conn_req_num:0,conn_fail_num:0,conn_jump_num:0}}},{key:"resetTransmuxer",value:function(){this.MP4Demuxer&&this.MP4Demuxer.reset(),this.MP4Demuxer=null,this.FMP4Remuxer&&this.FMP4Remuxer.reset(),this.FMP4Remuxer=null,this.transmuxerWorkerControl&&this.transmuxerWorkerControl.reset()}},{key:"getMediaEndTime",value:function(){if(this._mediaEndTime>0)return this._mediaEndTime;var t=this.videoTrak,e=this.audioTrak;if(t&&(null==t?void 0:t.length)>0){var n=t[t.length-1].endTime;this._mediaEndTime=this._mediaEndTime<0?n:Math.min(n,this._mediaEndTime)}if(e&&(null==e?void 0:e.length)>0){var r=e[e.length-1].endTime;this._mediaEndTime=this._mediaEndTime<0?r:Math.min(r,this._mediaEndTime)}return this._mediaEndTime}},{key:"checkIsLoadEnd",value:function(t){var e=this.videoTrak,n=this.audioTrak;if(!e&&!n)return!1;var r=0,i=0;if(e&&(null==e?void 0:e.length)>0){var a=e[e.length-1].range;(null==a?void 0:a.length)>0&&(r=a[1])}if(n&&(null==n?void 0:n.length)>0){var o=n[n.length-1].range;(null==o?void 0:o.length)>0&&(i=o[1])}return t>=Math.max(r,i)}},{key:"checkInAdaptTimeRange",value:function(t){if(!(null!==(e=this.adaptTimeRange)&&void 0!==e&&e.length))return!1;var e,n=t.end-.5;return n<t.start&&(n=(t.end+t.start)/2),this.adaptTimeRange.some(function(t){return n>=t.startTime&&n<=t.endTime})}}],[{key:"pcdnDownLoadReqCnt",get:function(){var t=S.pcdn_download_request_cnt,e=S.pcdn_download_failed_cnt;return S.pcdn_download_request_cnt=0,S.pcdn_download_failed_cnt=0,{pcdn_download_request_cnt:t,pcdn_download_failed_cnt:e}}},{key:"getDefaultConfig",value:function(){return{onProcessMinLen:1024,xhrSetup:null,chunkSize:8e5,isCache:!1,playerId:"",vid:"",afterLoadeddataCallBackLen:0,ext:{}}}}])}(o()),L=S;L.pcdn_download_request_cnt=0,L.pcdn_download_failed_cnt=0},258817:function(t,e,n){n.d(e,{Z:function(){return d}});var r=n(22450);n(836654),n(511141),n(743465),n(891555),n(981168),n(469577),n(721911),n(777180),n(429532),n(98601),n(110617),n(304095),n(675373),n(819117),n(826893),n(927234),n(110006),n(284961),n(792315),n(329913),n(868352),n(17322),n(63249),n(950665),n(180138),n(911234),n(387605),n(936097),n(786120),n(339597),n(877193),n(391375),n(632637),n(645524),n(800599),n(69896),n(660999),n(12946),n(416555),n(747644),n(404948),n(789680),n(742611);var i=n(546041),a=n(380653),o=["bitrate","definition"],s={};function c(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]}function l(t){var e,n=Object.values(t);if(n.sort(function(t,e){return t.range[0]-e.range[0]}),0===n.length)return{};for(var i=0,o=0,c=new Uint8Array,l=0;l<n.length;l++){var u=n[l],d=u.range[0],f=u.range[1];if(i>0){if(o+1===d)c=(0,a.gJ)(c,new Uint8Array(u.res));else break}else c=(0,a.gJ)(c,new Uint8Array(u.res));i=d,o=f,e=u}var h=e.cacheKey.split("#"),p=(0,r.ZQ)(h,9),g=p[0],m=p[1],v=p[2],y=p[3],b=p[4],_=p[5],x=p[6],k=p[7],S=p[8],L=n[0].range[0],R={vid:g,mediaType:m,codecType:v,vtype:y,definition:b,start:_,end:x,fileId:"video"===m?k:S,range:[L,o],bitrate:k},O=s.generateRequestUniqueKey(R);return delete e.cacheKey,(0,r._x)({},O,(0,r.Zj)((0,r.Zj)({},e),{},{res:c.buffer,range:[L,o],memory:c.buffer.byteLength}))}function u(t){for(var e=Object.keys(t),n={},r=0;r<e.length;r++){var i=e[r],a=t[i],o=i.split("#"),s=o[1],c=o[4],l=o[7],u="video"===s?c:l;!n[u]&&(n[u]={}),n[u][i]=a}return n}s.ArrayBufferToString=function(t){for(var e="",n=new Uint8Array(t),r=0;r<n.length;r++)e+=String.fromCharCode(n[r]);return e},s.StringToArrayBuffer=function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return e},s.Base64ToHex=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=window.atob(t.replace(/-/g,"+").replace(/_/g,"/"));if(e){for(var r=[],i=0;i<n.length;i++)r.push(n.charCodeAt(i));return new Uint8Array(r).buffer}for(var a="",o=0;o<n.length;o++)a+="0".concat(n.charCodeAt(o).toString(16)).substr(-2);return a},s.HexToBase64=function(t){for(var e="",n=0;n<t.length;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2),16));return window.btoa(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},s.padStart=function(t,e,n){for(var r=String(n),i=e>>0,a=Math.ceil(i/r.length),o=[],s=String(t);a--;)o.push(r);return o.join("").substring(0,i-s.length)+s},s.durationConvert=function(t){var e=0,n=0,r=0;return(t=t.slice(t.indexOf("PT")+2)).indexOf("H")>-1&&t.indexOf("M")>-1&&t.indexOf("S")>-1?(e=parseFloat(t.slice(0,t.indexOf("H"))),n=parseFloat(t.slice(t.indexOf("H")+1,t.indexOf("M"))),r=parseFloat(t.slice(t.indexOf("M")+1,t.indexOf("S")))):t.indexOf("H")>-1&&t.indexOf("M")>-1&&0>t.indexOf("S")?(e=parseFloat(t.slice(0,t.indexOf("H"))),n=parseFloat(t.slice(t.indexOf("H")+1,t.indexOf("M")))):0>t.indexOf("H")&&t.indexOf("M")>-1&&t.indexOf("S")>-1?(n=parseFloat(t.slice(0,t.indexOf("M"))),r=parseFloat(t.slice(t.indexOf("M")+1,t.indexOf("S")))):t.indexOf("H")>-1&&0>t.indexOf("M")&&t.indexOf("S")>-1?(e=parseFloat(t.slice(0,t.indexOf("H"))),r=parseFloat(t.slice(t.indexOf("H")+1,t.indexOf("S")))):0>t.indexOf("H")&&0>t.indexOf("M")&&t.indexOf("S")>-1?r=parseFloat(t.slice(0,t.indexOf("S"))):0>t.indexOf("H")&&t.indexOf("M")>-1&&0>t.indexOf("S")&&(n=parseFloat(t.slice(0,t.indexOf("M")))),3600*e+60*n+r},s.preFixInterge=function(t,e){return(Array(e).join(0)+t).slice(-e)},s.toHex=function(){for(var t=[],e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach(function(e){t.push(s.padStart(Number(e).toString(16),2,0))}),t},s.sum=function(){for(var t=0,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return n.forEach(function(e){t+=e}),t},s.toUTF8=function(t){for(var e=unescape(encodeURIComponent(t)),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e.charCodeAt(r);return n.buffer},s.fromHex=function(t){for(var e=new Uint8Array(t.length/2),n=0;n<t.length;n+=2)e[n/2]=parseInt(t.substr(n,2),16);return e},s.fromCharCode=function(t){for(var e="",n=0;n<t.length;n+=16e3){var r=t.subarray(n,n+16e3);e+=String.fromCharCode.apply(null,r)}return e},s.toBase64=function(t,e){var n=s.fromCharCode(t);e=void 0===e||e;var r=window.btoa(n).replace(/\+/g,"-").replace(/\//g,"_");return e?r:r.replace(/=*$/,"")},s.str2hex=function(t){if(""===t)return"";for(var e=[],n=0;n<t.length;n++)e.push(t.charCodeAt(n));return e},s.bufferToString=function(t){return"0".concat(Number(t).toString(16)).slice(-2).toUpperCase()},s.stringToBuffer=function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t[n]+t[n+1],16));return new Uint8Array(e)},s.round=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Number(t.toFixed(e))},s.isEdge=function(){var t=window.navigator.userAgent.toLowerCase();return t.indexOf("edge")>-1||t.indexOf("edg/")>-1},s.offInDestroy=function(t,e,n,r){t.once(r,function i(){t.off(e,n),t.off(r,i)})},s.on=function(t,e,n,r){if(r)t.on(e,n),s.offInDestroy(t,e,n,r);else{var i=function(r){n(r),t.off(e,i)};t.on(e,i)}},s.once=function(t,e,n,r){if(r)t.once(e,n),s.offInDestroy(t,e,n,r);else{var i=function(r){n(r),t.off(e,i)};t.once(e,i)}},s.promisePolyfill=function(){!Promise.prototype.finally&&(Promise.prototype.finally=({finally:function(t){var e=function(e){return Promise.resolve(t()).then(e)};return this.then(function(t){return e(function(){return t})},function(t){return e(function(){return Promise.reject(t)})})}}).finally)},s.transformHeaders=function(t,e){var n=Object.assign({},t);return Object.keys(e).forEach(function(r){var i=e[r];t&&t[r]&&(n[i]=t[r],delete n[r])}),n},s.generateRequestUniqueKey=function(t){var e=t.vid,n=t.start,r=t.end,a=t.mediaType,o=t.definition,s=t.codecType,c=t.vtype,l=t.bitrate,u=t.fileId,d=t.range;if(d&&d.length>0?(n=d[0],r=d[1]):(n=n||0,r=r||0),s="hevc"===s?"h265":s||"h264",c=c||i.l0.DASH,!e||!a)return null;var f=o?"".concat(e,"#").concat(a,"#").concat(s,"#").concat(c,"#").concat(o,"#").concat(n,"#").concat(r):"".concat(e,"#").concat(a,"#").concat(s,"#").concat(c,"##").concat(n,"#").concat(r,"#").concat(l);return u?"".concat(f,"#").concat(u):f},s.getDefinition=function(t){if(!t)return null;var e=t.split("#");return e.length>2?e[2]:null},s.exchangeListUrl=function(t){if(!!t&&0!==t.length)for(var e=0;e<t.length;e++)s.exchangeUrl(t[e])},s.exchangeUrl=function(t){if(!!t&&!!t.main_url&&!!t.backup_url_1){var e=t.main_url,n=t.backup_url_1,r=e.split("?");2===r.length&&-1===n.indexOf("?")?(t.main_url="".concat(n,"?").concat(r[1]),t.backup_url_1=r[0]):(t.main_url=n,t.backup_url_1=e)}},s.validateFragment=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!(t instanceof ArrayBuffer))return!1;try{var n=new Uint8Array(t,4,4),r=String.fromCharCode.apply(null,n),i=!0;if(2===e.length){var a=e[1]-e[0]+1;if(!(i=t.byteLength===a))return}if("moof"!==r&&"styp"!==r&&"ftyp"!==r)return!1}catch(t){return!1}return!0},s.validateUrlRange=function(t,e){if((t=t||[]).length>0&&e)for(var n=0;n<t.length;n++){var r=t[n];if(/([0-9.\-A-Za-z]+)/.test(r)&&e.indexOf(r)>-1)return!0}return!1},s.nowTime=function(){try{return parseInt(performance.now(),10)}catch(t){return new Date().getTime()}},s.getBitrateItem=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=s.getSelectorList(t,n);return e.getSuitableBitrate?e.getSuitableBitrate(i,r):e.bitRateAdapter.select(i)},s.getSelectorList=function(t,e){for(var n=t.dynamic_video_list,i=[],a=0;a<n.length;a++){var s=n[a],c=s.bitrate,l=s.definition,u=(0,r.Kd)(s,o);!s.isExtra&&i.push((0,r.Zj)({bitrate:c,definition:l,duration:e,mediaType:"video"},u))}return i},s.typeof=c,s.getHostFromUrl=function(t){if("String"!==c(t)||!t)return"";var e=t.split("/"),n="";return e.length>3&&e[2]&&(n=e[2]),n},s.checkValidTopBox=function(t){var e=s.getTopBoxType(t);return("moof"===e||"styp"===e)&&!0},s.getTopBoxType=function(t){if(s.isArrayBuffer(t)){var e=t.subarray(4,8);return String.fromCharCode.apply(null,e)}return null},s.isArrayBuffer=function(t){return!!(t instanceof ArrayBuffer||t instanceof Uint8Array)||!1},s.getBufferData=function(t,e){var n=0,r=0,i=0,a=0,o=0;if(!t||0===t.length)return{beforeBufLen:n,afterBufLen:r,beforeLastBuffEnd:i,afterFirstBuffEnd:a,afterFirstBuffStart:o};a=1/0,o=1/0;for(var s=0,c=t.length;s<c;s++){var l=t.end(s),u=t.start(s),d=l-u;l<e?(n+=d,i=l):u<=e&&e<=l?(n+=e-u,r+=l-e):(o=Math.min(u,o),a=Math.min(l,a),r+=d)}return{beforeBufLen:n,afterBufLen:r,beforeLastBuffEnd:i,afterFirstBuffEnd:a}},s.combinePreloadData=function(t){for(var e=Object.keys(t),n={},r={},i={},a=0;a<e.length;a++){var o,s,c=e[a],d=t[c];d.isInitSegment?i[c]=d:(d.rangeEnd===(null===(o=d.range)||void 0===o?void 0:o[1])&&d.rangeStart===(null===(s=d.range)||void 0===s?void 0:s[0])?i[c]=d:"audio"===d.mediaType?n[c]=d:"video"===d.mediaType&&(r[c]=d),d.cacheKey=c)}for(var f=u(n),h=0,p=Object.keys(f);h<p.length;h++)Object.assign(i,l(f[p[h]]));for(var g=u(r),m=0,v=Object.keys(g);m<v.length;m++)Object.assign(i,l(g[v[m]]));return i};let d=s},749517:function(t,e,n){n.d(e,{ZP:function(){return h},jl:function(){return f},qu:function(){return a}}),n(836654),n(910795),n(826893),n(179133);var r=n(892210),i=n(869835),a=function(){return"undefined"!=typeof window&&(window.location.search.indexOf("log=true")>-1||!!r.Xb.getItem("abrdebug")||!!r.Xb.getItem("playerlog"))}(),o=new i.Y("Logger",{logCacheLevel:i._.DEBUG});a&&i.Y.enable();var s={},c={log:"log",network:"network",abr:"abr",encrypt:"encrypt",segment:"segment",definition:"definition",content:"content",mse:"mse",media:"media",time:"time",preload:"preload",gap:"gap"},l=["abr"],u=function(t){l.includes(t)?a?s[t]=function(){for(var e,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];(e=console).log.apply(e,["[".concat(t,"]"),new Date().toLocaleString()].concat(r))}:s[t]=function(){}:s[t]=function(){for(var e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];o.log.apply(o,["[".concat(t,"]")].concat(n))}};for(var d in c)u(d);function f(){return o}let h=s},732891:function(t,e,n){n.d(e,{Z:function(){return r}});function r(t,e,n){"function"==typeof e&&t.then(e),"function"==typeof n&&t.catch(n)}},551663:function(t,e,n){n.d(e,{Z:function(){return r}});let r=function(){try{if("undefined"!=typeof indexedDB)return indexedDB}catch(t){}}()},622109:function(t,e,n){n.d(e,{$w:function(){return r},Ac:function(){return g},PA:function(){return i},Vx:function(){return h},XW:function(){return u},_x:function(){return s},qH:function(){return o}});function r(t,e,n){return e=l(e),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,d()?Reflect.construct(e,n||[],l(t).constructor):e.apply(t,n))}function i(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,p(r.key),r)}}function o(t,e,n){return e&&a(t.prototype,e),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,n){return(e=p(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function c(){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!({}).hasOwnProperty.call(t,e)&&null!==(t=l(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(null,arguments)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function u(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&f(t,e)}function d(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(d=function(){return!!t})()}function f(t,e){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e,n,r){var i=c(l(1&r?t.prototype:t),e,n);return 2&r&&"function"==typeof i?function(t){return i.apply(n,t)}:i}function p(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}function g(t){return(g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}},767068:function(t,e,n){function r(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{_x:function(){return r}})},611210:function(t,e,n){n.d(e,{Z:function(){return c}});var r=n(874838),i=n(758698),a=n(675161),o=n(540931),s=n(761690),c=function(){function t(e){(0,r.Z)(this,t),this.TAG="DecodeEstimate",this._lowDecodeThreshold=(0,s.tT)().lowDecodeThreshold/5,this._lowDecodeFpsDelta=(0,s.tT)().lowDecodeFpsDelta,this._needEstimate=!0,this._parent=e,this._lastDecodeDot=0,this._lastDecodeCost=0,this._lastFrameDts=0,this._dtsDeltas=[],this._decodeCosts=[],this._lowDecodeQueue=[],this._fps=0,this._decodeFps=0,this._gopLength=0,this._webcodec=!1}return(0,i.Z)(t,[{key:"fps",get:function(){return this._fps}},{key:"decodeFps",get:function(){return this._decodeFps}},{key:"decodeCost",get:function(){return this._lastDecodeCost}},{key:"gopLength",get:function(){return this._gopLength}},{key:"webcodec",set:function(t){this._webcodec=t}},{key:"updateGopCount",value:function(){this._gopLength++}},{key:"needEstimateFps",value:function(){this._needEstimate=!0}},{key:"addDecodeInfo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{dts:0};this._estimateDecodeFps(t),this._estimateFps(t)}},{key:"resetDecodeDot",value:function(t){this._lastDecodeDot=t||0}},{key:"reset",value:function(){this._decodeCosts=[],this._lowDecodeQueue=[]}},{key:"_estimateFps",value:function(t){if(!this._needEstimate)return;if(!this._lastFrameDts){this._lastFrameDts=t.dts;return}var e=t.dts-this._lastFrameDts;if(this._lastFrameDts=t.dts,!(Math.abs(e)>200)){this._dtsDeltas.push(e);var n=this._dtsDeltas.length;!(n<5)&&(this._fps=Math.ceil(1e3/this._avg(this._dtsDeltas,n)),a.kg.log(this.TAG,"estimate fps:",this._fps),this._needEstimate=!1)}}},{key:"_estimateDecodeFps",value:function(t){if(!this._lastDecodeDot){this._lastDecodeDot=performance.now();return}var e=performance.now(),n=e-this._lastDecodeDot;this._lastDecodeDot=e,t.cost=n,this._lastDecodeCost=n,this._decodeCosts.push(n);var r=this._decodeCosts.length;if(!(r<5)){var i=this._avg(this._decodeCosts,r);this._decodeFps=Math.floor(1e3/i),this._decodeCosts=[],this._lowDecodeDetect()}}},{key:"_avg",value:function(t,e){return Math.floor(t.reduce(function(t,e){return t+=e},0)/e)||1}},{key:"_lowDecodeDetect",value:function(){if(!this._decodeFps){this._parent.emit(o.ZP.VIDEO.DECODE_LOW_FPS,0);return}this._decodeFps<this._fps*this._parent.playbackRate+(this.webcodec?0:this._lowDecodeFpsDelta)?this._lowDecodeQueue.push(this._decodeFps):this._lowDecodeQueue.pop(),this._lowDecodeQueue.length>this._lowDecodeThreshold&&(this._lowDecodeQueue=[],a.kg.log(this.TAG,","),this._parent.emit(o.ZP.VIDEO.DECODE_LOW_FPS,this._decodeFps))}},{key:"destroy",value:function(){this._parent=null}}]),t}()},289006:function(t,e,n){n.d(e,{i:function(){return a}});var r=n(83399),i=n(854174);function a(t){return(0,r.Zj)({loaderType:i.t.FETCH,retry:0,retryDelay:0,timeout:0,request:null,onTimeout:void 0,onProgress:void 0,onRetryError:void 0,transformRequest:void 0,transformResponse:void 0,transformError:void 0,responseType:i.U.TEXT,range:void 0,url:"",params:void 0,method:"GET",headers:{},body:void 0,mode:void 0,credentials:void 0,cache:void 0,redirect:void 0,referrer:void 0,referrerPolicy:void 0,integrity:void 0,onProcessMinLen:0,processMaxGapTime:1/0},t)}},768947:function(t,e,n){function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?r(Object(n),!0).forEach(function(e){f(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function a(){a=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,r=Object.defineProperty||function(t,e,n){t[e]=n.value},i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",c=i.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var a=Object.create((e&&e.prototype instanceof h?e:h).prototype);return r(a,"_invoke",{value:function(t,e,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return O()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=function t(e,n){var r=n.method,i=e.iterator[r];if(void 0===i)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=void 0,t(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=TypeError("The iterator does not provide a '"+r+"' method")),f;var a=d(i,e.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,f;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=void 0),n.delegate=null,f):o:(n.method="throw",n.arg=TypeError("iterator result is not an object"),n.delegate=null,f)}(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=d(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===f)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(t,n,new L(i||[]))}),a}function d(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var f={};function h(){}function p(){}function g(){}var m={};l(m,o,function(){return this});var v=Object.getPrototypeOf,y=v&&v(v(R([])));y&&y!==e&&n.call(y,o)&&(m=y);var b=g.prototype=h.prototype=Object.create(m);function _(t){["next","throw","return"].forEach(function(e){l(t,e,function(t){return this._invoke(e,t)})})}function x(t,e){var i;r(this,"_invoke",{value:function(r,a){function o(){return new e(function(i,o){!function r(i,a,o,s){var c=d(t[i],t,a);if("throw"!==c.type){var l=c.arg,u=l.value;return u&&"object"==typeof u&&n.call(u,"__await")?e.resolve(u.__await).then(function(t){r("next",t,o,s)},function(t){r("throw",t,o,s)}):e.resolve(u).then(function(t){l.value=t,o(l)},function(t){return r("throw",t,o,s)})}s(c.arg)}(r,a,i,o)})}return i=i?i.then(o,o):o()}})}function k(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function L(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(k,this),this.reset(!0)}function R(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:O}}function O(){return{value:void 0,done:!0}}return p.prototype=g,r(b,"constructor",{value:g,configurable:!0}),r(g,"constructor",{value:p,configurable:!0}),p.displayName=l(g,c,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===p||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,l(t,c,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},_(x.prototype),l(x.prototype,s,function(){return this}),t.AsyncIterator=x,t.async=function(e,n,r,i,a){void 0===a&&(a=Promise);var o=new x(u(e,n,r,i),a);return t.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},_(b),l(b,c,"Generator"),l(b,o,function(){return this}),l(b,"toString",function(){return"[object Generator]"}),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=R,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return o.type="throw",o.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(s&&c){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,f):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),S(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:R(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},t}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e,n,r,i,a,o){try{var s=t[a](o),c=s.value}catch(t){n(t);return}s.done?e(c):Promise.resolve(c).then(r,i)}function c(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var a=t.apply(e,n);function o(t){s(a,r,i,o,c,"next",t)}function c(t){s(a,r,i,o,c,"throw",t)}o(void 0)})}}function l(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,R(r.key),r)}}function d(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function f(t,e,n){return(e=R(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function h(t,e){if("function"!=typeof e&&null!==e)throw TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&g(t,e)}function p(t){return(p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function g(t,e){return(g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function m(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function v(t,e,n){return(v=m()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&g(i,n.prototype),i}).apply(null,arguments)}n.d(e,{Ac:function(){return o},IP:function(){return p},Kd:function(){return b},Lc:function(){return _},PA:function(){return l},U2:function(){return k},WY:function(){return x},XW:function(){return h},Zj:function(){return i},_x:function(){return f},l5:function(){return a},qH:function(){return d},sf:function(){return L},wm:function(){return y},x:function(){return c}});function y(t){var e="function"==typeof Map?new Map:void 0;return(y=function(t){var n;if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;if("function"!=typeof t)throw TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return v(t,arguments,p(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),g(r,t)})(t)}function b(t,e){if(null==t)return{};var n,r,i=function(t,e){if(null==t)return{};var n,r,i={},a=Object.keys(t);for(r=0;r<a.length;r++)n=a[r],!(e.indexOf(n)>=0)&&(i[n]=t[n]);return i}(t,e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(r=0;r<a.length;r++){if(n=a[r],!(e.indexOf(n)>=0))Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}}return i}function _(t){if(void 0===t)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function x(t){var e=m();return function(){var n,r=p(t);return n=e?Reflect.construct(r,arguments,p(this).constructor):r.apply(this,arguments),function(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw TypeError("Derived constructors may only return object or undefined");return _(t)}(this,n)}}function k(){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=p(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}}).apply(this,arguments)}function S(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function L(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return S(t,void 0);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(t,e)}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{!o&&null!=n.return&&n.return()}finally{if(s)throw a}}}}function R(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}},442718:function(t,e,n){n.d(e,{W:function(){return a}});var r=n(758772),i=n(693012),a=function(){function t(){(0,r.PA)(this,t),(0,r._x)(this,"id",2),(0,r._x)(this,"type",i.Vc.AUDIO),(0,r._x)(this,"codecType",i.yQ.AAC),(0,r._x)(this,"pid",-1),(0,r._x)(this,"codec",""),(0,r._x)(this,"sequenceNumber",0),(0,r._x)(this,"sampleDuration",0),(0,r._x)(this,"timescale",0),(0,r._x)(this,"formatTimescale",0),(0,r._x)(this,"baseMediaDecodeTime",0),(0,r._x)(this,"duration",0),(0,r._x)(this,"warnings",[]),(0,r._x)(this,"samples",[]),(0,r._x)(this,"baseDts",0),(0,r._x)(this,"sampleSize",16),(0,r._x)(this,"sampleRate",0),(0,r._x)(this,"channelCount",0),(0,r._x)(this,"objectType",0),(0,r._x)(this,"sampleRateIndex",0),(0,r._x)(this,"config",[]),(0,r._x)(this,"present",!1),(0,r._x)(this,"isVideoEncryption",!1),(0,r._x)(this,"isAudioEncryption",!1),(0,r._x)(this,"kid",null),(0,r._x)(this,"ext",void 0)}return(0,r.qH)(t,[{key:"reset",value:function(){this.sequenceNumber=0,this.timescale=0,this.sampleDuration=0,this.sampleRate=0,this.channelCount=0,this.baseMediaDecodeTime=0,this.present=!1,this.pid=-1,this.codec="",this.samples=[],this.config=[],this.warnings=[]}},{key:"exist",value:function(){return!!(this.sampleRate&&this.channelCount&&this.codec&&this.codecType===i.yQ.AAC)}},{key:"hasSample",value:function(){return!!this.samples.length}},{key:"isEncryption",get:function(){return this.isAudioEncryption}}]),t}()}}]);
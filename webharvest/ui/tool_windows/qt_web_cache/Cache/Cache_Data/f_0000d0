"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["31682"],{769125:function(e,t){t.Z={comment:"GkkH0S6K",commentOpt:"oaf6Ibtx",commentInput:"XS8pzVXh"}},632168:function(e,t){t.Z={full:"aWUFxyvW",enterRoom:"lPOF_UNl",loaded:"_ISFVfJd",enterRoomIcon:"X8tZCAb3"}},382069:function(e,t){t.Z={container:"nMP5L4c4",isAsianGames:"E5GerkUB"}},277303:function(e,t,i){i.d(t,{BC:function(){return c},MO:function(){return v},P7:function(){return _},_y:function(){return d},as:function(){return a},fH:function(){return h},iC:function(){return u}}),i(250440),i(779788);var n=i(277733),o=i(109270),l=i(862349),r=i(96008),s=i.n(r);function u(e){return 0===e.status}function a(e){return 1===e.status}function d(e){return 2===e.status}function c(e){return e===n.Qz.Admin}function v(e){var t;let{privilegeTab:i,roomId:l,anchorId:r,content:u,rtf_content:a,left_diamond:d,enter_from_merge:v,enter_method:_,request_id:h,onSuccess:f=s(),onRecharge:m}=e,g=null==i?void 0:i.style;if(c(g))return{isScreentChat:!0,sendPromise:(0,o.Ew)({room_id:l,content:u,rtf_content:a,enter_source:v,request_id:h})};if(t=g,[n.Qz.Advanced,n.Qz.Base,n.Qz.Supreme].includes(t)){let e=(0,o.nr)({room_id:l,anchor_id:r,content:u,style:g,left_diamond:d,tags_extra:JSON.stringify({enter_from_merge:v,action_type:"click",enter_method:_}),rtf_content:a});return e.then(e=>{let t=null==e?void 0:e.data;if(!t||0!==e.status_code)return;let i={is_mock:!0,method:"WebcastPrivilegeScreenChatMessage",msg_id:t.msg_id,show_identity:t.show_identity,identity_label:t.identity_label,payload:{content:u,common:{msg_id:t.msg_id},user:t.user,style:g}};null==f||f({mockMsg:i,data:t})}),{isScreentChat:!0,sendPromise:e}}return{isScreentChat:!1,sendPromise:null}}function _(e){var t;return"style"in(null==e?void 0:e.payload)&&Number(null==e?void 0:null===(t=e.payload)||void 0===t?void 0:t.style)===n.Qz.Supreme}function h(e){let{msg:t,lineMaxHeight:i=40}=e,n={width:"fit-content",height:"fit-content"};if(_(t)){let e=Number((0,l.nE)("area")||0)+1;n.maxHeight=`${i*e}px`}else n.height="1em";return n}},464170:function(e,t,i){i.d(t,{Z:function(){return G}});var n=i(134761),o=i(520739),l=i(878389);i(779788),i(675373),i(874386),i(284961),i(826893),i(413806),i(179133),i(429532);var r=i(63746),s=i(831202),u=i(782563),a=i(516599),d=i(770989),c=i(746025),v=i(399796),_=i(35730),h=i(725896),f=i(330449),m=i(383058),g=i(230501),p=i(585514),y=i(827045),E=i(134974),b=i(371816),S=i(236734),P=i(919382),k=i(457388),I=i(918056),L=i(645260),O=i.n(L),N=i(611243),w=i(828040),T=i(90463),C=i(567754),D=i(104013),M=i(690099),R=i(418831),F=i(623089),A=i(154183);let V="activity_indicator_jsb",x=null,U=null;class G{getGiftGuestListData(e){try{var t,i,n,o;let{choosePeopleList:e,choosePeopleArr:l,choosePeopleAll:r,linkStatus:s,isGroupLive:u}=this._store.linkmicStore,{roomInfo:a}=this._store.roomStore,d=null===(i=this._store)||void 0===i?void 0:null===(t=i.linkmicStore)||void 0===t?void 0:t.allowSendGiftGuest,c=Object.values(e).filter(e=>{var t,i,n;return!!d||!!u||(null===(i=e.user)||void 0===i?void 0:null===(t=i.user)||void 0===t?void 0:t.id_str)===(null==a?void 0:null===(n=a.anchor)||void 0===n?void 0:n.id_str)}).map(e=>{var t,i,n,o,l,r;let s="0";(null===(i=e.user)||void 0===i?void 0:null===(t=i.content)||void 0===t?void 0:t.linkmic_audience_content)?s=e.user.content.linkmic_audience_content.fan_ticket_fuzzy_str:(null===(o=e.user)||void 0===o?void 0:null===(n=o.content)||void 0===n?void 0:n.linkmic_content)&&(s=null===(r=e.user.content)||void 0===r?void 0:r.linkmic_content.fan_ticket);let u=4;return String(e.user.user.id_str)===String(null==a?void 0:null===(l=a.anchor)||void 0===l?void 0:l.id_str)&&(u=2),{count:s,identifier:u,user:JSON.stringify(e.user.user)}});if(s===T.cK.NOT_LINK)return{code:f.P.Success,data:{is_all_mic:!1,enable_all_mic:!1,current_user:null==a?void 0:null===(o=a.anchor)||void 0===o?void 0:o.id_str,current_user_list:(0,D.toJS)(l),guest_list:JSON.stringify(c),connection_type:""}};let v=Object.values(e),_={is_all_mic:r,enable_all_mic:r,current_user:(null==v?void 0:null===(n=v[0].user)||void 0===n?void 0:n.user.id_str)||"",current_user_list:(0,D.toJS)(l),guest_list:JSON.stringify(c),connection_type:""};return{code:f.P.Success,data:_}}catch(e){return{code:f.P.Failed}}}async _fetchSetting(){return x?x:U?await U:(U=(async()=>{var e,t,i,n,o;let l=await (0,R.Mr)({device_platform:"web",aid:"6383"});if((null==l?void 0:l.status)!==200||(null==l?void 0:null===(e=l.data)||void 0===e?void 0:e.status_code)!==0)return k.ZN.error(s.Mo.LiveSettingError,{content:{statusCode:null==l?void 0:null===(i=l.data)||void 0===i?void 0:i.status_code,logId:null!==(o=l.logId)&&void 0!==o?o:"",is_client:(0,u.DT)(),data:null==l?void 0:null===(n=l.data)||void 0===n?void 0:n.data}}),null;{let e=null==l?void 0:null===(t=l.data)||void 0===t?void 0:t.data;return x=e,e}})(),await U)}async getClientSetting(e){if(!e.key)return{code:f.P.Failed};let t=await this._fetchSetting();return t?("fans_club_lynx_url_group"===e.key&&(t[e.key].lynx_web_url=m.w.StarfansUser),{code:f.P.Success,data:{[e.key]:t[e.key]}}):{code:f.P.Failed}}async privilege_wear_notification(e){return window.location.reload(),(null==e?void 0:e.toast_text)&&a.F.info(null==e?void 0:e.toast_text),{code:f.P.Success}}async registerMessage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{type_list:t=[]}=e;try{if(!t.every(e=>{var t,i,n,o;return(null===(o=this._store)||void 0===o?void 0:null===(n=o.activityIndicatorStore)||void 0===n?void 0:null===(i=n.messageListenList)||void 0===i?void 0:null===(t=i.indexOf)||void 0===t?void 0:t.call(i,e))>=0})){var i,n,o;null===(o=this._store)||void 0===o||o.activityIndicatorStore.setMessageListenList([...new Set([...t,...null===(n=this._store)||void 0===n?void 0:null===(i=n.activityIndicatorStore)||void 0===i?void 0:i.messageListenList])])}return{code:f.P.Success}}catch(e){return{code:f.P.Success}}}async pcGetBalance(){let{data:e,logId:t}=await S.sb({}),i=O()(e,"status_code");if(0===i){var n,l,r;let t=O()(e,"data.diamond",0);null===(r=this._store)||void 0===r||null===(l=r.giftStore)||void 0===l||null===(n=l.setBalance)||void 0===n||n.call(l,t)}else k.kg.event(`[${s.Tn.Error}]${s.Mo.LiveBalanceError}`,(0,o._)({statusCode:i,logId:null!=t?t:"",is_client:(0,u.DT)()},e)),a.F.info(O()(e,"data.prompts","获取余额失败，请稍后重试")),k.kg.error("获取余额失败",e,t)}async openRechargeDialog(e){return new Promise(async t=>{let{rechargeStore:{rechargeAuthStatus:i}}=this._store,{showRecharge:n}=(0,N.y)();if(i){var o;let i=await (null===(o=d.a.getIAPRechargeParams)||void 0===o?void 0:o.call(d.a));n({type:"recharge",balance:(null==e?void 0:e.money_diff)||0,amount:0,theme:(0,c.Dr)(v.Q.getItem({sKey:_.CookieKeys.Theme})),requestPublicParams:i,onSuccess(){t({code:1,data:{recharge_code:1}})}})}})}constructor(e){var t=this;(0,n._)(this,"_store",null),(0,n._)(this,"_eventBus",void 0),(0,n._)(this,"__registerEvent",async()=>{let{publishEvent:e,broadcastEvent:t}=await Promise.resolve().then(i.bind(i,642448));this._eventBus.on("*",(i,n)=>{e(i,n),t(i,n)})}),(0,n._)(this,"showModal",async e=>{let{title:t,cancelText:i,confirmText:n,content:o,showCancel:l=!0}=e,{showModal:r}=(0,M.t)({});return new Promise(e=>{r({title:t,content:o,confirmBtnText:n,closeBtnText:i,onConfirm:()=>{e({code:f.P.Success,data:{cancel:!1,confirm:!0}})},onClose:()=>{e({code:f.P.Success,data:{cancel:!0,confirm:!1}})},showCancel:l})})}),(0,n._)(this,"fetch",async e=>{let{params:t,data:i,headers:n,url:a="",method:d="GET"}=e;try{var c;let e=(0,I.Kj)(this._store)||{},v=(0,o._)({},t);Object.keys(v).forEach(e=>{(""===v[e]||void 0===v[e])&&delete v[e]});let _=(0,l._)((0,o._)({},i||{},e,v),{aid:6383}),h=await (0,r.IZ)({url:a.replace(/^https?:\/\/[^/]+/,""),method:d,headers:n,data:i,params:_});return k.kg.event(`[${s.Tn.Info}]${s.Mo.LiveJsbFetchRqSuccess}`,{statusCode:f.P.Success,code:null==h?void 0:null===(c=h.data)||void 0===c?void 0:c.status_code,logId:null==h?void 0:h.logId,is_client:(0,u.DT)(),url:a.replace(/^https?:\/\/[^/]+/,"")}),{code:f.P.Success,raw:null==h?void 0:h.data}}catch(e){return k.kg.event(`[${s.Tn.Error}]${s.Mo.LiveJsbFetchRqError}`,{statusCode:f.P.Failed,is_client:(0,u.DT)(),url:a.replace(/^https?:\/\/[^/]+/,""),data:e}),{code:f.P.Failed}}}),(0,n._)(this,"sendLogV3",async e=>{let{eventName:t,params:i}=e;try{return window.collectEvent(t,(0,o._)({},(0,E.m6)(),(0,I.Kj)(this._store),i)),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"_transformShortLink",async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{if(0>e.indexOf("sslocal://webcast_redirect"))return e;let t=await fetch("https://lf-webcast-gr-sourcecdn.bytegecko.com/obj/byte-gurd-source-gr/webcast/cdn/api/scheme_config/api.roma.config.json"),i=await t.json(),n=C.parse(e.split("?")[1]);return i.redirect_rules[n.entry][0].location}catch(e){return!1}}),(0,n._)(this,"_converH5ToAnniexweb",async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";try{let t={redirect_rules:{exhibition_gift_list_h5:[{location:(0,A.SX)(),ruleType:0}]}},i=C.parse(e.split("?")[1]);return t.redirect_rules[i.entry][0].location}catch(e){return!1}}),(0,n._)(this,"openExhibition",async e=>{var t,i,n,o,l,r,s;let{lynx:u,targetUrl:a}=e,{roomInfo:d}=(null===(t=this._store)||void 0===t?void 0:t.roomStore)||{};try{let e=null===(n=this._store)||void 0===n?void 0:null===(i=n.singletonStore.liveContainer)||void 0===i?void 0:i.isSupportLynx(),t=null!==(l=null==d?void 0:null===(o=d.anchor)||void 0===o?void 0:o.id_str)&&void 0!==l?l:"";return u&&e?null===(s=this._store)||void 0===s||null===(r=s.singletonStore.liveContainer)||void 0===r||r.openLandPage({url:(0,A.oQ)(t,a),reset:!0}):this.openSchema({url:(0,A.dY)(t),_reset:!0}),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openGroupExhibition",async e=>{var t,i,n,o,l,r,s,u;let{lynx:a,newExhibition:d=!1,exhibitionSchema:c=""}=e,{choosePeopleArr:v}=(null===(t=this._store)||void 0===t?void 0:t.linkmicStore)||{},{roomInfo:_}=(null===(i=this._store)||void 0===i?void 0:i.roomStore)||{};try{let e=null===(o=this._store)||void 0===o?void 0:null===(n=o.singletonStore.liveContainer)||void 0===n?void 0:n.isSupportLynx(),t=(null==v?void 0:v[0])?null==v?void 0:v[0]:null!==(r=null==_?void 0:null===(l=_.anchor)||void 0===l?void 0:l.id_str)&&void 0!==r?r:"";return a&&e?d&&c?this.openScheme({url:c,_reset:!0}):null===(u=this._store)||void 0===u||null===(s=u.singletonStore.liveContainer)||void 0===s||s.openLandPage({url:(0,A.oQ)(t),reset:!0}):this.openSchema({url:(0,A.dY)(t),_reset:!0}),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openAnniexWeb",async e=>{var t,i,n,o;let{url:l,reset:r=!1,skipLint:s=!1}=e;if(!(null===(i=this._store)||void 0===i?void 0:null===(t=i.singletonStore.liveContainer)||void 0===t?void 0:t.isSupportLynx())||-1!==l.search("exhibition_gift_list_h5"))return await this.openScheme({url:l,_noReset:r});try{let e=s?l:await this._converH5ToAnniexweb(l);if(!e)return a.F.info("打开失败，请重试"),"boolean"==typeof e?(0,w.PO)({status:"1",statusCode:f.P.Failed,url:e}):(0,w.PO)({status:"2",statusCode:f.P.Failed,url:e}),{code:f.P.Failed};(0,w.PO)({statusCode:f.P.Success,status:"0",url:e});let t=(()=>{let e={__isDouyinPC:"true"};try{let t=C.parse(l.split("?")[1]);if("string"==typeof t.url_query){let i=C.parse(decodeURIComponent(t.url_query));Object.assign(e,i)}}catch(e){}return e})();return null===(o=this._store)||void 0===o||null===(n=o.singletonStore.liveContainer)||void 0===n||n.openLandPage({url:e,extraParams:t,reset:r}),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openScheme",async e=>{var t,i,n,o,l,r,s,u;let{url:d,isLiveModal:c=!1,_reset:v=!1,_noReset:_=!1}=e;if(-1!==d.indexOf("sslocal://webcast_redirect?entry=gold_gift"))try{let e=null===(t=this._store)||void 0===t?void 0:t.roomStore,o=null===(i=this._store)||void 0===i?void 0:i.userStore,l=null===(n=this._store)||void 0===n?void 0:n.activityIndicatorStore,r=O()(e,"roomInfo.roomId"),s=O()(e,"roomInfo.anchor.id_str"),u=O()(e,"roomInfo.anchor.sec_uid"),a=O()(o,"userInfo.id_str"),d=O()(o,"userInfo.sec_uid"),c=null==l?void 0:l._getGoldActLandUrl;return(null==l?void 0:l.setCurrentLandPage)([c({anchorId:s,secAnchorId:u,userId:a,secUserId:d,roomId:r})]),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}try{let e=await this._transformShortLink(d);if(!e)return a.F.info("打开失败，请重试"),"boolean"==typeof e?(0,w.PO)({status:"1",statusCode:f.P.Failed,url:e}):(0,w.PO)({status:"2",statusCode:f.P.Failed,url:e}),{code:f.P.Failed};(0,w.PO)({statusCode:f.P.Success,status:"0",url:e});let{url:t}=C.parse(e.split("?")[1]),i=()=>{let e={__isDouyinPC:"true"};try{let t=C.parse(d.split("?")[1]);if("string"==typeof t.url_query){let i=C.parse(decodeURIComponent(t.url_query));Object.assign(e,i)}}catch(e){}return e},n=!1;try{let e=(null==t?void 0:null===(o=t.split("?"))||void 0===o?void 0:o[1])||"",i=C.parse(e);"1"==i.pc_web_lynx&&(n=!0)}catch(e){}if(n&&(null===(r=this._store)||void 0===r?void 0:null===(l=r.singletonStore.liveContainer)||void 0===l?void 0:l.isSupportLynx()))return null===(u=this._store)||void 0===u||null===(s=u.singletonStore.liveContainer)||void 0===s||s.openLandPage({url:`sslocal://lynxview?url=${t}`,reset:v,extraParams:i()}),{code:f.P.Success};let c=(0,I.fh)(t,this._store,i()),h=this._store.activityIndicatorStore.currentLandPage.indexOf(c);if(h>=0){let e=[...this._store.activityIndicatorStore.currentLandPage];return e.splice(h,1),this._store.activityIndicatorStore.setCurrentLandPage(e,_),{code:f.P.Success}}return v?this._store.activityIndicatorStore.setCurrentLandPage([c],_):this._store.activityIndicatorStore.setCurrentLandPage([...this._store.activityIndicatorStore.currentLandPage,c],_),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openSchema",async e=>this.openScheme((0,o._)({url:null==e?void 0:e.schema},e))),(0,n._)(this,"openUrl",async e=>{let{url:t,pcNotClose:i}=e;try{let e=(0,I.fh)(t,this._store);if(e=`${e}&__isDouyinPC=true`,i){var n;this._store.activityIndicatorStore.setCurrentLandPage([...null===(n=this._store)||void 0===n?void 0:n.activityIndicatorStore.currentLandPage,e],!0)}else this._store.activityIndicatorStore.setCurrentLandPage([e]);return{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openLive",async e=>{var t,i,n,o,l,r,s,u,a,d,c,v,_,h,m,p,y,E,S;if("scheme"===e.type){if(!(null==e?void 0:null===(t=e.args)||void 0===t?void 0:t.url))return{code:f.P.Failed};let l=null==e?void 0:null===(n=e.args)||void 0===n?void 0:null===(i=n.url)||void 0===i?void 0:i.split("?");if(l[0].indexOf("webcast_room")>=0){let e=C.parse(l[1]||"");return e.web_rid&&window.open(`https://live.douyin.com/${e.web_rid}`),{code:f.P.Success}}return await this.openScheme({url:e.args.url,_noReset:null==e?void 0:null===(o=e.args)||void 0===o?void 0:o._noReset})}if("room"===e.type)return(null==e?void 0:null===(l=e.args)||void 0===l?void 0:l.web_rid)&&window.open(`/${e.args.web_rid}`),{code:f.P.Success};if("gift_panel"===e.type){let t=null==e?void 0:e.gift_id,i=null==e?void 0:e.is_send_gift,n=null==e?void 0:null===(r=e.gift_log_extra)||void 0===r?void 0:r.gift_source,o=(0,b.mS)(t,this._store.giftStore.giftList);return t&&i&&(null==o?void 0:o.id)?this.showModal({title:"",content:`送出1个${o.name}(${o.price}钻)`,confirmText:"确定",showCancel:!0,cancelText:"取消"}).then(i=>{var o,l;(null==i?void 0:i.code)===f.P.Success&&(null==i?void 0:null===(o=i.data)||void 0===o?void 0:o.confirm)&&this.sendGift({gift_id:t,gift_count:1,gift_source:n,to_user_id:null==e?void 0:null===(l=e.args)||void 0===l?void 0:l.user_id})}):(this._store.giftStore.setGiftPanelSwitchStatus(e.page_type?g.nN.OPEN_BY_PAGE_TYPE:g.nN.OPEN_GIFT),e.page_type&&(null===(s=this._store)||void 0===s||s.giftStore.setCurrentPageType(e.page_type))),{code:f.P.Success}}if("login_panel"===e.type)return await this.openLoginPanel(e.args);if("profile"===e.type){let{user_id:t,sec_uid:i,sec_user_id:n,source:o=""}=e.args||{};return(0,F.o8)(this._store,{targetUid:t,secTargetUid:n||i,source:o,skipPrivacyCheck:"true"===String((null==e?void 0:null===(u=e.args)||void 0===u?void 0:u.skip_privacy_check)||!1)}),{code:f.P.Success}}if("charge"===e.type)return this.openLiveRecharge(e),{code:f.P.Success};if("open_pc_package"===e.type)return(null===(d=this._store)||void 0===d?void 0:null===(a=d.giftStore)||void 0===a?void 0:a.giftPanelSwitchStatus)===g.nN.NO_CONTROL||(null===(v=this._store)||void 0===v?void 0:null===(c=v.giftStore)||void 0===c?void 0:c.giftPanelSwitchStatus)===g.nN.CLOSE?null===(h=this._store)||void 0===h||null===(_=h.giftStore)||void 0===_||_.setGiftPanelSwitchStatus(g.nN.OPEN_PROP):null===(p=this._store)||void 0===p||null===(m=p.giftStore)||void 0===m||m.setGiftPanelSwitchStatus(g.nN.CLOSE),{code:f.P.Success};if("lynx"===e.type){if(!(null==e?void 0:null===(y=e.args)||void 0===y?void 0:y.url))return{code:f.P.Failed};try{let t=decodeURIComponent(e.args.url),i=C.parse(t.split("?")[1]).url,n=t.split("?")[2]||"",o=C.parse(n);return null===(S=this._store)||void 0===S||null===(E=S.singletonStore.liveContainer)||void 0===E||E.openLandPage({url:`sslocal://lynxview?url=${i}`,reset:!0,extraParams:o}),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}return this._pcNotSupport("openLive",e.type),{code:f.P.Failed}}),(0,n._)(this,"call",async function(e,i){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e=>{};if((0,w.yQ)({name:e,params:""}),t[e]){let o=await t[e](i,n);try{if("on"===e||"x.subscribeEvent"===e)return;null==n||n(o),o.code!==f.P.Success&&(0,w.ZV)({name:e,params:""})}catch(t){(0,w.LQ)({name:e,params:""})}return}t._pcNotSupport(e);try{n({code:f.P.Failed})}catch(t){(0,w.LQ)({name:e,params:""})}}),(0,n._)(this,"x.subscribeEvent",(e,t)=>this.on(e,t)),(0,n._)(this,"x.publishEvent",e=>this.publishEvent(e)),(0,n._)(this,"x.open",e=>{if(null==e?void 0:e.schema)return this.openScheme({url:e.schema,_reset:null==e?void 0:e.replace})}),(0,n._)(this,"on",(e,t)=>"string"==typeof e?(this.subscribeEvent({eventName:e,callback:t}),t):this.subscribeEvent({eventName:e.eventName,callback:t})),(0,n._)(this,"off",(e,t)=>{this.unSubscribeEvent({eventName:e,listener:t})}),(0,n._)(this,"webcastBroadcast",async e=>{let{eventName:t,params:i}=e;try{return this._eventBus.emit(t,i),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"subscribeEvent",async e=>{let{eventName:t,callback:i}=e;try{return this._eventBus.on(t,i),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"publishEvent",async e=>{let{eventName:t,params:i}=e;try{return this._eventBus.emit(t,i),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"unSubscribeEvent",async e=>{let{eventName:t,listener:i}=e;try{return this._eventBus.off(t,i),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"setStorage",async e=>{let{key:t,value:i}=e;try{return localStorage.setItem(`${V}_${t}`,i),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"getStorage",async e=>{let{key:t}=e;try{var i;return{code:f.P.Success,value:null!==(i=localStorage.getItem(`${V}_${t}`))&&void 0!==i?i:""}}catch(e){return{code:f.P.Failed,value:""}}}),(0,n._)(this,"removeStorage",async e=>{let{key:t}=e;try{return localStorage.removeItem(`${V}_${t}`),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"toast",async e=>{let{text:t}=e;try{return a.F.info(t),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openLiveRecharge",async e=>{let{args:t}=e;try{let{rechargeStore:{rechargeAuthStatus:e}}=this._store,{showRecharge:n}=(0,N.y)();if(e){var i;let e=await (null===(i=d.a.getIAPRechargeParams)||void 0===i?void 0:i.call(d.a));n({type:"recharge",balance:(null==t?void 0:t.money_diff)||0,amount:0,theme:(0,c.Dr)(v.Q.getItem({sKey:_.CookieKeys.Theme})),requestPublicParams:e})}return{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"openLoginPanel",async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{return(0,y.p)().then(t=>{var i,n;t((0,o._)({headerText:"登录后即可参与互动",success:async()=>{!loginCallback()&&window.location.reload()},next:`https://${null===(n=window)||void 0===n?void 0:null===(i=n.location)||void 0===i?void 0:i.host}`,enterMethod:""},e))}),{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"login",async e=>{let{userStore:t}=this._store,{userInfo:i,odin:n}=t;if((null==i?void 0:i.user_id_str)||(null==i?void 0:i.sec_uid)||(null==i?void 0:i.short_id))return{code:f.P.Success,status:0};{let e=await this.openLoginPanel({});return{code:e.code,status:e.code===f.P.Success?1:2}}}),(0,n._)(this,"sendGift",async e=>{let{gift_id:t,gift_count:i,gift_source:n,args:r,gift_buff_level:d=0,to_user_id:c,send_type:v=4}=e;try{var _,h,m,g,p,y,E,P,I,L,N,w,T,C,D,M,R,F,A,V,x,U,G,K,W,H,B,Z,Y;let e;let{userStore:{userInfo:j},roomStore:{roomInfo:$},rechargeStore:{rechargeAuthStatus:J}}=this._store;if(!i)return{code:f.P.Failed};let z=c||O()($,"anchor.id_str"),q=O()($,"room.id_str");if(O()(j,"id_str")===z)return a.F.info("不可为自己送礼"),{code:f.P.Failed};let X=r?{plugin_id:JSON.stringify(r.plugin_id),plugin_info:JSON.stringify(r.plugin_info),toolbar_card_name:r.toolbar_card_name,extra:r.extra}:{};if(!q)return{code:f.P.Failed};let Q={gift_id:t,count:i,room_id:q,to_room_id:q,to_user_id:z,to_user_ids:"",send_type:v,send_scene:(null===(h=this._store)||void 0===h?void 0:null===(_=h.linkmicStore)||void 0===_?void 0:_.isGroupLive)?128:1,gift_source:0};k.kg.event("activity_indicator_send_gift",(0,l._)((0,o._)({},Q),{is_client:(0,u.DT)()}));let ee=await (0,S.hF)((0,o._)((0,l._)((0,o._)({},Q),{buff_level:d,tags_extra:(e=>{try{return JSON.stringify(e)}catch(e){return JSON.stringify({})}})({gift_source:n}),to_episode_id:O()($,"room.episode_extra.episode_id_str",0)||0}),X));try{let t=(null==ee?void 0:null===(p=ee.data)||void 0===p?void 0:p.data.diy_item_info)||"{}";e=JSON.parse(t)}catch(e){}let et=null==ee?void 0:null===(m=ee.data)||void 0===m?void 0:m.status_code,ei=await S.sb({});if(0===et){let l=O()(this._store,"giftStore.giftList",[]),r=O()(this._store,"giftStore.effectList",[]),d=(0,b.mL)(O()(ee.data,"data"),l,r,j,e,i);null===(P=this._store)||void 0===P||null===(E=P.giftStore)||void 0===E||null===(y=E.setGiftMessages)||void 0===y||y.call(E,d);let{data:c,logId:v}=ei,_=O()(c,"status_code");if(0===_){let e=O()(c,"data.diamond",0);null===(M=this._store)||void 0===M||null===(D=M.giftStore)||void 0===D||null===(C=D.setBalance)||void 0===C||C.call(D,e)}else k.kg.event(`[${s.Tn.Error}]${s.Mo.LiveBalanceError}`,(0,o._)({statusCode:_,logId:null!=v?v:"",is_client:(0,u.DT)()},c)),a.F.info(O()(c,"data.prompts","获取余额失败，请稍后重试")),k.kg.error("获取余额失败",c,v);this.publishEvent({eventName:"H5_sendGiftStatusChange",params:{gift_list:[{gift_id:Number(t),count:i}]}}),null===(N=this._store)||void 0===N||null===(L=N.eventStore)||void 0===L||null===(I=L.giftEvent)||void 0===I||I.liveGiftSendEvent({gift_id:t,combo_cnt:O()(ee.data,"data.combo_count"),group_cnt:O()(ee.data,"data.group_count"),gift_source:n,money_per_unit:O()(ee.data,"data.gift_struct.diamond_count"),gift_cnt:i,money:i*O()(ee.data,"data.gift_struct.diamond_count"),is_fans_club_gift:"0",to_user_id:O()($,"anchor.id_str"),full_seats_cnt:1,is_from_container:0}),null===(T=this._store)||void 0===T||null===(w=T.eventStore)||void 0===w||w.giftEvent.liveConsumeEvent({statusCode:et,amount:i*O()(ee.data,"data.gift_struct.diamond_count"),is_client:(0,u.DT)(),type:"gift_send"})}else if(k.kg.event(`[${s.Tn.Error}]${s.Mo.LiveGiftSendCodeNotZero}`,(0,o._)({statusCode:et,logId:null!==(R=null==ee?void 0:ee.logId)&&void 0!==R?R:"",is_client:(0,u.DT)()},null==ee?void 0:ee.data)),20003===et)await (0,b.m8)("登录后即可送礼","live_gift");else if(40001===et){if(!J)return{code:f.P.Success,error_code:null==ee?void 0:null===(x=ee.data)||void 0===x?void 0:x.status_code};let e=null===(F=this._store.giftStore.giftList)||void 0===F?void 0:F.find(e=>Number(e.id)===Number(t)).price;null===(V=this._store.giftStore)||void 0===V||null===(A=V.handleRecharge)||void 0===A||A.call(V,{type:"balance",balance:e-this._store.giftStore.balance,amount:e})}else 42201===et?a.F.info("为保障账号和资金安全，请先前往抖音app完成身份验证"):42202===et?a.F.info("为保障账号和资金安全，请先前往抖音app完成身份核对"):(a.F.info((null==ee?void 0:null===(G=ee.data)||void 0===G?void 0:null===(U=G.data)||void 0===U?void 0:U.prompts)||"送礼失败，请稍后重试"),k.kg.event(`[${s.Tn.Error}]${s.Mo.LiveSendGiftError}`,(0,o._)({statusCode:et,logId:null!==(K=null==ee?void 0:ee.logId)&&void 0!==K?K:"",is_client:(0,u.DT)()},null==ee?void 0:ee.data)));if((null==ee?void 0:null===(g=ee.data)||void 0===g?void 0:g.status_code)===40001)return a.F.info("余额不足，请充值后再试"),{code:f.P.Success,error_code:null==ee?void 0:null===(W=ee.data)||void 0===W?void 0:W.status_code};return{code:f.P.Success,error_code:null==ee?void 0:null===(H=ee.data)||void 0===H?void 0:H.status_code,error_msg:null!==(Y=null==ee?void 0:null===(Z=ee.data)||void 0===Z?void 0:null===(B=Z.data)||void 0===B?void 0:B.prompts)&&void 0!==Y?Y:""}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"getAppInfo",async e=>{try{var t;let{userStore:{odin:e}}=null!==(t=this._store)&&void 0!==t?t:{userStore:{}};return{code:f.P.Success,aid:"6383",user_id:null==e?void 0:e.user_id,device_id:null==e?void 0:e.user_unique_id,is_mas:!!(0,u.xo)(),appID:"6383"}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"getBaseInfo",async e=>{try{let{roomStore:e}=this._store;return{code:f.P.Success,anchor_info:{nickname:O()(e,"roomInfo.anchor.nickname","")}}}catch(t){let{roomStore:e}=this._store;return{code:f.P.Failed,anchor_info:{nickname:O()(e,"roomInfo.anchor.nickname","")}}}}),(0,n._)(this,"userAction",async e=>{let{type:t,args:{user_id:i=""}}=e;try{let e;let n=O()(this._store,"roomStore.roomInfo.roomId",""),o=O()(this._store,"userStore.userInfo.sec_uid",""),l=O()(this._store,"roomStore.roomInfo.anchor.id_str"),r=O()(this._store,"roomStore.setFollowStatus",()=>{});if("follow"===t?e=await (0,P.ZN)({to_user_id:String(i),current_room_id:n,sec_user_id:o,sec_to_user_id:"",channel_id:0}):"unfollow"===t&&(e=await (0,P.fv)({to_user_id:String(i),current_room_id:n,sec_user_id:o,sec_to_user_id:""})),String(l)===String(i)&&e){let t=O()(e,"data.data.follow_status",0);r(t)}return{code:f.P.Success}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"getPaidLiveInfo",async()=>{try{let{paidLiveStore:e}=this._store,t=O()(this._store,"roomStore.roomInfo.anchor.follow_info.follow_status",0),i=O()(this._store,"paidLiveStore.viewType",0),n=t===p.E.FOLLOWING||t===p.E.BOTH;return{code:f.P.Success,paid_live_info:null==e?void 0:e.paidLiveData,follow_status:Number(n),view_type:Number(i)}}catch(e){return{code:f.P.Failed}}}),(0,n._)(this,"userInfo",async e=>{try{var t,i,n,o;let{userStore:e}=this._store,{userInfo:l,odin:r}=e;return{code:(null==r?void 0:r.user_is_login)===1?f.P.Success:f.P.Failed,userInfo:{userID:null==l?void 0:l.user_id_str,nickName:null==l?void 0:l.nickname,avatarURL:null==l?void 0:null===(i=l.avatar_large)||void 0===i?void 0:null===(t=i.url_list)||void 0===t?void 0:t[0],secUserID:null==l?void 0:l.sec_uid,shortID:null==l?void 0:l.short_id},user_id:null==r?void 0:r.user_id,short_id:null==l?void 0:l.short_id,sec_user_id:null==l?void 0:l.sec_uid,nickname:null==l?void 0:l.nickname,avatar:null==l?void 0:null===(o=l.avatar_large)||void 0===o?void 0:null===(n=o.url_list)||void 0===n?void 0:n[0],is_silent:void 0,douyin_uid:null==l?void 0:l.short_id,is_login:null==r?void 0:r.user_is_login}}catch(e){return{code:f.P.Failed,userInfo:{userID:""}}}}),(0,n._)(this,"getUserInfo",async e=>{try{var t,i;let{userStore:e}=this._store,{userInfo:n}=e,o=(null==n?void 0:n.id_str)||(null==n?void 0:n.sec_uid)||(null==n?void 0:n.short_id);return{code:o?f.P.Success:f.P.Failed,isLogin:!!o,is_login:!!o,userInfo:{userID:null==n?void 0:n.id_str,nickName:null==n?void 0:n.nickname,avatarURL:null==n?void 0:null===(i=n.avatar_large)||void 0===i?void 0:null===(t=i.url_list)||void 0===t?void 0:t[0],secUserID:null==n?void 0:n.sec_uid,shortID:null==n?void 0:n.short_id}}}catch(e){return{code:f.P.Failed,userInfo:{userID:""}}}}),(0,n._)(this,"x.getUserInfo",async e=>this.getUserInfo(e)),(0,n._)(this,"baseInfo",async()=>{var e,t,i,n,o;let{userStore:{userInfo:l},roomStore:{roomInfo:r}}=this._store,s={avatar:null==l?void 0:null===(t=l.avatar_large)||void 0===t?void 0:null===(e=t.url_list)||void 0===e?void 0:e[0],nickname:null==l?void 0:l.nickname,sec_user_id:null==l?void 0:l.sec_uid,short_id:null==l?void 0:l.short_id,user_id:null==l?void 0:l.user_id_str,user_level:null==l?void 0:l.level,user_type:"",display_id:null==l?void 0:l.display_id},{anchor:u}=r,a={avatar:null==u?void 0:null===(n=u.avatar_thumb)||void 0===n?void 0:null===(i=n.url_list)||void 0===i?void 0:i[0],nickname:null==u?void 0:u.nickname,short_id:null==u?void 0:u.id_str,user_id:null==u?void 0:u.id_str,sec_user_id:null==u?void 0:u.sec_uid,anchor_level:void 0,anchor_type:void 0,display_id:void 0},d={room_id:null==r?void 0:r.roomId,room_layout:1,is_paidlive:!1,live_room_mode:(null==r?void 0:null===(o=r.room)||void 0===o?void 0:o.live_room_mode)||"0",game_points_playing:2,quiz_game_points_playing:2,is_life:!1};return{code:f.P.Success,user_info:s,room_info:d,anchor_info:a,__data:{user_info:s,room_info:d,anchor_info:a}}}),(0,n._)(this,"close",async e=>{let{url:t}=e,{activityIndicatorStore:{closeLandPage:i}}=this._store;return i(t),{code:f.P.Success}}),(0,n._)(this,"_pcNotSupport",(e,t)=>{(0,w.Jn)({name:e,params:t})}),this._store=e,this._eventBus=new h.N,this.__registerEvent()}}},605125:function(e,t,i){i(675373);var n=i(563097);i(88648);var o=i(821025),l=i(81947),r=i(62783),s=i(346398),u=i(259898),a=i(443737),d=i(702281),c=i(338426);let v=(0,a.n)((0,c.ZP)(()=>Promise.resolve().then(i.bind(i,927928)),{ssr:!1}),{name:l.l.RefreshPlugin,renderWhen:d.d.afterComponent(l.l.ChatRoom)});(0,r.GI)({name:l.l.RefreshPlugin,condition:()=>!0,Component:v,index:0}),t.Z=(0,u.OV)({Component:()=>(0,n.jsx)(s.Z,{name:l.l.RefreshPlugin}),layoutName:o.t.PlayerControlLayout,ComponentName:l.l.RefreshPlugin,index:0})},834870:function(e,t,i){var n=i(520739),o=i(878389);i(874386),i(268917),i(429532),i(250440),i(675373),i(819117);var l=i(408487),r=i(859231),s=i(852061),u=i(456147),a=i(889503),d=i(457388),c=i(83188),v=i(114682),_=i(90463),h=i(794290),f=i(613136),m=i(192109),g=i(178849),p=i(508789),y=i(926012),E=i(466621),b=i(393265),S=i(56702),P=i(907831),k=i.n(P),I=i(645260),L=i.n(I),O=i(332630),N=i.n(O),w=i(410204),T=i.n(w),C=i(128231),D=i.n(C),M=i(779145),R=i.n(M),F=i(96008),A=i.n(F),V=i(88648),x=i(680005),U=i(58655),G=i(516599),K=i(407217),W=i(782563),H=i(428873),B=i(296013),Z=i(884866),Y=i(616406),j=i(242570),$=i(788376),J=i(544845),z=i(489112),q=i(551572);let X=!1,Q=D()(function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];G.F.info(...t)},1e3);t.Z=e=>{let{isVerifyed:t}=e,{isLiveModal:i,linkmicStore:{setFloatModal:P,imLinkMicLayout:I,linkMicConfig:O,linkMicLayout:w,seiLinkMicLayout:C,setEnlargeSeatApplyUid:D,setEnlargeSeatImage:M,setEnlargeGuestType:F,teamfightInfo:ee,setIsPlayModeNotSupport:et,isSing:ei,linkRoomType:en,sceneNum:eo,setSceneNum:el,playModes:er,playModesPC:es,setPlayModes:eu,setTeamfightInfo:ea,guestBattleInfo:ed,setGuestBattleInfo:ec,orderSingInfo:ev,setOrderSingInfo:e_,updateLinkMicConfig:eh,linkMicSeats:ef,linkMicSeatsRaw:em,setImLinkMicSeats:eg,setSeiLinkMicSeats:ep,setLinkStatus:ey,setImLinkMicLayout:eE,setUiLayout:eb,setSeiLinkMicLayout:eS,setOtherRoomLinkSilenceStatus:eP,linkStatus:ek,setLinkMicConfig:eI,selfLinkMicId:eL,resetStore:eO,setOrderSingUserScore:eN,dressListInfo:ew,setDressListInfo:eT,linkMicLayout:eC,setLinkMicSettings:eD,dressMvpInfo:eM,setDressMvpInfo:eR,dressListAll:eF,layoutConfig:eA,setAgcAnchor:eV,setEggModeInfo:ex,functionType2:eU,setIsCrossLink:eG,setCrossLinkTimerStart:eK,crossLinkTimerStart:eW,isCrossLink:eH,setRoomBattleType:eB,uiLayout:eZ,setOpenUiLayout:eY,setAsrSubtitle:ej,lastLayout:e$,setLastLayout:eJ,setShowGiftInfo:ez,linkmicVideoEqualLayoutFrameOpt:eq,setLinkmicVideoEqualLayoutFrameOpt:eX},roomStore:{roomInfo:eQ,setNotSupportReason:e0},userStore:{userInfo:e1},singletonStore:{message:e2,audioPower:e3},eventStore:{linkmicEvent:e6}}=(0,U.o)(),{player:e8}=(0,b.n)(),e4=V.useRef(eW);V.useEffect(()=>{eK(e4.current||0)},[e4.current]);let{leave:e7}=(0,x.Z)(),{isGuestBattle:e5}=(0,j.Z)(),{isGroupFight:e9,isRoomBattle:te}=(0,$.Z)();L()(eQ,"room.linker_map",{});let tt=V.useRef(!1),ti=V.useRef({}),tn=V.useRef({}),to=V.useRef(),tl=V.useRef({}),tr=V.useRef(void 0);V.useRef([]);let ts=V.useRef(void 0),tu=V.useRef(void 0),ta=V.useRef(void 0),td=V.useRef(""),tc=V.useCallback(()=>em,[em]);V.useEffect(()=>{ta.current=ef},[ef]),V.useEffect(()=>{td.current=eU},[eU]);let tv=V.useCallback((e,t)=>{let i=[];return null==e||e.map(e=>{!(null==t?void 0:t.some(t=>(null==t?void 0:t.linkmic_id_str)===(null==e?void 0:e.linkmic_id_str)))&&i.push(e)}),i},[]),t_=V.useCallback(()=>{var e;return eL&&to.current?(0,o._)((0,n._)({},null!==(e=tn.current)&&void 0!==e?e:{}),{[eL]:to.current}):tn.current},[eL]),th=V.useCallback(()=>tl.current,[]),tf=V.useCallback(e=>{eS(e)},[eS]);(0,E.wz)({selfLinkMicId:eL,setLayout:tf,setSeats:ep,layout:C,getUsers:t_,getPositions:th,getSeats:tc,enable:!0,roomIdStr:eQ.roomId,audioPower:e3,linkRoomType:en,uiLayout:eZ,setUiLayout:eb,linkStatus:ek});let tm=V.useCallback(e=>{let t=void 0===e?I:e;void 0===t&&eZ===l.V_.LINKMICUILAYOUT_LIVE_PARTNER_DYNAMIC&&(t=y.yP.MATE_CUSTOM);let i=k()(_.Fk);return t===y.yP.VIDEO_DYNAMIC||t===y.yP.MATE_CUSTOM?i={}:t===y.yP.AUDIO_DOUBLE_C&&(i=(0,E.Lq)(10)),Object.values(ti.current).forEach(e=>{"number"==typeof e.user_position&&(i[e.user_position]={idx:e.user_position,user:e})}),Object.keys(tl.current).forEach(e=>{tl.current[e]&&(i[e].info=(0,n._)({},tl.current[e]))}),1===Object.keys(i).length&&t===y.yP.VIDEO_DYNAMIC&&(i[1]={idx:1}),t===y.yP.AUDIO_DOUBLE_C&&9===Object.keys(i).length&&(i[9]={idx:9}),i},[I,eZ]),tg=V.useCallback(e=>{let{listUsers:t,type:i,linkUsers:o,version:l}=e,r=void 0===i?I:i,s=(e,t)=>{let i={};return e.forEach(e=>{var n,o,l,s,u,a;if(e&&"number"==typeof e.user_position&&("number"!=typeof e.is_background&&(e.is_background=Number(e.is_background)),null===(o=e.content)||void 0===o?void 0:null===(n=o.linkmic_audience_content)||void 0===n?void 0:n.rank_contributor_ids)){let t=null===(s=e.content)||void 0===s?void 0:null===(l=s.linkmic_audience_content)||void 0===l?void 0:l.rank_contributor_ids;t[0],t&&(e.content.linkmic_audience_content.rank_contributor_ids=t)}e&&e.linkmic_id_str&&((null==e1?void 0:e1.id_str)&&(null===(u=e.user)||void 0===u?void 0:u.id_str)===(null==e1?void 0:e1.id_str)&&(to.current=e),e.user_position=Number(null!==(a=null==e?void 0:e.user_position)&&void 0!==a?a:0),r===y.yP.VIDEO_6V6&&!t&&(e.user_position=e.user_position+y.Lf[r]),i[e.linkmic_id_str]=e)}),r===y.yP.VIDEO_6V6&&0===Object.keys(i).length&&Object.keys(ti.current).forEach(e=>{var n,o;let l=null==ti?void 0:ti.current[e];t&&(null!==(n=null==l?void 0:l.user_position)&&void 0!==n?n:0)<y.Lf[r]?i[e]=l:!t&&(null!==(o=null==l?void 0:l.user_position)&&void 0!==o?o:0)>=y.Lf[r]&&(i[e]=l)}),i},u=s(null!=t?t:[],!0),a=r===y.yP.VIDEO_6V6?s(null!=o?o:[],!1):[],d=(0,n._)({},u,a);tn.current=Object.assign({},tn.current,ti.current,d),ti.current=d;let c=tm(r);return eg(c,l),c},[eg,tm,e1,I]),tp=V.useCallback(e=>{let t={};return null==e||e.forEach(e=>{void 0!==e.key&&void 0!==e.value&&(t[e.key]=e.value)}),t},[]),ty=V.useMemo(()=>0!==R()(ef).filter(e=>!!(null==e?void 0:e.user)).length,[ef]);V.useEffect(()=>{tr.current=I},[ty]);let tE=V.useMemo(()=>T()(ef).filter(e=>e.user).length,[ef]);V.useEffect(()=>{"1"===eq&&q.qK.includes(w)?e8.position((0,z.PS)(w,tE)):w===y.yP.AUDIO_1V8||w===y.yP.AUDIO_GRID||w===y.yP.VIDEO_GRID||w===y.yP.VIDEO_DYNAMIC?e8.position({y:.203,h:.5}):w===y.yP.VIDEO_6V6?e8.position({y:.183,h:.52}):[w===y.yP.VIDEO_1V6,w===y.yP.VIDEO_1V8,w===y.yP.VIDEO_1_V_8].some(Boolean)?e8.position({y:1-.7375,h:.7375}):w===y.yP.VIDEO_DYNAMIC_FLOAT||w===y.yP.MATE_CUSTOM?e8.position({y:0,h:1}):w===y.yP.VIDEO_1_V_6?e8.position({y:.203,h:.5}):w===y.yP.VIDEO_1_V_3?e8.position({y:.203,h:.5}):w===y.yP.VIDEO_T1_V_B8?e8.position({y:.11,h:.7375}):w===y.yP.VIDEO_2V4V4&&e8.position({y:.203,h:.625})},[w,eq,tE]);let tb=(0,H.Z)();V.useEffect(()=>{if((null==tb?void 0:tb.data)&&(null==tb?void 0:tb.status_code)===0){var e;let{teamfight_info:t,guest_battle_info:i,linkmic_play_mode_info:n}=null==tb?void 0:tb.data,o=t||(null==n?void 0:n.teamfight_info);o&&ea(o);let l=i||(null==n?void 0:n.guest_battle_info);l&&ec(l),n&&ez((null==n?void 0:null===(e=n.order_sing_info)||void 0===e?void 0:e.show_gift_info)||!1),I===y.yP.VIDEO_6V6&&(null==e6||e6.liveAudiencePlayModeRoomEvent(tr.current))}},[tb]),V.useEffect(()=>{var e;let t=null!==(e=null==ed?void 0:ed.dress_id)&&void 0!==e?e:"",i=(null==ee?void 0:ee.dressId)||(null==ee?void 0:ee.dress_id)||"";if(t!==(null==ew?void 0:ew.dress_id)&&""!==t){let e=eF.find(e=>e.dress_id===t);e?eT(e):(0,u.VT)({dress_id:t}).then(e=>{var t,i,n,o;if(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.data){let t=null!==(o=null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.dress_list)&&void 0!==o?o:[];t.length&&eT(t[0])}})}if(i!==(null==eM?void 0:eM.dress_id)&&""!==i){let e=eF.find(e=>e.dress_id===i);e?eR(e):(0,u.VT)({dress_id:e}).then(e=>{var t,i,n,o;if(null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.data){let t=null!==(o=null==e?void 0:null===(n=e.data)||void 0===n?void 0:null===(i=n.data)||void 0===i?void 0:i.dress_list)&&void 0!==o?o:[];t.length&&eR(t[0])}})}},[null==ed?void 0:ed.battle_id_str,ee]);let tS=V.useCallback(async()=>{var e,t,i,l,r,s,a,d,c,v,_,f;let m=L()(eQ,"roomId",""),g=L()(eQ,"anchor.sec_uid",""),p=L()(eQ,"anchor.id_str",""),E=L()(eQ,"room.AnchorABMap.live_linkmic_order_sing_micro_opt","");eX(L()(eQ,"room.AnchorABMap.linkmic_video_equal_layout_frame_opt","0"));let[b,P]=await Promise.all([(0,u.lx)({room_id:m,anchor_id:p}),(0,u.$s)(m,g)]);if(P.data&&0===P.status_code){let u=tp(null===(e=P.data)||void 0===e?void 0:e.settings),a=(0,o._)((0,n._)({},P.data),{config:u});eI(a);let d=(a.settings||[]).find(e=>e.key===h.V9.AU_AudioSubtitle);d&&ej({isOpen:(null==d?void 0:null===(i=d.content)||void 0===i?void 0:null===(t=i.audio_subtitle_content)||void 0===t?void 0:t.audio_subtitle_value)===1,type:(null==d?void 0:null===(s=d.content)||void 0===s?void 0:null===(r=s.audio_subtitle_content)||void 0===r?void 0:null===(l=r.linkmic_subtitle_status)||void 0===l?void 0:l.subtitle_type)||S.rFD.SubtitleType_Room})}if(b.data.data&&0===b.data.status_code){let{user:e,locked_positions:t,linker_content_map:i,linker_base_info:n={}}=b.data.data,{scene:o,play_modes:l=[],cross_link_timer_start:r}=n;if(16!==o||l.map(e=>Number(e)).includes(16)?16===o&&l.map(e=>Number(e)).includes(16)&&r&&(eG(!0),eB("pk"),e4.current=Number(r)):(eG(!0),eB("crossLink"),e4.current=Number(r||Math.floor(Date.now()/1e3))),null==t||t.forEach(e=>{void 0!==e.position&&(tl.current[e.position]=e)}),I===y.yP.VIDEO_6V6){let e=null==i?void 0:null===(c=i[null===(v=Object.keys(i))||void 0===v?void 0:v[0]])||void 0===c?void 0:c.room_link_silence_status;void 0!==e&&eP(e)}tg({listUsers:e,type:I,linkUsers:null==i?void 0:null===(a=i[null===(d=Object.keys(i))||void 0===d?void 0:d[0]])||void 0===a?void 0:a.linked_users})}if(er.includes(S.V0x.LinkmicPlayMode_OrderSing)){let[e,t]=await Promise.all([(0,u.RO)({room_id:m}),(0,K.ZP)({service_name:"webcast.douyin.live_pc",key:"order_sing_info"})]);if(e.data.data&&0===e.data.status_code){let i=e.data.data;i.live_linkmic_order_sing_micro_opt=E,i.golden_microphone_icon=null==t?void 0:t.golden_microphone_icon,i.silver_microphone_icon=null==t?void 0:t.silver_microphone_icon,i.user_microphone_list=null!==(f=null===(_=e.data.data.user_microphone_list)||void 0===_?void 0:_.map(e=>{var t,i,n;return(null===(i=null==e?void 0:null===(t=e.microphone_list)||void 0===t?void 0:t.length)||void 0===i||i)&&(e.microphone_list=[...null!==(n=e.microphone_list)&&void 0!==n?n:[],{microphone_type:S.W5X.GOLDEN_MICROPHONE,micro_phone_num:0}]),e}))&&void 0!==f?f:[],e_(i),null==e6||e6.liveAudiencePlayModeRoomEvent(tr.current,"request_song")}}(0,K.ZP)({service_name:"webcast.douyin.live_pc",key:"agc_anchor_list"}).then(e=>{e&&(null==e?void 0:e.includes(p))&&eV(!0)})},[tg,eQ,eI,I,tp,eP,er,e_,eV,eG,eB,eX]);V.useEffect(()=>{!tt.current&&(tS(),tt.current=!0)},[tS]);let tP=(0,B.F)(),tk=V.useRef(ek);V.useEffect(()=>{tk.current=ek},[ek]),V.useEffect(()=>e2.syncOn("ControlMessage",e=>{let{method:t,payload:i}=e;if(!!t&&!!i)switch(Number(i.action)){case r.Rz.FINISH:case r.Rz.FINISH_BY_ADMIN:case r.Rz.ROOM_FINISH_BY_SWITCH:d.kg.info("直播间断播消息下发, 离开聊天室"),X=!0,e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{null==e6||e6.liveLinkMicDurationEvent(tr.current),null==e6||e6.liveVoiceRoomLayoutWatchDuration((0,Y.getLayoutParams)(tr.current,(0,Z.ic)(ta.current)),(0,Y.getFunctionType)(tr.current,td.current)),(0,_.SH)(I,es)?(null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(tr.current,ts.current),ek===_.cK.LINKED&&(null==e6||e6.liveAudiencePlayModeRoomLinkDurationEvent(void 0,ts.current)),ek===_.cK.LINKED&&(null==e6||e6.liveLeaveLinkMicEvent(s.JW.NONE,s._o.ANCHOR,ts.current))):(e5||e9||te)&&(null==e6||e6.liveLeaveLinkMicEvent(s.JW.NONE,s._o.ANCHOR),null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent()),eO()})}}),[e7,eO,es,I,ek,t,e2,e6]),V.useEffect(()=>null==e2?void 0:e2.syncOn("MemberMessage",e=>{let{method:t,payload:n}=e;if(!t||!n)return;let o=Number(n.action);switch(o){case r.WU.KICK_OUT:case r.WU.BLOCK:case r.WU.LEAVE:if(o===r.WU.LEAVE&&(null==n?void 0:n.action_description)==="WEB_INITIATIVE"||o===r.WU.LEAVE&&i)return;d.kg.info("直播间用户被踢出, 离开聊天室"),e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{null==e6||e6.liveLinkMicDurationEvent(tr.current),null==e6||e6.liveVoiceRoomLayoutWatchDuration((0,Y.getLayoutParams)(tr.current,(0,Z.ic)(ta.current)),(0,Y.getFunctionType)(tr.current,td.current)),(0,_.SH)(I,es)&&(null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(tr.current,ts.current)),eO()})}}),[e7,eO,w,es,I,t,e2,e6,i]),V.useEffect(()=>e2.syncOn("NoticeMessage",e=>{let{method:t,payload:i}=e;if(!!t&&!!i){if(Number(i.notice_type)===r.F3.PAUSE)d.kg.info("直播间被封禁, 离开聊天室"),e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{null==e6||e6.liveLinkMicDurationEvent(tr.current),null==e6||e6.liveVoiceRoomLayoutWatchDuration((0,Y.getLayoutParams)(tr.current,(0,Z.ic)(ta.current)),(0,Y.getFunctionType)(tr.current,td.current)),(0,_.SH)(I,es)&&(null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(tr.current,ts.current)),eO()})}}),[t]),V.useEffect(()=>e2.syncOn("LinkSettingNotifyMessage",e=>{let{method:t,payload:i}=e;if(!t||!i)return;let n=Number(null==i?void 0:i.message_type);d.kg.info("uselinkmic",t,n,i);let{settings:o}=i;(null==o?void 0:o.find(e=>24===e.value))?I!==y.yP.AUDIO_1V8_STAGE&&eE(y.yP.AUDIO_1V8):(null==o?void 0:o.find(e=>26===e.value))&&eE(y.yP.AUDIO_GRID);try{if(null==o?void 0:o.find(e=>72===e.key)){var l,r;let e=R()(O.settings).findIndex(e=>72===e.key),t=null==o?void 0:o.find(e=>72===e.key);if(e>=0&&Array.isArray(O.settings)&&e<(null===(l=O.settings)||void 0===l?void 0:l.length)){let i=null===(r=O.settings)||void 0===r?void 0:r.slice();i[e]=(0,a._0)(t),eD(i)}}}catch(e){d.kg.info("处理嘉宾大作战设置消息变更异常",e)}eh(tp(o))}),[t,tp,null==O?void 0:O.settings,eE,I,eD,eh]);let tI=V.useCallback((e,t,i)=>{(null==e1?void 0:e1.isReady)&&(0,v.Qz)({anchor_id:L()(eQ,"anchor.id_str",""),room_id:null==eQ?void 0:eQ.roomId,user_id:null==e1?void 0:e1.id_str,scene:e,playmode:t,ui_layout:i})},[eQ,e1]);V.useEffect(()=>e2.syncOn("LinkMicMethod",e=>{let{method:t,payload:i}=e;if(!!t&&!!i)switch(Number(i.message_type)){case m.iM.TYPE_KICKOUTED:G.F.info("你的连线已被断开"),e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{ey(_.cK.NOT_LINK)});break;case m.iM.TYPE_SWITCH_SCENE:let n;let{scene:o,play_modes:l=[],linked_list_users:u=[],linker_content_map:d={},ui_layout:v}=i;if(eb(v),"string"==typeof o){let e=Number(o);if(el(e),eH&&16!==e&&(eG(!1),e4.current=0,eP(void 0)),!eH&&16===e&&e4.current>0&&(eG(!0),eB("crossLink")),e===r.vX.AUDIO_KTV)et(!0),e0(r.Ly.MULTI_KTV),tI(e,l,v);else{let e=Number(v);n=(0,c.M2)(e,eA)}void 0!==n&&eE(n)}if((n=void 0===n?I:n)===y.yP.VIDEO_6V6){var h,f;let e=null===(f=Object.values(d))||void 0===f?void 0:null===(h=f[0])||void 0===h?void 0:h.linked_users,t=tv(u,e);tg({listUsers:null==t?void 0:t.map(a._0),type:n,linkUsers:null==e?void 0:e.map(a._0)})}else tg({listUsers:null==u?void 0:u.map(a._0),type:n,version:null==i?void 0:i.version});break;case m.iM.TYPE_LINKED_LIST_CHANGED:let g=Number(null==i?void 0:i.ui_layout),p=(0,c.M2)(g,eA);eb(null==i?void 0:i.ui_layout),void 0!==p&&eE(p);case m.iM.TYPE_FINISH:}}),[tP,tv,I,ek,null==e8?void 0:e8.root,eA,eE,et,e0,el,tg,e7,ey,t,eH,eB]),V.useEffect(()=>e2.syncOn("LinkMessage",e=>{var t,i,n,o,l,r,u,v,h,m,g,p,E,b,S,P,k,L,O,N,w,C,R;let{method:A,payload:V}=e;if(!A||!V)return;let x=Number(V.message_type);switch(d.kg.info("uselinkmic",A,x,V),x){case f.W6.TYPE_LINKER_CLOSE:!X&&e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(void 0,ts.current),null==e6||e6.liveLinkMicDurationEvent(tr.current,ts.current),null==e6||e6.liveVoiceRoomLayoutWatchDuration((0,Y.getLayoutParams)(tr.current,(0,Z.ic)(ta.current)),(0,Y.getFunctionType)(tr.current,td.current)),ek===_.cK.LINKED&&(null==e6||e6.liveAudiencePlayModeRoomLinkDurationEvent(void 0,ts.current)),ek===_.cK.LINKED&&(null==e6||e6.liveLeaveLinkMicEvent(s.JW.NONE,s._o.ANCHOR,ts.current)),eO()});break;case f.W6.TPYE_LINKER_LEAVE:tg({listUsers:null===(i=V.leave_content)||void 0===i?void 0:null===(t=i.linked_users)||void 0===t?void 0:t.map(a._0),version:null==V?void 0:null===(n=V.leave_content)||void 0===n?void 0:n.version});break;case f.W6.TPYE_LINKER_ENTER:tg({listUsers:null==V?void 0:null===(l=V.enter_content)||void 0===l?void 0:null===(o=l.linked_users)||void 0===o?void 0:o.map(a._0),version:null==V?void 0:null===(r=V.enter_content)||void 0===r?void 0:r.version}),(null==e1?void 0:e1.id_str)&&(null===(u=V.enter_content)||void 0===u?void 0:u.user_id)===(null==e1?void 0:e1.id_str)&&eg(tm());break;case f.W6.TYPE_LINKER_UPDATE_USER:tg({listUsers:null===(h=V.update_user_content)||void 0===h?void 0:null===(v=h.linked_users)||void 0===v?void 0:v.map(a._0),version:null==V?void 0:null===(m=V.update_user_content)||void 0===m?void 0:m.version});break;case f.W6.TPYE_LINKER_SYS_KICK_OUT:case f.W6.TPYE_LINKER_KICK_OUT:d.kg.info("接收被踢出房间，更新上麦状态"),e7(s.JW.NONE,s._o.ANCHOR).finally(()=>{ey(_.cK.NOT_LINK)});break;case f.W6.TYPE_LINKER_LOCK_POSITION:let{locked_positions:U}=V.lock_position_content;tl.current={},null==U||U.forEach(e=>{if("string"==typeof e.position){let t=Number(e.position);e.position=t,tl.current[t]=e}else"number"==typeof e.position&&(tl.current[e.position]=e)}),eg(tm());break;case f.W6.TYPE_LINKER_LINKED_LIST_CHANGE:I===y.yP.VIDEO_6V6?tg({listUsers:void 0,type:I,linkUsers:null===(E=Object.values(null===(b=V.linked_list_change_content)||void 0===b?void 0:b.linker_content_map))||void 0===E?void 0:null===(p=E[0])||void 0===p?void 0:null===(g=p.linked_users)||void 0===g?void 0:g.map(a._0)}):tg({listUsers:null===(P=V.linked_list_change_content)||void 0===P?void 0:null===(S=P.linked_users)||void 0===S?void 0:S.map(a._0),version:null===(k=V.linked_list_change_content)||void 0===k?void 0:k.version});break;case f.W6.TYPE_LINKER_CROSS_ROOM_UPDATE:let{linker_content_map:K}=V.cross_room_update_content;eP(null===(O=Object.values(K))||void 0===O?void 0:null===(L=O[0])||void 0===L?void 0:L.room_link_silence_status);break;case f.W6.TYPE_ENLARGE_GUEST_INVITE:D(null==V?void 0:null===(N=V.enlarge_guest_invite_content)||void 0===N?void 0:N.from_user_id),M(((null==V?void 0:null===(C=V.enlarge_guest_invite_content)||void 0===C?void 0:null===(w=C.ui_image)||void 0===w?void 0:w.url_list)||[])[0]||""),F((null==V?void 0:null===(R=V.enlarge_guest_invite_content)||void 0===R?void 0:R.target_enlarge_guest_type)||0);break;case f.W6.TYPE_LINKER_UILAYOUT_CHANGE:let{ui_layout:W}=null==V?void 0:V.linker_ui_layout_change_content,H=Number(W);eb(H),eE((0,c.M2)(H,eA));break;case f.W6.TYPE_LINKER_CROSS_LINK_INFO_UPDATE:let{cross_link_info_update:B={}}=V,{cross_link_timer_start:j=Math.floor(Date.now()/1e3)}=B;e4.current=Number(j),eH?eB("crossLink"):16===eo&&(eG(!0),eB("crossLink"));break;case f.W6.TYPE_LINKER_CROSS_LINK_FINISH:let{cross_link_finish:$={}}=V,J=null==e1?void 0:e1.id_str,z=T()(ef),q=null==z?void 0:z.includes(J),{finish_toast:Q="",guest_finish_toast:ee=""}=$;eH&&(eG(!1),e4.current=0,eP(void 0),q&&ee?G.F.info(ee,e8.root):Q&&G.F.info(Q,e8.root))}}),[t,D,I,tg,ey,e7,eO,tm,eg,ek,eE,eP,e1,eA,eH,eG,eB,ef,null==e8?void 0:e8.root,eo]),V.useEffect(()=>e2.syncOn("LinkerContributeMessage",e=>{let{method:t,payload:i}=e;if(!t||!i)return;null==i||i.message_type;let{total_score_str:n,total_score_real_str:o,user_contribute_list:l,user_id:r}=i,s=(null==l?void 0:l.map(e=>String(null==e?void 0:e.user_id)))||[],u=String(r),a=Object.keys(ti.current).find(e=>{var t;return(null===(t=ti.current[e].user)||void 0===t?void 0:t.id_str)===u});if(a&&ti.current[a]){var d;let e=null===(d=ti.current[a].content)||void 0===d?void 0:d.linkmic_audience_content;e&&(e.rank_contributor_ids=s,e.fan_ticket_real_str=o,e.fan_ticket_fuzzy_str=n)}eg(tm())}),[tm,eg,t]),V.useEffect(()=>e2.syncOn("LinkmicTeamfightScoreMessage",e=>{let{method:t,payload:i}=e;if(!t||!i)return;null==i||i.message_type;let{teamfight_info:n}=i,o=(0,a._0)(n);ts.current=ee,ea(o,!0)}),[ea,ee]),V.useEffect(()=>e2.syncOn("LinkmicTeamfightMessage",e=>{var t,i,n,o,l;let{method:r,payload:s}=e;if(!r||!s)return;let{teamfight_info:u,finish_content:d,settle_content:c}=s,v=(0,a._0)(u),h=null==e1?void 0:e1.id_str,f=N()(null==u?void 0:null===(t=u.team_infos)||void 0===t?void 0:t.map(e=>{var t;return null==e?void 0:null===(t=e.players)||void 0===t?void 0:t.map(e=>String(null==e?void 0:e.user_id))})),m=null==f?void 0:f.includes(h);if(s.msg_type===S.Vql.LinkmicTeamfightMessageType_CREATE&&(null==e6||e6.liveLinkMicRoomShowEvent(tr.current||y.yP.VIDEO_T1_V_B8),(null==s?void 0:null===(i=s.teamfight_info)||void 0===i?void 0:i.type)===g.yw.LinkmicTeamfightType_TWO_TEAM&&("video"===en?A()():(eJ(I),eE(y.yP.AUDIO_1V8)),m&&(null==e6||e6.liveAudiencePlayModeRoomLinkEvent(u)))),s.msg_type===S.Vql.LinkmicTeamfightMessageType_START&&((null==s?void 0:null===(n=s.teamfight_info)||void 0===n?void 0:n.type)===g.yw.LinkmicTeamfightType_TWO_TEAM&&m&&G.F.info("如不愿参与作战可退出连线",e8.root),(null==s?void 0:null===(o=s.teamfight_info)||void 0===o?void 0:o.type)===g.yw.LinkmicTeamfightType_ROOM_BATTLE&&(eB("pk"),m&&(G.F.info("跨房对战已开启 如不愿参与对战可退出连线"),null==e6||e6.liveAudiencePlayModeRoomLinkEvent(void 0,"room_grouppk")))),s.msg_type===S.Vql.LinkmicTeamfightMessageType_FINISH){if((null==s?void 0:null===(l=s.teamfight_info)||void 0===l?void 0:l.type)===g.yw.LinkmicTeamfightType_TWO_TEAM){if("video"===en)A()();else{let e=L()(eQ,"room.linker_detail.linker_play_modes",[]);setTimeout(()=>{e.includes(24)?e$?(eE(e$),eJ(void 0)):eE(y.yP.AUDIO_1V8):e.includes(26)&&eE(y.yP.AUDIO_GRID)},1e3)}}null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(void 0,ts.current)}let p=Number(s.msg_type);p===S.Vql.LinkmicTeamfightMessageType_FINISH&&(eH?(eB("crossLink"),e4.current=0):eP(void 0),ek===_.cK.LINKED&&(null==e6||e6.liveAudiencePlayModeRoomLinkDurationEvent(void 0,ts.current)),setTimeout(()=>{var e,t,i,n;let o=tk.current===_.cK.LINKED;o&&(null!==(e=null==d?void 0:d.guest_finish_toast)&&void 0!==e?e:"")!==""?Q(null!==(i=null==d?void 0:d.guest_finish_toast)&&void 0!==i?i:"",e8.root):!o&&(null!==(t=null==d?void 0:d.finish_toast)&&void 0!==t?t:"")!==""&&Q(null!==(n=null==d?void 0:d.finish_toast)&&void 0!==n?n:"",e8.root)},1e3)),p===S.Vql.LinkmicTeamfightMessageType_PUNISH&&(null==c?void 0:c.disable_show_toast)!==""&&(null==c?void 0:c.disable_show_toast)!==void 0&&G.F.info(null==c?void 0:c.disable_show_toast),ts.current=ee,ea(v)}),[en,e8.root,eQ,I,ef,ek,e1,ea,eE,eP,ee,tk,t,eH,eB,eJ,e$]),V.useEffect(()=>e2.syncOn("LinkmicProfitEggMessage",e=>{let{method:t,payload:i}=e;if(!!t&&!!i)ex(i)}),[ex]),V.useEffect(()=>e2.syncOn("LinkmicOrderSingMessage",e=>{let{method:t,payload:i}=e;if(!t||!i)return;let n=Number(null==i?void 0:i.message_type);switch(d.kg.info("uselinkmic",t,n,i),n){case p.ZP.TYPE_MESSAGE_CREATE:let{order_sing_create_content:o}=i;(0,K.ZP)({service_name:"webcast.douyin.live_pc",key:"order_sing_info"}).then(e=>{let t=k()(ev)||{};t.golden_microphone_icon=null==e?void 0:e.golden_microphone_icon,t.silver_microphone_icon=null==e?void 0:e.silver_microphone_icon,t.gift_id=Number(null==o?void 0:o.gift_id),t.gift_ids=null==o?void 0:o.gift_ids,t.audition_gift_ids=null==o?void 0:o.audition_gift_ids;let i=Object.keys(ef).map(e=>{var t,i;return{microphone_list:[{microphone_type:S.W5X.GOLDEN_MICROPHONE,micro_phone_num:0},{microphone_type:S.W5X.SILVER_MICROPHONE,micro_phone_num:0}],order_user:{id:null===(i=ef[e].user)||void 0===i?void 0:null===(t=i.user)||void 0===t?void 0:t.id_str}}});t.user_microphone_list=i,tu.current=ev,e_(t),eu([...er,S.V0x.LinkmicPlayMode_OrderSing]),ez((null==o?void 0:o.show_gift_info)||!1),null==e6||e6.liveAudiencePlayModeRoomEvent(tr.current)}),(null==o?void 0:o.open_order_sing_toast)&&G.F.info(o.open_order_sing_toast);break;case p.ZP.TYPE_MESSAGE_FINISH:let{order_sing_finish_content:l}=i;(null==l?void 0:l.close_order_sing_toast)&&G.F.info(null==l?void 0:l.close_order_sing_toast),tu.current=ev,e_(void 0),P(_.uH.NONE),er.includes(S.V0x.LinkmicPlayMode_OrderSing)&&eu(er.filter(e=>e!==S.V0x.LinkmicPlayMode_OrderSing));break;case p.ZP.TYPE_MESSAGE_SING_ACTION_TOAST:let{order_sing_action_toast_content:r}=i;(null==r?void 0:r.start_sing_toast)?G.F.info(r.start_sing_toast):(null==r?void 0:r.oder_sing_toast)?G.F.info(r.oder_sing_toast):(null==r?void 0:r.finish_sing_toast)&&G.F.info(r.finish_sing_toast);break;case p.ZP.TYPE_MESSAGE_SING_ACTION:(0,u.RO)({room_id:eQ.roomId}).then(e=>{if(e.data.data&&0===e.data.status_code){var t,i;let n=k()(ev)||e.data.data;n.user_microphone_list=null!==(i=null===(t=e.data.data.user_microphone_list)||void 0===t?void 0:t.map(e=>{var t,i,n;return(null===(i=null==e?void 0:null===(t=e.microphone_list)||void 0===t?void 0:t.length)||void 0===i||i)&&(e.microphone_list=[...null!==(n=e.microphone_list)&&void 0!==n?n:[],{microphone_type:S.W5X.GOLDEN_MICROPHONE,micro_phone_num:0}]),e}))&&void 0!==i?i:[],n.current_sing_item=e.data.data.current_sing_item,n.auto_enlarge=e.data.data.auto_enlarge,n.gift_id=e.data.data.gift_id,e_(n)}})}}),[t,eQ.roomId,P,ef,er,eu,ev,e_,ez]),V.useEffect(()=>e2.syncOn("LinkmicOrderSingScoreMessage",e=>{var t,i,n,o,l;let{method:r,payload:s}=e;if(!r||!s)return;let u=Number(null==s?void 0:s.message_type);d.kg.info("uselinkmic",r,u,s);let{order_sing_score_content:c}=s,{user_score:v}=null!=c?c:{},_=k()(ev),h=[{microphone_type:S.W5X.GOLDEN_MICROPHONE,micro_phone_num:null!==(i=null==v?void 0:v.golden_microphone_num)&&void 0!==i?i:0,title_sponsor:null!==(n=null==v?void 0:v.title_sponsor)&&void 0!==n?n:{},hit_toast:null!==(o=null==v?void 0:v.hit_toast)&&void 0!==o&&o},{microphone_type:S.W5X.SILVER_MICROPHONE,micro_phone_num:null!==(l=null==v?void 0:v.silver_microphone_num)&&void 0!==l?l:0}],f=!1;if(null==_||null===(t=_.user_microphone_list)||void 0===t||t.map(e=>{var t;String(null===(t=e.order_user)||void 0===t?void 0:t.id)===(null==v?void 0:v.user_id)&&(f=!0,e.microphone_list=h)}),!f){let e=(null==_?void 0:_.user_microphone_list)?[...null==_?void 0:_.user_microphone_list]:[];e.push({order_user:{id:null==v?void 0:v.user_id},microphone_list:h}),_&&(_.user_microphone_list=e)}tu.current=ev,_&&e_(_),v&&eN((0,a._0)(v))}),[ev,e_,eN,t]),V.useEffect(()=>e2.syncOn("GuestBattleMessage",e=>{var t,i;let{method:n,payload:o}=e;if(!n||!o)return;let l=Number(null==o?void 0:o.message_type);d.kg.info("uselinkmic",n,l,o);let{battle_info:r,finish_content:s,finish_toast:u}=o,c=null===(i=T()(ef))||void 0===i?void 0:null===(t=i.map(e=>{var t,i;return null==e?void 0:null===(i=e.user)||void 0===i?void 0:null===(t=i.user)||void 0===t?void 0:t.id_str}))||void 0===t?void 0:t.filter(e=>![void 0,""].includes(e)),v=null==e1?void 0:e1.id_str,h=null==c?void 0:c.includes(v),f=Number(o.msg_type);ec((0,a._0)(r)),f===S.$s7.GuestBattle_CREATE&&(localStorage.removeItem("guest_battle_animation"),null==e6||e6.guestBattleLiveConnectionGameTransformEvent(),h&&setTimeout(()=>{G.F.info("如不愿参与作战可退出连线",e8.root)},1750)),f===S.$s7.GuestBattle_FINISH?(eP(void 0),ek===_.cK.LINKED&&(null==e6||e6.liveAudiencePlayModeRoomLinkDurationEvent(void 0,ts.current)),null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(void 0,void 0,void 0,void 0,ed),""!==u?(G.F.info(u,e8.root),localStorage.removeItem("guest_battle_animation")):(null==s?void 0:s.reason)===S.GO3.FinishGuestBattleReason_SCENE_CHANGE&&(G.F.info("本轮作战结束，恢复原始连线记值展示",e8.root),localStorage.removeItem("guest_battle_animation"))):f===S.$s7.GuestBattle_PAUSE?G.F.info("大作战计时已暂停",e8.root):f===S.$s7.GuestBattle_RESUME&&G.F.info("大作战计时继续",e8.root)}),[e8.root,ef,ek,e1,ed,ec,eP,t]),V.useEffect(()=>e2.syncOn("GuestBattleScoreMessage",e=>{let{method:t,payload:i}=e;if(!t||!i)return;let n=Number(null==i?void 0:i.message_type);d.kg.info("uselinkmic",t,n,i);let{battle_info:o}=i;ec((0,a._0)(o))}),[ec,t]),V.useEffect(()=>null==e2?void 0:e2.wrds.on("RoomDataSyncMessage","RoomLinkMicSyncData",e=>{let t=L()(e,"payload.payload.linker_base_info.anchor_manual_open_ui_layout");t&&eY(Number(t))}),[eY]),V.useEffect(()=>null==e2?void 0:e2.syncOn("LinkmicPlaymodeMessage",e=>{let{method:t,payload:i}=e;if(!!t&&!!i){if(null==i?void 0:i.linkmic_subtitle_status){var n;ej({isOpen:!0,type:(null==i?void 0:null===(n=i.linkmic_subtitle_status)||void 0===n?void 0:n.subtitle_type)||S.rFD.SubtitleType_Room})}}}),[ej]),V.useEffect(()=>null==e2?void 0:e2.on("LinkmicProfitMessage",e=>{e.forEach(e=>{let{method:t,payload:i}=e;if(!t||!i)return;let n=i.msg_type;if("string"==typeof i.msg_type&&(n=Number(i.msg_type)),7===n&&eu([...er,S.V0x.LinkmicPlayMode_NormalPaidLinkmic]),8===n&&eu(er.filter(e=>e!==S.V0x.LinkmicPlayMode_NormalPaidLinkmic)),20===n){var o,l;ej({isOpen:!0,type:(null==i?void 0:null===(l=i.audio_subtitle_start_content)||void 0===l?void 0:null===(o=l.linkmic_subtitle_status)||void 0===o?void 0:o.subtitle_type)||S.rFD.SubtitleType_Room})}21===n&&ej({isOpen:!1,type:S.rFD.SubtitleType_Room})})}),[e2]);let tL=V.useCallback(()=>{ek===_.cK.LINKED&&(null==e6||e6.liveLeaveLinkMicEvent(s.JW.NONE,s._o.AUDIENCE,ts.current),(0,_.SH)(I,es)&&(null==e6||e6.liveAudiencePlayModeRoomLinkDurationEvent(I,ts.current))),void 0!==I&&(null==e6||e6.liveLinkMicDurationEvent(tr.current),null==e6||e6.liveVoiceRoomLayoutWatchDuration((0,Y.getLayoutParams)(tr.current,(0,Z.ic)(ta.current)),(0,Y.getFunctionType)(tr.current,td.current)),(0,_.SH)(I,es)?null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent(void 0,void 0,[],tu.current):(e5||e9||te)&&(null==e6||e6.liveAudiencePlayModeRoomWatchDurationEvent())),e7(s.JW.NONE,s._o.AUDIENCE,!0)},[e7,ek,es,I]);V.useEffect(()=>{let e="onpagehide"in self?"pagehide":"unload",t=e=>{if(ek===_.cK.LINKED)return e.returnValue="正在连麦中，是否确认离开？","正在连麦中，是否确认离开？"};return(0,W.DT)()?window.addEventListener("beforeunload",tL):(window.addEventListener("beforeunload",t),window.addEventListener(e,tL)),()=>{(0,W.DT)()?window.removeEventListener("beforeunload",tL):(window.removeEventListener("beforeunload",t),window.removeEventListener(e,tL))}},[ek,tL]),(0,J.Z)(()=>{tL()});V.useEffect(()=>{ek===_.cK.LINKED},[!1,!1,ek,tL])}},589375:function(e,t,i){i.d(t,{Z:function(){return s}});var n=i(134761);i(954372),i(826893);var o=i(479638),l=i(104013),r=i(519055);class s extends o.Z{makeObservable(){(0,l.makeObservable)(this,{isSpider:l.computed,setHomeNeedIntial:l.action,setIsOpenLongTask:l.action,setLinkMicHeartConfig:l.action,XTTENV:l.observable,setXTTENV:l.action})}setIsOpenLongTask(e){this.isOpenLongTask=e}get isSpider(){return!r.s&&/(bot|spider|slurp|Google-InspectionTool|GoogleOther|perplexity-user|Google-Extended|Deepseek|ChatGPT-User)/i.test(navigator.userAgent)}setHomeNeedIntial(e){this.needInital=e}setLinkMicHeartConfig(e){this.linkMicHeartConfig=e}constructor(){super(),(0,n._)(this,"needInital",!1),(0,n._)(this,"linkMicHeartConfig",{}),(0,n._)(this,"isOpenLongTask",!0),(0,n._)(this,"XTTENV",""),(0,n._)(this,"setXTTENV",e=>{this.XTTENV=e});this.makeObservable()}}},500007:function(e,t,i){i.d(t,{Z:function(){return M}});var n=i(134761);i(874386),i(954372),i(826893);var o=i(479638),l=i(104013),r=i(215090),s=i(76490),u=i(333425),a=i(445302),d=i(604579),c=i(278689),v=i(124103),_=i(219913),h=i(104109),f=i(243085),m=i(69277),g=i(688094),p=i(666403),y=i(732547),E=i(743612),b=i(298604),S=i(563570),P=i(794652),k=i(428627),I=i(190974),L=i(65509),O=i(13044),N=i(46448),w=i(796773),T=i(659122),C=i(15733),D=i(317326);class M extends o.Z{initEvents(){this.chatEvent=new r.s(this.store),this.basicEvent=new s.L(this.store),this.ecomEvent=new u.B(this.store),this.fansclubEvent=new a.h(this.store),this.giftBaseEvent=new d.f(this.store),this.giftEvent=new c.c(this.store),this.redPacketEvent=new v.q(this.store),this.linkmicBaseEvent=new _.U(this.store),this.linkmicEvent=new h.O(this.store),this.loginEvent=new f.p(this.store),this.pkEvent=new m.C(this.store),this.playerEvent=new g.r(this.store),this.ranklistEvent=new p.F(this.store),this.reportEvent=new y.P(this.store),this.rtcEvent=new E.z(this.store),this.gameTabEvent=new b.V(this.store),this.userEvent=new S.L(this.store),this.vsEvent=new P.y(this.store),this.slardarEvent=new k.Uh(this.store),this.vipEvent=new I.Z(this.store),this.giftGuideEvent=new L.v(this.store),this.wishListEvent=new O.D(this.store),this.giftExhibitionEvent=new N.B(this.store),this.lotteryEvent=new w.T(this.store),this.reserveEvent=new T.r(this.store),this.vrEvent=new C.Z(this.store),this.liveChannelEvent=new D.r(this.store)}constructor(e){super(),(0,n._)(this,"store",void 0),(0,n._)(this,"chatEvent",void 0),(0,n._)(this,"basicEvent",void 0),(0,n._)(this,"ecomEvent",void 0),(0,n._)(this,"fansclubEvent",void 0),(0,n._)(this,"giftBaseEvent",void 0),(0,n._)(this,"giftEvent",void 0),(0,n._)(this,"redPacketEvent",void 0),(0,n._)(this,"linkmicBaseEvent",void 0),(0,n._)(this,"linkmicEvent",void 0),(0,n._)(this,"loginEvent",void 0),(0,n._)(this,"pkEvent",void 0),(0,n._)(this,"playerEvent",void 0),(0,n._)(this,"ranklistEvent",void 0),(0,n._)(this,"reportEvent",void 0),(0,n._)(this,"rtcEvent",void 0),(0,n._)(this,"tabEvent",void 0),(0,n._)(this,"gameTabEvent",void 0),(0,n._)(this,"userEvent",void 0),(0,n._)(this,"vsEvent",void 0),(0,n._)(this,"slardarEvent",void 0),(0,n._)(this,"vipEvent",void 0),(0,n._)(this,"giftGuideEvent",void 0),(0,n._)(this,"wishListEvent",void 0),(0,n._)(this,"giftExhibitionEvent",void 0),(0,n._)(this,"lotteryEvent",void 0),(0,n._)(this,"reserveEvent",void 0),(0,n._)(this,"vrEvent",void 0),(0,n._)(this,"LiveChannelEvent",void 0),(0,n._)(this,"makeObservable",()=>{(0,l.makeObservable)(this,{chatEvent:l.observable,basicEvent:l.observable,ecomEvent:l.observable,fansclubEvent:l.observable,giftBaseEvent:l.observable,giftEvent:l.observable,linkmicBaseEvent:l.observable,linkmicEvent:l.observable,loginEvent:l.observable,pkEvent:l.observable,playerEvent:l.observable,ranklistEvent:l.observable,reportEvent:l.observable,rtcEvent:l.observable,tabEvent:l.observable,gameTabEvent:l.observable,userEvent:l.observable,vsEvent:l.observable,redPacketEvent:l.observable,vipEvent:l.observable,giftGuideEvent:l.observable,wishListEvent:l.observable,giftExhibitionEvent:l.observable,lotteryEvent:l.observable,reserveEvent:l.observable,vrEvent:l.observable,LiveChannelEvent:l.observable})}),(0,n._)(this,"reset",()=>{Object.entries(this).filter(e=>{let[t]=e;return/Event$/.test(t)}).forEach(e=>{let[t]=e;return this[t]=null}),this.store=null});this.store=e,this.makeObservable(),this.initEvents()}}},914561:function(e,t,i){i.d(t,{Z:function(){return s}});var n=i(134761);i(250440);var o=i(479638),l=i(104013),r=i(111908);class s extends o.Z{get supportedPropList(){return this.propList.filter(e=>r.cf.includes(Number(e.type)))}constructor(){super(),(0,n._)(this,"propList",[]),(0,n._)(this,"makeObservable",()=>{(0,l.makeObservable)(this,{propList:l.observable,supportedPropList:l.computed,setPropList:l.action})}),(0,n._)(this,"setPropList",e=>this.propList=e);this.makeObservable()}}},36322:function(e,t,i){i.d(t,{V:function(){return r}}),i(209955);var n=i(705686),o=i(88648);let{Currency:l}=n;function r(){let e=(0,o.useContext)(l);if(void 0===e)throw Error("Currency must be used within Provider");return e}},423937:function(e,t,i){i.d(t,{DQ:function(){return E},FD:function(){return b},_i:function(){return y},cT:function(){return k},oR:function(){return p},od:function(){return S},t:function(){return P}}),i(874386);var n=i(148933),o=i(411415),l=i(850159),r=i(58655),s=i(207964),u=i(663744),a=i(731402),d=i(812325),c=i(62589),v=i(664590),_=i(632841),h=i(903880),f=i(739041),m=i(665859);let g=e=>{let{oldFn:t,newFn:i}=e;return function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];let l=t(...n),r=i(...n);return(0,s.useInNewProjectAB)()||(0,s.useInNewProjectPreviewAB)()?r:l}},p=g({oldFn:l.Z,newFn:r.o}),y=g({oldFn:n._i,newFn:o._i}),E=g({oldFn:u.DQ,newFn:()=>({})}),b=g({oldFn:a.FD,newFn:d.FD}),S=g({oldFn:c.o,newFn:v.o}),P=g({oldFn:()=>_.S,newFn:()=>h.S}),k=g({oldFn:()=>f.l,newFn:()=>m.l})},403300:function(e,t,i){var n=i(520739),o=i(878389),l=i(563097),r=i(88648);let s=(0,r.forwardRef)((e,t)=>(0,l.jsx)("svg",(0,o._)((0,n._)({width:32,height:32,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.5 10a2 2 0 0 1 2-2h13a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-13a2 2 0 0 1-2-2V10zm3 4.5v-2h1.499V11h2v2.5a1 1 0 0 1-1 1H10.5zM20 11h-2v2.498a1 1 0 0 0 1 1h2.5v-2H20V11zm0 8.5h1.5v-2H19a1 1 0 0 0-1 1V21h2v-1.5zM12 21v-1.498h-1.5v-2H13a1 1 0 0 1 1 1V21h-2z",fill:"#fff"})})));t.Z=s},694385:function(e,t,i){var n=i(520739),o=i(878389),l=i(563097),r=i(88648);let s=(0,r.forwardRef)((e,t)=>(0,l.jsxs)("svg",(0,o._)((0,n._)({width:32,height:32,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:[(0,l.jsx)("path",{d:"M7 14a2 2 0 0 1 2-2h1l4.36-3.633a1 1 0 0 1 1.64.768v13.73a1 1 0 0 1-1.64.768L10 20H9a2 2 0 0 1-2-2v-4zM18 19a3 3 0 1 0 0-6v6z",fill:"#fff"}),(0,l.jsx)("path",{d:"M18 23.734l.095-.007A7.75 7.75 0 0 0 18 8.266v2.507a5.25 5.25 0 0 1 0 10.454v2.507z",fill:"#fff"})]})));t.Z=s}}]);
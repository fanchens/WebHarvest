"use strict";(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["65386"],{825521:function(e,t,n){n.d(t,{W:function(){return g}}),n(675373),n(413806),n(826893);var l=n(563097),i=n(88648),r=n(713097),o=n.n(r),a=n(309931),u=n(871350),s=n(343049),d=n(235476),c=n(509090);let f=null,v=!1;function m(e){let{text:t,style:n}=e;async function i(){(0,u.J)(null==f?void 0:f.innerText),c.F.info({text:"已复制",duration:1e3})}return(0,l.jsx)("div",{className:d.default.panel,style:{height:n.height,width:n.width},onDoubleClick:i,children:t})}function p(e){let{name:t,text:n,showPanelRightside:i}=e;return(0,l.jsx)("div",{className:d.default.button,onClick:function(e){v?(f.style="display: none;",v=!1):(!function(e,t){if(f){let e=`top:${t.top}px; left:${t.left}px;`;0===t.right&&(e=`top:${t.top}px; right:0px;`),f.style=e}else{let e=`top:${t.top}px; left:${t.left}px;`;0===t.right&&(e=`top:${t.top}px; right:0px;`),(f=document.createElement("div")).className=d.default.panelWrapper,f.id="panelContainer",f.style=e,document.body.appendChild(f)}a.render((0,l.jsx)(m,{text:e,style:t}),f)}(n,function(e,t){let n={width:300,height:600,top:0,left:0,right:""},l=t.target.getBoundingClientRect(),i=document.documentElement.scrollTop,r=document.documentElement.clientWidth;return n.right=l.right+4+300>r?0:"unset",n.top=l.bottom+4+i,e?n.left=l.right+4:n.left=l.left-n.width-4,n}(i,e)),v=!0),e.stopPropagation(),e.preventDefault()},children:t})}function g(e){let{req:t=null,video:n,isLeft:r=!0,showPanelRightside:a=!1,size:u=null,gear:c}=e;return(0,i.useEffect)(()=>()=>void(f&&(document.body.removeChild(f),f=null,v=!1)),[]),(0,l.jsxs)("div",{className:o()(d.default.buttonWraper,d.default.opacityAnimation,{[d.default.right]:!r}),children:[t&&(0,l.jsx)(p,{name:"请求",text:t,showPanelRightside:a}),n&&(0,l.jsx)(p,{name:"视频",text:function(e,t,n){if("String"!==(0,s.tQ)(e))return"";let l=e.split("\r\n");if(t){let e=`播放分辨率: ${t.height},${t.width}`;l.splice(2,0,e)}if(n){let e=`播放档位: ${n}`;l.splice(2,0,e)}return l.join("\r\n")}(n,u,c),showPanelRightside:a})]})}},252288:function(e,t,n){n.d(t,{d:function(){return v},s:function(){return f}}),n(338172),n(874386);var l=n(88648),i=n(87908),r=n(441447),o=n(725887),a=n(465769),u=n(429371),s=n(314703);let d=e=>window.location.pathname.startsWith(`/${e}`),c=!1,f=e=>{(0,l.useEffect)(()=>{let t=r.listen(r.EVENT.changeVideoSideBar,t=>{let{isShowRelatedCard:n,isShowComment:l,lastStatus:r}=t;(l&&n)===!((null==r?void 0:r.isShow)&&(null==r?void 0:r.tab)===i.L.Comment)&&e&&(c=!0)});return()=>{null==t||t()}},[e])},v=e=>{let{canShowDownloadBar:t,type:n}=e,[i,f]=(0,l.useState)(!0),[v,m]=(0,l.useState)(()=>{let{isCommentShow:e}=o.Le.getConfig(o.gI.IsDownloadBarShow)||{};return e&&f(!1),!!e}),p=(0,l.useCallback)(e=>{if(!!t&&!!(0,u.A8)(e))s.Z.sendLog("addToDesktopShow",{enter_from:(0,a.vM)(),type:"comment"}),(0,u.D0)(e),m(!0),"comment"===e&&(o.Le.setConfig(o.gI.IsDownloadBarShow,{isCommentShow:!0}),r.emit(r.EVENT.showClientDownloadGuide,{isShow:!0,type:"comment",text:"",isBar:!0}))},[t]),g=(0,l.useCallback)(e=>{if(!!t&&!!v)"comment"===e&&(o.Le.setConfig(o.gI.IsDownloadBarShow,{isCommentShow:!1}),r.emit(r.EVENT.showClientDownloadGuide,{isShow:!1,type:"comment",text:"",isBar:!0})),m(!1)},[t,v]);return(0,l.useEffect)(()=>{if(!t)return()=>null;let e=r.listen(r.EVENT.showClientDownloadGuide,e=>{let{isShow:t,type:l,isBar:i}=e;if(l===n&&!!i)"comment"===l?m(t):t?(0,u.A8)(l)&&((0,u.D0)(l),m(!0)):m(!1)});return()=>{null==e||e()}},[t,n]),(0,l.useEffect)(()=>{c&&(g("comment"),c=!1)},[g,c]),{showBar:p,hideBar:g,isShow:v,isHighlight:i,canShowLightComment:d("search")||d("video")}}},133221:function(e,t,n){n.d(t,{s:function(){return r}}),n(874386),n(250440);var l=n(88648),i=n(710978);let r=()=>{let[e,t]=(0,i.x)();return{handleHiddenLog:(0,l.useCallback)(e=>{if(![i.O.LogTrace,i.O.UserInfo].includes(e))return!0;t()},[])}}},239776:function(e,t,n){n.d(t,{Y:function(){return r}}),n(874386);var l=n(87908),i=n(28528);let r=new Map([[l.L.Related,`${i.a.t("related",{},"相关推荐")}`],[l.L.AwemeRelated,`${i.a.t("related",{},"相关推荐")}`],[l.L.VideoDetail,"详情"],[l.L.Music,`${i.a.t("music",{},"音乐")}`],[l.L.Topic,`${i.a.t("topic",{},"话题")}`],[l.L.Mix,`${i.a.t("mix",{},"合集")}`],[l.L.Series,`${i.a.t("series",{},"短剧")}`],[l.L.Comment,`${i.a.t("comment",{},"评论")}`],[l.L.Hot,`${i.a.t("hot",{},"热点")}`],[l.L.Author,`${i.a.t("ta_s_works",{},"TA的作品")}`],[l.L.Handpick,`${i.a.t("handplick",{},"编辑精选")}`],[l.L.Search,"搜索结果"],[l.L.History,`${i.a.t("history",{},"历史记录")}`],[l.L.Like,"TA的喜欢"],[l.L.Collection,"TA的收藏"],[l.L.CollectFolder,`${i.a.t("collect_folder",{},"收藏夹")}`],[l.L.AbstractList,`${i.a.t("abstract_list",{},"摘要")}`],[l.L.Record,`${i.a.t("record",{},"观看历史")}`]])},251537:function(e,t,n){n.d(t,{N:function(){return h}}),n(874386),n(284961),n(826893);var l=n(563097),i=n(88648),r=n(713097),o=n.n(r),a=n(162095),u=n(87908),s=n(828782),d=n(66627),c=n(441447),f=n(97199),v=n(385236),m=n(566019),p=n(239776),g=n(979571);let h=e=>{let{exitTextProps:t,onHandleReturn:n,positionFixed:r,className:u}=e,c=y(t),p=(0,i.useRef)(),h=(0,s.DT)()&&(0,d.y)((0,s.FJ)().awemePcClient,">=","5.4.0");return(0,l.jsx)("div",{className:o()("isDark",u,m.default.container,r&&m.default.fixed,h&&m.default.clientHomeStyleWrap),children:(0,l.jsx)(a.Tooltip,{getPopupContainer:()=>p.current||document.body,position:"bottom",content:c,children:(0,l.jsxs)("div",{className:m.default.circle,onClick:n,ref:p,children:[!h&&(0,l.jsx)(g.z,{size:"large",svg:(0,l.jsx)(f.Z,{}),className:m.default.return}),h&&(0,l.jsx)(g.z,{svg:(0,l.jsx)(v.Z,{style:{fontSize:"24px"}}),className:o()(m.default.back)})]})})})},y=e=>{let{getCurrentTab:t,modalEnterFrom:n,isSelf:l,uidEquals:r,awemeInfo:o}=e,[a,s]=(0,i.useState)("");return(0,i.useEffect)(()=>{var e;let i=null==t?void 0:t();if(i===u.L.Comment)return;let a=p.Y.get(i);i===u.L.Series&&(null==o?void 0:null===(e=o.seriesInfo)||void 0===e?void 0:e.isSeries2Mix)&&(a=p.Y.get(u.L.Mix));let d=a?`退出${a}`:"";switch(i){case u.L.Like:"userLike"===n&&l&&(d=d.replace("TA","我"));break;case u.L.Collection:"userCollection"===n&&l&&(d=d.replace("TA","我"));break;case u.L.Author:"userPost"===n&&r&&l&&(d=d.replace("TA","我"))}s(d||"退出")},[t,n,l,r]),(0,i.useEffect)(()=>c.listen(c.EVENT.changeTab,e=>{let t=p.Y.has(e)?`退出${p.Y.get(e)}`:"";t&&s(t)}),[]),a}},180554:function(e,t,n){n.d(t,{Ci:function(){return p},aW:function(){return v},cy:function(){return u},fF:function(){return y},mM:function(){return d},nJ:function(){return h},vV:function(){return c},zo:function(){return m}});var l=n(520739),i=n(878389);n(874386),n(675373),n(927234),n(179133),n(826893);var r=n(594235),o=n(888163),a=n(623582);let u=function(){let e={};return{setPreloadCache:(t,n)=>{e[t]=n},getPreloadCache:t=>{if(t in e)return e[t]}}}(),s=new Map;var d={PROFILE_BTN_CLICKED:"profileBtnClicked",COMMENT_BTN_CLICKED:"commentBtnClicked"},c={PROFILE_PRELOAD:"profilePreload",COMMENT_PRELOAD:"commentPreload"};let f=async e=>{try{return await r.get({key:e,defaultValue:o.TCC_DEFAULT_VALUE_MAP.get(e)})}catch(e){return null}};async function v(e){let t=s.get(e);if(t)return t;let n=await f(e);return s.set(e,n),n}let m=function(e,t,n,l,i){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0,s="commentPreload"===n,d=s?"commentInferenceResult":"profileInferenceResult",c=u.getPreloadCache(d)||{};c={scene:s?"comment_preload_ml":"profile_preload_ml",model_name:l,s_result:String(t),f_result:e,threshold:i,with_feature:r.toString(),is_ad:o,vid:a},u.setPreloadCache(d,c)},p=()=>{let e=u.getPreloadCache("commentInferenceResult")||{};if(e&&Object.keys(e).length>0){let t=u.getPreloadCache("commentBtnClicked"),n=(0,i._)((0,l._)({},e),{s_real:String(t),f_real:t?1:0});a.logInstance.sendLog("aiPreloadResult",n)}g()},g=()=>{u.setPreloadCache("commentInferenceResult",{}),u.setPreloadCache("profileInferenceResult",{}),u.setPreloadCache("commentBtnClicked",!1),u.setPreloadCache("profileBtnClicked",!1)},h=e=>{u.setPreloadCache(e,!0)};function y(e){return function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];try{window.location.search.indexOf("pylon-debug")}catch(e){}}}},658228:function(e,t,n){n.d(t,{C:function(){return i},V:function(){return l}});var l={PlayerCreated:"PlayerCreated",PlayerBeforeCreate:"PlayerBeforeCreate"},i={danmakuSettingChange:"danmakuSettingChange",danmakuInputFocus:"danmakuInputFocus",MiniWinChange:"miniWinChange",PlayRatioChange:"playRatioChange",UpdateCommentCount:"updateCommentCount",VolumeUp:"upVolume",VolumeDown:"downVolume",NextAutoplayChange:"nextAutoplayChange",BeforePlaySwitchPrev:"playSwitchPrevBefore",BeforePlaySwitchNext:"playSwitchNextBefore",KeyPlaySwitchPrev:"keyPlaySwitchPrev",KeyPlaySwitchNext:"keyPlaySwitchNext",Waiting:"waiting",ManualChangeMiniState:"manual_change_min_state",OnStar:"onStar",ShowComment:"showComment",Collect:"onCollect",ShowShareCode:"showShareCode",Dislike:"onDislike",Avatar:"onAvatar",Follow:"onFollow",MenuRecommend:"onRecommend",FakeScreen:"onFakeScreen",SwitchFullScreen:"switch_fullscreen",FakeScreenChange:"fakeScreenChange",PlayRatioPanelShow:"playRatioPanelShow",LightBottomControls:"lightBottomControls",ResolutionChange:"resolutionChange",PlayResolutionClick:"playResolutionClick",PlayResolutionEnter:"playResolutionEnter",UpdateImmersiveSwitch:"updateImmersiveSwitch",ImmersiveSwitchChange:"immersiveSwitchChange",UpdateAutoPlaySwitch:"updateAutoPlay",AutoPlaySwitchChange:"autoPlaySwitchChange",CustomShortCut:"customShortCut",ChangePlayRate:"changePlayRate",ShowAdDetail:"showAdDetail",AdLike:"adverLike",AdDislike:"adverDislike",AdReport:"adverReport",AdThrow:"adverThrow",AdIntroduce:"adverIntroduce",ChangeDanmaku:"changeDanmaku",UpdateRadio:"UpdateRadio",UpdateClarity:"UpdateClarity",UpdateAutoPlay:"UpdateAutoPlay",BeforeDestroy:"beforeDestroy",DyUserSeek:"dyUserSeek",UpdateDebugInfo:"updateDebugInfo",RegisterMissingSrPlugin:"registerMissingSrPlugin",IconMouseenter:"icon_mouseenter",IconMouseleave:"icon_mouseleave",ChangeImmersiveSwitchTip:"changeImmersiveSwitchTip",ShowReportModal:"showReportModal",ShortcutTopic:"shortcutTopic",OnWatchLater:"onWatchLater",OnListenVideo:"onListenVideo",OnFlow:"onFlow",UpdateIsAutoPlay:"updateIsAutoPlay",CreateMultitaskingWindow:"createMultitaskingWindow",EnterDetail:"enterDetail",Feedback:"feedback",DownloadVideo:"downloadVideo",UpdatePlayBackRatio:"updatePlayBackRatio",PrePause:"prepause",OpenVolume:"openVolume",DanmakuCloseAll:"danmakuCloseAll"}},645361:function(e,t,n){n.d(t,{N:function(){return i}});var l=n(623527);let i=()=>l.oe},146586:function(e,t,n){n.d(t,{_:function(){return R},r:function(){return b}});var l=n(134761),i=n(520739),r=n(878389);n(874386),n(250440);var o=n(563097),a=n(88648),u=n(713097),s=n.n(u),d=n(309931),c=n(850634),f=n(832052),v=n(302461),m=n(441447),p=n(262648),g=n(959911),h=n(53659),y=n(487330),_=n(763718),w=n(384387),C=n(335101),x=n(645361),S=n(289228),P=n(658228),E=n(282765),T=n(757858);n(358121);var k=n(790262);let b={root:null,copyParentNode:null,copyNextSibling:null},I=e=>{let{requestPIP:t}=e;return(0,o.jsxs)("div",{className:s()(_.default.inPicture),onClick:t,children:[(0,o.jsx)(g.Z,{style:{fontSize:"32px"}}),(0,o.jsxs)("div",{className:_.default.douyinTips,children:[(0,o.jsx)("span",{children:"小窗模式"}),!!(null==h?void 0:h.SHORTCUT_KEY.pip.badgeText)&&(0,o.jsx)("span",{className:_.default.shortcutKey,children:null==h?void 0:h.SHORTCUT_KEY.pip.badgeText})]})]})};class L extends c.di{afterPlayerInit(){if(!this._config.disable)this.renderRoot(),this.el.addEventListener("mouseenter",this.onMouseenter),this.el.addEventListener("mouseleave",this.onMouseleave)}beforeDestroy(){this.el.removeEventListener("mouseenter",this.onMouseenter),this.el.removeEventListener("mouseleave",this.onMouseleave)}renderRoot(){(0,T.s)(this,(0,o.jsx)(I,(0,i._)({},this._config)))}render(){return'<dy-icon class="douyin-player-inpicture" data-state="normal"></dy-icon>'}constructor(...e){super(...e),(0,l._)(this,"onMouseleave",()=>{this._player.emit(P.C.IconMouseleave,{pluginName:E.p7.AutoPlaySettingPlugin})}),(0,l._)(this,"onMouseenter",()=>{this._player.emit(P.C.IconMouseenter,{pluginName:E.p7.AutoPlaySettingPlugin})})}}(0,l._)(L,"pluginName",E.p7.PipPlugin);let N=e=>{let t=(0,C.n)(),{pipWindow:n,isWebMiniWin:l}=(0,y.Iq)(e=>{let{pipWindow:t,isWebMiniWin:n}=e;return{isWebMiniWin:n,pipWindow:t}}),{awemeInfo:u,isActive:s}=e,g=(0,a.useRef)(!1),{isDark:h}=(0,k.C)(),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{_.current=n,t&&(t._pipWindow=n)},[n,t]);let x=(0,a.useCallback)(async()=>{var e,n,l;let i=t.root.parentNode;b.root=i,b.copyParentNode=i.parentNode,b.copyNextSibling=i.nextSibling;let r=await documentPictureInPicture.requestWindow({width:480,height:278,preferDocument:!0,disallowReturnToOpener:!0,alwaysKeepDocumentWindow:!0}),a=[...document.styleSheets].map(e=>{try{return[...e.cssRules].map(e=>e.cssText).join("")}catch(n){let t=document.createElement("link");t.rel="stylesheet",t.type=e.type,t.media=e.media,t.href=e.href,r.document.head.appendChild(t)}return""}).filter(Boolean).join("\n"),u=document.createElement("style");u.textContent=a,r.document.head.appendChild(u);let s=document.createElement("style");s.append(".douyin-player{width: 100%!important; height: 100%!important;}"),r.document.head.append(s),r.document.body.append(null!=i?i:t.root.parentNode),r.document.body.classList.add("isMiniWindowWebV1"),h&&(null==r?void 0:null===(l=r.document)||void 0===l?void 0:null===(n=l.body)||void 0===n?void 0:null===(e=n.classList)||void 0===e?void 0:e.add)&&r.document.body.classList.add("isMiniWindowWebDark");let c=r.document.createElement("div");return c.style.height="fit-content",d.render((0,o.jsx)(w.n,{pipWin:r,parentWin:window}),c),r.document.body.appendChild(c),m.emit(m.EVENT.changeMinWinWeb,{isMiniWinWeb:!0,pipWindow:r}),r},[t,h]);(0,a.useEffect)(()=>{var e,n,l,i,r,o,a,u;if(t&&s&&(null===(n=_.current)||void 0===n?void 0:null===(e=n.document)||void 0===e?void 0:e.body)){try{let{root:e,copyParentNode:n,copyNextSibling:l}=b;e&&e instanceof Element&&n&&n.isConnected&&l?n.insertBefore(e,l):(null==e?void 0:e.remove)&&e.remove();let s=null==t?void 0:null===(i=t.root)||void 0===i?void 0:i.parentNode;b.root=s,b.copyParentNode=s.parentNode,b.copyNextSibling=s.nextSibling;let d=null===(o=_.current)||void 0===o?void 0:null===(r=o.document)||void 0===r?void 0:r.body;null===(a=d.classList)||void 0===a||a.add("isMiniWindowWebV1"),null===(u=d.append)||void 0===u||u.call(d,s)}catch(e){}null==t||null===(l=t.play)||void 0===l||l.call(t)}},[t,s]);let S=(0,a.useCallback)(()=>{let{root:e}=b,{copyParentNode:t,copyNextSibling:n}=b;e&&e instanceof Element&&t&&t.isConnected&&n&&t.insertBefore(e,n),m.emit(m.EVENT.changeMinWinWeb,{isMiniWinWeb:!1,pipWindow:null})},[t]);(0,a.useEffect)(()=>{t&&(null==u?void 0:u.awemeType)!==f.e.Note&&s&&t.registerPlugin&&t.autoOpenPip&&t.reuse&&(x(),t.autoOpenPip=!1)},[t,s,u,x]),(0,a.useEffect)(()=>{if(n)return n.addEventListener("pagehide",S),()=>{n.removeEventListener("pagehide",S)}},[n,S]),(0,v.o)(()=>{if((null==t?void 0:t.on)&&s){let e=()=>{n?(S(),n.close()):(t.exitFullscreen(),setTimeout(()=>{x()},100))};return t.on("switchPIP",e),()=>{t.off("switchPIP",e)}}},[t,s,u,n,x,S]),(0,v.o)(()=>{if(n&&s){let e=e=>{var l,i;[p.bf.ArrowUp.keyCode,p.bf.ArrowDown.keyCode,p.bf.H.keyCode,p.bf.U.keyCode,p.bf.Equal.keyCode,p.bf.Minus.keyCode,p.bf.K.keyCode,p.bf.Shift.keyCode,p.bf.Z.keyCode,p.bf.C.keyCode,p.bf.V.keyCode].includes(null==e?void 0:e.keyCode)&&n.opener.postMessage({type:"KEY_DOWN",data:{code:null==e?void 0:e.code,keyCode:null==e?void 0:e.keyCode,metaKey:null==e?void 0:e.metaKey,ctrlKey:null==e?void 0:e.ctrlKey,shiftKey:null==e?void 0:e.shiftKey}},"*"),(null==t?void 0:null===(i=t.plugins)||void 0===i?void 0:null===(l=i.keyboard)||void 0===l?void 0:l._onBodyKeyDown)&&t.plugins.keyboard._onBodyKeyDown(e)};return n.addEventListener("keydown",e),()=>{n.removeEventListener("keydown",e)}}},[n,s]),(0,a.useEffect)(()=>{if(n&&s&&(null==t?void 0:t.video)){var e;let n=()=>{(null==t?void 0:t.paused)?t.play():t.pause()};return null==t||null===(e=t.video)||void 0===e||e.addEventListener("click",n),()=>{var e;null==t||null===(e=t.video)||void 0===e||e.removeEventListener("click",n)}}},[n,s,t]),(0,a.useEffect)(()=>{let e=m.listen(m.EVENT.PipBackToTab,e=>{let{from:t}=e;"webMini"===t&&(g.current=!0)});return()=>{e()}},[]),(0,a.useEffect)(()=>{if(t&&(null==u?void 0:u.awemeType)!==f.e.Note&&t.registerPlugin)return t.registerPlugin(L,(0,r._)((0,i._)({index:5,position:c.PZ.CONTROL_RIGHT},e),{root:t.root.parentNode,pipWindow:n,isWebMiniWin:l,requestPIP:x})),()=>{var e,n;(null==t?void 0:null===(e=t.getPlugin)||void 0===e?void 0:e.call(t,E.p7.PipPlugin))&&(null==t||null===(n=t.unRegisterPlugin)||void 0===n||n.call(t,E.p7.PipPlugin))}},[t,u])},R=e=>{let{supportDocumentPip:t}=(0,y.Iq)(e=>{let{supportDocumentPip:t}=e;return{supportDocumentPip:t}}),n=(0,x.N)();return t?(0,o.jsx)(S.k,{componentName:"InPicture",Slardar:n,children:(0,o.jsx)(N,(0,i._)({},e))}):null}},757858:function(e,t,n){n.d(t,{s:function(){return r},v:function(){return o}});var l=n(309931);let i=n(944189).createRoot,r=(e,t)=>{if(e.clientRoot){e.clientRoot.render(t);return}e.el&&(e.clientRoot=i(e.el),e.clientRoot.render(t))},o=e=>{if(e.clientRoot){let t=e.clientRoot;e.clientRoot=void 0,setTimeout(()=>{t.unmount()},0)}else l.unmountComponentAtNode(e.el)}},235584:function(e,t,n){n.d(t,{A_:function(){return f},_0:function(){return m},_g:function(){return v},jb:function(){return c}}),n(874386),n(250440);var l=n(88648),i=n(439837),r=n.n(i),o=n(128231),a=n.n(o),u=n(987475),s=n(847191),d=n(725887);let c=e=>{let{lastTimes:t,total:n=0,actionClose:l=!1}=(0,s.$o)(e)||{};return r()(new Date).isSame(r()(t),"day")?{total:n,actionClose:l}:{total:0,actionClose:!1}},f=e=>{let{effectiveTime:t,type:n,abtestData:l,isLogin:i}=e;if(!(n>0)||!i)return!1;{let{time:e=0}=d.Le.getConfig(d.gI.FirstInstallTime)||{};return!!(Date.now()>(e+t)*1e3)||!1}},v=e=>{let{effectiveTime:t,type:n,abtestData:i,isLogin:r}=e,[o,d]=(0,l.useState)(0),[v,m]=(0,l.useState)(!1),p=(0,l.useRef)(!1),[g,h]=(0,l.useState)(!1),y=(0,l.useRef)(f({effectiveTime:t,type:n,abtestData:i,isLogin:r}));(0,l.useEffect)(()=>{y.current=f({effectiveTime:t,type:n,abtestData:i,isLogin:r})},[t,n,i]),(0,l.useEffect)(()=>{var e;if([3,4].includes(null==i?void 0:null===(e=i.authorBlock)||void 0===e?void 0:e.type)&&y.current&&!r){let{total:e,actionClose:t}=c(u.LocalStorageKeys.AuthorBlock);e&&d(e),m(t)}},[i,r]),(0,l.useEffect)(()=>{var e;[3,4].includes(null==i?void 0:null===(e=i.authorBlock)||void 0===e?void 0:e.type)&&y.current&&!r&&v&&(p.current=!1)},[i,r,v]);let _=a()(()=>{h(!0)},200);return{blockNum:o,setBlockNum:d,actionCloseBlock:v,setActionCloseBlock:m,refBlockShowMore:p,handleJumpBlock:()=>{var e;[3,4].includes(null==i?void 0:null===(e=i.authorBlock)||void 0===e?void 0:e.type)&&y.current&&p.current&&(m(!0),setTimeout(()=>{(0,s.qQ)(u.LocalStorageKeys.AuthorBlock,{lastTimes:Date.now(),actionClose:!0})},200))},refLoginBlock:y,getBlockNum:c,transition:g,isShowDebounce:_,isHideDebounce:a()(()=>{h(!1)},200)}},m=e=>{let{effectiveTime:t,type:n,abtestData:i,isLogin:r,defaultCommentList:o}=e,[d,v]=(0,l.useState)(0),[m,p]=(0,l.useState)(!1),g=(0,l.useRef)(!1),[h,y]=(0,l.useState)(!1),_=(0,l.useRef)(f({effectiveTime:t,type:n,abtestData:i,isLogin:r}));(0,l.useEffect)(()=>{_.current=f({effectiveTime:t,type:n,abtestData:i,isLogin:r})},[t,n,i]),(0,l.useEffect)(()=>{var e;if(!(null==i?void 0:null===(e=i.commentBlock)||void 0===e?void 0:e.is_force)&&_.current&&!r){let{total:e,actionClose:t}=c(u.LocalStorageKeys.CommentBlock);e&&v(e),p(t)}},[i,r]),(0,l.useEffect)(()=>{var e,t,n;!(null==i?void 0:null===(e=i.commentBlock)||void 0===e?void 0:e.is_force)&&_.current&&!r&&m&&(g.current=!1),(null==o?void 0:o.length)>(null==i?void 0:null===(t=i.commentBlock)||void 0===t?void 0:t.comment_total)&&(null==i?void 0:null===(n=i.commentBlock)||void 0===n?void 0:n.type)&&!r&&_.current&&!m&&(g.current=!0)},[i,r,m,o]);let w=a()(()=>{y(!0)},200);return{blockNum:d,setBlockNum:v,actionCloseBlock:m,setActionCloseBlock:p,refBlockShowMore:g,handleJumpBlock:()=>{var e;!(null==i?void 0:null===(e=i.commentBlock)||void 0===e?void 0:e.is_force)&&_.current&&g.current&&(p(!0),setTimeout(()=>{(0,s.qQ)(u.LocalStorageKeys.CommentBlock,{lastTimes:Date.now(),actionClose:!0})},200))},refLoginBlock:_,getBlockNum:c,transition:h,isShowDebounce:w,isHideDebounce:a()(()=>{y(!1)},200)}}},67120:function(e,t,n){n.d(t,{$:function(){return s}}),n(250440);var l=n(88648),i=n(832052),r=n(905003),o=n(828782),a=n(47047),u=n(487330);let s=e=>{let{abtestData:t,awemeInfo:n,enterFrom:s}=e,{supportDocumentPip:d}=(0,u.Iq)(e=>{let{supportDocumentPip:t}=e;return{supportDocumentPip:t}});return{enablePip:(0,l.useMemo)(()=>!(!d||(0,o.tq)()||(0,o.DT)()||(0,a.O)()||(null==n?void 0:n.awemeType)===i.e.Note||(null==n?void 0:n.awemeType)===i.e.Article||s&&[r.a.Im,r.a.Search,r.a.GeneralSearch].includes(s))&&!0,[d,t,n])}}},314331:function(e,t,n){n.d(t,{O:function(){return _}});var l=n("520739"),i=n("878389"),r=n("88648"),o=n("399242"),a=n("613480"),u=n("487330"),s=n("725887"),d=n("465769"),c=n("441447");let f=new(n("872136")).h({pcPlaySettingShow:{eventName:"pc_play_setting_show",params:{enter_from:"",player_display_mode:"",group_id:""}},pcPlaySettingExit:{eventName:"pc_play_setting_exit",params:{enter_from:"",player_display_mode:"",group_id:"",duration:0}}});n("874386");let v=e=>{let{player:t}=e,[n,l]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{if(!t)return;let e=()=>{l(!0)},n=()=>{l(!1)},i=t.getPlugin("progress");return null==i||i.addCallBack("dragstart",e),null==i||i.addCallBack("dragend",n),()=>{null==i||i.removeCallBack("dragstart",e),null==i||i.removeCallBack("dragend",n)}},[t]),{isDragging:n}};n("914014");let m=[".player-position-box-bottom",".xgplayer-controls",".miniWinToolBar"],p=e=>{let{isActive:t=!1}=e,[n,l]=(0,r.useState)(!1),i=(0,r.useRef)(null),[o,a]=(0,r.useState)(!1),[u,s]=(0,r.useState)(!1),d=(0,r.useRef)(null),c=()=>{clearTimeout(i.current),l(!1),i.current=window.setTimeout(()=>{i.current=null,l(!0)},3e3)},f=()=>{clearTimeout(i.current),i.current=null,l(!0)},v=()=>{a(!0)},p=()=>{a(!1)},g=e=>{let{target:t}=e,{tagName:n,innerHTML:l}=t;"BUTTON"===n&&("展开"===l||"expand"===l)&&a(!1)},h=()=>{var e;clearTimeout(i.current),i.current=null,l(!1),a(!1),null===(e=d.current)||void 0===e||e.call(d),d.current=null};return(0,r.useEffect)(()=>{!t&&h()},[t]),(0,r.useEffect)(()=>()=>{h()},[]),{isInactiveStyle:n&&!o||u,handleImmersiveSwitchOn:()=>{f(),s(!0),setTimeout(()=>{l(!0),s(!1)},500)},handleImmersiveSwitchOff:c,bindEvents:e=>{var t;null===(t=d.current)||void 0===t||t.call(d),d.current=null,clearTimeout(i.current),i.current=null,l(!1),a(!1),c(),e.addEventListener("mouseenter",c),e.addEventListener("mousemove",c),e.addEventListener("click",c),e.addEventListener("mouseleave",f);let n=m.map(t=>e.querySelector(t));n.forEach(e=>{e&&(e.addEventListener("mouseenter",v),e.addEventListener("mouseleave",p),e.classList.contains("player-position-box-bottom")&&e.addEventListener("click",g))}),d.current=()=>{e.removeEventListener("mouseenter",c),e.removeEventListener("mousemove",c),e.removeEventListener("click",c),e.removeEventListener("mouseleave",f),n.forEach(e=>{e&&(e.removeEventListener("mouseenter",v),e.removeEventListener("mouseleave",p),e.classList.contains("player-position-box-bottom")&&e.removeEventListener("click",g))})}},unbindEvents:h}},g="immersive-style--inactive",h="immersive-style--fullscreen",y="immersive-style--disable-control-tips",_=e=>{var t;let{abtestData:n,player:m,scene:_,awemeInfo:w,isActive:C=!1,refPlayer:x}=e,{isFullScreen:S=!1,isCssFullScreen:P=!1}=null!==(t=(0,r.useContext)(a.C))&&void 0!==t?t:{},{isWebMiniWin:E}=(0,r.useContext)(u.ko),{isDragging:T}=v({player:m}),k=S||P||_===o.lT.Modal,b=(0,r.useRef)(null),{isInactiveStyle:I,handleImmersiveSwitchOn:L,handleImmersiveSwitchOff:N,bindEvents:R,unbindEvents:M}=p({isActive:C});(0,r.useEffect)(()=>{let e="normal";E||s.Le.getConfig(s.gI.IsMiniWin)?e="small_window":S?e="full_screen":P&&(e="full_webscreen"),s.Le.setConfig(s.gI.PlayerDisplayMode,e)},[S,P,E]),(0,r.useEffect)(()=>{var e,t;if(!(null==n?void 0:n.immersiveStyle))return;let r=(null==m?void 0:null===(e=m.root)||void 0===e?void 0:e.closest(".basePlayerContainer"))||(null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.root);if(!r)return;let o={enter_from:(0,d.vM)(),player_display_mode:(0,d.Ok)(),group_id:(null==w?void 0:w.awemeId)||""};if(I){if(r.classList.add(g),C&&k){let e=b.current?Date.now()-b.current:0;b.current=null,f.sendLog("pcPlaySettingExit",(0,i._)((0,l._)({},o),{duration:e}))}}else{if(b.current)return;r.classList.remove(g),C&&k&&(b.current=Date.now(),f.sendLog("pcPlaySettingShow",(0,l._)({},o)))}},[null==n?void 0:n.immersiveStyle,m,I,k,null==w?void 0:w.awemeId,C]),(0,r.useEffect)(()=>{if(!(null==n?void 0:n.immersiveStyle))return;let e=c.listen(c.EVENT.ImmersiveSwitch,e=>{let{isOn:t}=e;if(!!k)t?L():N()});return()=>{e()}},[null==n?void 0:n.immersiveStyle,k]),(0,r.useEffect)(()=>{var e,t;if(!(null==n?void 0:n.immersiveStyle))return;let l=(null==m?void 0:null===(e=m.root)||void 0===e?void 0:e.closest(".basePlayerContainer"))||(null==x?void 0:null===(t=x.current)||void 0===t?void 0:t.root);if(!!l)l.classList.add("immersive-style"),E||k?R(l):M(),k?(l.classList.add(h),T?l.classList.add(y):l.classList.remove(y)):(l.classList.remove(h),l.classList.remove(y))},[n,null==m?void 0:m.root,E,k,T,null==w?void 0:w.awemeId,C])}},79139:function(e,t,n){n.d(t,{g:function(){return o}}),n(209955);var l=n(88648),i=n(734123),r=n(4168);let o=e=>{let{player:t,awemeInfo:n}=e,o=(0,l.useRef)(0);(0,l.useEffect)(()=>{if(t&&n){let{seriesInfo:l,awemeId:a}=n||{},{seriesId:u,currentEpisode:s}=l||{},d=!1,c=async e=>{let{currentTime:n}=e;if(!d&&u&&a&&o.current<5&&n>=5){d=!0;try{let e=await (0,r.tJ)({episode:s,seriesId:u,awemeId:a});if((null==e?void 0:e.statusCode)===0){var l;null==t||null===(l=t.off)||void 0===l||l.call(t,i.Events.TIME_UPDATE,c)}else throw Error(null==e?void 0:e.statusMessage)}catch(e){o.current++}d=!1}};if(u){var e;return null==t||null===(e=t.on)||void 0===e||e.call(t,i.Events.TIME_UPDATE,c),()=>{var e;null==t||null===(e=t.off)||void 0===e||e.call(t,i.Events.TIME_UPDATE,c),o.current=0}}}},[t,n])}},52678:function(e,t,n){n.d(t,{h:function(){return W}});var l=n("520739");n("874386"),n("250440");var i=n("563097"),r=n("88648"),o=n("734123"),a=n("613063"),u=n.n(a),s=n("645260"),d=n.n(s),c=n("877639"),f=n.n(c),v=n("982755"),m=n("623582"),p=n("369881"),g=n("725887"),h=n("441447"),y=n("465769"),_=n("742740"),w=n("87124"),C=n("262648");n("897860");var x=n("311921"),S=n("713097"),P=n.n(S);function E(e){let{x:t=50,y:n=50}=e,l=(0,r.useRef)(parseInt(String(1e4*Math.random()%61-30))),o={left:t-35,top:n-34,transform:`rotate(${l.current}deg)`};return(0,i.jsx)("div",{style:o,className:x.default.containerBox,children:(0,i.jsx)("img",{src:"//p-pc-weboff.byteimg.com/tos-cn-i-9r5gewecjs/feed_money_like_icon.svg",className:P()(x.default.container,x.default.heartBeat)})})}let T=e=>{var t;return(null==e?void 0:null===(t=e.delegateTarget)||void 0===t?void 0:t.tagName)==="XG-SLIDER"};var k=e=>{let{onClick:t,onLongPress:n,onDoubleClick:l,onCancelLongPress:i,longPressDelay:o=300,doubleTapDelay:a=300}=e,u=(0,r.useRef)(null),s=(0,r.useRef)(null),d=(0,r.useRef)(!1),c=(0,r.useRef)(!1),f=(0,r.useRef)(!1);return(0,r.useEffect)(()=>()=>{u.current&&(clearTimeout(u.current),u.current=null),s.current&&(clearTimeout(s.current),s.current=null)},[]),{onMouseDown:e=>{if(!(0!==e.button||T(e)))u.current&&(d.current=!0,clearTimeout(u.current),u.current=null),d.current&&l(e),c.current=!0,u.current=setTimeout(()=>{!d.current&&!c.current&&t(e),d.current=!1,clearTimeout(u.current),u.current=null},a),s.current=setTimeout(()=>{f.current=!0,n(e),clearTimeout(s.current),s.current=null},o)},onMouseUp:e=>{if(!(0!==e.button||T(e)))clearTimeout(s.current),s.current=null,c.current=!1,f.current&&(f.current=!1,i(e))},onMouseLeave:e=>{clearTimeout(u.current),clearTimeout(s.current),u.current=null,s.current=null,f.current&&i(e),c.current=!1,f.current=!1,d.current=!1}}},b=n("335101"),I=n("443073"),L=n("745707"),N=n("436241"),R=n("289228"),M=n("568201");let j=e=>{let{isActive:t,awemeInfo:n,disableShortCut:a,abtestData:s}=e||{},c=(0,b.n)(),x=(0,r.useRef)(0),S=(0,r.useRef)(0);(0,r.useRef)(()=>void 0);let[P,T]=(0,r.useState)([]);(0,r.useRef)(1);let{onMouseDown:I,onMouseLeave:R,onMouseUp:j}=k({onClick:e=>{var t,n;let l=(0,L.H)(c);if(e.target===(null==c?void 0:c.root)||e.target===(null==c?void 0:c.video)||e.target===(null==c?void 0:c.innerContainer)||e.target===(null==c?void 0:null===(t=c.video)||void 0===t?void 0:t.__canvas)||l){if(null==c?void 0:null===(n=c.openGeneralSearchModalSlide)||void 0===n?void 0:n.call(c,{from:"pause"})){c.emit(o.Events.USER_ACTION,{action:"click_video_area"});return}(null==c?void 0:c.paused)?(c.play(),c.emitUserAction(o.Events.USER_ACTION,"switch_play_pause",{action:"switch_play_pause",paused:!0,pluginName:"click"})):(c.pause(),c.emitUserAction(o.Events.USER_ACTION,"switch_play_pause",{action:"switch_play_pause",paused:!1,pluginName:"click"}))}},onLongPress:e=>{var t;let l=(0,L.H)(c);if(e.target===(null==c?void 0:c.root)||e.target===(null==c?void 0:c.video)||e.target===(null==c?void 0:c.innerContainer)||e.target===(null==c?void 0:null===(t=c.video)||void 0===t?void 0:t.__canvas)||l){if(g.Le.getConfig(g.gI.disableSpeed)&&!g.Le.getConfig(g.gI.IsMiniWin)){h.emit(h.EVENT.loginBlockKeyBoard,{speed:!0});return}!(0,v.Jt)(n)&&(g.Le.setConfig(g.gI.PlayRatioBeforeLongPress,c.playbackRate),c.emit(M.B.ChangePlayRate,{rate:2,notStorage:!0}),m.logInstance.sendLog("holdVideoSpeed",{group_id:null==n?void 0:n.awemeId,enter_from:(0,y.vM)(),enter_from_merge:(0,_.yW)()}))}},onCancelLongPress:()=>{if(!(0,v.Jt)(n)){let e=g.Le.getConfig(g.gI.PlayRatioBeforeLongPress);c.emit(M.B.ChangePlayRate,{rate:e||1}),g.Le.setConfig(g.gI.PlayRatioBeforeLongPress,0)}},onDoubleClick:e=>{var t;let n=(0,L.H)(c);(e.target===(null==c?void 0:c.root)||e.target===(null==c?void 0:c.video)||e.target===(null==c?void 0:c.innerContainer)||e.target===(null==c?void 0:null===(t=c.video)||void 0===t?void 0:t.__canvas)||n)&&c.emit("onStar",{event:e,clickMethod:"mouse"})}});return(0,r.useEffect)(()=>{if(c&&t){var e,i,r;let t=(0,L.H)(c),v=f()(e=>{let t=0,n=0;if(e&&"keydown"===e.type){var l,i;t=(null==c?void 0:null===(l=c.root)||void 0===l?void 0:l.clientWidth)/2,n=(null==c?void 0:null===(i=c.root)||void 0===i?void 0:i.clientHeight)/2}else t=null==e?void 0:e.offsetX,n=null==e?void 0:e.offsetY;let r=Date.now();T(e=>(x.current++,[...e,{x:t,y:n,index:x.current,timeFlag:r}])),setTimeout(()=>{T(e=>e.filter(e=>e.timeFlag!==r))},1e3)},300),m=(0,w.e)((e,t)=>{var n;if("mouse"===t&&(null==c?void 0:null===(n=c.openGeneralSearchModalSlide)||void 0===n?void 0:n.call(c,{from:"pause"}))){c.emit(o.Events.USER_ACTION,{action:"click_video_area"});return}(null==c?void 0:c.paused)?(c.play(),c.emitUserAction(o.Events.USER_ACTION,"switch_play_pause",{action:"switch_play_pause",paused:!0,pluginName:"click"})):(c.pause(),c.emitUserAction(o.Events.USER_ACTION,"switch_play_pause",{action:"switch_play_pause",paused:!1,pluginName:"click"}))},(e,t)=>{c.emit("onStar",{event:e,clickMethod:t})},300),h=e=>{(e.target===c.root||e.target===c.video||e.target===c.innerContainer||e.target===c.video.__canvas||t)&&m(e,"mouse")},y={space:{keyCode:C.bf.Space.keyCode,action:e=>{m(e,"space")},disable:a,noBodyTarget:!1}},_=e=>{var t,l;if(null==s?void 0:null===(t=s.changeCandle)||void 0===t?void 0:t.includes(null==n?void 0:n.awemeId))return;let{event:i,isKeyWorkCancalLike:r,clickMethod:o}=e,a=null===(l=g.Le.getConfig(g.gI.DiggStatusCache))||void 0===l?void 0:l[null==n?void 0:n.awemeId];if(!(Date.now()-((null==a?void 0:a.lastDiggTime)||0)>1e3&&(null==a?void 0:a.diggStatus)===p.gZ.Digged&&"hot_key"===o&&r&&Date.now()-S.current>500))S.current=Date.now(),v(i)};c.config.closeVideoClick=!0,t?t.addEventListener("click",h,!1):c.root.addEventListener("click",h,!1);let P={space:null==c?void 0:null===(r=c.plugins)||void 0===r?void 0:null===(i=r.keyboard)||void 0===i?void 0:null===(e=i.keyCodeMap)||void 0===e?void 0:e.space};return u()(c,"plugins.keyboard.keyCodeMap",(0,l._)({},d()(c,"plugins.keyboard.keyCodeMap")||{},y)),c.on("onStar",_),()=>{c.config.closeVideoClick=!1,t?t.removeEventListener("click",h,!1):c.root.removeEventListener("click",h,!1),c.plugins.keyboard&&((0,N.v)({currentCodeMap:c.plugins.keyboard.keyCodeMap,additionalCodeMap:y}),u()(c,"plugins.keyboard.keyCodeMap",(0,l._)({},d()(c,"plugins.keyboard.keyCodeMap")||{},P))),c.off("onStar",_)}}},[c,t,n,null==s?void 0:s.changeCandle,!1]),(0,r.useEffect)(()=>{if(c)return c.config.closeVideoClick=!0,()=>{c.config.closeVideoClick=!1}},[c]),(0,i.jsx)(i.Fragment,{children:P.map(e=>(0,i.jsx)(E,{x:e.x,y:e.y},e.index))})},W=e=>{let t=(0,I.N)();return(0,i.jsx)(R.k,{componentName:"DoubleDiggPlugin",Slardar:t,children:(0,i.jsx)(j,(0,l._)({},e))})}},929767:function(e,t,n){n.d(t,{I:function(){return v}});var l=n(520739),i=n(563097),r=n(88648),o=n(737271),a=n(441447),u=n(332679),s=n(335101),d=n(443073),c=n(289228);n(155593);let f=e=>{let t=(0,s.n)(),{isActive:n,fullScreenTarget:l,scene:i,disableHook:d}=e;return(0,r.useEffect)(()=>{t&&(t.config&&t.config.fullscreenTarget!==l&&(t.config.fullscreenTarget=l,"detail"===i&&(t.config.fullscreenTarget=document.documentElement)),n&&(0,o.r)()&&(t.getFullscreen(l),"detail"===i&&t.getFullscreen(document.documentElement)))},[t,n,l]),(0,r.useEffect)(()=>{if(t&&n){let e=a.listen(a.EVENT.fullScreen,e=>{let{fullScreen:n}=e;!n&&t.exitFullscreen()});return()=>{e()}}},[t,n]),(0,r.useEffect)(()=>{t&&t.usePluginHooks("fullscreen","fullscreen_change",()=>((0,u.QD)()&&a.emit(a.EVENT.changeMinWindows,{event:"close",isMiniWin:!1,clickMethod:"click_fullScreen"}),!0))},[t,n,d]),(0,r.useEffect)(()=>{if(n&&t)return a.listen(a.EVENT.syncInteraction,()=>{(0,o.r)()&&t.isUserActive&&t.getFullscreen()})},[t,n]),null},v=e=>{let t=(0,d.N)();return(0,i.jsx)(c.k,{componentName:"FullScrren",Slardar:t,children:(0,i.jsx)(f,(0,l._)({},e))})}},384387:function(e,t,n){n.d(t,{n:function(){return w}}),n(874386);var l,i=n(563097),r=n(88648),o=n(797973),a=n(434739),u=n(297517),s=n(713097),d=n.n(s),c=n(162095),f=n(243150),v=n(934134),m=n(441447),p=n(828782),g=n(63405),h=n(738713),y=n(556966),_=n(678315);let w=e=>{let{pipWin:t=null===(l=window.documentPictureInPicture)||void 0===l?void 0:l.window,parentWin:n}=e,[s,w]=(0,r.useState)(0),C=(0,o.Z)(()=>{w((0,_.nz)()?1:2)});(0,a.Z)("resize",()=>C(),{target:t}),(0,u.Z)(()=>C(),50);let x=()=>{m.emit(m.EVENT.PipBackToTab,{from:"webMini"}),null==t||t.close(),null==n||n.focus(),(0,p.DT)()&&g.invoke("pipParentWinShow")};return 0===s?null:1===s?(0,i.jsx)("div",{className:d()(h.default.pipTabbar,h.default["pipTabbar--WithSystemBar"],"tabbar"),children:(0,i.jsx)(c.Tooltip,{className:"custom-tooltip",content:"返回大窗观看",position:"bottom",getPopupContainer:()=>t.document.querySelector(".tabbar"),children:(0,i.jsx)("div",{className:h.default.pipTabbarBackToTabBtn,onClick:x,children:(0,i.jsx)(f.Z,{src:y.Z,viewBox:"0 0 19 16",width:19,height:16})})})}):(0,i.jsxs)("div",{className:d()(h.default.pipTabbar,h.default["pipTabbar--WithoutSystemBar"]),children:[(0,i.jsx)("div",{className:h.default.pipTabbarDragBar}),(0,i.jsxs)("div",{className:d()(h.default.pipTabbarBtns,"tabbar"),children:[(0,i.jsx)("div",{className:h.default.pipTabbarBtnsItem,onClick:x,children:(0,i.jsx)(f.Z,{src:y.Z,viewBox:"0 0 19 16",width:19,height:16})}),(0,i.jsx)("div",{className:h.default.pipTabbarBtnsItem,onClick:()=>{null==t||t.close()},children:(0,i.jsx)(f.Z,{src:v.Z,viewBox:"0 0 12 13",width:12,height:13})})]})]})}},804074:function(e,t,n){n.d(t,{R:function(){return O},_:function(){return F}});var l=n(520739),i=n(878389);n(250440);var r=n(563097),o=n(88648),a=n(713097),u=n.n(a),s=n(734123),d=n(542680),c=n(149250),f=n(309931),v=n(832052),m=n(302461),p=n(78776),g=n(441447),h=n(465769),y=n(262648),_=n(828782),w=n(63405),C=n(146345),x=n(384387),S=n(205825),P=n(535649),E=n(335101),T=n(443073),k=n(289228);n(515353);var b=n(29489),I=n(912377),L=n(49279),N=n(790262),R=n(324794),M=n(487330),j=n(146586),W=n(725887);let D=e=>{let{awemeInfo:t,isActive:n,isReusePlayer:a,hideModalWhenPip:u,setHideModalByPip:c,modalClose:p,logParams:C}=e,T=(0,E.n)(),{pipWindow:k,isWebMiniWin:I}=(0,M.Iq)(e=>{let{pipWindow:t,isWebMiniWin:n}=e;return{pipWindow:t,isWebMiniWin:n}}),D=(0,o.useRef)(null),{awemeFeed:A}=(0,L.j)(),F=(0,o.useRef)(!1),O=(0,o.useRef)(!1),{isDark:B}=(0,N.C)(),V=(0,R.h)(e=>e.resetSmallWindowScene),U=(0,o.useRef)(!1);(0,o.useEffect)(()=>{if(T&&(null==t?void 0:t.awemeType)!==v.e.Note&&n&&T.registerPlugin){let t;if(a?t=T.root.parentNode.parentNode:(T.reuse||(null==T?void 0:T.isQuickPlayer))&&(t=T.root.parentNode),T.registerPlugin(d.Z,(0,i._)((0,l._)({showIcon:!0,preferDocument:!0},e),{player:T,alwaysKeepDocumentWindow:!0,docPiPNode:t,width:480,height:278})),T.autoOpenPip&&T.reuse){var r,o;null==T||null===(o=T.plugins)||void 0===o||null===(r=o.pip)||void 0===r||r.requestPIP(D.current),T.autoOpenPip=!1}return()=>{T.getPlugin("PIP")&&T.unRegisterPlugin("PIP",!0)}}},[T,n,t,a]),(0,o.useEffect)(()=>{D.current=k},[k]),(0,o.useEffect)(()=>{if(T&&n){let n=()=>{g.emit(g.EVENT.changeMinWinWeb,{isMiniWinWeb:!1,pipWindow:null});let e=O.current?"zoom":"close",n=(0,h.vM)();b.i.sendLog("smallWindowOps",(0,l._)({action:e,scene:R.h.getState().smallWindowScene,enter_from:n,group_id:null==t?void 0:t.groupId,player_display_mode:(0,h.Ok)()},C)),b.i.sendLog("smallWindowExit",(0,l._)({enter_from:n,scene:R.h.getState().smallWindowScene,group_id:null==t?void 0:t.groupId,player_display_mode:(0,h.Ok)()},C)),V(),setTimeout(()=>{O.current=!1},500)},a=()=>{var e,t,n,l,i,o;let a=T.plugins.pip.getDocumentWindow();if(!a)return;null==T||null===(n=T.plugins)||void 0===n||null===(t=n.srplugin)||void 0===t||null===(e=t.setRunning)||void 0===e||e.call(t,!1),g.emit(g.EVENT.changeMinWinWeb,{isMiniWinWeb:!0,pipWindow:a}),U.current&&a.document.body.classList.add("document-hidden"),a.document.body.setAttribute("id","isMiniWindowWeb"),B&&(null==a?void 0:null===(o=a.document)||void 0===o?void 0:null===(i=o.body)||void 0===i?void 0:null===(l=i.classList)||void 0===l?void 0:l.add)&&a.document.body.classList.add("isMiniWindowWebDark");let u=a.document.body,s=a.document.createElement("div");s.style.height="fit-content",f.render((0,r.jsx)(x.n,{pipWin:a,parentWin:window}),s),u.appendChild(s)};if(D.current){var e,i,o;D.current.document.body.setAttribute("id","isMiniWindowWeb"),H(),null===(o=T.plugins)||void 0===o||null===(i=o.pip)||void 0===i||null===(e=i.attachDocumentWindow)||void 0===e||e.call(i,D.current),T.play()}let u=e=>{e?a():n()};return T.on(s.Events.PIP_CHANGE,u),()=>{T.off(s.Events.PIP_CHANGE,u)}}},[T,n,t,B,C]);let H=(0,o.useCallback)(()=>{var e,t,n,l,i,r;if((null===(t=W.Le.getConfig(W.gI.AbtestData))||void 0===t?void 0:null===(e=t.webcodecRecommend)||void 0===e?void 0:e.open)===!0)try{if(j.r.root){let{root:e,copyParentNode:t,copyNextSibling:o}=j.r;e&&e instanceof Element&&t&&t.isConnected&&o?t.insertBefore(e,o):(null==e?void 0:e.remove)&&e.remove();let a=null==T?void 0:T.root;j.r.root=a,j.r.copyParentNode=a.parentNode,j.r.copyNextSibling=a.nextSibling;let u=null===(l=D.current)||void 0===l?void 0:null===(n=l.document)||void 0===n?void 0:n.body;null===(i=u.classList)||void 0===i||i.add("isMiniWindowWebV1"),null===(r=u.append)||void 0===r||r.call(u,a)}}catch(e){}},[T]);return(0,m.o)(()=>{if(T&&n){let e=()=>{if(I&&D.current){var e;D.current.document.body.removeAttribute("id"),null===(e=D.current)||void 0===e||e.close()}else T.exitCssFullscreen(),T.exitFullscreen(),setTimeout(()=>{var e,t;H(),null==T||null===(t=T.plugins)||void 0===t||null===(e=t.pip)||void 0===e||e.requestPIP()},100)};return T.on("switchPIP",e),()=>{T.off("switchPIP",e)}}},[T,n,t,I]),(0,m.o)(()=>{if(k&&n){let e=e=>{[y.bf.ArrowUp.keyCode,y.bf.ArrowDown.keyCode,y.bf.H.keyCode,y.bf.U.keyCode,y.bf.Equal.keyCode,y.bf.Minus.keyCode,y.bf.K.keyCode,y.bf.Shift.keyCode,y.bf.Z.keyCode,y.bf.C.keyCode,y.bf.V.keyCode].includes(null==e?void 0:e.keyCode)&&k.opener.postMessage({type:"KEY_DOWN",data:{code:null==e?void 0:e.code,keyCode:null==e?void 0:e.keyCode,metaKey:null==e?void 0:e.metaKey,ctrlKey:null==e?void 0:e.ctrlKey,shiftKey:null==e?void 0:e.shiftKey}},"*")};return k.addEventListener("keydown",e),()=>{k.removeEventListener("keydown",e)}}},[k,n]),(0,o.useEffect)(()=>{if(T&&u&&n){let e=e=>{if(e)F.current=!1,c(!0);else{if(T.fullscreen||F.current){F.current=!1;return}if(O.current){c(!1);return}c(!1),A.dispatch("modalAwemeInfo",null),null==p||p()}},t=()=>{var e,t;if(!T.fullscreen)null===(e=D.current)||void 0===e||e.close(),c(!1),F.current=!0,window.focus(),(0,_.DT)()&&w.invoke("pipParentWinShow"),null===S.YY||void 0===S.YY||S.YY.setPlayerReuseAble(P.v.Discover,null==T?void 0:null===(t=T.config)||void 0===t?void 0:t.vid)};return T.on(s.Events.PIP_CHANGE,e),T.on(s.Events.FULLSCREEN_REQUEST,t),()=>{T.off(s.Events.PIP_CHANGE,e),T.on(s.Events.FULLSCREEN_REQUEST,t)}}},[u,T,n,p]),(0,o.useEffect)(()=>{let e=g.listen(g.EVENT.PipBackToTab,e=>{let{from:t}=e;"webMini"===t&&(O.current=!0)});return()=>{e()}},[]),(0,o.useEffect)(()=>{let e=()=>{var e,t,n,l,i,r,o,a;if("visible"===document.visibilityState){U.current=!1,null===(a=D.current)||void 0===a||null===(o=a.document)||void 0===o||null===(r=o.body)||void 0===r||null===(i=r.classList)||void 0===i||i.remove("document-hidden");return}U.current=!0,null===(l=D.current)||void 0===l||null===(n=l.document)||void 0===n||null===(t=n.body)||void 0===t||null===(e=t.classList)||void 0===e||e.add("document-hidden")};return document.addEventListener("visibilitychange",e),()=>{document.removeEventListener("visibilitychange",e)}},[T]),null},A=e=>{let{isWebMiniWin:t,pipWindow:n,isListenVideoMiniWin:l}=(0,M.Iq)(e=>{let{isWebMiniWin:t,pipWindow:n,isListenVideoMiniWin:l}=e;return{isWebMiniWin:t,pipWindow:n,isListenVideoMiniWin:l}}),i=(0,o.useCallback)(()=>{if(g.emit(g.EVENT.ListenVideoPipWindowClose),l){let e=I.e.getPipWindow({scene:p.d.ListenVideo});c.T.exit(),e&&e.close();return}n&&(n.document.body.removeAttribute("id"),n.close())},[n,l]);return(t||l)&&(0,r.jsx)("div",{className:u()(C.default.inPictureCover),children:(0,r.jsxs)("div",{className:u()(C.default.inPictureContainer),children:[(0,r.jsx)("div",{className:u()(C.default.inPictureTitle),children:l?"听抖音\xb7支持后台播放":"正在「小窗模式」下播放"}),(0,r.jsx)("div",{className:u()(C.default.inPictureBtn),onClick:i,children:l?"退出听抖音":"点击可退出小窗播放"})]})})},F=e=>{let{supportDocumentPip:t}=(0,M.Iq)(e=>{let{supportDocumentPip:t}=e;return{supportDocumentPip:t}}),n=(0,T.N)();return t?(0,r.jsx)(k.k,{componentName:"InPicture",Slardar:n,children:(0,r.jsx)(D,(0,l._)({},e))}):null},O=e=>{let t=(0,T.N)(),{supportDocumentPip:n,isListenVideoMiniWin:i}=(0,M.Iq)(e=>{let{supportDocumentPip:t,isListenVideoMiniWin:n}=e;return{supportDocumentPip:t,isListenVideoMiniWin:n}});return(n||i)&&(0,r.jsx)(k.k,{componentName:"InPictureBackground",Slardar:t,children:(0,r.jsx)(A,(0,l._)({},e))})}},29489:function(e,t,n){n.d(t,{i:function(){return i}});var l=n(872136);let i=new l.h({smallWindowOps:{eventName:"small_window_ops",params:{action:"close",enter_from:"",scene:"",group_id:"",player_display_mode:""}},smallWindowExit:{eventName:"small_window_exit",params:{enter_from:"",scene:"",group_id:"",player_display_mode:""}}})},466428:function(e,t,n){n.d(t,{N:function(){return m}});var l=n(520739),i=n(563097);n(88648);var r=n(713097),o=n.n(r),a=n(982755),u=n(961412),s=n(774569),d=n(289228),c=n(443073);n(683757);var f=n(186298);let v=e=>{var t;let{awemeInfo:n,hitMiniWindowOptimize:l}=e,r=null==n?void 0:n.desc,d=null==n?void 0:null===(t=n.authorInfo)||void 0===t?void 0:t.nickname,c=null==n?void 0:n.mixInfo,v=(0,a.Jt)(n),m=(0,a.Kf)(n);return(0,i.jsxs)("div",{className:o()(f.default.wrap,f.default.newWrapShow,{[f.default.miniWindowOptimize]:l}),children:[(0,i.jsx)("div",{className:f.default.clientDragArea}),(0,i.jsx)("div",{className:f.default.nickname,children:(0,i.jsx)(u.Z,{className:f.default.userText,text:`@${d}`})}),(0,i.jsxs)("div",{className:o()(f.default.title,{[f.default.isAd]:v||m}),children:[(0,i.jsx)(u.Z,{className:f.default.text,text:r,isRemoveRowspan:!0,children:(null==c?void 0:c.currentEpisode)&&(0,i.jsxs)("span",{children:["第",null==c?void 0:c.currentEpisode,"集："]})}),(v||m)&&(0,i.jsx)(s.Vp,{className:o()(f.default.adTag),presetType:"ad",children:"广告"})]})]})},m=e=>{let t=(0,c.N)();return(0,i.jsx)(d.k,{componentName:"MiniWinInfo",Slardar:t,children:(0,i.jsx)(v,(0,l._)({},e))})}},691254:function(e,t,n){n.d(t,{H:function(){return V},_:function(){return U}});var l=n(520739),i=n(878389),r=n(368200);n(779788),n(250440),n(874386),n(268917),n(950331);var o=n(563097),a=n(88648),u=n(567754),s=n(810901),d=n(832052),c=n(982755),f=n(248434),v=n(15793),m=n(119422),p=n(774281),g=n(320028),h=n(226683),y=n(490377),_=n(594649),w=n(590682),C=n(847191),x=n(768492),S=n(742740),P=n(765595),E=n(725887),T=n(828782),k=n(66627),b=n(388128),I=n(441447),L=n(860805),N=n(795012),R=n(929582),M=n(987475),j=n(781837),W=n(901046),D=n(801636),A=n(568201),F=n(489278),O=n(979571),B=n(734123);let V=e=>{var t;return!((null!==(t=(0,C.$o)(e))&&void 0!==t?t:0)>0)&&!0},U=e=>{let{shortcut:t,emitEvent:n,position:C,showEnterDetail:V,setIsShow:U,awemeInfo:H,userInfo:K,modalEnterFrom:G,abtestData:z,showRecommendToFriend:$}=e,Z=(0,a.useMemo)(()=>{if(H){var e,t;let n=H.awemeType!==d.e.Note&&H.awemeType!==d.e.XgVideo,l=null==H?void 0:null===(e=H.download)||void 0===e?void 0:e.allowDownload,i=(null===(t=H.status)||void 0===t?void 0:t.reviewStatus)===1,r=(0,c.Jt)(H);return n&&l&&!i&&!r}return!1},[H]),Y=(0,a.useMemo)(()=>{if(!H)return"";let e={},t=(0,N.zD)();if(null==H?void 0:H.logParams){let n=H.logParams,{enter_from:l,previous_page:i,tab_name:o}=n,a=(0,r._)(n,["enter_from","previous_page","tab_name"]);o&&(t=o),e[f.LOG_PASS_THROW_PARAMS]=JSON.stringify(a)}let n="";switch(H.awemeType){case d.e.Note:n=(0,x.Wr)(H.awemeId,(0,u.stringify)((0,l._)({tab_name:t,previous_page:(0,S.yW)()},(0,P.U)(),e)));break;case d.e.XgVideo:n=(0,x.Tl)({videoid:null==H?void 0:H.awemeId});break;default:let i="";if("search"===G)i=v.VideoDetailModeFrom.SearchResult;else if("hot"===G){i=v.VideoDetailModeFrom.HotDetail;let t=null==H?void 0:H.hotList;e.trending_topic=null==t?void 0:t.sentence,e.sentenceId=null==t?void 0:t.sentenceId,e.position=null==t?void 0:t.rank,e.hotValue=null==t?void 0:t.hotScore}if(n=(0,x.JF)(H.awemeId,(0,u.stringify)((0,l._)({tab_name:t,modeFrom:i,previous_page:(0,S.yW)()},(0,P.U)(),e))),["userLike","userPost","userCollection"].includes(G)){var o;let e=null===(o=E.Le.getConfig(E.gI.EnterDetailUrl))||void 0===o?void 0:o[H.awemeId];e&&(n=e)}}return n},[H,G]),q=(0,a.useMemo)(()=>{var e,r,o,a,u,s,d;return[{text:"清屏",key:null===(e=t.immersivePlayer)||void 0===e?void 0:e.badgeText,handler:()=>n(A.B.UpdateImmersiveSwitch,{logParams:{enter_method:"long_press"}})},{text:"评论",key:null===(r=t.comment)||void 0===r?void 0:r.badgeText,handler:()=>n("showComment")},{text:"赞",key:null===(o=t.like)||void 0===o?void 0:o.badgeText,handler:e=>n("onStar",{event:(0,i._)((0,l._)({},e),{offsetX:C.x,offsetY:C.y}),clickMethod:"mouse"})},{text:"进入作者主页",key:null===(a=t.avatar)||void 0===a?void 0:a.badgeText,handler:()=>n("onAvatar")},...(null==H?void 0:null===(u=H.status)||void 0===u?void 0:u.allowSelfRecommendToFriend)&&$?[{text:"推荐给朋友",key:null===(s=t.recommend)||void 0===s?void 0:s.badgeText,handler:()=>n(B.Events.USER_ACTION,{action:"recommend",source:"menu_list"})}]:[],{text:"分享",key:null===(d=t.share)||void 0===d?void 0:d.badgeText,handler:()=>n("showShareCode",{clickMethod:"mouse"})}].filter(e=>e.key)},[n,C,t,$,H]),J=(0,a.useMemo)(()=>{var e;let t=(0,T.DT)(),n=null!==(e=(0,T.FJ)().awemePcClient)&&void 0!==e?e:"";return t&&n&&(0,k.y)(n,">=","3.7.1")&&Z},[z,Z]),Q=(0,a.useMemo)(()=>(0,j.T)(),[]),X=(0,a.useMemo)(()=>{var e,l;let i=[{text:"不感兴趣",key:t.dislike.badgeText,handler:()=>n(A.B.Dislike)},{text:"意见反馈",handler:()=>n("feedback")}];return(null==H?void 0:null===(e=H.authorInfo)||void 0===e?void 0:e.uid)!==(null==K?void 0:null===(l=K.info)||void 0===l?void 0:l.uid)&&!(0,c.Kf)(H)&&i.push({text:"举报",handler:()=>n("showReportModal")}),J&&i.push({text:"下载视频",handler:()=>n("downloadVideo")}),Q&&i.push({text:"独立窗口显示",useRedDot:!0,redDotKey:M.LocalStorageKeys.MultiWindowMenuListRedDot,handler:()=>n("createMultitaskingWindow",Y)}),i},[n,H,t,J,K]),ee=(0,a.useMemo)(()=>{if(!H)return"";let e={},t=(0,N.zD)();if(null==H?void 0:H.logParams){let n=H.logParams,{enter_from:l,previous_page:i,tab_name:o}=n,a=(0,r._)(n,["enter_from","previous_page","tab_name"]);o&&(t=o),e[f.LOG_PASS_THROW_PARAMS]=JSON.stringify(a)}let n="";switch(H.awemeType){case d.e.Note:n=(0,x.Wr)(H.awemeId,(0,u.stringify)((0,l._)({tab_name:t,previous_page:(0,S.yW)()},(0,P.U)(),e)));break;case d.e.XgVideo:n=(0,x.Tl)({videoid:null==H?void 0:H.awemeId});break;default:let i="";if("search"===G)i=v.VideoDetailModeFrom.SearchResult;else if("hot"===G){i=v.VideoDetailModeFrom.HotDetail;let t=null==H?void 0:H.hotList;e.trending_topic=null==t?void 0:t.sentence,e.sentenceId=null==t?void 0:t.sentenceId,e.position=null==t?void 0:t.rank,e.hotValue=null==t?void 0:t.hotScore}if(n=(0,x.JF)(H.awemeId,(0,u.stringify)((0,l._)({tab_name:t,modeFrom:i,previous_page:(0,S.yW)()},(0,P.U)(),e))),["userLike","userPost","userCollection"].includes(G)){var o;let e=null===(o=E.Le.getConfig(E.gI.EnterDetailUrl))||void 0===o?void 0:o[H.awemeId];e&&(n=e)}}return n},[H,G]),et=(0,a.useCallback)(e=>{(0,b.$)(z)?(e.preventDefault(),I.emit(I.EVENT.changeRoute,{to:ee})):n("enterDetail")},[ee,n,z]),en=(0,a.useMemo)(()=>[{component:(0,o.jsx)(W.a,{href:ee,target:"_blank",className:F.default.enterDetail,rel:"opener",onClick:et,children:"进入详情页"},"enterDetail"),handler:()=>n("enterDetail")}],[et,ee,n]),el=(0,a.useMemo)(()=>[...q,...X,...V?en:[]],[q,X,V,en]);return{menuList:el,adMenuList:(0,a.useMemo)(()=>{let e=[{text:"不感兴趣",handler:()=>n(A.B.Dislike)},{text:"喜欢该广告",handler:()=>n(A.B.AdLike)},{text:"举报",handler:()=>n(A.B.AdReport)},{text:"为什么看到广告",handler:()=>n(A.B.AdIntroduce)}];if((0,m.L)(H)||(0,p.u)(H)||(0,g.A)(H)||(0,h.o4)(H)){let t=(0,y.rQ)(H);e.unshift({component:(0,o.jsxs)("div",{className:F.default.viewAdDetail,children:[(0,o.jsxs)("div",{className:F.default.innerContainer,onClick:e=>{I.emit(I.EVENT.openAdSideCard);let t=(0,c.Rx)(H);(0,_.E)("realtime_click",{tag:(0,L.f)(),value:null==t?void 0:t.creative_id,log_extra:null==t?void 0:t.log_extra,refer:"feedback"}),U(!1)},children:[(0,o.jsx)(D.Q,{src:(null==t?void 0:t.image_url)||w.DEFAULT_AD_IMAGE_URL,iconHeight:28,iconWidth:28,className:F.default.adIcon}),(0,o.jsxs)("div",{className:F.default.word,children:[(0,o.jsx)("span",{children:t.button_text||"查看详情"}),(0,o.jsx)(O.z,{svg:(0,o.jsx)(R.Z,{style:{fontSize:"12px",height:"12px",width:"12px"}}),className:F.default.icon})]})]}),(0,o.jsx)(s.i,{className:F.default.divider})]})})}return e},[n,H,U])}}},23171:function(e,t,n){n.d(t,{zm:function(){return O}});var l=n("134761"),i=n("520739");n("874386");var r=n("563097"),o=n("88648"),a=n("489478"),u=n("713097"),s=n.n(u),d=n("734123"),c=n("946075"),f=n("959911"),v=n("361959"),m=n("987475"),p=n("441447"),g=n("637632"),h=n("847191"),y=n("725887"),_=n("162095"),w=n("428647"),C=n("505302"),x=n("872136"),S=new x.h({openPureToastShow:{eventName:"small_window_toast_show",params:{}}}),P=n("979571");let E=o.forwardRef(e=>{let{onDone:t,isShowGuideTip:n,setIsShowGuideTip:l,setIsGuideTipActive:i}=e;return(0,o.useEffect)(()=>{n&&S.sendLog("openPureToastShow",{})},[n]),(0,r.jsxs)("div",{className:s()(C.default.tips,{[C.default.show]:n}),onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},children:[(0,r.jsx)(P.z,{svg:(0,r.jsx)(w.Z,{}),className:s()(C.default.close,"noTransform"),onClick:()=>{i(!1),l(!1)}}),(0,r.jsx)("div",{className:C.default.title,children:(0,r.jsx)("span",{children:"小窗模式播放"})}),(0,r.jsx)("p",{className:C.default.desc,children:"右上角「小窗功能」移到此处，推荐/主页都能使用"}),(0,r.jsx)(_.Button,{theme:"solid",className:C.default.btn,onClick:()=>{null==t||t(),i(!1),l(!1)},children:"立即开启"})]})});var T=n("289228"),k=n("335101"),b=n("443073"),I=n("122677"),L=n("758454"),N="PictureInPictureSettingPlugin";let R={[L.kd.CONTROLS_RIGHT]:{PictureInPictureSettingPlugin:5.5}};n("557586");var M=n("53659");let j={vvCount:0,currentVideoId:"",resetVVInfo:()=>{j.vvCount=0,j.currentVideoId=""}};function W(){return(0,r.jsxs)("div",{className:s()("xgTips"),children:[(0,r.jsx)("span",{children:"小窗模式"}),!!M.SHORTCUT_KEY.pip.badgeText&&(0,r.jsx)("span",{className:"shortcutKey",children:M.SHORTCUT_KEY.pip.badgeText})]})}function D(e){let{isShowGuideTip:t,resizeMiniWindowGuideShow:n,setIsShowGuideTip:l,player:i,noTransform:a,abtestData:u}=e,[c,m]=(0,o.useState)(!1);(0,o.useEffect)(()=>{let e=p.listen(p.EVENT.closeOtherTip,e=>{"PictureInPictureTip"!==e&&(null==l||l(!1))});return()=>e()},[]);let g=(0,o.useCallback)(e=>{p.emit(p.EVENT.changeMinWindows,{event:"check",isMiniWin:!1,clickMethod:e}),null==i||i.emit(d.Events.USER_ACTION,{action:"click_small_window"})},[i]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(E,{isShowGuideTip:t||c,setIsShowGuideTip:l,setIsGuideTipActive:m,onDone:()=>g("toast")}),(0,r.jsx)("div",{className:"xgplayer-icon xgplayer-icon-picture-in-picture",onClick:()=>g("button"),children:(0,r.jsx)(P.z,{svg:(0,r.jsx)(f.Z,{className:s()(a&&"noTransform")}),style:{fontSize:"32px"}})}),n&&!!M.SHORTCUT_KEY.pip.badgeText&&(0,r.jsxs)("div",{className:"picture-in-picture-resize-guide-tips",children:["点击或快捷键",(0,r.jsx)("span",{className:"shortcutKey",children:M.SHORTCUT_KEY.pip.badgeText})," ，启用小窗模式播放",(0,r.jsx)(P.z,{className:"picture-in-picture-resize-guide-tips-icon",svg:(0,r.jsx)(v.Z,{})})]}),!t&&!c&&!n&&(0,r.jsx)(W,{})]})}class A extends d.Plugin{static get pluginName(){return N}static get defaultConfig(){return{position:a.POSITIONS.CONTROLS_RIGHT,index:R[a.POSITIONS.CONTROLS_RIGHT][N],className:"xgplayer-picture-in-picture-setting"}}afterCreate(){if(!this.config.disable)this.renderRoot()}destroy(){(0,I.v)(this)}renderRoot(){let e=(0,r.jsx)(D,{player:this.player,isShowGuideTip:this.config.isShowGuideTip,setIsShowGuideTip:this.config.setShowGuideTip,resizeMiniWindowGuideShow:this.config.resizeMiniWindowGuideShow,noTransform:this.config.noTransform,abtestData:this.config.abtestData});(0,I.s)(this,e)}render(){return`
    <xg-icon class="xgplayer-picture-in-picture-setting picture-in-picture" data-state="normal">
    </xg-icon>`}constructor(...e){super(...e),(0,l._)(this,"updatePictureInPicture",e=>{var t,n,l;this.config.isShowGuideTip!==(null==e?void 0:e.isShowGuideTip)&&(this.config.isShowGuideTip=null!==(t=null==e?void 0:e.isShowGuideTip)&&void 0!==t&&t,this.renderRoot()),this.config.resizeMiniWindowGuideShow!==(null==e?void 0:e.resizeMiniWindowGuideShow)&&(this.config.resizeMiniWindowGuideShow=null!==(n=null==e?void 0:e.resizeMiniWindowGuideShow)&&void 0!==n&&n,this.renderRoot()),this.config.noTransform!==(null==e?void 0:e.noTransform)&&(this.config.noTransform=null!==(l=null==e?void 0:e.noTransform)&&void 0!==l&&l,this.renderRoot())})}}let F=e=>{let{isActive:t,awemeInfo:n,isInnerFeed:l,resizeMiniWindowGuideShow:i,enableGuide:r=!0,noTransform:a=!0,abtestData:u}=e,[s,d]=(0,o.useState)(!1),f=(0,k.n)(),v=(0,o.useRef)(null),_=(0,c.k)(),w=!!(0,g.J)();return(0,o.useEffect)(()=>{let e=_.listen(()=>{j.resetVVInfo()});return()=>{e()}},[]),(0,o.useEffect)(()=>f?2===f.config.reuse&&f.getPlugin(A.pluginName)?()=>{}:(f.registerPlugin(A,{isShowGuideTip:s,setShowGuideTip:d,resizeMiniWindowGuideShow:i,noTransform:a,abtestData:u}),()=>{f.getPlugin(A.pluginName)&&2!==f.config.reuse&&f.unRegisterPlugin(A.pluginName)}):void 0,[f]),(0,o.useEffect)(()=>{if(!f||!t)return;let e=f.getPlugin(A.pluginName);null==e||e.updatePictureInPicture({isShowGuideTip:s,resizeMiniWindowGuideShow:i,noTransform:a})},[s,i,a]),(0,o.useEffect)(()=>{let e=p.listen(p.EVENT.changeMinWindows,e=>{let{event:t}=e,n=(0,h.$o)(m.LocalStorageKeys.PictureInPictureGuide);"open"===t&&!n&&(0,h.qQ)(m.LocalStorageKeys.PictureInPictureGuide,!0)});return()=>null==e?void 0:e()},[]),(0,o.useEffect)(()=>{let e=(0,h.$o)(m.LocalStorageKeys.PictureInPictureGuide);if(!r||e||w)return;let i=()=>{var e;if((null===(e=y.Le.getConfig(y.gI.IsInLookMiniModal))||void 0===e?void 0:e.isInMiniModal)&&!l)return;let n=window.innerWidth<970||window.innerHeight<600;j.vvCount>5&&n&&t&&((0,h.qQ)(m.LocalStorageKeys.PictureInPictureGuide,!0),j.resetVVInfo(),p.emit(p.EVENT.closeOtherTip,"PictureInPictureTip"),d(!0),v.current=setTimeout(()=>{d(!1)},5e3))};return t&&(null==n?void 0:n.awemeId)!==j.currentVideoId&&(j.vvCount++,j.currentVideoId=null==n?void 0:n.awemeId,i()),window.addEventListener("resize",i),()=>{d(!1),clearTimeout(v.current),window.removeEventListener("resize",i)}},[t,null==n?void 0:n.awemeId,r,l]),null},O=e=>{let t=(0,b.N)();return(0,r.jsx)(T.k,{componentName:"PictureInPicturePlugin",Slardar:t,children:(0,r.jsx)(F,(0,i._)({},e))})}},820510:function(e,t,n){n.d(t,{vq:function(){return Z},nf:function(){return G}});var l=n("134761"),i=n("520739"),r=n("878389");n("874386"),n("413806"),n("826893"),n("250440");var o=n("563097"),a=n("489478"),u=n("734123"),s=n("88648"),d=n("713097"),c=n.n(d),f=n("162095"),v=n("867961"),m=n("873034"),p=n("53659"),g=n("28528"),h=n("465769"),y=n("983253"),_=n("725887"),w=n("441447"),C=n("742740"),x=n("504995"),S=n("376978"),P=n("795012"),E=n("914617");let T=(0,s.forwardRef)((e,t)=>(0,o.jsxs)("svg",(0,r._)((0,i._)({width:32,height:32,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:[(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.97 7.73C7.882 7.73 7 8.72 7 9.94v10.58c0 1.22.882 2.21 1.97 2.21h7.287a3 3 0 0 1 4.01-4.186l.308.169 1.564-2.485c.23-.365.525-.663.861-.89V9.94c0-1.22-.882-2.21-1.97-2.21H8.97zm4.723 10.464l3.822-2.451a1.025 1.025 0 0 0 0-1.743l-3.822-2.451c-.724-.464-1.693.035-1.693.871v4.902c0 .837.97 1.336 1.693.872z",fill:"#fff",fillOpacity:".9"}),(0,o.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.946 20.69a1 1 0 0 1 1.358-.394l1.96 1.078 2.567-4.08a1 1 0 1 1 1.693 1.065l-3.07 4.878a1 1 0 0 1-1.328.343L18.34 22.05a1 1 0 0 1-.394-1.358z",fill:"#fff",fillOpacity:".9"})]})));var k=n("39579"),b=n("365102"),I=n("567669"),L=n("407866"),N=n("509090"),R=n("582296"),M=n("115627"),j=n("289228");n("422012");var W=n("335101"),D=n("443073"),A=n("892821"),F=n("122677"),O=n("23380"),B=n("872136"),V=new B.h({watchLaterAdd:{eventName:"watch_later_add",params:{enter_from:"",enter_from_merge:"",group_id:"",author_id:"",tab_name:"",search_params:{search_id:"",search_result_id:""},status:0,failure_reason:"",click_method:"",if_first_big_card:0}},clickHoverLogin:{eventName:"click_hover_login",params:{enter_method:"",enter_from:"",params_for_special:""}}});function U(e){let{disableShortcut:t=!1}=e;return(0,o.jsxs)("div",{className:"xgTips",children:[(0,o.jsx)("span",{children:g.a.t("see_you_later",{},"稍后再看")}),!t&&!!(null==p?void 0:p.SHORTCUT_KEY.watchLater.badgeText)&&(0,o.jsx)("span",{className:"shortcutKey",children:null==p?void 0:p.SHORTCUT_KEY.watchLater.badgeText})]})}let H=e=>{var t,n,l;return{group_id:null!==(n=null==e?void 0:e.awemeId)&&void 0!==n?n:"",author_id:null!==(l=null==e?void 0:null===(t=e.authorInfo)||void 0===t?void 0:t.uid)&&void 0!==l?l:""}},K=e=>(0,r._)((0,i._)({},e),{enter_from_merge:(null==e?void 0:e.enter_from_merge)||"",enter_from:(null==e?void 0:e.enter_from)||(0,h.mo)()||"",tab_name:(null==e?void 0:e.tab_name)||(0,P.zD)()||(0,y.Rs)("tab_name")||"",search_params:(null==e?void 0:e.search_params)||{},player_display_mode:(0,h.Ok)()});function G(e){let{player:t,isLogin:n,loginDispatch:l,isActive:a,awemeInfo:d,isMini:p,isPreview:h,previewSceneProps:y,toast:x,disableShortcut:S,logParams:P,abtest:j,canCancleWatchLaterOnPreview:W=!1,useNewIconOnPreview:D=!1}=e,F=(0,O.H)("watch_later"),B=(0,s.useRef)(null),G=(0,s.useRef)(null),{isMobile:z,isiPad:$}=(0,v.X)(),Z=(0,s.useCallback)(e=>"function"==typeof x?x(e):N.F.info(e),[x]),Y=(0,m.d)(P),[q,J]=(0,s.useState)(!1),Q=e=>{var t,n;let l=null!==(t=_.Le.getConfig(_.gI.WatchLater))&&void 0!==t?t:{},o=null!==(n=l.list)&&void 0!==n?n:"",a=Array.from(new Set([...o?o.split(","):[],e]));_.Le.setConfig(_.gI.WatchLater,(0,r._)((0,i._)({},l),{list:a.join(",")}))},X=e=>{var t,n,l;let o=null!==(n=_.Le.getConfig(_.gI.WatchLater))&&void 0!==n?n:{},a=null!==(l=o.list)&&void 0!==l?l:"",u=a?a.split(","):[],s=null==u?void 0:null===(t=u.filter)||void 0===t?void 0:t.call(u,t=>t!==e);_.Le.setConfig(_.gI.WatchLater,(0,r._)((0,i._)({},o),{list:s.join(",")}))};(0,s.useEffect)(()=>{if(W){var e;let{list:t=""}=null!==(e=_.Le.getConfig(_.gI.WatchLater))&&void 0!==e?e:{};J(t&&t.includes(d.awemeId))}},[W,d]);let ee=(0,s.useCallback)(async e=>{var n,l,o;let a={DUPLICATE:"已添加过该视频",SUCCESS:"添加成功，可在“我的-稍后再看”中查看",FAIL:"添加失败，请稍后再试",OFFLINE:"网络异常，请稍后再试",MAX_LIMIT:"已达上限"},{list:u=""}=null!==(l=_.Le.getConfig(_.gI.WatchLater))&&void 0!==l?l:{};if(d.watchLaterInfo||u.includes(d.awemeId)){Z(a.DUPLICATE),J(!0),Q(null==d?void 0:d.awemeId),V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},H(d),K(Y.current)),{click_method:e,status:0}));return}if(!navigator.onLine){Z(a.OFFLINE),V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},K(Y.current),H(d)),{click_method:e,status:0}));return}let{statusCode:s=-1}=await (0,b.ih)({actionType:1,itemToPlayinfo:{[d.awemeId]:{play_duration:0,loop_status:null!==(o=null==d?void 0:null===(n=d.playProgress)||void 0===n?void 0:n.watch_times)&&void 0!==o?o:0}}});if(0===s){Z(a.SUCCESS),J(!0),t&&(t.isWatchLater=!0),Q(null==d?void 0:d.awemeId),V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},K(Y.current),H(d)),{click_method:e,status:1}));return}if(4===s){Z(a.MAX_LIMIT),V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},H(d),K(Y.current)),{failure_reason:"overlimit",click_method:e,status:0}));return}Z(a.FAIL),V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},K(Y.current),H(d)),{click_method:e,status:0}))},[d]);(0,s.useEffect)(()=>{var e;let{list:n=""}=null!==(e=_.Le.getConfig(_.gI.WatchLater))&&void 0!==e?e:{},l=!!d.watchLaterInfo||n.includes(d.awemeId);t&&(t.isWatchLater=l)},[t,d]);let et=(0,s.useCallback)(async()=>{let{isSuccess:e}=await (0,b.iH)({awemeIds:[null==d?void 0:d.awemeId],remove_type:b.L7.selectItems});if(!e){Z("服务异常，请稍后再试");return}X(null==d?void 0:d.awemeId),J(!1),t&&(t.isWatchLater=!1),Z("已移除添加视频")},[d]),en=(0,s.useRef)(!1),el=(0,s.useCallback)(async e=>{en.current=!1,(0,R.default)({headerText:"登录后可添加稍后再看",success:async()=>{en.current=!0,null==l||l({type:"updateUserInfo"}),ee(e)},enterMethod:"watch_later_add",onClose:()=>{w.emit(w.EVENT.videoRemoveStopPlayNext),!en.current&&(en.current=!0,V.sendLog("watchLaterAdd",(0,r._)((0,i._)({},K(Y.current),H(d)),{failure_reason:"not_login",click_method:e,status:0})))}})},[ee,l,d,j]),ei=(0,s.useCallback)(async e=>{let{clickMethod:i="icon"}=e||{};if(!!a&&!!d&&!B.current&&(!!(null==t?void 0:t.isUserActive)||!!h))null==t||t.emit(u.Events.USER_ACTION,{action:"click_view_later"}),B.current=setTimeout(()=>{B.current&&(B.current=null)},3e3),n?ee(i):(null==l||l({type:"updateUserInfo"}),el(i))},[l,el,ee,n,a,d,t]);(0,s.useEffect)(()=>()=>{clearTimeout(B.current)},[]),(0,s.useEffect)(()=>{if(!a||!t||S)return()=>{};let e=e=>{let{clickMethod:t,isOn:n}=e;"switch"===t?n?ei(e):et():ei(e)};return null==t||t.on("onWatchLater",e),()=>{null==t||t.off("onWatchLater",e)}},[t,a,ei,S]);let[er,eo]=(0,s.useState)(!1);if(h){let e=W&&q;return(0,o.jsx)("div",{className:c()(I.default.preview,null==y?void 0:y.className),onClick:t=>{t.stopPropagation(),t.preventDefault(),e?et():ei({clickMethod:`${(0,C.yW)()}_preview`})},children:(0,o.jsx)(f.Tooltip,{position:"bottomRight",content:(0,o.jsx)("div",{className:I.default.text,children:e?"已添加稍后再看":"添加到稍后再看"}),getPopupContainer:()=>G.current||document.body,style:(null==y?void 0:y.disabledTooltip)?{display:"none"}:{},children:(0,o.jsx)("div",{ref:G,style:{position:"relative"},children:e?(0,o.jsx)(M.Z,{className:c()(I.default.cancleIcon),src:T,width:(null==y?void 0:y.width)||24,height:(null==y?void 0:y.height)||24,viewBox:(null==y?void 0:y.viewBox)||"2 2 26 26"}):(0,o.jsx)(o.Fragment,{children:D?(0,o.jsx)(A.Z,{width:(null==y?void 0:y.width)||24,height:(null==y?void 0:y.height)||24,className:I.default.previewIcon}):(0,o.jsx)(M.Z,{className:c()(I.default.previewIcon,{[I.default.isHover]:er}),src:E.Z,width:(null==y?void 0:y.width)||24,height:(null==y?void 0:y.height)||24,viewBox:(null==y?void 0:y.viewBox)||"2 2 26 26"})})})})})}return p?(0,o.jsxs)("div",{className:L.default.switchBox,onClick:e=>ei({clickMethod:"icon"}),children:[(0,o.jsx)("div",{className:L.default.switchLabel,children:g.a.t("see_you_later",{},"稍后再看")}),(0,o.jsxs)("div",{className:c()(L.default.select,L.default.textSelect),children:["添加",(0,o.jsx)(k.Z,{className:"noTransform"})]})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("div",{ref:F,className:"xgplayer-watch-later-item xgplayer-icon",onClick:e=>ei({clickMethod:"icon"}),children:(0,o.jsx)(A.Z,{width:32,height:32,className:I.default.newIcon})}),!z&&!$&&(0,o.jsx)(U,{disableShortcut:S})]})}class z extends u.Plugin{static get pluginName(){return"WatchLaterPlugin"}static get defaultConfig(){return{position:a.POSITIONS.CONTROLS_RIGHT,index:6.2,className:"xgplayer-watch-later"}}afterCreate(){if(!this.config.disable)this.renderRoot(),this.bind("mouseenter",this.onMouseenter),this.bind("mouseleave",this.onMouseleave)}destroy(){this.unbind("mouseenter",this.onMouseenter),this.unbind("mouseleave",this.onMouseleave),(0,F.v)(this)}renderRoot(){var e;let t=null!==(e=this.config)&&void 0!==e?e:{};this.root&&(0,F.s)(this,(0,o.jsx)(G,(0,i._)({},t)))}update(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.config=(0,i._)({},this.config,e),this.renderRoot()}render(){return`
    <xg-icon class="xgplayer-watch-later" data-state="normal">
    </xg-icon>`}constructor(...e){super(...e),(0,l._)(this,"onMouseleave",()=>{this.emit("icon_mouseleave",{pluginName:this.pluginName})}),(0,l._)(this,"onMouseenter",()=>{this.emit("icon_mouseenter",{pluginName:this.pluginName})})}}let $=e=>{let{awemeInfo:t,isActive:n,disable:l,loginDispatch:i,isLogin:r,toast:o,disableShortcut:a,logParams:u,abtest:d}=e,c=(0,W.n)(),f=(0,m.d)(u);return(0,s.useEffect)(()=>{if(c&&(0,x.D)(t)&&!S.H.baseOpt(d))return 2===c.config.reuse&&c.getPlugin("WatchLaterPlugin")?()=>{}:(c.registerPlugin(z,{disable:l,loginDispatch:i,isActive:n,awemeInfo:t,isLogin:r,player:c,toast:o,disableShortcut:a,logParams:f.current,abtest:d}),()=>{c.getPlugin("WatchLaterPlugin")&&2!==c.config.reuse&&c.unRegisterPlugin("WatchLaterPlugin",!0)})},[c,t,d]),(0,s.useEffect)(()=>{if(c&&(0,x.D)(t)&&S.H.baseOpt(d))return 2===c.config.reuse&&c.getPlugin("WatchLaterPlugin")?()=>{}:(c.registerPlugin(z,{disable:l,loginDispatch:i,isActive:n,awemeInfo:t,isLogin:r,player:c,toast:o,disableShortcut:a,logParams:f.current,abtest:d}),()=>{c.getPlugin("WatchLaterPlugin")&&2!==c.config.reuse&&c.unRegisterPlugin("WatchLaterPlugin",!0)})},[c,d]),(0,s.useEffect)(()=>{var e;let u=null==c?void 0:null===(e=c.getPlugin)||void 0===e?void 0:e.call(c,"WatchLaterPlugin");u&&u.update({isActive:n,awemeInfo:t,loginDispatch:i,disable:l,isLogin:r,toast:o,disableShortcut:a,abtest:d})},[c,n,t,i,l,r,o,a,d]),null},Z=e=>{let t=(0,D.N)();return(0,o.jsx)(j.k,{componentName:"WatchLater",Slardar:t,children:(0,o.jsx)($,(0,i._)({},e))})}},914592:function(e,t,n){n.d(t,{rl:function(){return O},Vw:function(){return U}});var l=n("134761"),i=n("520739");n("874386"),n("250440");var r=n("563097"),o=n("88648"),a=n("734123"),u=n("489478"),s=n("713097"),d=n.n(s),c=n("784492"),f=n("867961"),v=n("399242"),m=n("987475"),p=n("982755"),g=n("594649"),h=n("905003"),y=n("175018"),_=n("441447"),w=n("847191"),C=n("828782"),x=n("28528"),S=n("465769"),P=n("860805"),E=n("737271"),T=n("725887"),k=n("613480"),b=n("690001"),I=n("18950"),L=n("872136"),N=new L.h({fullscreenBubbleShow:{eventName:"fullscreen_bubble_show",params:{author_id:"",group_id:"",enter_from:"recommend"}},enterFullWebscreen:{eventName:"enter_full_webscreen",params:{author_id:"",group_id:"",enter_from:"recommend",enter_from_merge:"",item_duration_ms:0,click_from:"",player_display_mode:""}},exitFullWebscreen:{eventName:"exit_full_webscreen",params:{author_id:"",group_id:"",enter_from:"recommend",click_from:"",player_display_mode:""}}}),R=n("289228"),M=n("335101"),j=n("443073"),W=n("798644"),D=n("122677");n("976261");var A=n("49279"),F=n("53659");function O(e){let{player:t,isCtxCssFullScreen:n}=e,{isMobile:l,isiPad:i}=(0,f.X)(),[u,s]=(0,o.useState)(W.s.getPlayerScene(null==t?void 0:t.playerId)===v.lT.Modal?W.s.getPlayerIsPageFullscreen(null==t?void 0:t.playerId):W.s.getIsPageFullscreen()||n);return t&&(t.isPageFullScreen=u),(0,o.useEffect)(()=>{if(!t)return;let e=_.listen(_.EVENT.pageFullScreen,e=>{let{playerId:n,fullScreen:l}=e||{};W.s.getPlayerScene(null==t?void 0:t.playerId)===v.lT.Modal?n===(null==t?void 0:t.playerId)&&(s(l),W.s.setPageFullscreen({playerId:t.playerId,isPageFullscreen:l})):(s(l),W.s.setPageFullscreen({playerId:t.playerId,isPageFullscreen:l}))});return()=>{e()}},[t]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{onMouseEnter:()=>{(0,w.qQ)(m.LocalStorageKeys.ShowPageFullScreenGuide,!0)},onClick:()=>{var e;if(null==t?void 0:null===(e=t.openGeneralSearchModalSlide)||void 0===e?void 0:e.call(t,{from:"pageFullscreen"}))return;let n=W.s.getPlayerIsPageFullscreen(null==t?void 0:t.playerId);s(!n),W.s.setPageFullscreen({playerId:t.playerId,isPageFullscreen:!n}),_.emit(_.EVENT.pageFullScreen,{clickMethod:"icon",fullScreen:!n,playerId:t.playerId}),t.emit(a.Events.USER_ACTION,{action:"page_fullscreen_change"})},className:"xgplayer-icon",children:u?(0,r.jsx)(b.Z,{width:32,height:32,color:"#fff"}):(0,r.jsx)(I.Z,{width:32,height:32})}),!l&&!i&&(0,r.jsxs)("div",{className:d()("xgTips"),children:[!!(!(0,C.DT)()&&u)&&(0,r.jsx)("span",{children:x.a.t("webpage_full_screen_exit",{},"退出网页全屏")}),!!(!(0,C.DT)()&&!u)&&(0,r.jsx)("span",{children:x.a.t("webpage_full_screen",{},"网页全屏")}),!!((0,C.DT)()&&u)&&(0,r.jsx)("span",{children:"退出窗口全屏"}),!!((0,C.DT)()&&!u)&&(0,r.jsx)("span",{children:"窗口全屏"}),!!F.SHORTCUT_KEY.pageFullScreen.badgeText&&(0,r.jsx)("span",{className:"shortcutKey",children:F.SHORTCUT_KEY.pageFullScreen.badgeText})]})]})}class B extends a.Plugin{static get pluginName(){return"PageFullScreenPlugin"}static get defaultConfig(){return{position:u.POSITIONS.CONTROLS_RIGHT,index:.8,className:"xgplayer-page-full-screen"}}updateConfig(e){this.config=e,this.renderRoot()}afterCreate(){this.bind("mouseenter",this.onMouseenter),this.bind("mouseleave",this.onMouseLeave),this.renderRoot()}destroy(){this.unbind("mouseenter",this.onMouseenter),this.unbind("mouseleave",this.onMouseLeave),(0,D.v)(this)}renderRoot(){let e=(0,r.jsx)(O,{player:this.config.player,isCtxCssFullScreen:this.config.isCtxCssFullScreen,abtestData:this.config.abtestData});(0,D.s)(this,e)}render(){return`
    <xg-icon class="xgplayer-page-full-screen" data-state="normal" data-e2e="xgplayer-page-full-screen">
    </xg-icon>`}constructor(...e){super(...e),(0,l._)(this,"onMouseenter",()=>{this.emit("icon_mouseenter",{pluginName:this.pluginName})}),(0,l._)(this,"onMouseLeave",()=>{this.emit("icon_mouseleave",{pluginName:this.pluginName})})}}let V=e=>{let{awemeInfo:t,logParams:n,isActive:l,defaultIsPageFullScreen:i,modalEnterFrom:r,abtestData:u}=e,s=(0,o.useRef)(),{isCssFullScreen:d}=(0,o.useContext)(k.C)||{},f=(0,M.n)(),{awemeFeed:m}=(0,A.j)();return(0,o.useEffect)(()=>{f&&l&&(null!=i?i:d)&&W.s.setPageFullscreen({playerId:f.playerId,isPageFullscreen:null!=i?i:d})},[f,l]),(0,o.useEffect)(()=>{if(f&&l)return 2===f.config.reuse&&f.getPlugin("PageFullScreenPlugin")?()=>{}:(f.registerPlugin(B,{player:f,isCtxCssFullScreen:d,abtestData:u}),()=>{f.getPlugin("PageFullScreenPlugin")&&2!==f.config.reuse&&(null==f||f.unRegisterPlugin("PageFullScreenPlugin"))})},[f,l]),(0,o.useEffect)(()=>{if(f&&l){let e=f.getPlugin("PageFullScreenPlugin");e&&[v.lT.Follow,v.lT.Friend,v.lT.Recommend,v.lT.Topic].includes(W.s.getPlayerScene(f.playerId))&&e.updateConfig({player:f,isCtxCssFullScreen:d,abtestData:u})}},[d,u]),(0,o.useEffect)(()=>{if(t&&f&&l){let e=_.listen(_.EVENT.pageFullScreen,e=>{var l,i;let{clickMethod:o,fullScreen:a,oldFullScreen:u}=e||{},s=null!==(i=null!=u?u:W.s.getIsPageFullscreen())&&void 0!==i&&i,d=null!=a?a:!s,c={author_id:null==t?void 0:t.authorUserId,group_id:null==t?void 0:t.groupId,enter_from:null==n?void 0:n.enter_from,enter_from_merge:null==n?void 0:n.enter_from_merge,item_duration_ms:(null==t?void 0:null===(l=t.video)||void 0===l?void 0:l.duration)||0,click_from:o,player_display_mode:(0,S.Ok)()};if(d){if("inner_player"!==o&&N.sendLog("enterFullWebscreen",c),(0,p.Jt)(t)){let e=(0,p.Rx)(t);(0,g.E)("full_screen",{tag:(0,P.f)(),value:e.creative_id,log_extra:e.log_extra,player_form:"web_full"})}}else if(!1!==s&&(N.sendLog("exitFullWebscreen",c),(0,p.Jt)(t))){let e=(0,p.Rx)(t);(0,g.E)("full_screen",{tag:(0,P.f)(),value:e.creative_id,log_extra:e.log_extra,player_form:"normal"})}if((0,E.r)()&&d){if(W.s.getPlayersByScene(v.lT.Modal).length>0&&r!==h.a.RecommendUpdateWindow)return;f.exitFullscreen(),f.emit("switch_fullscreen",{fullscreen:!0,cssFullScreen:!0})}T.Le.setConfig(T.gI.IsPageFullScreen,{type:d})});return()=>{null==e||e()}}},[n,f,t,l,r]),(0,o.useEffect)(()=>{if(f&&l){let e=e=>{e&&W.s.getIsPageFullscreen()&&(W.s.setPageFullscreen({playerId:f.playerId,isPageFullscreen:!1}),!m.getValue("modalAwemeInfo")&&_.emit(_.EVENT.pageFullScreen,{clickMethod:"fullscreen",fullScreen:!1,playerId:f.playerId}))};return f.on(a.Events.FULLSCREEN_CHANGE,e),()=>{null==f||f.off(a.Events.FULLSCREEN_CHANGE,e)}}},[f,l]),(0,o.useEffect)(()=>{let e=e=>{if(e.shiftKey||e.metaKey||e.ctrlKey)return;let t=T.Le.getConfig(T.gI.DisableExit);"Escape"===e.code&&W.s.getPlayerIsPageFullscreen(null==f?void 0:f.playerId)&&f.isUserActive&&!t&&(W.s.setPageFullscreen({playerId:f.playerId,isPageFullscreen:!1}),setTimeout(()=>{m.dispatch("modalAwemeInfo",null)},100),_.emit(_.EVENT.pageFullScreen,{clickMethod:"esc",fullScreen:!1,playerId:f.playerId}))};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[f]),(0,c.Z)(()=>{if(l){var e,t;let n=null===(e=T.Le.getConfig(T.gI.IsInLookMiniModal))||void 0===e?void 0:e.isInMiniModal;if(d){if(!n&&!m.getValue("modalAwemeInfo")){let e=F.SHORTCUT_KEY.pageFullScreen.badgeText;s.current=y.F.info({text:`ESC${e?`或${e}`:""}可退出网页全屏`,zIndex:1e4})}}else null===(t=s.current)||void 0===t||t.call(s)}},[d]),null},U=e=>{let t=(0,j.N)();return(0,r.jsx)(R.k,{componentName:"PageFullScreen",Slardar:t,children:(0,r.jsx)(V,(0,i._)({},e))})}},745707:function(e,t,n){n.d(t,{H:function(){return l}});let l=e=>{var t;let n=null===(t=e.root)||void 0===t?void 0:t.closest(".basePlayerContainer");return(null==n?void 0:n.querySelector(".focusPanel"))||null}},39579:function(e,t,n){var l=n(520739),i=n(878389),r=n(563097),o=n(88648);let a=(0,o.forwardRef)((e,t)=>(0,r.jsx)("svg",(0,i._)((0,l._)({width:12,height:12,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:(0,r.jsx)("path",{d:"M13 4a1 1 0 1 0-2 0v7H4a1 1 0 1 0 0 2h7v7a1 1 0 1 0 2 0v-7h7a1 1 0 1 0 0-2h-7V4z",fill:"#000"})})));t.Z=a},914617:function(e,t,n){var l=n(520739),i=n(878389),r=n(563097),o=n(88648);let a=(0,o.forwardRef)((e,t)=>(0,r.jsxs)("svg",(0,i._)((0,l._)({width:32,height:32,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:[(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8.97 8.73C7.882 8.73 7 9.72 7 10.94v10.58c0 1.22.882 2.21 1.97 2.21h8.254A5.5 5.5 0 0 1 23 15.59v-4.65c0-1.22-.882-2.21-1.97-2.21H8.97zm4.723 10.464l3.822-2.451a1.025 1.025 0 0 0 0-1.743l-3.822-2.451c-.724-.464-1.693.035-1.693.871v4.902c0 .837.97 1.336 1.693.872z",fill:"#fff",fillOpacity:".9"}),(0,r.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M22 25a4 4 0 1 0 0-8 4 4 0 0 0 0 8zm.4-6a.9.9 0 1 0-1.8 0v2.5a.9.9 0 0 0 .9.9H24a.9.9 0 1 0 0-1.8h-1.6V19z",fill:"#fff",fillOpacity:".9"})]})));t.Z=a},556966:function(e,t,n){var l=n(520739),i=n(878389),r=n(563097),o=n(88648);let a=(0,o.forwardRef)((e,t)=>(0,r.jsxs)("svg",(0,i._)((0,l._)({width:19,height:16,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t},e),{children:[(0,r.jsx)("path",{d:"M8.371.75c1.625 0 2.91 0 3.925.12 1.03.121 1.88.376 2.589.958l.177.152c.172.157.333.326.481.506l.105.135c.508.681.74 1.488.854 2.454.09.76.11 1.67.116 2.763h-1.5c-.005-1.075-.025-1.908-.105-2.587-.092-.778-.255-1.278-.513-1.657l-.116-.156a3.257 3.257 0 0 0-.33-.346l-.121-.105c-.398-.326-.924-.524-1.813-.629-.906-.107-2.087-.108-3.749-.108h-1c-1.18 0-2.019 0-2.674.057-.564.048-.94.133-1.236.266l-.122.06a3.25 3.25 0 0 0-1.213 1.128l-.121.207c-.168.314-.272.713-.327 1.358C1.622 5.981 1.62 6.82 1.62 8s.001 2.019.057 2.674c.055.645.159 1.044.327 1.358l.121.207c.3.473.717.862 1.213 1.127l.122.06c.296.134.672.22 1.236.267.655.056 1.494.057 2.674.057h2.76c.008.374.025.635.071.868.043.218.105.429.182.632H7.37c-1.154 0-2.067 0-2.8-.062-.65-.055-1.211-.163-1.722-.393l-.217-.105a4.751 4.751 0 0 1-1.773-1.647l-.177-.304c-.304-.569-.436-1.196-.5-1.938C.12 10.068.123 9.154.123 8c0-1.154-.002-2.068.06-2.8.064-.743.196-1.37.5-1.94l.177-.303a4.75 4.75 0 0 1 1.773-1.646l.217-.106C3.359.975 3.92.867 4.57.812 5.304.749 6.217.75 7.371.75h1z",fill:"#fff",fillOpacity:".9"}),(0,r.jsx)("path",{d:"M17.375 12.838c0-.492-.002-.786-.03-.997a.708.708 0 0 0-.042-.178l-.001-.002H17.3a.713.713 0 0 0-.178-.042c-.21-.03-.505-.031-.997-.031h-1c-.492 0-.786.002-.997.03a.713.713 0 0 0-.178.042l-.002.001v.002a.713.713 0 0 0-.042.178c-.029.21-.031.505-.031.997s.002.786.03.997a.713.713 0 0 0 .042.178l.001.002h.002a.713.713 0 0 0 .178.042c.21.029.505.03.997.03h1c.492 0 .786-.001.997-.03a.713.713 0 0 0 .178-.041l.002-.001v-.002a.708.708 0 0 0 .042-.178c.029-.21.031-.505.031-.997zm1.5 0c0 .45.002.863-.043 1.197-.042.311-.133.637-.362.921l-.108.12c-.309.308-.684.421-1.04.469-.334.045-.747.043-1.197.043h-1c-.45 0-.863.002-1.197-.043-.311-.042-.638-.133-.921-.362l-.12-.108c-.308-.309-.421-.684-.469-1.04-.045-.334-.043-.747-.043-1.197 0-.45-.002-.863.043-1.197.048-.356.16-.731.47-1.04l.119-.108c.284-.229.61-.32.92-.362.335-.045.748-.043 1.198-.043h1c.45 0 .863-.002 1.197.043.356.048.731.16 1.04.47l.108.119c.229.283.32.61.362.92.045.335.043.748.043 1.198zM5.701 6.894l-.002.184v2.25H4.2v-2.25c0-.45-.002-.863.043-1.197.042-.311.134-.637.362-.921l.108-.12c.309-.308.684-.421 1.04-.469.334-.045.747-.043 1.197-.043H9.2v1.5H6.95l-.188.002 3.122 3.123-1.06 1.06L5.7 6.894z",fill:"#fff",fillOpacity:".9"})]})));t.Z=a}}]);
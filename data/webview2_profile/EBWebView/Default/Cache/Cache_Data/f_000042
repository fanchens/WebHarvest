/*! For license information please see 46362.c1f24377.js.LICENSE.txt */
(self.webpackChunkdouyin_web=self.webpackChunkdouyin_web||[]).push([["46362"],{53562:function(e,t,n){"use strict";n.d(t,{DT:function(){return f},Pi:function(){return E}}),n("563724");var i,r=n("203321"),o=n("274713");n("535917"),n("602157"),n("874386"),n("268917");var a=n("104013"),s=n("88648");function u(e){return(0,a.getDependencyTree)(e)}var l=n("826886"),c=!1;function f(e){c=e}function d(){return c}var h=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)a.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return a};function p(e){return"observer".concat(e)}var v=function(){};function y(){return new v}function m(e,t){if(void 0===t&&(t="observed"),c)return e();var n,i,r=h(s.useState(y),1)[0],o=h(s.useState(),2)[1],f=function(){return o([])},d=s.useRef(null);!d.current&&(d.current={reaction:null,mounted:!1,changedBeforeMount:!1});var v=d.current;if(!v.reaction&&(v.reaction=new a.Reaction(p(t),function(){v.mounted?f():v.changedBeforeMount=!0}),l.O.register(r,v,v)),s.useDebugValue(v.reaction,u),s.useEffect(function(){return l.O.unregister(v),v.mounted=!0,v.reaction?v.changedBeforeMount&&(v.changedBeforeMount=!1,f()):(v.reaction=new a.Reaction(p(t),function(){f()}),f()),function(){v.reaction.dispose(),v.reaction=null,v.mounted=!1,v.changedBeforeMount=!1}},[]),v.reaction.track(function(){try{n=e()}catch(e){i=e}}),i)throw i;return n}n("209955");var g="function"==typeof Symbol&&Symbol.for,_=g?Symbol.for("react.forward_ref"):"function"==typeof s.forwardRef&&(0,s.forwardRef)(function(e){return null}).$$typeof,b=g?Symbol.for("react.memo"):"function"==typeof s.memo&&(0,s.memo)(function(e){return null}).$$typeof;function E(e,t){if(b&&e.$$typeof===b)throw Error("[mobx-react-lite] You are trying to use `observer` on a function component wrapped in either another `observer` or `React.memo`. The observer already applies 'React.memo' for you.");if(c)return e;var n,i=null!==(n=null==t?void 0:t.forwardRef)&&void 0!==n&&n,r=e,o=e.displayName||e.name;if(_&&e.$$typeof===_&&(i=!0,"function"!=typeof(r=e.render)))throw Error("[mobx-react-lite] `render` property of ForwardRef was not a function");var a=function(e,t){return m(function(){return r(e,t)},o)};return""!==o&&(a.displayName=o),e.contextTypes&&(a.contextTypes=e.contextTypes),i&&(a=(0,s.forwardRef)(a)),function(e,t){Object.keys(e).forEach(function(n){!S[n]&&Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))})}(e,a=(0,s.memo)(a)),a}var S={$$typeof:!0,render:!0,compare:!0,type:!0,displayName:!0};n("150981"),(0,o.z0)(r.m),l.O.finalizeAllImmediately},629582:function(e,t,n){"use strict";n.d(t,{SB:function(){return r}}),n(874386);var i=function(){function e(e){var t=this;Object.defineProperty(this,"finalize",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"registrations",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"sweepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sweep",{enumerable:!0,configurable:!0,writable:!0,value:function(e){void 0===e&&(e=1e4),clearTimeout(t.sweepTimeout),t.sweepTimeout=void 0;var n=Date.now();t.registrations.forEach(function(i,r){n-i.registeredAt>=e&&(t.finalize(i.value),t.registrations.delete(r))}),t.registrations.size>0&&t.scheduleSweep()}}),Object.defineProperty(this,"finalizeAllImmediately",{enumerable:!0,configurable:!0,writable:!0,value:function(){t.sweep(0)}})}return Object.defineProperty(e.prototype,"register",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t,n){this.registrations.set(n,{value:t,registeredAt:Date.now()}),this.scheduleSweep()}}),Object.defineProperty(e.prototype,"unregister",{enumerable:!1,configurable:!0,writable:!0,value:function(e){this.registrations.delete(e)}}),Object.defineProperty(e.prototype,"scheduleSweep",{enumerable:!1,configurable:!0,writable:!0,value:function(){void 0===this.sweepTimeout&&(this.sweepTimeout=setTimeout(this.sweep,1e4))}}),e}(),r="undefined"!=typeof FinalizationRegistry?FinalizationRegistry:i},535917:function(e,t,n){"use strict";n(250440),n(268917)},544845:function(e,t,n){"use strict";var i=n(88648);t.Z=function(e){var t=(0,i.useRef)(e);t.current=e,(0,i.useEffect)(function(){return function(){return t.current()}},[])}},826540:function(e,t,n){"use strict";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach(function(t){u(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,v(i.key),i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,n){return(t=v(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}n.d(t,{IP:function(){return c},Lc:function(){return d},PA:function(){return o},U2:function(){return p},WY:function(){return h},XW:function(){return l},Zj:function(){return r},_x:function(){return u},qH:function(){return s}});function d(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=c(e);return n=t?Reflect.construct(i,arguments,c(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return d(e)}(this,n)}}function p(){return(p="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function v(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}},247267:function(e,t,n){"use strict";function i(e,t){var n=e.createDynamicsCompressor();return function(e,t,n){t.threshold.setValueAtTime(n.threshold,e.currentTime),t.knee.setValueAtTime(n.knee,e.currentTime),t.ratio.setValueAtTime(n.ratio,e.currentTime),t.attack.setValueAtTime(n.attack,e.currentTime),t.release.setValueAtTime(n.release,e.currentTime)}(e,n,t),n}n.d(t,{e:function(){return i}})},565912:function(e,t,n){"use strict";n.d(t,{EH:function(){return a},Qf:function(){return i},bC:function(){return o},i_:function(){return r}});var i={Closed:"closed",Running:"running",Suspended:"suspended"},r={Suspended:1,Init:2,Source:3,Effect:4},o={pause:"_onPause",play:"_onPlay",loadeddata:"_onLoadedData",timeupdate:"_onTimeupdate",error:"_onPlayerError"},a={COMPRESSOR:"compressor",LOUDNESS:"loudness",MIX:"mix"}},130003:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n(826540);n(891555),n(98601),n(429532);var r=n(537561),o=n(734123),a=n(398624),s=function(e){(0,i.XW)(n,e);var t=(0,i.WY)(n);function n(e){var r;return(0,i.PA)(this,n),r=t.call(this,e),(0,i._x)((0,i.Lc)(r),"handleMetaParsed",function(e){if("audio"===e){var t,n,i,o,a,s=null===(t=r.player.plugins.flvlive)||void 0===t?void 0:null===(n=t.flv)||void 0===n?void 0:null===(i=n.tracks)||void 0===i?void 0:null===(o=i.audioTrack)||void 0===o?void 0:null===(a=o.meta)||void 0===a?void 0:a.sampleRate;s&&(r.config.meta.sampleRate=s)}}),(0,i._x)((0,i.Lc)(r),"updateLoudness",function(e){if(100===e.code)try{var t=new TextDecoder("utf-8").decode(e.content);t=t.slice(t.indexOf("{"),t.lastIndexOf("}")+1);var n=JSON.parse(t),i=n.loudness||n.audio_loudness;if(i){var o,a,s,u=i.sourcePeak,l=i.sourceLuft,c=i.integrated_source_loudness,f=i.integrated_source_peak,d=(null===(o=r.mammonEngine)||void 0===o?void 0:o.param)||r.config.meta,h=l||c,p=u||f;void 0!==p&&(d.source_peak=p,d.peak=p),void 0!==h&&(d.source_lufs=h,d.loudness=h),r.mammonEngine?r.mammonEngine.updateEffectNode(r.mammonEngine.player._effectNode,d):r.config.meta.sampleRate&&(null===(a=r.player.plugins.flvlive)||void 0===a||null===(s=a.flv)||void 0===s||s.off("SEI_PARSED",r.updateLoudness),r.initMammon())}}catch(e){}}),r.config=Object.assign((0,a._)(),e.config),r}return(0,i.qH)(n,[{key:"afterCreate",value:function(){var e,t;this.player.on("metadataparsed",this.handleMetaParsed),null===(e=this.player.plugins.flvlive)||void 0===e||null===(t=e.flv)||void 0===t||t.on("SEI_PARSED",this.updateLoudness),this.player.on("SEI_PARSED",this.updateLoudness)}},{key:"initMammon",value:function(){(!this.mammonEngine||!this.mammonEngine.player)&&(this.mammonEngine=new r.Z(this.config),this.mammonEngine.attachPlayer(this.player))}},{key:"destroy",value:function(){var e,t,n;this.player.off("metadataparsed",this.handleMetaParsed),null===(e=this.player.plugins.flvlive)||void 0===e||null===(t=e.flv)||void 0===t||t.off("SEI_PARSED",this.updateLoudness),null===(n=this.mammonEngine)||void 0===n||n.destroy()}}],[{key:"pluginName",get:function(){return"mammon"}},{key:"isSupported",value:function(){return r.Z.isSupported()}}]),n}(o.BasePlugin)},885254:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var i={ERROR:"error",META_UPDATE:"metaupdate",META_APPEND:"metaappend",WORKER_READY:"workerready",WORKER_ERROR:"workererror"}},938033:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});let i="0.0.1-alpha.9"},117801:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=Object.defineProperty,r=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t,n)=>(r(e,"symbol"!=typeof t?t+"":t,n),n);class a{constructor(e){o(this,"options"),o(this,"scores"),this.options=e,this.scores=[],this._init()}_init(){Object.keys(this.options.plugins).forEach(e=>{let t=this.options.plugins[e];!t.ignore&&(t.cls&&(t.instance=new t.cls(t)),t.instance&&this.scores.push(new Promise(n=>{t.instance.getScore().then(i=>{n({key:e,factor:t.factor,val:i})})})))})}getScore(){return new Promise(e=>{Promise.all(this.scores).then(t=>{let n={},i=0,r=0;t.forEach(({factor:e,val:t})=>{t.score>0&&(r+=e)}),r=0===r?1:r;for(let e=0;e<t.length;e++){let o=t[e];i+=o.factor/r*o.val.score,n[o.key]=o.val}n.score=i,e(n)}).catch(console.log)})}}},663037:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var i=new class e{getScore(){return new Promise(e=>{let t=navigator.hardwareConcurrency,n=0;if(t>0){let e=Math.log2(t);n=e<=2?3*e:e<=3?(e-2)*1.6+6:(e-3)*.523+7.6}e({score:n,origin:t})})}}},754843:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=Object.defineProperty,r=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t,n)=>(r(e,"symbol"!=typeof t?t+"":t,n),n),a=new class e{constructor(){o(this,"_worker"),o(this,"_getScoreCallback",()=>{})}getScore(){return new Promise(e=>{try{let t=new Image;t.src="//lf6-cdn-tos.douyinstatic.com/obj/venus/pc-theme/spring/20230411-162827.jpeg",t.onload=()=>{let n=Date.now();"function"==typeof t.decode?t.decode().then(()=>{let t=Date.now()-n,i=1e3/t,r=0;if(i>0){let e=Math.log10(i);e<=1?r*=6:r=e<=2?(e-1)*1.6+6:(e-2)*2.4+7.6}e({score:r,origin:i})}):e({score:0,origin:-1})}}catch(t){e({score:0,origin:-1})}})}}},954063:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var i=new class e{_getOrigin(){new Uint8Array(3686400).fill(8);let e=performance.now();return 1e3/(performance.now()-e)}getScore(){return new Promise(e=>{e({score:0,origin:this._getOrigin()})})}}},67902:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var i=new class e{getScore(){return new Promise(e=>{e({score:0,origin:navigator.deviceMemory})})}}},517853:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var i=new class e{getScore(){return new Promise(e=>{var t;let n=null==(t=null==navigator?void 0:navigator.connection)?void 0:t.downlink,i=0;n>0&&n<1e6&&(i=n<1?60*n:n<5?(n-1)*.4+6.01:(n-5)*.02+7.61),e({score:i,origin:n})})}}},215153:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(117801);class r extends i.Z{constructor(e){super(e)}}},97399:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(722440),r=n(828151);class o extends r.Z{constructor(e){super(e)}}var a=new o(i.V.H264)},828151:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=Object.defineProperty,r=(e,t,n)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,o=(e,t,n)=>(r(e,"symbol"!=typeof t?t+"":t,n),n);class a{constructor(e){o(this,"_origin"),o(this,"_codec"),this._codec=e}_getOrigin(){try{let e=localStorage.getItem(`player_${this._codec}_fps`)||-1;return Number(e)}catch(e){return -1}}getScore(){return new Promise(e=>{let t=this._origin||this._getOrigin(),n=0;t>0&&t<=120&&(n=t<=30?.2*t:t<=60?(t-30)*.0533+6:(t-60)*.04+7.6),e({score:n,origin:t})})}}},422288:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(722440),r=n(828151);class o extends r.Z{constructor(e){super(e)}}var a=new o(i.V.H265)},381751:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n(117801),r=Object.defineProperty,o=(e,t,n)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,a=(e,t,n)=>(o(e,"symbol"!=typeof t?t+"":t,n),n);class s extends i.Z{constructor(){super(...arguments),a(this,"_player")}setPlayer(e,t){let n,i;if(!e)return;this._player=e;let r=()=>{if(!e.video||!e.video.getVideoPlaybackQuality){e.off("timeupdate",r);return}if(i){if(Date.now()-n>1e3)try{e.off("timeupdate",r);let n=e.video.getVideoPlaybackQuality();localStorage.setItem(`player_${t}_fps`,n.totalVideoFrames-i+"")}catch(e){}}else this.bufferLength>1&&(i=e.video.getVideoPlaybackQuality().totalVideoFrames,n=Date.now())};e.on("timeupdate",r)}get bufferLength(){let e=this._player.getBufferedRange();if(!this._player.video)return 0;let{currentTime:t}=this._player.video,n=e[1]-Math.max(e[0],t);return n=Math.max(0,n)}}},637e3:function(e,t,n){"use strict";function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}n.d(t,{f:function(){return i}})},88012:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n("777706"),r=n("546771"),o=n("931057"),a="play";class s extends r.ZP{constructor(){super(...arguments),this.config={}}static get pluginName(){return"VR"}static isVRSupported(){return i.Z.isVRSupported()}enable(){super.enable(),this.config.enable=!0}disable(){var e;super.disable(),(null==(e=this.config)?void 0:e.enable)&&(this.config.enable=!1)}reset(){this.destroy()}onEnableChanged(e){var t;!!this.vr!==e&&(e&&s.isVRSupported()?(this.afterCreate(),null==(t=this.vr)||t.play()):this.reset())}setConfig(e){if(!e)return;let t=this.config||{},n=e||{};this.config=n;["projectionType","three180","xr"].some(e=>t[e]!==n[e])&&(this.reset(),n.enable&&this.onEnableChanged(n.enable)),t.enable!==n.enable&&(n.enable?this.enable():this.disable(),this.onEnableChanged(!!n.enable))}setEnable(e){this.setConfig({...this.config,enable:e})}afterCreate(){var e;if(!!(null==(e=this.config)?void 0:e.enable))this._initVRLoader(),this.on(a,this._playEvent=()=>{var e;null==(e=this.vr)||e.play()})}addVideoStyle(){o.Z.addClass(this.player.video,"xgplayer-vr-active")}removeVideoStyle(){o.Z.removeClass(this.player.video,"xgplayer-vr-active")}_initVRLoader(){!this.vr&&(this.addVideoStyle(),this.vr=new i.Z({video:this.player.video,container:this.player.root,...this.config}),!this.player.paused&&this.vr.play(),this.vr.on("pointer",this._pointerEvent=()=>{this.vr&&this.player.focus()}),this.emit("vr-ready"))}_offEvents(){this.off(a,this._playEvent)}destroy(){this.removeVideoStyle(),this.vr&&(this.vr.off("pointer",this._pointerEvent),this.vr.destroy()),this._offEvents(),this.vr=null}set flipX(e){this.vr&&(this.vr.flipX=e)}get flipX(){var e;return null==(e=this.vr)?void 0:e.flipX}set fov(e){this.vr&&(this.vr.fov=e)}get fov(){var e;return null==(e=this.vr)?void 0:e.fov}set viewPosition(e){this.vr&&(this.vr.viewPosition=e)}get viewPosition(){var e;return null==(e=this.vr)?void 0:e.viewPosition}set projectionType(e){this.vr&&(this.vr.projectionType=e)}get projectionType(){return this.vr.projectionType}get motion(){return this.vr.motion}set motion(e){this.vr&&(this.vr.motion=e)}set dampingFactor(e){this.vr&&(this.vr.dampingFactor=e)}get dampingFactor(){var e;return null==(e=this.vr)?void 0:e.dampingFactor}set deceleration(e){this.vr&&(this.vr.deceleration=e)}get deceleration(){var e;return null==(e=this.vr)?void 0:e.deceleration}set factor(e){this.vr&&(this.vr.factor=e)}get factor(){var e;return null==(e=this.vr)?void 0:e.factor}set enablePreventDefault(e){this.vr&&this.vr._mouseHandler&&(this.vr._mouseHandler.enablePreventDefault=e)}get enablePreventDefault(){return this.vr&&this.vr._mouseHandler&&this.vr._mouseHandler.enablePreventDefault}set androidStillnessThreshold(e){this.vr.androidStillnessThreshold=e}get androidStillnessThreshold(){return this.vr.androidStillnessThreshold}set xr(e){this.vr.xr=e}get xr(){return this.vr&&this.vr.xr}}},846330:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});if("undefined"!=typeof Element&&!Element.prototype.matches){var i=Element.prototype;i.matches=i.matchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector||i.webkitMatchesSelector}var r=function(e,t){for(;e&&9!==e.nodeType;){if("function"==typeof e.matches&&e.matches(t))return e;e=e.parentNode}}},619603:function(e,t,n){"use strict";n.d(t,{Qs:function(){return l},ZP:function(){return u},v8:function(){return s},xn:function(){return a},z3:function(){return o}});var i=n(616275);function r(e,t,n){for(var i=arguments.length,r=Array(i>3?i-3:0),o=3;o<i;o++)r[o-3]=arguments[o];var a=t.call.apply(t,[e].concat(r));if(!!n&&"function"==typeof n)a&&a.then?a.then(function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];n.call.apply(n,[e].concat(i))}):n.call.apply(n,[e].concat(r))}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return!this.__hooks&&(this.__hooks={}),this.__hooks[e]||(this.__hooks[e]=null),(function(){var o=arguments,a=this;if(n.pre)try{(s=n.pre).call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,":pre error] >> ").concat(t.message),t}if(this.__hooks&&this.__hooks[e])try{var s,u,l=(u=this.__hooks[e]).call.apply(u,[this,this].concat(Array.prototype.slice.call(arguments)));l?l.then?l.then(function(e){!1!==e&&r.apply(void 0,[a,t,n.next].concat((0,i.u)(o)))}).catch(function(e){throw e}):r.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments))):void 0===l&&r.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}catch(t){throw t.message="[pluginName: ".concat(this.pluginName,":").concat(e,"] >> ").concat(t.message),t}else r.apply(void 0,[this,t,n.next].concat(Array.prototype.slice.call(arguments)))}).bind(this)}function a(e,t){var n=this.__hooks;return n?!!n.hasOwnProperty(e)&&(n&&(n[e]=t),!0):void 0}function s(e,t){var n=this.__hooks;if(!!n)delete n[e]}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map(function(t){e.__hooks[t]=null}),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map(function(t){if(e.__hooks[t])return t})}})}function l(e){e.__hooks=null}},837463:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i="undefined"!=typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,r={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},o="%c[xgplayer]",a={config:{debug:i?3:0},logInfo:function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.config.debug>=3&&(t=console).log.apply(t,[o,r.info,e].concat(i))},logWarn:function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),a=1;a<n;a++)i[a-1]=arguments[a];this.config.debug>=1&&(t=console).warn.apply(t,[o,r.warn,e].concat(i))},logError:function(e){if(!(this.config.debug<1)){for(var t,n=this.config.debug>=2?"trace":"error",i=arguments.length,a=Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(t=console)[n].apply(t,[o,r.error,e].concat(a))}}}},582839:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(616275),r=function(){function e(t){(0,i.PA)(this,e),this.bufferedList=t}return(0,i.qH)(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}()},385951:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i,r=n(567678),o=n(184505);var a=(i="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){(e=e||{}).instantiateWasm=function(e,t){(0,o.Z)(e).then(function(e){t({exports:e})})};var t,n,a,s,u,l,c,f,d,h,p,v,y,m=void 0!==e?e:{},g=Object.assign;m.ready=new Promise(function(e,t){n=e,a=t});var _=g({},m),b="./this.program",E="";E=self.location.href,i&&(E=i),E=0!==E.indexOf("blob:")?E.substr(0,E.replace(/[?#].*/,"").lastIndexOf("/")+1):"",s=function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)},m.print;var S=m.printErr||void 0;g(m,_),_=null,m.arguments&&m.arguments,m.thisProgram&&(b=m.thisProgram),m.quit&&m.quit,m.wasmBinary&&(u=m.wasmBinary),m.noExitRuntime,("undefined"==typeof WebAssembly?"undefined":(0,r.Ac)(WebAssembly))!=="object"&&I("no native wasm support detected");var w=!1,k="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function T(e,t){return e?function(e,t,n){for(var i=t+n,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&k)return k.decode(e.subarray(t,r));for(var o="";t<r;){var a=e[t++];if(!(128&a)){o+=String.fromCharCode(a);continue}var s=63&e[t++];if((224&a)==192){o+=String.fromCharCode((31&a)<<6|s);continue}var u=63&e[t++];if((a=(240&a)==224?(15&a)<<12|s<<6|u:(7&a)<<18|s<<12|u<<6|63&e[t++])<65536)o+=String.fromCharCode(a);else{var l=a-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}return o}(d,e,t):""}function C(e,t,n,i){if(!(i>0))return 0;for(var r=n,o=n+i-1,a=0;a<e.length;++a){var s=e.charCodeAt(a);if(s>=55296&&s<=57343&&(s=65536+((1023&s)<<10)|1023&e.charCodeAt(++a)),s<=127){if(n>=o)break;t[n++]=s}else if(s<=2047){if(n+1>=o)break;t[n++]=192|s>>6,t[n++]=128|63&s}else if(s<=65535){if(n+2>=o)break;t[n++]=224|s>>12,t[n++]=128|s>>6&63,t[n++]=128|63&s}else{if(n+3>=o)break;t[n++]=240|s>>18,t[n++]=128|s>>12&63,t[n++]=128|s>>6&63,t[n++]=128|63&s}}return t[n]=0,n-r}function O(e){for(var t=0,n=0;n<e.length;++n){var i=e.charCodeAt(n);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++n)),i<=127?++t:i<=2047?t+=2:i<=65535?t+=3:t+=4}return t}function A(e){c=e,m.HEAP8=f=new Int8Array(e),m.HEAP16=new Int16Array(e),m.HEAP32=h=new Int32Array(e),m.HEAPU8=d=new Uint8Array(e),m.HEAPU16=new Uint16Array(e),m.HEAPU32=new Uint32Array(e),m.HEAPF32=new Float32Array(e),m.HEAPF64=new Float64Array(e)}m.INITIAL_MEMORY;var R=[],P=[],D=[],x=0,L=null;function I(e){m.onAbort&&m.onAbort(e),S(e="Aborted("+e+")"),w=!0,e+=". Build with -s ASSERTIONS=1 for more info.";var t=new WebAssembly.RuntimeError(e);throw a(t),t}m.preloadedImages={},m.preloadedAudios={};function M(e){return e.startsWith("data:application/octet-stream;base64,")}if(!M(v="aw.wasm")){;t=v,v=m.locateFile?m.locateFile(t,E):E+t}function B(e){try{if(e==v&&u)return new Uint8Array(u);if(s)return s(e);throw"both async and sync fetching of the wasm failed"}catch(e){I(e)}}function U(e){for(;e.length>0;){var t=e.shift();if("function"==typeof t){t(m);continue}var n=t.func;"number"==typeof n?void 0===t.arg?(function(e){return p.get(e)})(n)():(function(e){return p.get(e)})(n)(t.arg):n(void 0===t.arg?null:t.arg)}}function N(e){return p.get(e)}function F(e){this.excPtr=e,this.ptr=e-16,this.set_type=function(e){h[this.ptr+4>>2]=e},this.get_type=function(){return h[this.ptr+4>>2]},this.set_destructor=function(e){h[this.ptr+8>>2]=e},this.get_destructor=function(){return h[this.ptr+8>>2]},this.set_refcount=function(e){h[this.ptr>>2]=e},this.set_caught=function(e){e=e?1:0,f[this.ptr+12>>0]=e},this.get_caught=function(){return 0!=f[this.ptr+12>>0]},this.set_rethrown=function(e){e=e?1:0,f[this.ptr+13>>0]=e},this.get_rethrown=function(){return 0!=f[this.ptr+13>>0]},this.init=function(e,t){this.set_type(e),this.set_destructor(t),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var e=h[this.ptr>>2];h[this.ptr>>2]=e+1},this.release_ref=function(){var e=h[this.ptr>>2];return h[this.ptr>>2]=e-1,1===e}}var V={};function j(){if(!j.strings){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(("undefined"==typeof navigator?"undefined":(0,r.Ac)(navigator))==="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:b||"./this.program"};for(var t in V)void 0===V[t]?delete e[t]:e[t]=V[t];var n=[];for(var t in e)n.push(t+"="+e[t]);j.strings=n}return j.strings}function H(e){return e%4==0&&(e%100!=0||e%400==0)}function Z(e,t){for(var n=0,i=0;i<=t;n+=e[i++]);return n}var G=[31,29,31,30,31,30,31,31,30,31,30,31],K=[31,28,31,30,31,30,31,31,30,31,30,31];function W(e,t){for(var n=new Date(e.getTime());t>0;){var i=H(n.getFullYear()),r=n.getMonth(),o=(i?G:K)[r];if(t>o-n.getDate())t-=o-n.getDate()+1,n.setDate(1),r<11?n.setMonth(r+1):(n.setMonth(0),n.setFullYear(n.getFullYear()+1));else{n.setDate(n.getDate()+t);break}}return n}function z(e,t,n){var i=Array(n>0?n:O(e)+1),r=C(e,i,0,i.length);return t&&(i.length=r),i}var Y={h:function(e){return X(e+16)+16},g:function(e,t,n){throw new F(e).init(t,n),e},a:function(){I("")},f:function(e,t,n){d.copyWithin(e,t,t+n)},e:function(e){var t=d.length;e>>>=0;if(e>2147483648)return!1;for(var n=1;n<=4;n*=2){var i,r,o=t*(1+.2/n);if(o=Math.min(o,e+100663296),function(e){try{return l.grow(e-c.byteLength+65535>>>16),A(l.buffer),1}catch(e){}}(Math.min(2147483648,(r=65536,(i=Math.max(e,o))%65536>0&&(i+=r-i%r),i))))return!0}return!1},c:function(e,t){var n=0;return j().forEach(function(i,r){var o=t+n;h[e+4*r>>2]=o,!function(e,t,n){for(var i=0;i<e.length;++i)f[t++>>0]=e.charCodeAt(i);f[t>>0]=0}(i,o),n+=i.length+1}),0},d:function(e,t){var n=j();h[e>>2]=n.length;var i=0;return n.forEach(function(e){i+=e.length+1}),h[t>>2]=i,0},b:function(e,t,n,i){return function(e,t,n,i){var r,o,a=h[i+40>>2],s={tm_sec:h[i>>2],tm_min:h[i+4>>2],tm_hour:h[i+8>>2],tm_mday:h[i+12>>2],tm_mon:h[i+16>>2],tm_year:h[i+20>>2],tm_wday:h[i+24>>2],tm_yday:h[i+28>>2],tm_isdst:h[i+32>>2],tm_gmtoff:h[i+36>>2],tm_zone:a?T(a):""},u=T(n),l={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var c in l)u=u.replace(RegExp(c,"g"),l[c]);var d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],p=["January","February","March","April","May","June","July","August","September","October","November","December"];function v(e,t,n){for(var i="number"==typeof e?e.toString():e||"";i.length<t;)i=n[0]+i;return i}function y(e,t){return v(e,t,"0")}function m(e,t){var n;function i(e){return e<0?-1:e>0?1:0}return 0===(n=i(e.getFullYear()-t.getFullYear()))&&0===(n=i(e.getMonth()-t.getMonth()))&&(n=i(e.getDate()-t.getDate())),n}function g(e){switch(e.getDay()){case 0:return new Date(e.getFullYear()-1,11,29);case 1:return e;case 2:return new Date(e.getFullYear(),0,3);case 3:return new Date(e.getFullYear(),0,2);case 4:return new Date(e.getFullYear(),0,1);case 5:return new Date(e.getFullYear()-1,11,31);case 6:return new Date(e.getFullYear()-1,11,30)}}function _(e){var t=W(new Date(e.tm_year+1900,0,1),e.tm_yday),n=new Date(t.getFullYear(),0,4),i=new Date(t.getFullYear()+1,0,4),r=g(n),o=g(i);return 0>=m(r,t)?0>=m(o,t)?t.getFullYear()+1:t.getFullYear():t.getFullYear()-1}var b={"%a":function(e){return d[e.tm_wday].substring(0,3)},"%A":function(e){return d[e.tm_wday]},"%b":function(e){return p[e.tm_mon].substring(0,3)},"%B":function(e){return p[e.tm_mon]},"%C":function(e){return y((e.tm_year+1900)/100|0,2)},"%d":function(e){return y(e.tm_mday,2)},"%e":function(e){return v(e.tm_mday,2," ")},"%g":function(e){return _(e).toString().substring(2)},"%G":function(e){return _(e)},"%H":function(e){return y(e.tm_hour,2)},"%I":function(e){var t=e.tm_hour;return 0==t?t=12:t>12&&(t-=12),y(t,2)},"%j":function(e){return y(e.tm_mday+Z(H(e.tm_year+1900)?G:K,e.tm_mon-1),3)},"%m":function(e){return y(e.tm_mon+1,2)},"%M":function(e){return y(e.tm_min,2)},"%n":function(){return"\n"},"%p":function(e){return e.tm_hour>=0&&e.tm_hour<12?"AM":"PM"},"%S":function(e){return y(e.tm_sec,2)},"%t":function(){return"	"},"%u":function(e){return e.tm_wday||7},"%U":function(e){var t=new Date(e.tm_year+1900,0,1),n=0===t.getDay()?t:W(t,7-t.getDay()),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>m(n,i)){var r=Z(H(i.getFullYear())?G:K,i.getMonth()-1)-31;return y(Math.ceil((31-n.getDate()+r+i.getDate())/7),2)}return 0===m(n,t)?"01":"00"},"%V":function(e){var t,n=new Date(e.tm_year+1900,0,4),i=new Date(e.tm_year+1901,0,4),r=g(n),o=g(i),a=W(new Date(e.tm_year+1900,0,1),e.tm_yday);return 0>m(a,r)?"53":0>=m(o,a)?"01":y(Math.ceil((t=r.getFullYear()<e.tm_year+1900?e.tm_yday+32-r.getDate():e.tm_yday+1-r.getDate())/7),2)},"%w":function(e){return e.tm_wday},"%W":function(e){var t=new Date(e.tm_year,0,1),n=1===t.getDay()?t:W(t,0===t.getDay()?1:7-t.getDay()+1),i=new Date(e.tm_year+1900,e.tm_mon,e.tm_mday);if(0>m(n,i)){var r=Z(H(i.getFullYear())?G:K,i.getMonth()-1)-31;return y(Math.ceil((31-n.getDate()+r+i.getDate())/7),2)}return 0===m(n,t)?"01":"00"},"%y":function(e){return(e.tm_year+1900).toString().substring(2)},"%Y":function(e){return e.tm_year+1900},"%z":function(e){var t=e.tm_gmtoff;return(t>=0?"+":"-")+String("0000"+(t=(t=Math.abs(t)/60)/60*100+t%60)).slice(-4)},"%Z":function(e){return e.tm_zone},"%%":function(){return"%"}};for(var c in b)u.includes(c)&&(u=u.replace(RegExp(c,"g"),b[c](s)));var E=z(u,!1);if(E.length>t)return 0;return r=E,o=e,f.set(r,o),E.length-1}(e,t,n,i)}};!function(){var e,t={a:Y};function n(e,t){var n,i=e.exports;m.asm=i,A((l=m.asm.i).buffer),p=m.asm.p,n=m.asm.j,P.unshift(n),!function(e){if(x--,m.monitorRunDependencies&&m.monitorRunDependencies(x),0==x&&L){var t=L;L=null,t()}}()}function i(e){n(e.instance)}function r(e){return(u||"function"!=typeof fetch?Promise.resolve().then(function(){return B(v)}):fetch(v,{credentials:"same-origin"}).then(function(e){if(!e.ok)throw"failed to load wasm binary file at '"+v+"'";return e.arrayBuffer()}).catch(function(){return B(v)})).then(function(e){return WebAssembly.instantiate(e,t)}).then(function(e){return e}).then(e,function(e){S("failed to asynchronously prepare wasm: "+e),I(e)})}x++,m.monitorRunDependencies&&m.monitorRunDependencies(x);if(m.instantiateWasm)try{return m.instantiateWasm(t,n)}catch(e){return S("Module.instantiateWasm callback failed with error: "+e),!1}(u||"function"!=typeof WebAssembly.instantiateStreaming||M(v)||"function"!=typeof fetch?r(i):fetch(v,{credentials:"same-origin"}).then(function(e){return WebAssembly.instantiateStreaming(e,t).then(i,function(e){return S("wasm streaming compile failed: "+e),S("falling back to ArrayBuffer instantiation"),r(i)})})).catch(a)}(),m.___wasm_call_ctors=function(){return(m.___wasm_call_ctors=m.asm.j).apply(null,arguments)};var X=m._malloc=function(){return(X=m._malloc=m.asm.k).apply(null,arguments)};function q(e){if(x>0)return;if(!function(){if(m.preRun)for("function"==typeof m.preRun&&(m.preRun=[m.preRun]);m.preRun.length;)(function(e){R.unshift(e)})(m.preRun.shift());U(R)}(),!(x>0))m.setStatus?(m.setStatus("Running..."),setTimeout(function(){setTimeout(function(){m.setStatus("")},1),t()},1)):t();function t(){if(!y)y=!0,m.calledRun=!0,!w&&(U(P),n(m),m.onRuntimeInitialized&&m.onRuntimeInitialized(),!function(){if(m.postRun)for("function"==typeof m.postRun&&(m.postRun=[m.postRun]);m.postRun.length;)(function(e){D.unshift(e)})(m.postRun.shift());U(D)}())}}if(m._free=function(){return(m._free=m.asm.l).apply(null,arguments)},m._descryptKdsKey=function(){return(m._descryptKdsKey=m.asm.m).apply(null,arguments)},m._descryptKey=function(){return(m._descryptKey=m.asm.n).apply(null,arguments)},m._descryptCBC=function(){return(m._descryptCBC=m.asm.o).apply(null,arguments)},m.intArrayFromString=z,m.UTF8ToString=T,m.allocateUTF8=function(e){var t=O(e)+1,n=X(t);return n&&C(e,f,n,t),n},L=function e(){!y&&q(),!y&&(L=e)},m.run=q,m.preInit)for("function"==typeof m.preInit&&(m.preInit=[m.preInit]);m.preInit.length>0;)m.preInit.pop()();return q(),e.ready})},283191:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var i=n("567678"),r=n("878328"),o=n("53985"),a=n("529546"),s=n("583135"),u=n("458616"),l=n("479593"),c=n("701175"),f=n("519075"),d=n("381774"),h=n("593489"),p=n("569550");function v(e){for(var t=e.byteLength,n=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(!n.length)return e;var r=t-n.length,o=new Uint8Array(r),a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),o[i]=e[a];return o}var y=function(){function e(){(0,i.PA)(this,e)}return(0,i.qH)(e,null,[{key:"parseHEVCDecoderConfigurationRecord",value:function(t){var n,i,r,o,a,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(t.length<23)){s=s||{};for(var u=(3&t[21])+1,l=[],c=[],f=[],d=23,h=t[22],p=0;p<h;p++){r=63&t[d],o=t[d+1]<<8|t[d+2],d+=3;for(var y=0;y<o;y++)if(a=t[d]<<8|t[d+1],d+=2,a){switch(r){case 32:var m=t.subarray(d,d+a);!n&&(n=e.parseVPS(v(m),s)),f.push(m);break;case 33:var g=t.subarray(d,d+a);!i&&(i=e.parseSPS(v(g),s)),l.push(g);break;case 34:c.push(t.subarray(d,d+a))}d+=a}}return{hvcC:s,sps:i,spsArr:l,ppsArr:c,vpsArr:f,nalUnitSize:u}}}},{key:"parseVPS",value:function(t,n){n=n||{};var i=new p.Z(t);i.readUByte(),i.readUByte(),i.readBits(12);var r=i.readBits(3);return n.numTemporalLayers=Math.max(n.numTemporalLayers||0,r+1),i.readBits(17),e._parseProfileTierLevel(i,r,n),n}},{key:"parseSPS",value:function(t){var n,i,r,o,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a=a||{};var s=new p.Z(t);s.readUByte(),s.readUByte(),s.readBits(4);var u=s.readBits(3);a.numTemporalLayers=Math.max(u+1,a.numTemporalLayers||0),a.temporalIdNested=s.readBits(1),e._parseProfileTierLevel(s,u,a),s.readUEG();var l=a.chromaFormatIdc=s.readUEG(),c=420;l<=3&&(c=[0,420,422,444][l]);var f=0;3===l&&(f=s.readBits(1));var d=s.readUEG(),h=s.readUEG(),v=s.readBits(1);if(1===v&&(n=s.readUEG(),i=s.readUEG(),r=s.readUEG(),o=s.readUEG()),a.bitDepthLumaMinus8=s.readUEG(),a.bitDepthChromaMinus8=s.readUEG(),1===v){var y=(1===l||2===l)&&0===f?2:1,m=1===l&&0===f?2:1;d-=y*(i+n),h-=m*(o+r)}return{codec:"hev1.1.6.L93.B0",width:d,height:h,chromaFormat:c,hvcC:a}}},{key:"_parseProfileTierLevel",value:function(e,t,n){var i=n.generalTierFlag||0;n.generalProfileSpace=e.readBits(2),n.generalTierFlag=Math.max(e.readBits(1),i),n.generalProfileIdc=Math.max(e.readBits(5),n.generalProfileIdc||0),n.generalProfileCompatibilityFlags=e.readBits(32),n.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var r=e.readBits(8);i<n.generalTierFlag?n.generalLevelIdc=r:n.generalLevelIdc=Math.max(r,n.generalLevelIdc||0);for(var o=[],a=[],s=0;s<t;s++)o[s]=e.readBits(1),a[s]=e.readBits(1);t>0&&e.readBits((8-t)*2);for(var u=0;u<t;u++)0!==o[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==a[u]&&e.readBits(8)}}]),e}(),m=n("827095");function g(e){var t=[],n=e.length;if(n<=48)return e;for(var i=0;i<n-4;)0===e[i]&&0===e[i+1]&&3===e[i+2]&&e[i+3]<=3?(t.push(i+2),i+=3):i+=1;if(t.length){var r=new Uint8Array(n-t.length),o=0;return t.map(function(i,a){var s=t[a-1]||-1,u=e.slice(s+1,i);r.set(u,o),o+=u.length,a===t.length-1&&i+1<n&&r.set(e.slice(i+1),o)}),r}return e}var _=u.Z,b=l.Z,E=c.Z,S=f.Z,w=[19,20,21],k=[5],T={AVC:7,HEVC:12,VVC:14},C=function(e){(0,i.XW)(n,e);var t=(0,i.WY)(n);function n(e){var r;return(0,i.PA)(this,n),(r=t.call(this))._headerParsed=!1,r._gopId=0,r._videoRecentMetadata=null,r._onMetaData=null,r._audioMetaParsed=!1,r._vSeqHeaderIndex=0,r._userAgent="undefined"==typeof window?"":window.navigator.userAgent.toLowerCase()||"",r.awManager=e,r.getSourceBody=g,r}return(0,i.qH)(n,[{key:"foundAudioMetaFromScriptTag",get:function(){var e,t;return(null===(e=this._onMetaData)||void 0===e?void 0:e.audiosamplerate)&&(null===(t=this._onMetaData)||void 0===t?void 0:t.audiochannels)}},{key:"demux",value:function(e){if(this._headerParsed){if(!(e.length<11)){var t,n=1e4;do t=this._parseFlvTag(e);while(t&&n-- >0)}}else{if(e.length<13)return;var i=e.shift(13);this.parseFlvHeader(i),this.demux(e)}}},{key:"parseFlvHeader",value:function(e){if(n.isFlvFile(e)){this._headerParsed=!0;var t=e[4]>>>2==1,i=(1&e[4])==1;this.emit(n.EVENTS.FILE_HEADER_PARSED,{hasVideo:i,hasAudio:t})}else throw Error("invalid flv file,".concat(e.join(",")))}},{key:"_parseFlvTag",value:function(e){var t=e.toInt(1,3);if(e.length<11+t+4)return null;var n=this._parseFlvTagHeader(e);if(n&&(this._processTagData(n,e),!this._datasizeValidator(n.datasize,e)))throw Error("TAG length error at "+n.datasize);return n}},{key:"_parseFlvTagHeader",value:function(e){var t=0,n=new r.Z,i=e.toInt(t,1);if(t+=1,n.filtered=(32&i)>>>5,n.tagType=31&i,n.datasize=e.toInt(t,3),t+=3,8!==n.tagType&&9!==n.tagType&&11!==n.tagType&&18!==n.tagType)throw e&&e.length>0&&e.shift(1),Error("tagType "+n.tagType);if(e.length<n.datasize+15)return null;e.shift(4);var o=e.toInt(0,3);e.shift(3);var a=e.shift(1)[0];return a>0&&(o+=16777216*a),n.dts=o,e.shift(3),n}},{key:"_processTagData",value:function(e,t){switch(e.tagType){case 18:this._parseScriptData(e,t);break;case 8:this._parseAudioTag(e,t);break;case 9:this._parseVideoData(e,t);break;case 11:t.shift(3);break;default:t.shift(1)}}},{key:"_parseScriptData",value:function(e,t){e.data=t.shift(e.datasize);var i=new d.Z().resolve(e.data,e.data.length);if(this._onMetaData=i?i.onMetaData:void 0,this._onMetaData.encrypt_method){if("SAMPLE-AES"!==this._onMetaData.encrypt_method)throw Error("invalid encrypt method: ".concat(this._onMetaData.encrypt_method))}else this.descrypt=function(e){return e},this.descryptVideo=function(e){return e},this.getSourceBody=function(e){return e};this.emit(n.EVENTS.SCRIPT_TAG_PARSED,this._onMetaData)}},{key:"_aacSequenceHeaderParser",value:function(e){var t,n,i={};i.hasSpecificConfig=!0,i.objectType=e[1]>>>3,i.originObjectType=i.objectType,i.sampleRateIndex=(7&e[1])<<1|e[2]>>>7,i.audiosamplerate=this._switchAudioSampleRate(i.sampleRateIndex),i.channelCount=(120&e[2])>>>3,i.frameLength=(4&e[2])>>>2,i.dependsOnCoreCoder=(2&e[2])>>>1,i.extensionFlagIndex=1&e[2];var r=i.sampleRateIndex;return this._userAgent&&-1!==this._userAgent.indexOf("firefox")?i.sampleRateIndex>=8?(i.objectType=5,n=[,,,,],t=r-3):(i.objectType=2,n=[,,],t=r):this._userAgent&&-1!==this._userAgent.indexOf("android")||this._userAgent&&-1!==this._userAgent.indexOf("iphone")?(i.objectType=2,n=[,,],t=r):(i.objectType=5,t=i.sampleRateIndex,n=[,,,,],i.sampleRateIndex>=6?t=i.sampleRateIndex-3:1===i.channelCount&&(i.objectType=2,n=[,,],t=i.sampleRateIndex)),i.codec="mp4a.40.".concat(i.objectType),n[0]=i.objectType<<3,n[0]|=(15&i.sampleRateIndex)>>>1,n[1]=(15&i.sampleRateIndex)<<7,n[1]|=(15&i.channelCount)<<3,5===i.objectType&&(n[1]|=(15&t)>>>1,n[2]=(1&t)<<7,n[2]|=8,n[3]=0),i.config=n,i}},{key:"_parseAudioTag",value:function(e,t){var i=new o.h,r=t.shift(1)[0];e.data=t.shift(e.datasize-1);var a=(240&r)>>>4;if(10!==a)throw Error("invalid audio format: ".concat(a));10===a&&(i.sampleRate=this._switchAudioSamplingFrequency(r),i.sampleRateIndex=(12&r)>>>2,i.frameLenth=(2&r)>>>1,i.channelCount=1&r,i.refSampleDuration=Math.floor(1024/i.audioSampleRate*i.timescale));var s=i.audioSampleRate,u=i.sampleRateIndex,l=i.refSampleDuration;if(0===e.data[0]){var c=this._aacSequenceHeaderParser(e.data);s=c.audiosamplerate||i.audioSampleRate,u=c.sampleRateIndex||i.sampleRateIndex,l=Math.floor(1024/s*i.timescale),i.channelCount=c.channelCount,i.sampleRate=s,i.sampleRateIndex=u,i.refSampleDuration=l,i.duration=this._onMetaData?this._onMetaData.duration*i.timescale:0,i.config=c.config,i.objectType=c.objectType,i.originObjectType=c.originObjectType,this.emit(n.EVENTS.AUDIO_META_PARSED,i),this._audioMetaParsed=!0}else{if(!this._audioMetaParsed&&!this.foundAudioMetaFromScriptTag)throw Error("flv stream without audio metadata detected");e.data=e.data.slice(1,e.data.length),e.data=this.descrypt(e.data),this.emit(n.EVENTS.AUDIO_SAMPLE_PARSED,e)}}},{key:"_parseVideoData",value:function(e,t){var i=t.shift(1)[0],r=new a._(e);r.isKeyframe=1==(240&i)>>>4;var o=15&i;if(e.avcPacketType=t.shift(1)[0],r.cts=t.toInt(0,3),r.cts=r.cts<<8>>8,t.shift(3),o===T.AVC||o===T.HEVC||o===T.VVC){var u=o===T.HEVC,l=o===T.VVC,c=t.shift(e.datasize-5);if(0===c[4]&&0===c[5]&&0===c[6]&&1===c[7]){for(var f=0,d=0;d<4;d++)f=256*f+c[d];f-=4,(c=c.slice(4,c.length))[3]=f%256,f=(f-c[3])/256,c[2]=f%256,f=(f-c[2])/256,c[1]=f%256,c[0]=(f-c[1])/256}if(!c.length)return;if(r.data=c,0===e.avcPacketType)(P=u?this._hevcSequenceHeaderParser(c):l?this._vvcSequenceHeaderParser(c):this._avcSequenceHeaderParser(c)).codecID=o,this._videoRecentMetadata=P,this._vSeqHeaderIndex++,this.emit(n.EVENTS.VIDEO_META_PARSED,P);else{for(var h=new s.Z(c.buffer),p=l?m.Z.getAvccNals(h):u?S.getHvccNals(h):b.getAvccNals(h),v=u?w:k,y=!1,g=0,_=[],E=0;E<p.length;E++){var C=p[E];l?m.Z.analyseNal(C):u?S.analyseNal(C):b.analyseNal(C);var O=u?C.body[0]>>>1&63:31&C.body[0];(u&&[0,1,2,3,4,5,6,7,8,9,16,17,18,19,20,21].includes(O)||!u&&[1,5].includes(O))&&(C.body=this.getSourceBody(C.body),C.body=this.descryptVideo(C.body)),C.sps&&(y=!0),C.sei&&this.emit(n.EVENTS.VIDEO_SEI_PARSED,Object.assign(C.sei,{dts:e.dts})),v&&v.indexOf(C.type)>-1&&(r.firstInGop=!0,this._gopId++);var A=C.body.length;C.header=new Uint8Array([A>>24,A>>16,A>>8,A]),_.push(C.header),_.push(C.body),g+=A+4}r.data=new Uint8Array(g);var R=0;if(_.forEach(function(e){r.data.set(e,R),R+=e.length}),this._vSeqHeaderIndex>1&&this._videoRecentMetadata&&r.firstInGop&&!y){var P,D,x,L,I=this._videoRecentMetadata.hvcCConfigParsed;I?(D=I.vpsArr[I.vpsArr.length-1],x=I.spsArr[I.spsArr.length-1],L=I.ppsArr[I.ppsArr.length-1]):(D=this._videoRecentMetadata.vps,x=this._videoRecentMetadata.sps,L=this._videoRecentMetadata.pps);var M=[D?[0,0,D.length>>8,D.length%256]:0,D,[0,0,x.length>>8,x.length%256],x,[0,0,L.length>>8,L.length%256],L,r.data].filter(Boolean),B=new Uint8Array(M.reduce(function(e,t){return e+t.length},0)),U=0;M.forEach(function(e){B.set(e,U),U+=e.length}),this._videoRecentMetadata=null,r.data=B}r.gopId=this._gopId,r.nals=p,this.emit(n.EVENTS.VIDEO_SAMPLE_PARSED,r)}}else throw Error("video codeid is ".concat(o))}},{key:"descrypt",value:function(e){if(e.length<32)return e;var t=e.slice(16),n=t.length%16,i=t.length-n,r=this.awManager.descrypt(t.slice(0,i),new Uint8Array(16)),o=new Uint8Array(r.length+n+16);return o.set(e.slice(0,16),0),o.set(r,16),o.set(e.slice(i+16),r.length+16),o}},{key:"descryptVideo",value:function(e){if(e.length<48)return e;var t=e.slice(32),n=t.length%16;0===n&&(n=16);var i=t.length-n,r=new Uint8Array(e.length);r.set(e.slice(0,32),0);for(var o=new Uint8Array(16),a=0;a<i;a+=160){var s=t.slice(a,a+16),u=this.awManager.descrypt(s,o);r.set(u,a+32),r.set(t.slice(a+16,a+160),a+48),o=s}return r.set(e.slice(i+32),i+32),r}},{key:"_avcSequenceHeaderParser",value:function(e){var t,n=0,i=new o.l;i.configurationVersion=e[0],i.avcProfileIndication=e[1],i.profileCompatibility=e[2],i.avcLevelIndication=e[3]/10,i.nalUnitLength=(3&e[4])+1;var r=31&e[5];n=6;for(var a={},s=0;s<r;s++){var u=255*e[n]+e[n+1];n+=2;for(var l=new Uint8Array(u),c=0;c<u;c++)l[c]=e[n+c];for(var f="avc1.",d=1;d<4;d++){var h=l[d].toString(16);h.length<2&&(h="0"+h),f+=h}i.codec=f,n+=u,i.sps=l,a=_.parseSPS(l)}var p=e[n];n++;for(var v=0;v<p;v++){var y=255*e[n]+e[n+1];n+=2;for(var m=new Uint8Array(y),g=0;g<y;g++)m[g]=e[n+g];n+=y,i.pps=m}return Object.assign(i,_.toVideoMeta(a)),i.duration=(null===(t=this._onMetaData)||void 0===t?void 0:t.duration)*i.timescale,i.avcc=new Uint8Array(e.length),i.avcc.set(e),i.streamType=27,i}},{key:"_hevcSequenceHeaderParser",value:function(e){var t,n,i,r,a=new o.l;try{t=y.parseHEVCDecoderConfigurationRecord(e)}catch(e){}var s=0;a.hvcCConfigParsed=t,a.configurationVersion=e[0],a.hevcProfileSpace=(192&e[1])>>>6,a.hevcTierFlag=(32&e[1])>>>5,a.hevcProfileIdc=31&e[1],a.hevcProfileCompatibilityFlags=[e[2],e[3],e[4],e[5]],a.hevcConstraintIndicatorFlags=[e[6],e[7],e[8],e[9],e[10],e[11]],a.hevcLevelIdc=e[12],a.minSpatialSegmentationIdc=e[13]&15+e[14]<<4,a.parallelismType=3&e[15],a.chromaFormat=3&e[16],a.bitDepthLumaMinus8=7&e[17],a.bitDepthChromaMinus8=7&e[18],a.avgFrameRate=256*e[19]+e[20],a.constantFrameRate=(192&e[21])>>>6,a.numTemporalLayers=(56&e[21])>>>3,a.temporalIdNested=(4&e[21])>>>2,a.lengthSizeMinusOne=3&e[21];var u=e[22];s=23;for(var l={},c=0,f=0,d=0,h=!1,p=!1,v=!1,m=0;m<u;m++){c=63&e[s],f=256*e[s+1]+e[s+2],s+=3;for(var g=0;g<f;g++){switch(d=256*e[s]+e[s+1],c){case 32:!h&&(h=!0,n=e.slice(s+2,s+2+d),a.vps=E._ebsp2rbsp(n),a.rawVps=n);break;case 33:!p&&(p=!0,i=e.slice(s+2,s+2+d),a.sps=E._ebsp2rbsp(i),a.rawSps=i,a.codec="hev1.1.6.L93.B0",l=E.parseSPS(i));break;case 34:!v&&(v=!0,r=e.slice(s+2,s+2+d),a.pps=E._ebsp2rbsp(r),a.rawPps=r)}s+=2+d}}return Object.assign(a,E.toVideoMeta(l)),a.streamType=36,a}},{key:"_vvcSequenceHeaderParser",value:function(e){var t,n,i=m.Z.parseVVCDecoderConfigurationRecord(e),r=new o.l;return r.presentHeight=r.codecHeight=(null===(t=i.spsParsed)||void 0===t?void 0:t.height)||i.maxPictureHeight,r.presentWidth=r.codecWidth=(null===(n=i.spsParsed)||void 0===n?void 0:n.width)||i.maxPictrueWidth,r.sps=i.spsArr,r.pps=i.ppsArr,r.vps=i.vpsArr,r.codec="vvc1.1.6.L93.B0",r.vvcC=i.vvcC,r.vvcCConfigParsed=i,r}},{key:"_switchAudioSampleRate",value:function(e){return[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350][e]}},{key:"_switchAudioSamplingFrequency",value:function(e){return[5500,11025,22050,44100,48e3][(12&e)>>>2]}},{key:"_switchAudioChannel",value:function(e){return[1,2][1&e]}},{key:"_datasizeValidator",value:function(e,t){var n=t.toInt(0,4);return t.shift(4),n===e+11}},{key:"destroy",value:function(){(0,i.U2)((0,i.IP)(n.prototype),"removeAllListeners",this).call(this)}}],[{key:"EVENTS",get:function(){return{FILE_HEADER_PARSED:"FILE_HEADER_PARSED",SCRIPT_TAG_PARSED:"SCRIPT_TAG_PARSED",AUDIO_META_PARSED:"AUDIO_META_PARSED",VIDEO_META_PARSED:"VIDEO_META_PARSED",VIDEO_SAMPLE_PARSED:"VIDEO_SAMPLE_PARSED",AUDIO_SAMPLE_PARSED:"AUDIO_SAMPLE_PARSED",VIDEO_SEI_PARSED:"VIDEO_SEI_PARSED"}}},{key:"isFlvFile",value:function(e){return!(70!==e[0]||76!==e[1]||86!==e[2]||1!==e[3])}},{key:"getPlayType",value:function(e){var t={hasVideo:!1,hasAudio:!1};return!0&e&&(t.hasVideo=!0),!0&e&&(t.hasAudio=!0),t}}]),n}(h.Z)},398920:function(e,t,n){"use strict";n.d(t,{$w:function(){return i},Ac:function(){return v},PA:function(){return r},XW:function(){return l},Zj:function(){return d},_x:function(){return s},qH:function(){return a}});function i(e,t,n){return t=u(t),function(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,c()?Reflect.construct(t,n||[],u(e).constructor):t.apply(e,n))}function r(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function a(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&h(e,t)}function c(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(c=function(){return!!e})()}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function h(e,t){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function p(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}function v(e){return(v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}},468509:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(398920),r=n(734123),o=n(610126),a=n(106845),s={open:!0,debug:!1,method:7,start_limit:4e3,up_thresh:2.5,down_thresh:1.2,down_living:5e3,up_living:5e3,up_bandwidth:1e3,speedKey:"live-abr-downloadspeed"},u=function(e){function t(e){var n;return(0,i.PA)(this,t),(n=(0,i.$w)(this,t,[e])).bindCtx(),n.updateConfig(n.config),n.initBitrate(),n.hasFrameChase=!1,n.isStalling=!1,n.stallStartTime=0,n}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"bitrates",get:function(){return this.algo&&this.algo.bitrates},set:function(e){this.algo&&(this.algo.bitrates=e)}},{key:"bitrate",get:function(){return this.algo&&this.algo.bitrate},set:function(e){this.algo&&(this.algo.bitrate=e),this.config.bitrate=e}},{key:"open",get:function(){return this._open}},{key:"initBitrate",value:function(){!this.algo&&(this.algo=new o.Z(this.player,this.config,Date.now()),this.algo.initModule())}},{key:"switchAbr",value:function(e){if(e!==this._open){if(e)this.setAbr();else{var t,n;null===(t=(n=this.player).switchCancel)||void 0===t||t.call(n),this.delAbr()}}}},{key:"setAbr",value:function(){!this._open&&(this.changeTime=Date.now(),this.player.on("isKeyframe",this._checkStatus),this.player.on("urlchange",this._handleUrlChange),this.player.on("waiting",this._recordStalling),this.player.on("pause",this._resetStalling),this.player.on("playing",this._checkStalling),this.player.on("timeupdate",this._checkStalling),this.player.on("chaseframe",this._recordFrameTrace),this._open=!0,this.hasFrameChase=!1,this.isStalling=!1,this.stallStartTime=0)}},{key:"delAbr",value:function(){this.player.off("isKeyframe",this._checkStatus),this.player.off("urlchange",this._handleUrlChange),this.player.off("waiting",this._recordStalling),this.player.off("pause",this._resetStalling),this.player.off("playing",this._checkStalling),this.player.off("timeupdate",this._checkStalling),this.player.off("chaseframe",this._recordFrameTrace),this._open=!1,this.stallStartTime=0}},{key:"storeSpeed",value:function(e){try{if(!this.config.speedKey)return;localStorage.setItem(this.config.speedKey,e)}catch(e){}}},{key:"getSpeed",value:function(){try{return localStorage.getItem(this.config.speedKey)||0}catch(e){return 0}}},{key:"updateConfig",value:function(e){this.config=Object.assign({},s,this.config,e),!this.config.bitrate||this.config.urls,e.urls&&(this.config.bitrates=Object.keys(this.config.urls).map(function(e){return Number(e)}).sort(function(e,t){return e-t})),this.switchAbr(this.config.open),this.waitings=[],this.algo&&this.algo.inited&&(this.algo.initParamers(this.player,Object.assign({},this.config,{bitrate:e.bitrate||this.algo.bitrate})),this.algo.parseMPD())}},{key:"bindCtx",value:function(){this._checkStatus=this._checkStatus.bind(this),this._initAbr=this._initAbr.bind(this),this._checkStalling=this._checkStalling.bind(this),this._recordStalling=this._recordStalling.bind(this),this._recordFrameTrace=this._recordFrameTrace.bind(this),this._handleUrlChange=this._handleUrlChange.bind(this)}},{key:"_handleUrlChange",value:function(){this.algo=null,this.firstFrameViewed=!1,this.player&&(this.player.once("loadeddata",this._initAbr),this.player.once("canplay",this._initAbr))}},{key:"_initAbr",value:function(){!this.firstFrameViewed&&(this.firstFrameViewed=!0,this.algo=new o.Z(this.player,this.config,Date.now()),this.algo.initModule())}},{key:"_recordFrameTrace",value:function(){this.hasFrameChase=!0}},{key:"_recordStalling",value:function(){this.isStalling=!0,this.stallStartTime=this.player.currentTime}},{key:"_checkStalling",value:function(){!(this.player.currentTime-this.stallStartTime<.2)&&this._resetStalling()}},{key:"_resetStalling",value:function(){this.isStalling=!1}},{key:"_checkStatus",value:function(e){if(!(this.player&&this.player.video)||Date.now()-this.changeTime<this.config.start_limit)return;var t=a.Z.get(this,"player.plugins.flvlive.flv");if(!t||t._inSwitching)return;var n=t._context;if(!!n){var i=n.getInstance("FETCH_LOADER");if(this.algo&&i){var r=i.currentSpeed;this.storeSpeed(r);var o=this.isStalling,s=this.hasFrameChase,u=this.algo.getPredictedBitrate(r,o,s);if(this.hasFrameChase=!1,u){if(!this._open)return;var l=this.config.urls[u];if(!l)return;var c="".concat(l).concat(l.indexOf("?")>0?"&":"?","abr_pts=").concat(e);this.switchURL(c,u)}}}}},{key:"switchURL",value:function(e,t){var n=this;a.Z.get(this.player,"plugins.flvlive"),t&&(this.player.once("switch_completed",function(){n.changeTime=Date.now(),n.player.config.url===e&&(n.bitrate=t,n.config.bitrate=t)}),this.player.switchURL(e,!0))}},{key:"destroy",value:function(){this.delAbr()}}],[{key:"pluginName",get:function(){return"abr"}},{key:"initAbrModule",value:function(){return new Promise(function(e,n){try{var i=new o.Z({},{},Date.now());i.initModule({onRuntimeInitialized:function(){i.inited=!0,t.algo=i,e()}})}catch(e){n(e)}})}}])}(r.BasePlugin)},926418:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(398920),r=function(e){function t(e){var n;return(0,i.PA)(this,t),n=(0,i.$w)(this,t,[e]),(0,i._x)(n,"reset",function(){n.stallList=[],n.bufferList=[],n.mLastHurryBufferPts=0,n.mLastHurryPlayPts=0,n.hurryStartTime=0,n.normalStartTime=0}),(0,i._x)(n,"onTimeUpdate",function(){var e=n.bufferLength;n.speed===n.config.hurrySpeed?e<=n.config.hurryEndMs&&(n.speed=1):1===n.speed&&e>=n.config.hurryStartMs&&(n.speed=n.config.hurrySpeed)}),(0,i._x)(n,"onTimeUpdateNet",function(){var e=n.bufferLength;n.bufferList.length>=60&&n.bufferList.shift(),n.bufferList.push(e/1e3);var t=Date.now();n.speed===n.config.hurrySpeed?n.isBigJitter?(n.speed=1,n.normalStartTime=t):e<n.config.hurryEndMs+500&&t-n.hurryStartTime>=1e3&&(n.isBufferLack||e<n.config.hurryEndMs)&&(n.speed=1,n.normalStartTime=t):1===n.speed&&(n.isGoodNet(e)?(n.speed=n.config.hurrySpeed,n.cacheHurryPts()):e>=n.config.hurryStartMs&&n.isLittleJitter&&t-n.normalStartTime>=1e3&&(n.speed=n.config.hurrySpeed,n.cacheHurryPts()))}),(0,i._x)(n,"onWaiting",function(){var e=n.stallList[n.stallList.length-1],t=Date.now();t-(e||0)>=500&&n.stallList.push(t)}),n.minDelta=Math.max(n.config.hurryStartMs,n.config.hurrySpeed*n.config.hurryEndMs),n.reset(),n}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"afterCreate",value:function(){this.config.useNetCondition?this.on("timeupdate",this.onTimeUpdateNet):this.on("timeupdate",this.onTimeUpdate),this.on("waiting",this.onWaiting),this.on("urlchange",this.reset)}},{key:"cacheHurryPts",value:function(){this.hurryStartTime=Date.now(),this.mLastHurryBufferPts=this.tmpBufferPts,this.mLastHurryPlayPts=1e3*this.player.currentTime}},{key:"isGoodNet",value:function(e){e>this.minDelta&&0===this.stallCount&&(this.variance,this.config.varianceGood)}},{key:"isBufferLack",get:function(){return this.tmpBufferPts-this.mLastHurryBufferPts<(1e3*this.player.currentTime-this.mLastHurryPlayPts)/this.speed}},{key:"isLittleJitter",get:function(){return 0===this.stallCount&&this.variance<this.config.varianceLittle}},{key:"isBigJitter",get:function(){return this.stallCount>0||this.variance>this.config.varianceBig}},{key:"bufferLength",get:function(){var e=this.player.getBufferedRange(),t=this.player.video.currentTime;this.tmpBufferPts=1e3*e[1];var n=e[1]-Math.max(e[0],t);return n=Math.round(1e3*Math.max(0,n))}},{key:"stallCount",get:function(){var e=this,t=Date.now();return this.stallList=this.stallList.filter(function(n){return t-n<=e.config.stallDiff}),this.stallList.length}},{key:"variance",get:function(){var e=0;this.bufferList.forEach(function(t){e+=t});var t=this.bufferList.length,n=e/t;return e=0,this.bufferList.forEach(function(t){e+=Math.pow(t-n,2)}),Math.sqrt(e/t)}},{key:"speed",get:function(){return this.player.playbackRate},set:function(e){this.speed!==e&&(this.player.playbackRate=e)}}],[{key:"pluginName",get:function(){return"adaptive"}},{key:"defaultConfig",get:function(){return{hurryEndMs:1800,hurryStartMs:2500,hurrySpeed:1.1,useNetCondition:!1,stallDiff:5e3,varianceBig:.7,varianceLittle:.4,varianceGood:.6}}}])}(n(734123).BasePlugin)},780553:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(398920),r=function(e){function t(){var e;(0,i.PA)(this,t);for(var n=arguments.length,r=Array(n),o=0;o<n;o++)r[o]=arguments[o];return e=(0,i.$w)(this,t,[].concat(r)),(0,i._x)(e,"updateUrl",function(t){e.config.url=t}),(0,i._x)(e,"handleVisibilitychange",function(){if(clearTimeout(e.switchTimer),e.player.off("isKeyframe",e.switchUrl),!!e.player&&!!e.player.video)"visible"===document.visibilityState?(e.hidden=!1,e.player.paused&&e.preUrl&&(e.player.config.url=e.preUrl)):e.hidden=!0,!e.player.paused&&(e.hidden?e.switchTimer=setTimeout(function(){e.player.once("isKeyframe",e.switchUrl)},e.config.delayTime||0):e.player.once("isKeyframe",e.switchUrl))}),(0,i._x)(e,"switchUrl",function(t){if(!e.isPip&&e.player){var n,i,r,o=(null===(n=e.player.plugins.flvlive)||void 0===n||null===(n=n.loader)||void 0===n?void 0:n.finnalUrl)||e.player.config.url;if(e.hidden?(0>o.indexOf("_md")&&(e.preUrl=o),r="".concat(e.config.url).concat(e.config.url.indexOf("?")>0?"&":"?","abr_pts=").concat(t,"&bg_play=1")):e.preUrl&&(r=e.preUrl.indexOf("abr_pts")>0?e.preUrl.replace(/abr_pts=(-)*\d+/g,"abr_pts=".concat(t)):"".concat(e.preUrl).concat(e.preUrl.indexOf("?")>0?"&":"?","abr_pts=").concat(t)),null!==(i=e.player.plugins)&&void 0!==i&&i.abr&&(e.hidden?(e.useAbr=e.player.plugins.abr.open,e.player.plugins.abr.switchAbr(!1)):e.useAbr&&(e.player.plugins.abr.switchAbr(!0),e.useAbr=null)),r){if(r.indexOf(o.split("?")[0])>-1)return;e.player.switchURL(r,!0)}}}),e}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"beforePlayerInit",value:function(){this.player.updateBgPlayUrl=this.updateUrl,this.initEvt()}},{key:"initEvt",value:function(){document.removeEventListener("visibilitychange",this.handleVisibilitychange),document.addEventListener("visibilitychange",this.handleVisibilitychange)}},{key:"destroy",value:function(){clearTimeout(this.switchTimer),document.removeEventListener("visibilitychange",this.handleVisibilitychange),this.player.off("isKeyframe",this.switchUrl)}},{key:"isPip",get:function(){if(!this.player||!this.player.video)return!1;var e=this.player.video;return document.pictureInPictureElement===e||"picture-in-picture"===e.webkitPresentationMode}}],[{key:"pluginName",get:function(){return"bgplay"}}])}(n(734123).BasePlugin)},550295:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var i=n(398920),r=function(e){function t(e){var n;return(0,i.PA)(this,t),(n=(0,i.$w)(this,t,[e])).config=Object.assign({isUse:!0,probeCount:3},n.config),n.resetParams(),n.bindCtx(),n}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"resetParams",value:function(){this.preProbeTime=0,this.probeCount=0,this.codec="",this._emitter=null}},{key:"afterCreate",value:function(){this.config.isUse&&this.initEvt()}},{key:"bindCtx",value:function(){this.handleUrlChange=this.handleUrlChange.bind(this),this.handleTimeUpdate=this.handleTimeUpdate.bind(this),this.switchUse=this.switchUse.bind(this)}},{key:"initEvt",value:function(){this.player.on("urlchange",this.handleUrlChange),this.player.on("timeupdate",this.handleTimeUpdate)}},{key:"handleUrlChange",value:function(){this.resetParams(),this.player.on("timeupdate",this.handleTimeUpdate)}},{key:"handleTimeUpdate",value:function(){if(!this.codec&&(e=this.handleMetaDataLoad()),!this.codec){this.player.currentTime>0&&this.player.off("timeupdate",this.handleTimeUpdate);return}if(e||!this.codec.includes("hev")){this.player.off("timeupdate",this.handleTimeUpdate);return}var e,t=this.player.video.currentTime;if(0===this.probeCount||t-this.preProbeTime>=.5){var n=this.checkBlackScreen();if(this.preProbeTime=t,!n){this.player.off("timeupdate",this.handleTimeUpdate),this.cacheResult(0);return}this.probeCount++,this.probeCount===this.config.probeCount&&(this.cacheResult(1),this.emitBlackEvt())}}},{key:"checkBlackScreen",value:function(){try{var e=this.player,t=e.video,n=t.videoWidth,i=t.videoHeight;if(!n||!i)return!0;var r=document.createElement("canvas"),o=r.getContext("2d");r.width=n/2,r.height=i/2,o.drawImage(e.video,0,0,n,i,0,0,n/2,i/2);for(var a=o.getImageData(0,0,n/2,i/2).data,s=0;s<a.length;s+=4)if(a[s]||a[s+1]||a[s+2])return!1;return!0}catch(e){return!1}}},{key:"handleMetaDataLoad",value:function(){var e=this.getPlayerCore();if(!!e){var t=e._context||e.context;if(t){var n=(t.getInstance("TRACKS")||{}).videoTrack;if(n&&n.meta){var i=n.meta.codec;this.codec=i;var r=this.getCacheResult();if(r)return this.emitBlackEvt(),!0;if(0===r)return!0}}}}},{key:"getPlayerCore",value:function(){var e=this.player;if(e.plugins){if(e.plugins.flvlive)return e.plugins.flvlive;if(e.plugins.hlslive)return e.plugins.hlslive;else if(e.plugins.hlsvod)return e.plugins.hlsvod;else if(e.plugins.hlslivemobile)return e.plugins.hlslivemobile;else if(e.plugins.flvlivemobile)return e.plugins.flvlivemobile;else if(e.plugins.rts)return e.plugins.rts}}},{key:"cacheResult",value:function(e){if(this.codec)try{localStorage.setItem(this.codec,e)}catch(e){}}},{key:"getCacheResult",value:function(){try{var e=localStorage.getItem(this.codec);if(!e)return null;return Number(e)}catch(e){return null}}},{key:"emitBlackEvt",value:function(){this.emit("detectedblackscreen"),this.player&&this.player.off&&this.player.off("timeupdate",this.handleTimeUpdate)}},{key:"switchUse",value:function(e){(e=!!e)!==this.config.isUse&&(e?this.player.on("urlchange",this.handleUrlChange):(this.player.off("urlchange",this.handleUrlChange),this.player.off("timeupdate",this.handleTimeUpdate)),this.config.isUse=e)}}],[{key:"pluginName",get:function(){return"blackscreenprobe"}}])}(n(734123).BasePlugin)},770543:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});var i=n(398920),r=n(734123),o=n(591699),a=n(106845),s={md:1,ld:2,sd:3,hd:4},u=function(e){function t(e){var n;return(0,i.PA)(this,t),n=(0,i.$w)(this,t,[e]),(0,i._x)(n,"getSwitchUrlQuality",function(){if(n.config.switchUrl)try{var e=n.config.switchUrl.match(/.*\_(\w*)\..*/)[1];e&&(n.switchQuality=e)}catch(e){}}),(0,i._x)(n,"getDefaultQuality",function(){try{var e,t=null===(e=n.player.config.url)||void 0===e?void 0:e.match(/.*\_(\w*)\..*/)[1];t?(n.defaultQuality=t,["uhd","or4"].includes(t)&&(n.config.useArea=!1)):n.config.useArea=!1}catch(e){}}),(0,i._x)(n,"checkSwitchAndScore",function(){n.checkSwitch(),n.setScore()}),n.config=Object.assign({dividing:7,switchCount:3,useArea:!1,useScore:!0,useLongFirstframe:!0,longFirstframeRatio:.3,abr_pts:-800,selectedCallback:function(){}},n.config),n.config.resolutions&&(n.sortResolutions(),n.getSwitchUrlQuality(),n.getDefaultQuality()),n.selectResolution(),n}return(0,i.XW)(t,e),(0,i.qH)(t,[{key:"afterCreate",value:function(){this.switchURL=this.switchURL.bind(this),this.player.once("canplay",this.checkSwitchAndScore)}},{key:"setScore",value:function(){new o.Z({}).getScore().then(function(e){try{localStorage.setItem("xg_device_score",e.score)}catch(e){}})}},{key:"sortResolutions",value:function(){var e=this.config.resolutions;if(e)try{this.config.resolutions=e.filter(function(e){return s[e.quality]}).sort(function(e,t){var n=e.resolution.split("x");if(!t.width){var i=t.resolution.split("x");t.width=+i[0],t.height=+i[1]}return e.width=+n[0],e.height=+n[1],s[e.quality]-s[t.quality]}),!this.config.lowUrl&&(this.config.lowUrl=this.config.resolutions[0].url)}catch(e){this.config.resolutions=null}}},{key:"selectResolution",value:function(){"undefined"!=typeof window&&this.config.lowUrl&&(this.config.useScore&&this.scoreSelect(),!this.useResolution&&this.config.useLongFirstframe&&this.firstframeSelect(),!this.useResolution&&this.config.useArea&&this.areaSelect(),this.useResolution&&!this.config.switchUrl&&this.config.selectedCallback((0,i.Zj)({},this.useResolution)))}},{key:"scoreSelect",value:function(){try{var e=localStorage.getItem("xg_device_score");if(!e)return;e<=this.config.dividing&&this.setUrl("score")}catch(e){}}},{key:"setUrl",value:function(e){this.config.resolutions?this.useResolution=this.config.resolutions[0]:this.useResolution={url:this.config.lowUrl,quality:this.config.lowUrl.match(/.*\_(\w*)\..*/)[1]},this.player.config.url="".concat(this.useResolution.url).concat(this.useResolution.url.indexOf("?")>0?"&":"?","abr_pts=").concat(this.config.abr_pts,"&select_mode=").concat(e),this.setSwitchUrl(e)}},{key:"setSwitchUrl",value:function(e){var t=this.config.switchUrl;t&&(this.config.switchUrl="".concat(t).concat(t.indexOf("?")>0?"&":"?","select_mode=").concat(e,"&pre_q=").concat(this.useResolution.quality))}},{key:"firstframeSelect",value:function(){try{var e=localStorage.getItem("xg-firstframe");if(!e)return;e=e.split(",");var t=new Date,n=60*t.getHours()+t.getMinutes(),i=e[Math.floor(n/30)].split("/");+i[0]/(+i[1]+.1)>=this.config.longFirstframeRatio&&this.setUrl("first_frame")}catch(e){}}},{key:"areaSelect",value:function(){var e=this.config,t=e.playWidth,n=e.playHeight,i=e.resolutions;if(i&&i.length&&t>=0&&n>=0){for(var r=devicePixelRatio||1,o=0;o<i.length;o++){var a=i[o],u=a.width,l=a.height,c=a.url,f=a.quality;if(t*r<=u||n*r<=l){if(s[f]>=s[this.switchQuality]||s[f]>=s[this.defaultQuality])break;this.player.config.url="".concat(c).concat(c.indexOf("?")>0?"&":"?","abr_pts=").concat(this.config.abr_pts,"&select_mode=area"),this.useResolution=a,this.setSwitchUrl("area");break}}}}},{key:"checkSwitch",value:function(){if(!!this.config.switchUrl){var e,t,n=this.player.config.url;null!==(e=this.player.plugins.flvlive)&&void 0!==e&&null!==(e=e.loader)&&void 0!==e&&e.finnalUrl&&(n=null===(t=this.player.plugins.flvlive)||void 0===t||null===(t=t.loader)||void 0===t?void 0:t.finnalUrl),!(n.indexOf(this.config.switchUrl.split("?")[0])>-1)&&this.useResolution&&this.player.once("isKeyframe",this.switchURL)}}},{key:"switchURL",value:function(e){var t=this,n=this.config.switchUrl,i="".concat(n).concat(n.indexOf("?")>0?"&":"?","abr_pts=").concat(e);a.Z.get(this.player,"plugins.flvlive");var r,o=function(){t.player.off("switch_error",r)};r=function(){t.player.off("switch_completed",o),t.config.switchCount--,t.config.switchCount>0&&t.player.once("isKeyframe",t.switchURL)},this.player.once("switch_completed",o),this.player.once("switch_error",r),this.player.switchURL(i,!0)}},{key:"destroy",value:function(){var e,t;null===(e=this.player)||void 0===e||e.off("isKeyframe",this.switchURL),null===(t=this.player)||void 0===t||t.off("canplay",this.checkSwitchAndScore)}}],[{key:"pluginName",get:function(){return"resolutionsel"}}])}(r.BasePlugin)},90506:function(e,t,n){"use strict";var i=n("713936");n("836654"),n("826893"),n("954372"),n("110617"),n("691842");var r=function(){function e(t){var n=this;(0,i.PA)(this,e);try{var r=/xgdoffscreen=(\d)/.exec(document.cookie);this._status=!!r,this._level=r&&r[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error"].forEach(function(e){n[e]=function(){var r;if(!!n._status){for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];(r=console)[e].apply(r,["["+t+"]:"].concat((0,i.u)(a.filter(function(e){return void 0!==e}))))}}})}return(0,i.qH)(e,[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}]),e}(),o=["width","height","videoWidth","videoHeight","poster","playsInline","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","autoPictureInPicture","error","src","currentSrc","crossOrigin","networkState","preload","buffered","readyState","seeking","currentTime","duration","paused","defaultPlaybackRate","playbackRate","played","seekable","ended","autoplay","loop","controls","controlsList","volume","muted","defaultMuted","textTracks","onencrypted","onwaitingforkey","srcObject","NETWORK_EMPTY","NETWORK_IDLE","NETWORK_LOADING","NETWORK_NO_SOURCE","HAVE_NOTHING","HAVE_METADATA","HAVE_CURRENT_DATA","HAVE_FUTURE_DATA","HAVE_ENOUGH_DATA","preservesPitch","audioTracks","videoTracks","sinkId","remote","disableRemotePlayback","title","lang","translate","dir","hidden","accessKey","draggable","spellcheck","autocapitalize","contentEditable","isContentEditable","inputMode","offsetParent","offsetTop","offsetLeft","offsetWidth","offsetHeight","innerText","outerText","onbeforexrselect","onabort","onblur","oncancel","oncanplay","oncanplaythrough","onchange","onclick","onclose","oncontextlost","oncontextmenu","oncontextrestored","oncuechange","ondblclick","ondrag","ondragend","ondragenter","ondragleave","ondragover","ondragstart","ondrop","ondurationchange","onemptied","onended","onerror","onfocus","onformdata","oninput","oninvalid","onkeydown","onkeypress","onkeyup","onload","onloadeddata","onloadedmetadata","onloadstart","onmousedown","onmouseenter","onmouseleave","onmousemove","onmouseout","onmouseover","onmouseup","onmousewheel","onpause","onplay","onplaying","onprogress","onratechange","onreset","onresize","onscroll","onsecuritypolicyviolation","onseeked","onseeking","onselect","onslotchange","onstalled","onsubmit","onsuspend","ontimeupdate","ontoggle","onvolumechange","onwaiting","onwheel","onauxclick","ongotpointercapture","onlostpointercapture","onpointerdown","onpointermove","onpointerup","onpointercancel","onpointerover","onpointerout","onpointerenter","onpointerleave","onselectstart","onselectionchange","onanimationend","onanimationiteration","onanimationstart","ontransitionrun","ontransitionstart","ontransitionend","ontransitioncancel","oncopy","oncut","onpaste","dataset","nonce","autofocus","tabIndex","style","inert","editContext","enterKeyHint","virtualKeyboardPolicy","onoverscroll","onscrollend","onpointerrawupdate","focusgroup","onbeforematch","namespaceURI","prefix","localName","tagName","id","className","classList","slot","attributes","shadowRoot","part","assignedSlot","innerHTML","outerHTML","scrollTop","scrollLeft","scrollWidth","scrollHeight","clientTop","clientLeft","clientWidth","clientHeight","attributeStyleMap","onbeforecopy","onbeforecut","onbeforepaste","onsearch","elementTiming","onfullscreenchange","onfullscreenerror","role","ariaAtomic","ariaAutoComplete","ariaBusy","ariaChecked","ariaColCount","ariaColIndex","ariaColSpan","ariaCurrent","ariaDescription","ariaDisabled","ariaExpanded","ariaHasPopup","ariaHidden","ariaInvalid","ariaKeyShortcuts","ariaLabel","ariaLevel","ariaLive","ariaModal","ariaMultiLine","ariaMultiSelectable","ariaOrientation","ariaPlaceholder","ariaPosInSet","ariaPressed","ariaReadOnly","ariaRelevant","ariaRequired","ariaRoleDescription","ariaRowCount","ariaRowIndex","ariaRowSpan","ariaSelected","ariaSetSize","ariaSort","ariaValueMax","ariaValueMin","ariaValueNow","ariaValueText","children","firstElementChild","lastElementChild","childElementCount","previousElementSibling","nextElementSibling","popup","defaultOpen","computedRole","computedName","accessibleNode","ariaVirtualContent","ariaActiveDescendantElement","ariaControlsElements","ariaDescribedByElements","ariaDetailsElements","ariaErrorMessageElement","ariaFlowToElements","ariaLabelledByElements","ariaOwnsElements","nodeType","nodeName","baseURI","isConnected","ownerDocument","parentNode","parentElement","childNodes","firstChild","lastChild","previousSibling","nextSibling","nodeValue","textContent","ELEMENT_NODE","ATTRIBUTE_NODE","TEXT_NODE","CDATA_SECTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","PROCESSING_INSTRUCTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","NOTATION_NODE","DOCUMENT_POSITION_DISCONNECTED","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","DOCUMENT_POSITION_CONTAINS","DOCUMENT_POSITION_CONTAINED_BY","DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC"],a=["cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","addTextTrack","captureStream","canPlayType","load","pause","play","setSinkId","attachInternals","blur","click"],s=new r("OffscreenVideo"),u=function(e){(0,i.XW)(n,e);var t=(0,i.WY)(n);function n(){var e,r,s,u,l;return(0,i.PA)(this,n),s=t.call(this),(0,i._x)((0,i.Lc)(s),"_flyVideo",document.createElement("video")),(0,i._x)((0,i.Lc)(s),"_mainCanvas",document.createElement("canvas")),(0,i._x)((0,i.Lc)(s),"_miniCanvas",document.createElement("canvas")),(0,i._x)((0,i.Lc)(s),"_mainCtx",s._mainCanvas.getContext("2d")),(0,i._x)((0,i.Lc)(s),"_miniCtx",s._miniCanvas.getContext("2d")),(0,i._x)((0,i.Lc)(s),"_mainPosition",null),(0,i._x)((0,i.Lc)(s),"_miniPosition",null),(0,i._x)((0,i.Lc)(s),"_currentMain",null),(0,i._x)((0,i.Lc)(s),"_mainPointers",[0,0,1,1]),(0,i._x)((0,i.Lc)(s),"_miniPointers",[0,0,1,1]),(0,i._x)((0,i.Lc)(s),"_displayMode",0),(0,i._x)((0,i.Lc)(s),"_rafId",0),(0,i._x)((0,i.Lc)(s),"_resizeObserver",null),(0,i._x)((0,i.Lc)(s),"addEventListener",function(){for(var t,r,o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];var l=a[0];if("click"===l||"dbclick"===l||"contextmenu"===l){(r=(0,i.U2)((e=(0,i.Lc)(s),(0,i.IP)(n.prototype)),"addEventListener",e)).call.apply(r,[e].concat(a));return}"enterpictureinpicture"===l&&s._flyVideo.addEventListener("enterpictureinpicture",s._enterpictureinpicture),"leavepictureinpicture"===l&&s._flyVideo.addEventListener("leavepictureinpicture",s._leavepictureinpicture),(t=s._flyVideo).addEventListener.apply(t,a)}),(0,i._x)((0,i.Lc)(s),"removeEventListener",function(){for(var e,t,o=arguments.length,a=Array(o),u=0;u<o;u++)a[u]=arguments[u];var l=a[0];if("click"===l||"dbclick"===l||"contextmenu"===l){(t=(0,i.U2)((r=(0,i.Lc)(s),(0,i.IP)(n.prototype)),"removeEventListener",r)).call.apply(t,[r].concat(a));return}"enterpictureinpicture"===l&&s._flyVideo.removeEventListener("enterpictureinpicture",s._enterpictureinpicture),"leavepictureinpicture"===l&&s._flyVideo.removeEventListener("leavepictureinpicture",s._leavepictureinpicture),(e=s._flyVideo).removeEventListener.apply(e,a)}),(0,i._x)((0,i.Lc)(s),"_enterpictureinpicture",function(){s._currentMain.style.display="none"}),(0,i._x)((0,i.Lc)(s),"_leavepictureinpicture",function(){s._currentMain.style.display="block"}),(0,i._x)((0,i.Lc)(s),"_rafDraw",function(){if(!s._canDraw){s._requestRaf();return}s._draw(),s._requestRaf()}),u=(0,i.Lc)(s),l=s._flyVideo,o.forEach(function(e){if("firstChild"!==e&&"parentNode"!==e&&"style"!==e)Object.defineProperty(u,e,{get:function(){return l[e]},set:function(t){l[e]=t}})}),a.forEach(function(e){if("appendChild"!==e&&"removeChild"!==e&&"setAttribute"!==e)u[e]=function(){return l[e].apply(l,arguments)}}),s._bindVideoEvents(),s}return(0,i.qH)(n,[{key:"flyVideo",get:function(){return this._flyVideo}},{key:"media",get:function(){return this._flyVideo}},{key:"mainScreen",get:function(){return this._mainCanvas}},{key:"pipScreen",get:function(){return this._currentMain===this._mainCanvas?this._miniCanvas:this._mainCanvas}},{key:"_parentWidth",get:function(){return this.parentNode.clientWidth}},{key:"_parentHeight",get:function(){return this.parentNode.clientHeight}},{key:"_canDraw",get:function(){return!this.paused&&this.readyState>1}},{key:"canvas",get:function(){return this._currentMain}},{key:"setAttribute",value:function(e,t){(0,i.U2)((0,i.IP)(n.prototype),"setAttribute",this).call(this,e,t),this._flyVideo[e]=t}},{key:"connectedCallback",value:function(){var e=this;this.style.width="100%",this.style.height="100%",this.style.position="absolute",this.style.left="0px",this.style.top="0px",ResizeObserver&&(this._resizeObserver=new ResizeObserver(function(){e._scaleCanvas("resizeElement"),e._drawOnceForPause()}),this._resizeObserver.observe(this))}},{key:"disconnectCallback",value:function(){this._resizeObserver&&this._resizeObserver.disconnect(this),this._rafId&&window.cancelAnimationFrame(this._rafId)}},{key:"updateMeta",value:function(e){var t=e.mainPointers,n=e.miniPointers,i=e.displayMode;s.log("update metadata",t,n,"displayMode:",i),this._mainPointers=t,this._miniPointers=n,this._displayMode=i;var r=!1;if(this.videoWidth){var o,a,u,l,c,f,d,h,p=this._getScreenPosition(this.videoWidth,this.videoHeight,this._mainPointers),v=this._getScreenPosition(this.videoWidth,this.videoHeight,this._miniPointers);r=p.left!==(null===(o=this._mainPosition)||void 0===o?void 0:o.left)||p.top!==(null===(a=this._mainPosition)||void 0===a?void 0:a.top)||p.width!==(null===(u=this._mainPosition)||void 0===u?void 0:u.width)||p.height!==(null===(l=this._mainPosition)||void 0===l?void 0:l.height)||v.left!==(null===(c=this._miniPosition)||void 0===c?void 0:c.left)||v.top!==(null===(f=this._miniPosition)||void 0===f?void 0:f.top)||v.width!==(null===(d=this._miniPosition)||void 0===d?void 0:d.width)||v.height!==(null===(h=this._miniPosition)||void 0===h?void 0:h.height)}r&&(this._initCanvasSize(),this._drawOnceForPause())}},{key:"switchScreen",value:function(){this.firstChild&&this.removeChild(this.firstChild),this._currentMain===this._mainCanvas?(this.appendChild(this._miniCanvas),this._currentMain=this._miniCanvas):(this.appendChild(this._mainCanvas),this._currentMain=this._mainCanvas),this._scaleCanvas("switchScreen")}},{key:"_bindVideoEvents",value:function(){var e=this;this.addEventListener("loadeddata",function(){s.log("on loadeddata, videoWidth=".concat(e.videoWidth,", videoHeight=").concat(e.videoHeight,", displayMode:").concat(e._displayMode)),0===e._displayMode?e._currentMain=e._mainCanvas:e._currentMain=e._miniCanvas,e.firstChild&&e.removeChild(e.firstChild),e.appendChild(e._currentMain),e._initCanvasSize(),e._drawOnceForPause(),e._requestRaf()}),this.addEventListener("resize",function(){4===e.readyState&&(s.log("on resize, videoWidth=".concat(e.videoWidth,", videoHeight=").concat(e.videoHeight)),e._initCanvasSize())})}},{key:"_getScreenPosition",value:function(e,t,n){return{left:parseInt(n[0]*e),top:parseInt(n[1]*t),width:parseInt(n[2]*e),height:parseInt(n[3]*t)}}},{key:"_initCanvasSize",value:function(){if(!!this.videoWidth&&!!this.videoHeight){this._mainPosition=this._getScreenPosition(this.videoWidth,this.videoHeight,this._mainPointers),this._miniPosition=this._getScreenPosition(this.videoWidth,this.videoHeight,this._miniPointers),s.log("init canvas size: ",this._mainPosition,this._miniPosition);var e=this._mainCanvas,t=this._miniCanvas;e.width=this._mainPosition.width,e.height=this._mainPosition.height,t.width=this._miniPosition.width,t.height=this._miniPosition.height,this._scaleCanvas("initCanvasSize")}}},{key:"_scaleCanvas",value:function(e){if(!!this._currentMain&&!!this.parentNode&&!!this._flyVideo.readyState){this._setCanvasStyle(this._miniCanvas),this._setCanvasStyle(this._mainCanvas);var t,n=/rotate\((\d+)/.exec(this.style.transform);if(90===(n=n&&parseInt(n[1]))||270===n){s.log("in rotate, deg=",n);return}this._parentWidth/this._parentHeight<this._currentMain.width/this._currentMain.height?(this._currentMain.style.width="100%",t="width"):(this._currentMain.style.height="100%",t="height"),s.log("[".concat(e,"]: set main canvas ").concat(t," 100%, parentWidth=").concat(this._parentWidth,", parentHeight=").concat(this._parentHeight,", videoWidth=").concat(this._currentMain.width,", videoHeight=").concat(this._currentMain.height))}}},{key:"_setCanvasStyle",value:function(e){e.style.top=0,e.style.bottom=0,e.style.left=0,e.style.right=0,e.style.margin="auto",e.style.position="absolute",e.style.maxWidth="100%",e.style.maxHeight="100%",e.style.width="initial",e.style.height="initial",e.style.pointerEvents="none"}},{key:"_drawOnceForPause",value:function(){this.paused&&this.readyState>1&&this._draw()}},{key:"_draw",value:function(){var e=this._mainPosition,t=e.left,n=e.top,i=e.width,r=e.height,o=this._miniPosition,a=o.left,s=o.top,u=o.width,l=o.height;this._mainCtx.drawImage(this._flyVideo,t,n,i,r,0,0,i,r),this._miniCtx.drawImage(this._flyVideo,a,s,u,l,0,0,u,l)}},{key:"_requestRaf",value:function(){this._rafId=window.requestAnimationFrame(this._rafDraw)}}],[{key:"version",get:function(){return"0.1.15"}},{key:"isSupported",value:function(){var e=navigator.userAgent;return"undefined"!=typeof window&&window.customElements&&!(/Safari/.test(e)&&!/Chrome/.test(e))&&window.requestAnimationFrame}}]),n}("undefined"==typeof HTMLElement?function(){}:HTMLElement);try{window.customElements.define("offscreen-video",u)}catch(e){}},29512:function(e,t){"use strict";var n,i=function(e,t){return(i=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function a(e,t,n,i){var r,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,n,a):r(t,n))||a);return o>3&&a&&Object.defineProperty(t,n,a),a}function s(e,t,n){if(n||2==arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))}var u=Symbol("singleton-decorator:instance");function l(e){Object.defineProperty(e,"getInstance",{value:function(t){var n,i;return n=e,i=t,n[u]=n[u]instanceof n?n[u]:new n(i)}})}function c(e){return function(t){var n=t.prototype.eventNames||[];t.prototype.eventNames=s(s([],n,!0),e,!0)}}var f,d,h,p,v,y=new((function(e){var t=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,i,o,a){if("function"!=typeof i)throw TypeError("The listener must be a function");var s=new r(i,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function s(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,i,r=[];if(0===this._eventsCount)return r;for(i in e=this._events)t.call(e,i)&&r.push(n?i.slice(1):i);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},s.prototype.listeners=function(e){var t=n?n+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var r=0,o=i.length,a=Array(o);r<o;r++)a[r]=i[r].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,i=this._events[t];return i?i.fn?1:i.length:0},s.prototype.emit=function(e,t,i,r,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,r),!0;case 5:return c.fn.call(c.context,t,i,r,o),!0;case 6:return c.fn.call(c.context,t,i,r,o,a),!0}for(l=1,u=Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var d,h=c.length;for(l=0;l<h;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,i);break;case 4:c[l].fn.call(c[l].context,t,i,r);break;default:if(!u)for(d=1,u=Array(f-1);d<f;d++)u[d-1]=arguments[d];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,i,r){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||r&&!s.once||i&&s.context!==i||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||r&&!s[u].once||i&&s[u].context!==i)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new i,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s}(f={exports:{}},f.exports)),f.exports),m=function(){function e(e){this.options=null,this.options=e,this.init(),this.bind()}return e.prototype.init=function(){},e.prototype.handler=function(e){void 0===this.options.groupId&&(this.options.groupId=e.data.group_id),this.observe(o({},e))},e.prototype.observe=function(e){},e.prototype.bind=function(){var e,t=this;null===(e=this.eventNames)||void 0===e||e.forEach(function(e){y.on(e,t.handler,t)})},e.prototype.destroy=function(){var e=this;this.eventNames.forEach(function(t){y.removeListener(t,e.handler,e)})},e.prototype.emit=function(e,t){y.emit(e,t)},e.prototype.getFeatures=function(){return this.features},e}();(g=d||(d={})).VIDEO_PLAY_QUALITY="video_play_quality",g.CLICK_COMMENT_BUTTON="click_comment_button",g.COMMENT_SHOW="comment_show",g.POST_COMMENT="post_comment",g.CLICK_LIKE="click_like",g.LIKE="like",g.CANCEL_LIKE="cancel_like",g.CLICK_FAVORITE_VIDEO="click_favorite_video",g.CANCEL_FAVORITE_VIDEO="cancel_favorite_video",g.FOLLOW_CANCEL="follow_cancel",g.CLICK_FOLLOW="click_follow",g.SHARE_MENU_SHOW="share_menu_show",g.SHARE_VIDEO="share_video",g.CLOSE_VIDEO_CARD="close_video_card",g.CLICK_AUTHOR_HEAD="click_author_head",g.PLAY_TIME="play_time",g.VIDEO_REQUEST="video_request",g.BEFORE_VIDEO_REQUEST="before_video_request",t.EBiz=void 0,(h=t.EBiz||(t.EBiz={})).DOUYIN_WEB_RECOMMEND="douyin-web-recommend",h.DOUYIN_WEB_LIVE="douyin-live",(_=p||(p={}))[_.Normal=0]="Normal",_[_.Fast=1]="Fast",_[_.Slow=2]="Slow",t.EScene=void 0,(v=t.EScene||(t.EScene={})).COMMENT="comment",v.AD_COMMENT="ad_comment",v.PROFILE="profile",v.EcomPopCard="ecom_popcard",v.EcomPopCardRptFeature="ecom_popcard_rpt_feature",v.FeedSlide="feed_slide";var g,_,b,E="singleton-plyon:collector_instance",S=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.features={count:0,open:!1,openTimes:0,hasComment:!1},t}return r(t,e),t.prototype.observe=function(e){var t=e.eventName,n=e.data;n.group_id===this.options.groupId&&(t===d.COMMENT_SHOW&&this.features.count++,t===d.CLICK_COMMENT_BUTTON&&(this.features.open=!0),t===d.CLOSE_VIDEO_CARD&&"comment"===n.type&&(this.features.open=!1),t===d.POST_COMMENT&&(this.features.hasComment=!0))},t=a([c([d.CLICK_COMMENT_BUTTON,d.COMMENT_SHOW,d.POST_COMMENT,d.CLOSE_VIDEO_CARD])],t)}(m),w=function(e){function t(t){var n=e.call(this,t)||this;n.features={duration:0,likeCount:0,shareCount:0,commentCount:0,downloadCount:0,forwardCount:0,playTime:0};var i=t.extraData;return i&&i.duration&&(n.features.duration=i.duration),n}return r(t,e),t.prototype.observe=function(e){var t=e.eventName,n=e.data;n.group_id===this.options.groupId&&(t===d.VIDEO_REQUEST&&(this.features.likeCount=n.v_like_cnt,this.features.commentCount=n.v_comment_cnt,this.features.downloadCount=n.v_download_cnt,this.features.forwardCount=n.v_forward_cnt,this.features.shareCount=n.v_share_cnt,this.features.duration=n.vduration),t===d.PLAY_TIME&&(this.features.playTime+=n.duration))},t=a([c([d.VIDEO_REQUEST,d.PLAY_TIME])],t)}(m),k=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.features={count:0},t}return r(t,e),t.prototype.observe=function(e){var t=e.eventName;e.data.group_id===this.options.groupId&&t===d.CLICK_AUTHOR_HEAD&&this.features.count++},t=a([c([d.CLICK_AUTHOR_HEAD])],t)}(m),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.features={likeCount:0,like:!1,favorite:!1,follow:!1,shareShowCount:0,shareCount:0},t}return r(t,e),t.prototype.observe=function(e){var t=e.eventName;e.data.group_id===this.options.groupId&&(t===d.CLICK_LIKE&&this.features.likeCount++,t===d.LIKE&&(this.features.like=!0),t===d.CANCEL_LIKE&&(this.features.like=!1),t===d.CLICK_FAVORITE_VIDEO&&(this.features.favorite=!0),t===d.CANCEL_FAVORITE_VIDEO&&(this.features.favorite=!1),t===d.CLICK_FOLLOW&&(this.features.follow=!0),t===d.FOLLOW_CANCEL&&(this.features.follow=!1),t===d.SHARE_MENU_SHOW&&this.features.shareShowCount++,t===d.SHARE_VIDEO&&this.features.shareCount++)},t=a([c([d.CLICK_LIKE,d.LIKE,d.CANCEL_LIKE,d.CLICK_FAVORITE_VIDEO,d.CANCEL_FAVORITE_VIDEO,d.FOLLOW_CANCEL,d.CLICK_FOLLOW,d.SHARE_MENU_SHOW,d.SHARE_VIDEO])],t)}(m),C=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){this.features=[]},t.prototype.initSubFeatures=function(e){var t,n,i,r,o=this.features.findIndex(function(t){var n,i;return(null===(i=null===(n=null==t?void 0:t.video)||void 0===n?void 0:n.options)||void 0===i?void 0:i.groupId)===(null==e?void 0:e.groupId)});if(!0!=o>-1){var a=new w(e),s=new S(e),u=new k(e),l=new T(e);10===this.features.length&&Object.values(this.features.shift()).forEach(function(e){var t;return null===(t=null==e?void 0:e.destroy)||void 0===t?void 0:t.call(e)}),this.features.push({video:a,comment:s,profile:u,interactive:l})}else null===(t=this.features)||void 0===t||t.splice(null===(n=this.features)||void 0===n?void 0:n.length,0,null===(r=null===(i=this.features)||void 0===i?void 0:i.splice(o,1))||void 0===r?void 0:r[0])},t.prototype.observe=function(e){var t=e.eventName,n=e.data;t===d.BEFORE_VIDEO_REQUEST&&this.initSubFeatures({groupId:n.group_id})},t.prototype.getLatestVideo=function(){var e;return null===(e=this.features[this.features.length-1])||void 0===e?void 0:e.video},t=a([c([d.BEFORE_VIDEO_REQUEST])],t)}(m);(n=b||(b={})).LIVESDK_SHOW_PRODUCT="livesdk_show_product",n.ENTER_PRODUCT_DETAIL="enter_product_detail",n.SHOW_PRODUCT_ENTRANCE_QR_CODE="show_product_entrance_qr_code",n.LIVESDK_LIVE_PLAY="livesdk_live_play",n.LIVESDK_LIVE_DURATION_NEW="livesdk_live_duration_new",n.LIVESDK_PERFPRMANCE_FRAME_LOAD="livesdk_performance_frame_load",n.LIVESDK_LIKE="livesdk_like",n.LIVESDK_DISLIKE="livesdk_dislike",n.LIVESDK_LIVE_CLICK_USER="livesdk_live_click_user",n.LIVESDK_FOLLOW="livesdk_follow",n.LIVESDK_UNFOLLOW="livesdk_unfollow",n.LIVESDK_SEND_GIFT="livesdk_send_gift",n.LIVESDK_SEND_PROP="livesdk_send_prop",n.LIVESDK_RECHARGE_SUCCESS="livesdk_recharge_success",n.LIVESDK_CONTRIBUTION_RANKLIST_SHOW="livesdk_contribution_ranklist_show",n.LIVESDK_FANS_CLUB_JOIN_SUCCESS="livesdk_fans_club_join_success",n.LIVESDK_AUDIENCE_LIVE_MESSAGE="livesdk_audience_live_message",n.VIDEO_REQUEST="video_request",n.BEFORE_VIDEO_REQUEST="before_video_request";var O=function(e){function t(t){var n=e.call(this,t)||this;return n.features={popCardShowTimes:0,popCardClickTimes:0,qrcodeShowTimes:0,duration:0,webMemorysize:0,webCpuCore:0,ecomLikeCount:0,ecomClickUserCount:0,ecomFollow:0,ecomUnFollow:0,ecomSendGift:0,ecomRecharge:0,ecomRanklist:0,ecomFanJoin:0,ecomSendMsg:0},n.timerId=null,n.ecomRptFeatures={predict:[],real:!1},n.sliceFeatures=null,n.storedFeatures=[],n.currentFeatures=[],n.initValuesFormLocalStorage(),n}return r(t,e),t.prototype.initValuesFormLocalStorage=function(){var e,t=this;if("undefined"!=typeof window){var n=window.localStorage.getItem("ai_pop_card_features");if(n)try{this.ecomRptFeatures=JSON.parse(n),this.storedFeatures=null===(e=this.ecomRptFeatures)||void 0===e?void 0:e.predict.slice(),this.timerId=setTimeout(function(){var e;for(var n in t.sliceFeatures=(e=t.features,JSON.parse(JSON.stringify(e))),t.sliceFeatures)t.sliceFeatures.hasOwnProperty(n)&&0===t.sliceFeatures[n]&&delete t.sliceFeatures[n];t.timerId=null},3e3),this.storedFeatures.length>0&&(this.storedFeatures.pop(),this.storedFeatures.length>=9&&(this.storedFeatures=this.storedFeatures.slice(-8)))}catch(e){}}},t.prototype.observe=function(e){var t,n,i,r=e.eventName,o=e.data;switch(r){case b.LIVESDK_SHOW_PRODUCT:"live_popup_card"===o.ecom_entrance_form&&1===o.is_visible&&this.features.popCardShowTimes++;break;case b.ENTER_PRODUCT_DETAIL:"live_popup_card"===o.ecom_entrance_form&&this.features.popCardClickTimes++;break;case b.SHOW_PRODUCT_ENTRANCE_QR_CODE:"live_popup_card"===o.ecom_entrance_form&&this.features.qrcodeShowTimes++;break;case b.LIVESDK_LIVE_DURATION_NEW:this.features.duration+=o.duration;break;case b.LIVESDK_PERFPRMANCE_FRAME_LOAD:this.features.webMemorysize=o.web_memory_size,this.features.webCpuCore=o.web_cpu_core;break;case b.LIVESDK_LIKE:this.features.ecomLikeCount++;break;case b.LIVESDK_LIVE_CLICK_USER:this.features.ecomClickUserCount++;break;case b.LIVESDK_FOLLOW:this.features.ecomFollow++;break;case b.LIVESDK_UNFOLLOW:this.features.ecomUnFollow++;break;case b.LIVESDK_SEND_GIFT:this.features.ecomSendGift++;break;case b.LIVESDK_RECHARGE_SUCCESS:this.features.ecomRecharge++;break;case b.LIVESDK_CONTRIBUTION_RANKLIST_SHOW:this.features.ecomRanklist++;break;case b.LIVESDK_FANS_CLUB_JOIN_SUCCESS:this.features.ecomFanJoin++;break;case b.LIVESDK_AUDIENCE_LIVE_MESSAGE:this.features.ecomSendMsg++}if("undefined"!=typeof window){var a=this.features.popCardShowTimes||0;if(o.room_id&&a>0){this.currentFeatures=s(s([],this.storedFeatures,!0),[((t={})[o.room_id]=this.features,t)],!1);var u={predict:s(s([],this.storedFeatures,!0),[((n={})[o.room_id]=this.features,n),((i={})[o.room_id]=this.sliceFeatures,i)],!1),real:this.features.popCardClickTimes>0};null==window||window.localStorage.setItem("ai_pop_card_features",JSON.stringify(u))}}},t=a([c([b.LIVESDK_SHOW_PRODUCT,b.ENTER_PRODUCT_DETAIL,b.SHOW_PRODUCT_ENTRANCE_QR_CODE,b.LIVESDK_LIVE_PLAY,b.LIVESDK_LIVE_DURATION_NEW,b.LIVESDK_PERFPRMANCE_FRAME_LOAD,b.LIVESDK_LIKE,b.LIVESDK_LIVE_CLICK_USER,b.LIVESDK_FOLLOW,b.LIVESDK_UNFOLLOW,b.LIVESDK_SEND_GIFT,b.LIVESDK_RECHARGE_SUCCESS,b.LIVESDK_CONTRIBUTION_RANKLIST_SHOW,b.LIVESDK_FANS_CLUB_JOIN_SUCCESS,b.LIVESDK_AUDIENCE_LIVE_MESSAGE])],t)}(m),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){this.features=[],this.initSubFeatures({})},t.prototype.initSubFeatures=function(e){var t=new O(e);this.features.push({ecomPopCard:t})},t}(m),R=function(){function e(e){this.options=e,this.init()}return e.prototype.init=function(){this.options.biz===t.EBiz.DOUYIN_WEB_RECOMMEND&&(this.collector={feed:new C({})}),this.options.biz===t.EBiz.DOUYIN_WEB_LIVE&&(this.collector={ecom:new A({})})},e.prototype.getCollector=function(){return this.collector},e}();function P(){return"undefined"!=typeof window?window:"undefined"!=typeof window?window:this}var D=P(),x=function(){function e(e){this.options=e,this.linster=this.linster.bind(this),this.observe()}return e.prototype.linster=function(e){var n,i=this,r=Object.values(d),o=Object.values(b);null===(n=null==e?void 0:e.forEach)||void 0===n||n.call(e,function(e){var n;null===(n=null==e?void 0:e.events)||void 0===n||n.forEach(function(e){var n=e.event,a=e.params,s=e.session_id,u=function(e){try{return JSON.parse(e)}catch(e){return{}}}(a),l=i.options.biz===t.EBiz.DOUYIN_WEB_RECOMMEND&&"recommend"===(null==u?void 0:u.enter_from);r.includes(n)&&l&&(y.emit("before_".concat(n),{eventName:"before_".concat(n),data:u,sessionId:s}),y.emit(n,{eventName:n,data:u,sessionId:s})),o.includes(n)&&i.options.biz===t.EBiz.DOUYIN_WEB_LIVE&&(y.emit("before_".concat(n),{eventName:"before_".concat(n),data:u,sessionId:s}),y.emit(n,{eventName:n,data:u,sessionId:s}))})})},e.prototype.observe=function(){var e;null===(e=D.collectEvent)||void 0===e||e.call(D,"on","submit-after",this.linster)},e.prototype.destroy=function(){var e;null===(e=D.collectEvent)||void 0===e||e.call(D,"off","submit-after",this.linster)},e=a([l],e)}();t.bootstrap=function(e){var t=P();t[E]||(t["singleton-pylon:observer_instance"]=new x(e),t[E]=new R(e))}},315985:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var i=n("336279"),r=n("833789"),o=function(e){if(!e||!document.getRootNode)return document;var t,n=Array.isArray(e)?e:[e];if(n.every(function(e){var t=(0,r.n)(e);return!!t&&(t.getRootNode() instanceof ShadowRoot||!1)})){;return(t=(0,r.n)(n[0]))?t.getRootNode():document}return document},a=n("277988");function s(e,t,n){void 0===n&&(n="click");var s=(0,i.Z)(e);(0,a.Z)(function(){var e=function(e){if(!(Array.isArray(t)?t:[t]).some(function(t){var n=(0,r.n)(t);return!n||n.contains(e.target)}))s.current(e)},i=o(t),a=Array.isArray(n)?n:[n];return a.forEach(function(t){return i.addEventListener(t,e)}),function(){a.forEach(function(t){return i.removeEventListener(t,e)})}},Array.isArray(n)?n:[n],t)}},379928:function(e,t,n){"use strict";var i=n(101380),r=n(128231),o=n.n(r),a=n(88648),s=n(336279),u=n(983096),l=n(526361),c=n(882611);t.Z=function(e,t){c.Z&&(0,l.mf)(e);var n,r=(0,s.Z)(e),f=null!==(n=null==t?void 0:t.wait)&&void 0!==n?n:1e3,d=(0,a.useMemo)(function(){return o()(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r.current.apply(r,(0,i.ev)([],(0,i.CR)(e),!1))},f,t)},[]);return(0,u.Z)(function(){d.cancel()}),{run:d,cancel:d.cancel,flush:d.flush}}},774805:function(e,t,n){"use strict";var i=n(101380),r=n(471525),o=n(434739);t.Z=function(e,t){var n=t||{},a=n.onEnter,s=n.onLeave,u=n.onChange,l=(0,i.CR)((0,r.Z)(!1),2),c=l[0],f=l[1],d=f.setTrue,h=f.setFalse;return(0,o.Z)("mouseenter",function(){null==a||a(),d(),null==u||u(!0)},{target:e}),(0,o.Z)("mouseleave",function(){null==s||s(),h(),null==u||u(!1)},{target:e}),c}},38555:function(e,t,n){"use strict";var i=n(88648),r=n(797973),o=n(526361);t.Z=function(e,t,n){void 0===n&&(n={});var a=(0,r.Z)(e),s=(0,i.useRef)(null),u=(0,i.useCallback)(function(){s.current&&clearInterval(s.current)},[]);return(0,i.useEffect)(function(){if(!!(0,o.hj)(t)&&!(t<0))return n.immediate&&a(),s.current=setInterval(a,t),u},[t,n.immediate]),u}},254575:function(e,t,n){"use strict";var i=n(101380),r=n(88648);t.Z=function(e){var t=this,n=(0,r.useRef)(!1);return(0,r.useCallback)(function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];return(0,i.mG)(t,void 0,void 0,function(){return(0,i.Jh)(this,function(t){switch(t.label){case 0:if(n.current)return[2];n.current=!0,t.label=1;case 1:return t.trys.push([1,3,4,5]),[4,e.apply(void 0,(0,i.ev)([],(0,i.CR)(r),!1))];case 2:return[2,t.sent()];case 3:throw t.sent();case 4:return n.current=!1,[7];case 5:return[2]}})})},[e])}},919441:function(e,t,n){"use strict";var i=n(101380),r=n(88648),o=n(124393);t.Z=function(e){var t=(0,o.Z)(),n=(0,i.CR)((0,r.useState)(e),2),a=n[0],s=n[1];return[a,(0,r.useCallback)(function(e){!t.current&&s(e)},[])]}},831291:function(e,t,n){"use strict";var i=n(101380),r=n(88648);t.Z=function(e,t){void 0===e&&(e=!1);var n=(0,i.CR)((0,r.useState)(e),2),o=n[0],a=n[1];return[o,(0,r.useMemo)(function(){var n=void 0===t?!e:t;return{toggle:function(){return a(function(t){return t===e?n:e})},set:function(e){return a(e)},setLeft:function(){return a(e)},setRight:function(){return a(n)}}},[])]}},371073:function(e,t,n){"use strict";n.d(t,{k:function(){return o}});var i=n(324791),r=n.n(i),o=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),r()(e,t)}},172639:function(e){e.exports=function(e,t){return e<t}},15376:function(e,t,n){var i=n(512710),r=n(898865),o=n(420669),a=n(385071),s=n(998373),u=n(271277),l=n(339416),c=n(916462),f=n(419936);e.exports=function(e,t,n){t=t.length?i(t,function(e){return f(e)?function(t){return r(t,1===e.length?e[0]:e)}:e}):[c];var d=-1;return t=i(t,u(o)),s(a(e,function(e,n,r){return{criteria:i(t,function(t){return t(e)}),index:++d,value:e}}),function(e,t){return l(e,t,n)})}},998373:function(e){e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},500024:function(e,t,n){var i=n(27946);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,o=e==e,a=i(e),s=void 0!==t,u=null===t,l=t==t,c=i(t);if(!u&&!c&&!a&&e>t||a&&s&&l&&!u&&!c||r&&s&&l||!n&&l||!o)return 1;if(!r&&!a&&!c&&e<t||c&&n&&o&&!r&&!a||u&&n&&o||!s&&o||!l)return -1}return 0}},652111:function(e){e.exports=function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}},281268:function(e,t,n){var i=n(687217),r=n(420669),o=n(172639);e.exports=function(e,t){return e&&e.length?i(e,r(t,2),o):void 0}},970838:function(e,t,n){var i=n(15376),r=n(419936);e.exports=function(e,t,n,o){return null==e?[]:(!r(t)&&(t=null==t?[]:[t]),!r(n=o?void 0:n)&&(n=null==n?[]:[n]),i(e,t,n))}},735636:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var i=n("378407"),r=n("80415"),o=n("196764"),a=n("334168"),s=n("88648"),u=n("357437"),l=n("20642"),c=function(e,t){return e&&t&&t.split(" ").forEach(function(t){return(0,a.Z)(e,t)})},f=function(e){function t(){for(var t,n=arguments.length,i=Array(n),r=0;r<n;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))||this).appliedClasses={appear:{},enter:{},exit:{}},t.onEnter=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1];t.removeClasses(r,"exit"),t.addClass(r,o?"appear":"enter","base"),t.props.onEnter&&t.props.onEnter(e,n)},t.onEntering=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1];t.addClass(r,o?"appear":"enter","active"),t.props.onEntering&&t.props.onEntering(e,n)},t.onEntered=function(e,n){var i=t.resolveArguments(e,n),r=i[0],o=i[1]?"appear":"enter";t.removeClasses(r,o),t.addClass(r,o,"done"),t.props.onEntered&&t.props.onEntered(e,n)},t.onExit=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"appear"),t.removeClasses(n,"enter"),t.addClass(n,"exit","base"),t.props.onExit&&t.props.onExit(e)},t.onExiting=function(e){var n=t.resolveArguments(e)[0];t.addClass(n,"exit","active"),t.props.onExiting&&t.props.onExiting(e)},t.onExited=function(e){var n=t.resolveArguments(e)[0];t.removeClasses(n,"exit"),t.addClass(n,"exit","done"),t.props.onExited&&t.props.onExited(e)},t.resolveArguments=function(e,n){return t.props.nodeRef?[t.props.nodeRef.current,e]:[e,n]},t.getClassNames=function(e){var n=t.props.classNames,i="string"==typeof n,r=i&&n?n+"-":"",o=i?""+r+e:n[e],a=i?o+"-active":n[e+"Active"],s=i?o+"-done":n[e+"Done"];return{baseClassName:o,activeClassName:a,doneClassName:s}},t}(0,o.Z)(t,e);var n=t.prototype;return n.addClass=function(e,t,n){var i,r,o=this.getClassNames(t)[n+"ClassName"],a=this.getClassNames("enter").doneClassName;if("appear"===t&&"done"===n&&a&&(o+=" "+a),"active"===n&&e&&(0,l.Q)(e),o){;this.appliedClasses[t][n]=o,i=e,r=o,i&&r&&r.split(" ").forEach(function(e){return function(e,t){if(e.classList)e.classList.add(t);else{var n,i;if(n=e,i=t,n.classList?!(!!i&&n.classList.contains(i)):-1===(" "+(n.className.baseVal||n.className)+" ").indexOf(" "+i+" "))"string"==typeof e.className?e.className=e.className+" "+t:e.setAttribute("class",(e.className&&e.className.baseVal||"")+" "+t)}}(i,e)})}},n.removeClasses=function(e,t){var n=this.appliedClasses[t],i=n.base,r=n.active,o=n.done;this.appliedClasses[t]={},i&&c(e,i),r&&c(e,r),o&&c(e,o)},n.render=function(){var e=this.props,t=(e.classNames,(0,r.Z)(e,["classNames"]));return s.createElement(u.ZP,(0,i.Z)({},t,{onEnter:this.onEnter,onEntered:this.onEntered,onEntering:this.onEntering,onExit:this.onExit,onExiting:this.onExiting,onExited:this.onExited}))},t}(s.Component);f.defaultProps={classNames:""},f.propTypes={};var d=f},357437:function(e,t,n){"use strict";n.d(t,{Ix:function(){return p},cn:function(){return h},d0:function(){return d}});var i=n(80415),r=n(196764),o=n(88648),a=n(309931),s=n(704002),u=n(392699),l=n(20642),c="unmounted",f="exited",d="entering",h="entered",p="exiting",v=function(e){function t(t,n){i=e.call(this,t,n)||this;var i,r,o=n&&!n.isMounting?t.enter:t.appear;return i.appearStatus=null,t.in?o?(r=f,i.appearStatus=d):r=h:r=t.unmountOnExit||t.mountOnEnter?c:f,i.state={status:r},i.nextCallback=null,i}(0,r.Z)(t,e),t.getDerivedStateFromProps=function(e,t){return e.in&&t.status===c?{status:f}:null};var n=t.prototype;return n.componentDidMount=function(){this.updateStatus(!0,this.appearStatus)},n.componentDidUpdate=function(e){var t=null;if(e!==this.props){var n=this.state.status;this.props.in?n!==d&&n!==h&&(t=d):(n===d||n===h)&&(t=p)}this.updateStatus(!1,t)},n.componentWillUnmount=function(){this.cancelNextCallback()},n.getTimeouts=function(){var e,t,n,i=this.props.timeout;return e=t=n=i,null!=i&&"number"!=typeof i&&(e=i.exit,t=i.enter,n=void 0!==i.appear?i.appear:t),{exit:e,enter:t,appear:n}},n.updateStatus=function(e,t){if(void 0===e&&(e=!1),null!==t){if(this.cancelNextCallback(),t===d){if(this.props.unmountOnExit||this.props.mountOnEnter){var n=this.props.nodeRef?this.props.nodeRef.current:a.findDOMNode(this);n&&(0,l.Q)(n)}this.performEnter(e)}else this.performExit()}else this.props.unmountOnExit&&this.state.status===f&&this.setState({status:c})},n.performEnter=function(e){var t=this,n=this.props.enter,i=this.context?this.context.isMounting:e,r=this.props.nodeRef?[i]:[a.findDOMNode(this),i],o=r[0],u=r[1],l=this.getTimeouts(),c=i?l.appear:l.enter;if(!e&&!n||s.Z.disabled){this.safeSetState({status:h},function(){t.props.onEntered(o)});return}this.props.onEnter(o,u),this.safeSetState({status:d},function(){t.props.onEntering(o,u),t.onTransitionEnd(c,function(){t.safeSetState({status:h},function(){t.props.onEntered(o,u)})})})},n.performExit=function(){var e=this,t=this.props.exit,n=this.getTimeouts(),i=this.props.nodeRef?void 0:a.findDOMNode(this);if(!t||s.Z.disabled){this.safeSetState({status:f},function(){e.props.onExited(i)});return}this.props.onExit(i),this.safeSetState({status:p},function(){e.props.onExiting(i),e.onTransitionEnd(n.exit,function(){e.safeSetState({status:f},function(){e.props.onExited(i)})})})},n.cancelNextCallback=function(){null!==this.nextCallback&&(this.nextCallback.cancel(),this.nextCallback=null)},n.safeSetState=function(e,t){t=this.setNextCallback(t),this.setState(e,t)},n.setNextCallback=function(e){var t=this,n=!0;return this.nextCallback=function(i){n&&(n=!1,t.nextCallback=null,e(i))},this.nextCallback.cancel=function(){n=!1},this.nextCallback},n.onTransitionEnd=function(e,t){this.setNextCallback(t);var n=this.props.nodeRef?this.props.nodeRef.current:a.findDOMNode(this),i=null==e&&!this.props.addEndListener;if(!n||i){setTimeout(this.nextCallback,0);return}if(this.props.addEndListener){var r=this.props.nodeRef?[this.nextCallback]:[n,this.nextCallback],o=r[0],s=r[1];this.props.addEndListener(o,s)}null!=e&&setTimeout(this.nextCallback,e)},n.render=function(){var e=this.state.status;if(e===c)return null;var t=this.props,n=t.children,r=(t.in,t.mountOnEnter,t.unmountOnExit,t.appear,t.enter,t.exit,t.timeout,t.addEndListener,t.onEnter,t.onEntering,t.onEntered,t.onExit,t.onExiting,t.onExited,t.nodeRef,(0,i.Z)(t,["children","in","mountOnEnter","unmountOnExit","appear","enter","exit","timeout","addEndListener","onEnter","onEntering","onEntered","onExit","onExiting","onExited","nodeRef"]));return o.createElement(u.Z.Provider,{value:null},"function"==typeof n?n(e,r):o.cloneElement(o.Children.only(n),r))},t}(o.Component);function y(){}v.contextType=u.Z,v.propTypes={},v.defaultProps={in:!1,mountOnEnter:!1,unmountOnExit:!1,appear:!1,enter:!0,exit:!0,onEnter:y,onEntering:y,onEntered:y,onExit:y,onExiting:y,onExited:y},v.UNMOUNTED=c,v.EXITED=f,v.ENTERING=d,v.ENTERED=h,v.EXITING=p,t.ZP=v},392699:function(e,t,n){"use strict";var i=n(88648);t.Z=i.createContext(null)},355649:function(e,t,n){"use strict";n.d(t,{ZP:function(){return el}});var i=n("734123"),r=n("515738"),o=n("598850");function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var u=new(function(){var e,t,n;function i(){var e=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i);try{var t=/xgd=(\d)/.exec(document.cookie);this._status=!!t,this._level=t&&t[1]}catch(e){this._status=!1}["group","groupEnd","log","warn","error","trace"].forEach(function(t){e[t]=function(n,i,r,o,s,u,l,c,f,d){if(e._status){var h,p,v=[i,r,o,s,u,l,c,f,d].filter(function(e){return void 0!==e});(h=console)[t].apply(h,["["+n+"]:"].concat(function(e){if(Array.isArray(e))return a(e)}(p=v)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(p)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}}(p)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))}}})}return e=i,t=[{key:"enable",get:function(){return this._status}},{key:"long",get:function(){return"2"===this._level}}],s(e.prototype,t),i}()),l=n("779148"),c=n("53673");function f(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var d=l.Z.REMUX_EVENTS,h=l.Z.PLAYER_EVENTS,p=function(){var e,t,n;function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),this.TAG="Mp4Remuxer",this._curTime=e,!this.remuxer&&this.initRemuxer()}return e=i,t=[{key:"init",value:function(){this.on(d.REMUX_MEDIA,this.remux.bind(this)),this.on(d.REMUX_METADATA,this.onMetaDataReady.bind(this)),this.on(d.DETECT_CHANGE_STREAM,this.resetDtsBase.bind(this)),this.on(d.DETECT_FRAG_ID_DISCONTINUE,this.seek.bind(this)),this.on(h.SEEK,this.seek.bind(this))}},{key:"initRemuxer",value:function(){this.remuxer=new c.Z({audioMeta:null,videoMeta:null,curTime:this._curTime}),this.remuxer.on(c.Z.EVENTS.MEDIA_SEGMENT,this.writeToSource.bind(this)),this.remuxer.on(c.Z.EVENTS.TRACK_REMUXED,this.onTrackRemuxed.bind(this))}},{key:"remux",value:function(){if(this.remuxer)try{!this.remuxer._videoMeta&&(this.remuxer._videoMeta=this.videoMeta,this.remuxer._audioMeta=this.audioMeta);var e=this._context.getInstance("TRACKS"),t=e.audioTrack,n=e.videoTrack;this.remuxer.remux(t,n)}catch(e){this.emit(d.REMUX_ERROR,this.TAG,e)}}},{key:"resetDtsBase",value:function(){this.remuxer&&this.remuxer.resetDtsBase()}},{key:"seek",value:function(e){this.remuxer&&this.remuxer.seek(e)}},{key:"onMetaDataReady",value:function(e,t){if(!this.remuxer&&this.initRemuxer(),"audio"===e){var n;n=this._context.getInstance("TRACKS").audioTrack}else n=this._context.getInstance("TRACKS").videoTrack;var i=this._context.getInstance("PRE_SOURCE_BUFFER"),r=i.getSource(e);!r&&(r=i.createSource(e)),r.mimetype=n.meta.codec,r.init=this.remuxer.remuxInitSegment(e,n.meta),t&&this.writeToSource(e,r.init,0),this.emit(d.INIT_SEGMENT,e)}},{key:"onTrackRemuxed",value:function(e){this.emit(d.MEDIA_SEGMENT,e)}},{key:"writeToSource",value:function(e,t,n){var i=this._context.getInstance("PRE_SOURCE_BUFFER"),r=i.getSource(e);!r&&(r=i.createSource(e)),r.data.push(t),n&&(r.bufferDuration=n+(r.bufferDuration||0))}},{key:"videoMeta",get:function(){return this._context.getInstance("TRACKS").videoTrack.meta}},{key:"audioMeta",get:function(){return this._context.getInstance("TRACKS").audioTrack.meta}},{key:"destroy",value:function(){this.remuxer&&this.remuxer.destroy(),this.remuxer=null}}],f(e.prototype,t),i}(),v=n("716152"),y=n("266427");function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var g=r.Z.MSE_EVENTS,_=function(){var e,t,n;function i(e,t){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),t&&(this._context=t,this.emit=t._emitter.emit.bind(t._emitter)),this.TAG="MSE",this.configs=Object.assign({},e),this.container=this.configs.container,this.format=this.configs.format,this.mediaSource=null,this.sourceBuffers={},this.preloadTime=this.configs.preloadTime||1,this.onSourceOpen=this.onSourceOpen.bind(this),this.onTimeUpdate=this.onTimeUpdate.bind(this),this.onUpdateEnd=this.onUpdateEnd.bind(this),this.onWaiting=this.onWaiting.bind(this),this.opened=!1,this.videoCodec=""}return e=i,t=[{key:"init",value:function(){this.mediaSource=new self.MediaSource,this.mediaSource.addEventListener("sourceopen",this.onSourceOpen),this._url=null,this.container.addEventListener("timeupdate",this.onTimeUpdate),this.container.addEventListener("waiting",this.onWaiting)}},{key:"resetContext",value:function(e,t){if(this._context=e,this.emit=e._emitter.emit.bind(e._emitter),!t)for(var n=0;n<Object.keys(this.sourceBuffers).length;n++){var r=this.sourceBuffers[Object.keys(this.sourceBuffers)[n]];!r.updating&&i.clearBuffer(r)}}},{key:"onTimeUpdate",value:function(){this.emit("TIME_UPDATE",this.container)}},{key:"onWaiting",value:function(){this.emit("WAITING",this.container)}},{key:"onSourceOpen",value:function(){this.opened=!0,this.addSourceBuffers()}},{key:"onUpdateEnd",value:function(){this.emit(g.SOURCE_UPDATE_END),this.doAppend()}},{key:"addSourceBuffers",value:function(){if(!this.mediaSource||"open"!==this.mediaSource.readyState||!this.opened)return;var e,t=this._context.getInstance("PRE_SOURCE_BUFFER"),n=this._context.getInstance("TRACKS");if(!!t&&!!n){t=t.sources;for(var i=!1,r=0,o=Object.keys(t).length;r<o;r++){var a=Object.keys(t)[r];i=!1,"audio"===a?e=n.audioTrack:"video"===a&&(e=n.videoTrack),e&&null!==t[a].init&&t[a].data.length&&(i=!0)}if(i){if(Object.keys(this.sourceBuffers).length>1)return;for(var s=0,l=Object.keys(t).length;s<l;s++){var c=Object.keys(t)[s];if(!this.sourceBuffers[c]){var f=t[c],d="video"===c?"video/mp4;codecs="+f.mimetype:"audio/mp4;codecs="+f.mimetype;try{u.log(this.TAG,"add sourcebuffer",d);var h=this.mediaSource.addSourceBuffer(d);this.sourceBuffers[c]=h,h.addEventListener("updateend",this.onUpdateEnd),"video"===c&&(this.videoCodec=f.mimetype)}catch(e){if(22===e.code&&Object.keys(this.sourceBuffers).length>0)return this.emit(g.MSE_WRONG_TRACK_ADD,c);this.emit(g.MSE_ERROR,this.TAG,Error(e.message))}}}Object.keys(this.sourceBuffers).length===this.sourceBufferLen&&this.doAppend()}}}},{key:"doAppend",value:function(){if(!!this.mediaSource&&"closed"!==this.mediaSource.readyState){try{this._doCleanupSourceBuffer()}catch(e){}var e=this._context.getInstance("PRE_SOURCE_BUFFER");if(e){if(Object.keys(this.sourceBuffers).length<this.sourceBufferLen)return;for(var t=0;t<Object.keys(this.sourceBuffers).length;t++){var n=Object.keys(this.sourceBuffers)[t],i=this.sourceBuffers[n];if(!i.updating){var r=e.sources[n];if(this["no".concat(n)]){r.data=[],r.init.buffer=null;continue}if(r&&!r.inited)try{i.appendBuffer(r.init.buffer.buffer),r.inited=!0}catch(e){}else if(r){var o=r.data.shift();if(o)try{i.appendBuffer(o.buffer.buffer)}catch(e){r.data.unshift(o)}}}}}}}},{key:"changeVideoCodecType",value:function(e){var t=this.sourceBuffers.video;if(null!=t&&t.updating)throw Error("source buffer in updating");t.changeType("video/mp4;codecs=".concat(e)),this.videoCodec=e}},{key:"endOfStream",value:function(){try{var e,t=this.mediaSource.readyState;"open"===t&&null!==(e=this.container)&&void 0!==e&&e.readyState&&this.mediaSource.endOfStream()}catch(e){}}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{for(var n=0;n<Object.keys(this.sourceBuffers).length;n++){var i=this.sourceBuffers[Object.keys(this.sourceBuffers)[n]];!i.updating&&e>t&&i.remove(t,e)}}catch(e){}}},{key:"_doCleanupSourceBuffer",value:function(){for(var e=this.container.currentTime,t={video:[],audio:[]},n=0;n<Object.keys(this.sourceBuffers).length;n++){for(var i=Object.keys(this.sourceBuffers)[n],r=this.sourceBuffers[i],o=r.buffered,a=!1,s=0;s<o.length;s++){var u=o.start(s),l=o.end(s);if(u<=e&&e<l+3){if(e-u>=180){a=!0;var c=e-180;t[i].push({start:u,end:c})}}else l<e&&e-u>=180&&(a=!0,t[i].push({start:u,end:l}))}a&&!r.updating&&this._doRemoveRanges(t)}}},{key:"_doRemoveRanges",value:function(e){for(var t in e){if(!!this.sourceBuffers[t]&&!this.sourceBuffers[t].updating)for(var n=this.sourceBuffers[t],i=e[t];i.length&&!n.updating;){var r=i.shift();try{r&&r.end>r.start&&n.remove(r.start,r.end)}catch(e){}}}}},{key:"cleanBuffers",value:function(){for(var e=this,t=[],n=0;n<Object.keys(this.sourceBuffers).length;n++)!function(n){var r=e.sourceBuffers[Object.keys(e.sourceBuffers)[n]],o=void 0;o=r.updating?new Promise(function(e){r.addEventListener("updateend",function t(){var n=3;setTimeout(function t(){r.updating?n>0?(setTimeout(t,200),n--):e():(i.clearBuffer(r),r.addEventListener("updateend",function(){e()}))},200),r.removeEventListener("updateend",t)})}):new Promise(function(e){if(!r.buffered.length){e();return}i.clearBuffer(r),r.addEventListener("updateend",function(){e()})}).catch(function(){}),t.push(o)}(n);return Promise.all(t)}},{key:"removeBuffers",value:function(){for(var e=this,t=[],n=0;n<Object.keys(this.sourceBuffers).length;n++)!function(n){var r=e.sourceBuffers[Object.keys(e.sourceBuffers)[n]];r.removeEventListener("updateend",e.onUpdateEnd);var o=void 0;o=r.updating?new Promise(function(e){r.addEventListener("updateend",function t(){var n=3;setTimeout(function t(){r.updating?n>0?(setTimeout(t,200),n--):e():(i.clearBuffer(r),r.addEventListener("updateend",function(){e()}))},200),r.removeEventListener("updateend",t)})}):new Promise(function(e){if(!r.buffered.length){e();return}i.clearBuffer(r),r.addEventListener("updateend",function(){e()})}).catch(function(){}),t.push(o)}(n);return Promise.all(t)}},{key:"destroy",value:function(){var e=this;return this.container?(this.container.removeEventListener("timeupdate",this.onTimeUpdate),this.container.removeEventListener("waiting",this.onWaiting),this.mediaSource.removeEventListener("sourceopen",this.onSourceOpen),this.removeBuffers().then(function(){for(var t=Object.keys(e.sourceBuffers),n=0;n<t.length;n++){var i=e.sourceBuffers[t[n]];delete e.sourceBuffers[t[n]],"open"===e.mediaSource.readyState&&e.mediaSource.removeSourceBuffer(i)}e.endOfStream();try{window.URL.revokeObjectURL(e.url)}catch(e){}e.url=null,e.configs={},e.container=null,e.mediaSource=null,e.sourceBuffers={},e.preloadTime=1,e.onSourceOpen=null,e.onTimeUpdate=null,e.onUpdateEnd=null,e.onWaiting=null,e.noaudio=void 0,e.novideo=void 0})):Promise.resolve()}},{key:"sourceBufferLen",get:function(){if(!this._context.mediaInfo)return this.noaudio||this.novideo?1:2;return(!!this._context.mediaInfo.hasVideo&&!this.novideo)+(!!this._context.mediaInfo.hasAudio&&!this.noaudio)}},{key:"url",get:function(){if(!this._url)try{this._url=window.URL.createObjectURL(this.mediaSource)}catch(e){}return this._url},set:function(e){this._url=e}}],n=[{key:"clearBuffer",value:function(e){try{for(var t=e.buffered,n=.1,i=0,r=t.length;i<r;i++)n=t.end(i);e.remove(0,n)}catch(e){}}}],t&&m(e.prototype,t),n&&m(e,n),i}(),b=n("967989");function E(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function S(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var w=function e(){S(this,e),this.mimetype="",this.init=null,this.data=[],this.bufferDuration=0},k=function(){var e,t,n;function i(){S(this,i),this.sources={}}return e=i,t=[{key:"getSource",value:function(e){return this.sources[e]}},{key:"createSource",value:function(e){return this.sources[e]=new w,this.sources[e]}},{key:"clear",value:function(){this.sources={}}},{key:"destroy",value:function(){this.clear()}}],E(e.prototype,t),i}(),T=n("809553"),C=n("721032");function O(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var A=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=i,t=null,n=[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);else if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);else if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);else if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);else if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);else if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}],n&&O(e,n),i}();function R(e){return function(e){if(Array.isArray(e))return P(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return P(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return P(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function P(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function D(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var x=l.Z.REMUX_EVENTS,L=function(){var e,t,n;function i(){var e=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),this.TAG="Compatibility",this.nextAudioDts=0,this.nextVideoDts=0,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.allAudioSamplesCount=0,this.allVideoSamplesCount=0,this._firstAudioSample=null,this._firstVideoSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.videoLastSample=null,this.audioLastSample=null,Object.defineProperties(this,{_videoLargeGap:{set:function(t){e.___videoLargeGap=t,Math.abs(t)>100&&e.emit(x.DETECT_LARGE_GAP,"video",t)},get:function(){return e.___videoLargeGap||0}},_audioLargeGap:{set:function(t){e.___audioLargeGap=t,Math.abs(t)>100&&e.emit(x.DETECT_LARGE_GAP,"audio",t)},get:function(){return e.___audioLargeGap||0}}}),this.audioUnsyncTime=0}return e=i,t=[{key:"init",value:function(){this.before(x.REMUX_MEDIA,this.doFix.bind(this))}},{key:"reset",value:function(){this.nextAudioDts=null,this.nextVideoDts=null,this.lastAudioSamplesLen=0,this.lastVideoSamplesLen=0,this.lastVideoDts=void 0,this.lastAudioDts=void 0,this.lastVideoDuration=void 0,this._audioLargeGap=0,this._videoLargeGap=0,this.videoLastSample=null,this.audioLastSample=null,this.filledAudioSamples=[],this.filledVideoSamples=[],this.audioUnsyncTime=0}},{key:"doFix",value:function(){var e=this.getFirstSample(),t=e.isFirstAudioSamples,n=e.isFirstVideoSamples;this.recordSamplesCount(),this._firstVideoSample&&this.fixVideoRefSampleDuration(this.videoTrack.meta,this.videoTrack.samples);var r=i.detectChangeStream(this.videoTrack.samples,n),o=r.changed,a=r.changedIdxes;if(o){for(var s=!1,u=0;u<a.length;u++)this.fixChangeStreamVideo(a[u],n)&&(s=!0);!s&&this.doFixVideo(n)}else this.doFixVideo(n);var l=i.detectChangeStream(this.audioTrack.samples,t),c=l.changed,f=l.changedIdxes;if(c){for(var d=!1,h=0;h<f.length;h++)this.fixChangeStreamAudio(f[h],t)&&(d=!0);if(d)return;this.doFixAudio(t)}else this.doFixAudio(t);this.removeInvalidSamples()}},{key:"doFixVideo",value:function(e,t){for(var n=this.videoTrack,r=n.samples,o=n.meta,a=r.length,s=0;s<a;s++){var u=r[s];u.originDts=u.dts,u.originPts=u.pts}if(!!r&&!!a&&!!this._firstVideoSample){var l=r[0];if(C.Z.log(this.TAG,"doFixVideo:: lastVideoDts: ".concat(this.lastVideoDts," ,  _videoLargeGap: ").concat(this._videoLargeGap," ,streamChangeStart:").concat(t,", lastVideoSample:[dts=").concat(this.videoLastSample&&this.videoLastSample.dts," , pts=").concat(this.videoLastSample&&this.videoLastSample.pts,"] ,  firstDTS:").concat(l.dts," ,cts:").concat(l.cts," firstPTS:").concat(l.pts," ,lastDTS:").concat(r[a-1].dts," , lastPTS: ").concat(r[a-1].pts)),!e&&null===this.videoLastSample&&l.options&&l.options.start&&void 0!==t&&(t=l.options.start),!e&&void 0===t&&this.videoLastSample&&i.detectVideoLargeGap(this.videoLastSample?this.videoLastSample.dts:0,l.dts+this._videoLargeGap)){var c=this.audioLastSample;!(c&&100>Math.abs(c.originDts-l.originDts))&&(this._videoLargeGap=this.videoLastSample.dts+o.refSampleDuration-l.dts)}if(0!==this._videoLargeGap&&(i.doFixLargeGap(r,this._videoLargeGap),this._videoLargeGap!==this.preVideoGap&&(this.preVideoGap=this._videoLargeGap,this.emit(x.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:this.videoLastSample&&this.videoLastSample.originDts,curDts:l.originDts,duration:o.refSampleDuration}))),!e&&void 0!==t&&(this._videoLargeGap=t-l.dts,i.doFixLargeGap(r,this._videoLargeGap)),e&&this._firstAudioSample){var f=this._firstVideoSample.originDts,d=f-(this._firstAudioSample.originDts||this._firstAudioSample.dts);if(d>2*o.refSampleDuration&&d<10*o.refSampleDuration){for(var h=Math.floor(d/o.refSampleDuration),p=0;p<h;p++){var v=Object.assign({},l);v.dts=f-(p+1)*o.refSampleDuration,v.pts=v.dts+v.cts,r.unshift(v),this.filledVideoSamples.push({dts:v.dts,size:v.data.byteLength})}this._firstVideoSample=this.filledVideoSamples[0]||this._firstVideoSample}else Math.abs(d)>2*o.refSampleDuration&&!this._videoLargeGap&&(this._videoLargeGap=-1*d,i.doFixLargeGap(r,-1*d))}var y=r.pop();if(r.length&&(r[r.length-1].duration=y.dts-r[r.length-1].dts),this.videoLastSample){var m=this.videoLastSample;m.duration=l.dts-m.dts,r.unshift(this.videoLastSample)}this.videoLastSample=y,r[r.length-1]&&(this.lastVideoDuration=r[r.length-1].duration,this.lastVideoDts=r[r.length-1].dts),this.videoTrack.samples=r}}},{key:"doFixAudio",value:function(e,t){var n,r=this,o=this.audioTrack,a=o.samples,s=o.meta;if(!!a&&!!a.length){this.fixAudioRefSampleDuration(s);for(var u=0,l=a.length;u<l;u++){var c=a[u];c.originDts=c.dts}var f=a.length,d=A.getSilentFrame(s.codec,s.channelCount),h=Math.floor(s.refSampleDuration),p=this._firstAudioSample,v=a[0];if(C.Z.log(this.TAG,"doFixAudio:: audioDtsBase:".concat(this.audioDtsBase," ,  _audioLargeGap: ").concat(this._audioLargeGap,", streamChangeStart:").concat(t," ,  nextAudioDts:").concat(this.nextAudioDts,",  audio: firstDTS:").concat(v.dts," ,firstPTS:").concat(v.pts," ,lastDTS:").concat(a[f-1].dts," , lastPTS: ").concat(a[f-1].pts)),!e&&null===this.nextAudioDts&&v.options&&v.options.start&&void 0!==t&&(t=v.options.start),!e&&void 0===t&&this.nextAudioDts&&i.detectAudioLargeGap(this.nextAudioDts||0,v.dts+this._audioLargeGap)){var y=this.videoLastSample;if(y&&150>Math.abs(y.originDts-this.nextAudioDts))this.nextAudioDts=v.dts;else if(Math.abs(this._videoLargeGap)>5e3){var m=this.nextAudioDts-v.dts;this._audioLargeGap=200>Math.abs(m-this._videoLargeGap)?this._videoLargeGap:m}else this.nextAudioDts=p.dts,this._audioLargeGap=1}if(0!==this._audioLargeGap?(i.doFixLargeGap(a,this._audioLargeGap),this._audioLargeGap!==this.preAudioGap&&(this.preAudioGap=this._audioLargeGap,this.emit(x.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:this.lastAudioOriginDts,curDts:v.originDts,duration:h}))):!e&&(void 0!==t||i.detectAudioLargeGap(this.nextAudioDts,v.dts))&&(void 0!==t&&(this.nextAudioDts=t),this._audioLargeGap=this.nextAudioDts-v.dts,v.options.start&&!v.options.start.isContinue&&i.doFixLargeGap(a,this._audioLargeGap)),this._firstVideoSample&&e){var g=this._firstVideoSample.originDts||this._firstVideoSample.dts,_=p.dts-g;if(_===this._videoLargeGap);else if(d&&_>s.refSampleDuration&&_<10*s.refSampleDuration){for(var b=Math.floor((p.dts-g)/s.refSampleDuration),E=0;E<b;E++){var S={data:d,datasize:d.byteLength,dts:p.dts-(E+1)*s.refSampleDuration,filtered:0};a.unshift(S),this.filledAudioSamples.push({dts:S.dts,size:S.data.byteLength})}this._firstAudioSample=this.filledAudioSamples[0]||this._firstAudioSample}else _<-1*s.refSampleDuration&&(this._audioLargeGap=-1*_,i.doFixLargeGap(a,-1*_))}var w=a[0].dts;if(this.nextAudioDts){var k=Math.abs(n=w-this.nextAudioDts);if(n>=h&&n<1e4&&d){for(var T=Math.ceil(n/h),O=0;O<T;O++){var R=w-(O+1)*h,P={dts:R>this.nextAudioDts?R:this.nextAudioDts,pts:R>this.nextAudioDts?R:this.nextAudioDts,datasize:d.byteLength,filtered:0,data:d};this.filledAudioSamples.push({dts:P.dts,size:P.data.byteLength}),this.audioTrack.samples.unshift(P),v=P}this.emit(x.DETECT_AUDIO_GAP,n,T)}else k<s.refSampleDuration&&k>0?(v.dts=this.nextAudioDts,v.pts=this.nextAudioDts):n<0&&k<h&&(i.doFixLargeGap(a,-1*n),this.emit(x.DETECT_AUDIO_OVERLAP,n))}for(var D=a[0].dts+h,L=1;L<a.length;){var I=a[L],M=I.dts-D;if(M<=-1*h){C.Z.warn("drop 1 audio sample for ".concat(M," ms overlap")),a.splice(L,1);continue}if(d&&M>=10*h){var B=Math.round(M/h);if(B>1e3)break;C.Z.warn(this.TAG,"inject ".concat(B," audio frame for ").concat(M," ms gap"));for(var U=0;U<B;U++){var N={data:d,datasize:d.byteLength,dts:D,originDts:D,filtered:0};a.splice(L,0,N),D+=h,L++}I.dts=I.pts=I.originDts=D,D+=h,L++}else I.dts=I.pts=I.originDts=D,D+=h,L++}var F=s.refSampleDuration-h;a.forEach(function(e,t){if(0!==t){var n=a[t-1];e.dts=e.pts=n.dts+n.duration}e.duration=h,r.audioUnsyncTime=r.audioUnsyncTime+F,r.audioUnsyncTime>=1&&(e.duration+=1,r.audioUnsyncTime-=1)});var V=a[a.length-1];this.lastAudioDts=V.dts;var j=V.duration;this.lastAudioSamplesLen=f,this.nextAudioDts=this.lastAudioDts+(j||h),this.lastAudioOriginDts=V.originDts,this.audioTrack.samples=i.sortAudioSamples(a),this.audioLastSample=V}}},{key:"fixChangeStreamVideo",value:function(e){C.Z.log(this.TAG,"fixChangeStreamVideo(), changeIdx=",e);var t,n=this.videoTrack,i=n.samples,r=n.meta,o=0===e&&this.lastVideoDuration?this.lastVideoDuration:r.refSampleDuration,a=0===e?this.lastVideoDts?this.lastVideoDts:this.getStreamChangeStart(i[0]):i[e-1].dts,s=i[e].dts,u=1e4>=Math.abs(a-s);if(this.emit(x.DETECT_CHANGE_STREAM,"video",s),u)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},!1;this.emit(x.DETECT_CHANGE_STREAM_DISCONTINUE,"video",{prevDts:a,curDts:s,duration:o});var l=i.slice(0,e),c=i.slice(e),f=i[e];return this._videoLargeGap=0,this.videoLastSample=null,this.lastVideoDts=null,this.lastVideoDuration=null,t=f.options&&void 0!==f.options.start?f.options.start:a-this.videoDtsBase,this.videoTrack.samples=i.slice(0,e),this.doFixVideo(!1),this.videoTrack.samples=i.slice(e),this.doFixVideo(!1,t),this.videoTrack.samples=l.concat(c),!0}},{key:"fixChangeStreamAudio",value:function(e){C.Z.log(this.TAG,"fixChangeStreamAudio(), changeIdx=",e);var t,n=this.audioTrack,i=n.samples,r=n.meta,o=0===e?this.lastAudioDts:i[e-1].dts,a=i[e].dts,s=1e4>=Math.abs(o-a);if(this.emit(x.DETECT_CHANGE_STREAM,"audio",a),s)return i[e].options?i[e].options.isContinue=!0:i[e].options={isContinue:!0},!1;this.emit(x.DETECT_CHANGE_STREAM_DISCONTINUE,"audio",{prevDts:o,curDts:a,duration:r.refSampleDuration}),this._audioLargeGap=0;var u=this.nextAudioDts;this.nextAudioDts=null;var l=i.slice(0,e),c=i.slice(e),f=i[e];return f.options&&void 0!==f.options.start?t=f.options.start:(t=u,f.options.isContinue=!0),this.audioTrack.samples=l,this.doFixAudio(!1),this.audioTrack.samples=c,this.doFixAudio(!1,t),this.audioTrack.samples=l.concat(c),!0}},{key:"getFirstSample",value:function(){var e=this.videoTrack.samples,t=this.audioTrack.samples,n=!1,r=!1;return!this._firstVideoSample&&e.length&&(this._firstVideoSample=i.findFirstVideoSample(e),this.removeInvalidSamples(),n=!0),!this._firstAudioSample&&t.length&&(this._firstAudioSample=i.findFirstAudioSample(t),this.removeInvalidSamples(),r=!0),{isFirstVideoSamples:n,isFirstAudioSamples:r}}},{key:"fixVideoRefSampleDuration",value:function(e,t){if(!!e){var n=this.allVideoSamplesCount,r=this._firstVideoSample.dts,o=this.filledVideoSamples.length;if(i.isRefSampleDurationValid(e.refSampleDuration)){if(e.refSampleDuration&&t.length>=5){var a=(t[t.length-1].dts-t[0].dts)/(t.length-1);if(a>0&&a<1e3){var s=Math.floor(5>=Math.abs(e.refSampleDuration-a)?e.refSampleDuration:a);i.isRefSampleDurationValid(s)&&(e.refSampleDuration=s)}}}else if(t.length>=1){var u=t[t.length-1].dts;if(Math.abs(u-r)<100*t.length){var l=Math.floor((u-r)/(n+o-1));i.isRefSampleDurationValid(l)&&(e.refSampleDuration=l)}}!i.isRefSampleDurationValid(e.refSampleDuration)&&(e.refSampleDuration=66)}}},{key:"fixAudioRefSampleDuration",value:function(e){if(!!e)e.refSampleDuration=1024*e.timescale/e.sampleRate}},{key:"recordSamplesCount",value:function(){var e=this.audioTrack,t=this.videoTrack;this.allAudioSamplesCount+=e.samples.length,this.allVideoSamplesCount+=t.samples.length}},{key:"removeInvalidSamples",value:function(){var e=this.audioTrack.samples[0],t=this.videoTrack.samples[0];e&&(this.audioTrack.samples=this.audioTrack.samples.filter(function(t,n){return t===e||t.dts>=e.dts})),t&&(this.videoTrack.samples=this.videoTrack.samples.filter(function(e,n){return e===t||e.dts>=t.dts}))}},{key:"getStreamChangeStart",value:function(e){return e.options&&e.options.start?e.options.start-this.dtsBase:1/0}},{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"audioTrack",get:function(){return this.tracks&&this.tracks.audioTrack?this.tracks.audioTrack:{samples:[],meta:{}}}},{key:"videoTrack",get:function(){return this.tracks&&this.tracks.videoTrack?this.tracks.videoTrack:{samples:[],meta:{}}}},{key:"dtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e?e._dtsBase:0}},{key:"audioDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._audioDtsBase?e._audioDtsBase:this.dtsBase}},{key:"videoDtsBase",get:function(){var e=this._context.getInstance("MP4_REMUXER");return e&&null!==e._videoDtsBase?e._videoDtsBase:this.dtsBase}}],n=[{key:"sortAudioSamples",value:function(e){return 1===e.length?e:R(e).sort(function(e,t){return e.dts-t.dts})}},{key:"isRefSampleDurationValid",value:function(e){return e&&e>0&&!Number.isNaN(e)}},{key:"findFirstAudioSample",value:function(e){return e&&0!==e.length?i.sortAudioSamples(e)[0]:null}},{key:"findFirstVideoSample",value:function(e){if(!e.length)return null;for(var t=R(e).sort(function(e,t){return e.dts-t.dts}),n=0,i=t.length;n<i;n++)if(t[n].isKeyframe)return t[n]}},{key:"detectVideoLargeGap",value:function(e,t){if(null!==e)return e-t>=1e4||t-e>=1e4}},{key:"detectAudioLargeGap",value:function(e,t){if(null!==e)return e-t>=1e3||t-e>=1e3}},{key:"doFixLargeGap",value:function(e,t){for(var n=0,i=e.length;n<i;n++){var r=e[n];r.dts+=t,r.pts&&(r.pts+=t)}}},{key:"detectChangeStream",value:function(e,t){for(var n=!1,i=[],r=0,o=e.length;r<o;r++){var a=e[r];a.options&&a.options.meta&&!(t&&0===r)&&(n=!0,i.push(r))}return{changed:n,changedIdxes:i}}}],t&&D(e.prototype,t),n&&D(e,n),i}();function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var M=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=i,t=[{key:"warn",value:function(){}}],I(e.prototype,t),i}(),B={LOADRETRY:"retry",TTFB:"ttfb",METADATA:"metadataparsed",KEYFRAME:"isKeyframe",SEI:"SEI_PARSED",CHASE_FRAME:"chaseframe",STREAM_DISCONTINUE:"streamdiscontinue",AUDIO_TIMESTAMP_BREAKED:"audiotimestampbreaked"},U={Remuxer:p,FlvDemuxer:v.Z,FetchLoader:y.Z,Tracks:b.ZP,RemuxedBufferManager:k,XgBuffer:T.Z,Compatibility:L,Mse:_,Logger:M};function N(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var V=function(){var e,t,n;function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),F(this,"_seiQueue",[]),F(this,"_baseDts",1/0),F(this,"_timer",0),F(this,"_checkEmitSEI",function(){if(!t._player){clearInterval(t._timer);return}var e=(null===(a=t._player)||void 0===a?void 0:a.currentTime)||0;if(!!e){for(var n=-1,i=0,r=t._seiQueue.length;i<r;i++){var o=t._seiQueue[i];if((null==o?void 0:o.time)>e){n=i;break}}if(!(n<0)){t._seiQueue.splice(0,n);for(var a,s,u,l=t._seiQueue[0];l;){;if(!l)break;if((null===(s=l)||void 0===s?void 0:s.time)-e>=.05)break;t._seiQueue.shift(),null===(u=t._player)||void 0===u||u.emit(B.SEI,l.data),l=t._seiQueue[0]}}}}),this._player=e}return e=i,t=[{key:"updateBaseDts",value:function(e){this._baseDts=e||1/0,this._bootCheckEmitSEI()}},{key:"append",value:function(e){(this._baseDts===1/0||0===this._baseDts)&&(this._baseDts=e.dts);var t,n=this._baseDts===1/0?0:(e.dts-this._baseDts)/1e3;if(n<2){null===(t=this._player)||void 0===t||t.emit(B.SEI,e);return}this._seiQueue.push({time:n,data:e})}},{key:"_bootCheckEmitSEI",value:function(){this._timer&&clearInterval(this._timer),this._timer=setInterval(this._checkEmitSEI,25)}},{key:"destroy",value:function(){clearInterval(this._timer),this._player=null,this._seiQueue=[]}}],N(e.prototype,t),i}();function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Z=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),H(this,"_ttfb",0),H(this,"_demuxCost",0),H(this,"_remuxCost",0),H(this,"_appendBufferCost",0),H(this,"_demuxQueue",[]),H(this,"_demuxEndQueue",[]),H(this,"_remuxerQueue",[]),H(this,"_bufferAppendQueue",[])}return e=i,t=[{key:"addTTFB",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._ttfb=e}},{key:"addDemuxStart",value:function(){this._demuxQueue.push(Date.now()),this._demuxEndQueue.pop()}},{key:"addDemuxEnd",value:function(){this._demuxEndQueue.push(Date.now())}},{key:"addBufferAppendStart",value:function(){this._bufferAppendQueue.push(Date.now())}},{key:"accumulateDemuxCost",value:function(){var e=this._demuxQueue.pop();e&&(this._demuxCost+=Date.now()-e)}},{key:"accumulateRemuxCost",value:function(){var e=this._demuxEndQueue.pop();e&&(this._remuxCost+=Date.now()-e)}},{key:"accumulateBufferAppendCost",value:function(){var e=this._bufferAppendQueue.shift();e&&(this._appendBufferCost+=Date.now()-e,this._bufferAppendQueue=[])}},{key:"getStats",value:function(){return{ttfbCost:this._ttfb,demuxCost:this._demuxCost,remuxCost:this._remuxCost,appendCost:this._appendBufferCost}}}],j(e.prototype,t),i}();function G(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W=function(){var e,t,n;function i(e){var t=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),K(this,"_waitingCount",0),K(this,"_stallTime",0),K(this,"_renderFps",0),K(this,"_core",null),K(this,"_totalFrame",0),K(this,"_lastCreationTime",0),K(this,"_lastTimeupdate",0),K(this,"_stallDot",0),K(this,"_onWaiting",function(){t._waitingCount+=1,t._renderFps=0,t._stallDot=Date.now()}),K(this,"_onPause",function(){t._renderFps=0}),K(this,"_onPlaying",function(){t._stallDot&&(t._stallTime+=Date.now()-t._stallDot,t._stallDot=0)}),K(this,"_onTimeupdate",function(){!t._lastTimeupdate&&(t._lastTimeupdate=Date.now());var e=Date.now();e-t._lastTimeupdate>1e3&&(t._renderFps=t._getVideoRenderFps(),t._lastTimeupdate=e)}),this._core=e,this._bindEvents()}return e=i,t=[{key:"fps",get:function(){var e,t,n,i=null===(e=this._core)||void 0===e?void 0:null===(t=e.videoMeta)||void 0===t?void 0:t.frameRate;return i?i.fps<100?i.fps:Math.round(1e3/(null===(n=this._core)||void 0===n?void 0:n.videoMeta.refSampleDuration)):0}},{key:"getStats",value:function(){return{waitingCount:this._waitingCount,stallTime:this._stallTime,renderFps:this._renderFps,fps:this.fps}}},{key:"_bindEvents",value:function(){var e,t,n,i,r,o,a,s;null===(e=this._core)||void 0===e||null===(t=e._player)||void 0===t||t.on("waiting",this._onWaiting),null===(n=this._core)||void 0===n||null===(i=n._player)||void 0===i||i.on("playing",this._onPlaying),null===(r=this._core)||void 0===r||null===(o=r._player)||void 0===o||o.on("pause",this._onPause),null===(a=this._core)||void 0===a||null===(s=a._player)||void 0===s||s.on("timeupdate",this._onTimeupdate)}},{key:"_getVideoRenderFps",value:function(){var e,t,n=null===(e=this._core)||void 0===e?void 0:null===(t=e._player)||void 0===t?void 0:t.video;if(!n||!n.getVideoPlaybackQuality||4!==n.readyState||n.paused)return 0;var i=n.getVideoPlaybackQuality(),r=i.creationTime,o=i.totalVideoFrames,a=Math.round((o-this._totalFrame)/(r-this._lastCreationTime)*1e3);return this._totalFrame=o,this._lastCreationTime=r,a}},{key:"destroy",value:function(){var e,t,n,i,r,o,a,s;null===(e=this._core)||void 0===e||null===(t=e._player)||void 0===t||t.off("waiting",this._onWaiting),null===(n=this._core)||void 0===n||null===(i=n._player)||void 0===i||i.off("pause",this._onPause),null===(r=this._core)||void 0===r||null===(o=r._player)||void 0===o||o.off("playing",this._onPlaying),null===(a=this._core)||void 0===a||null===(s=a._player)||void 0===s||s.off("timeupdate",this._onTimeupdate),this._core=null,this._waitingCount=0,this._stallTime=0}}],G(e.prototype,t),i}();function z(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var X=r.Z.REMUX_EVENTS,q=r.Z.DEMUX_EVENTS,Q=r.Z.LOADER_EVENTS,$=r.Z.MSE_EVENTS,J=function(){var e,t,n;function i(e,t){var n=this;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),Y(this,"_transCostAnalyse",new Z),Y(this,"_inSwitching",!1),Y(this,"_handleMetadataChanged",function(e){var t;u.log("metadata changed, type=",e),n.emit(X.REMUX_METADATA,e,!0),null===(t=n._player)||void 0===t||t.emit(B.METADATA,e,n.tracks["".concat(e,"Track")].meta)}),this.TAG="FLVController",this.state={initSegmentArrived:!1,randomAccessPoints:[]},this.bufferClearTimer=null,this._handleTimeUpdate=this._handleTimeUpdate.bind(this),this._handleKeyFrame=this._handleKeyFrame.bind(this),this.mse=e,this.configs=t||{},this._endedStatus=null,this._ttfbEmit=!1,this._playStartTime=0,this._mseInChangeCodecError=!1,this._streamBreaked={audio:!1,video:!1,emited:!1}}return e=i,t=[{key:"tracks",get:function(){return this._context.getInstance("TRACKS")}},{key:"preSourceBufer",get:function(){var e,t;return null===(e=this._context)||void 0===e?void 0:null===(t=e.getInstance("PRE_SOURCE_BUFFER"))||void 0===t?void 0:t.sources}},{key:"videoMeta",get:function(){var e,t;return null===(e=this.tracks)||void 0===e?void 0:null===(t=e.videoTrack)||void 0===t?void 0:t.meta}},{key:"endedStatus",get:function(){return this._endedStatus}},{key:"transferCost",get:function(){return this._transCostAnalyse.getStats()}},{key:"stableStats",get:function(){var e;return null===(e=this._stableStats)||void 0===e?void 0:e.getStats()}},{key:"loader",get:function(){return this._context.getInstance("FETCH_LOADER")}},{key:"init",value:function(){if(!this.mse){var e=this._pluginConfig.Mse;this.mse=new e({container:this._player.video},this._context),this.mse.init()}this._pluginConfig.seiOnDemand&&"undefined"!=typeof requestAnimationFrame&&(this._seiOnDemand=new V(this._player)),this._stableStats=new W(this),this.initComponents(),this.initListeners()}},{key:"initComponents",value:function(){var e=this._pluginConfig,t=e.FetchLoader,n=e.XgBuffer,i=e.FlvDemuxer,r=e.Tracks,o=e.Remuxer,a=e.RemuxedBufferManager,s=e.Compatibility,u=e.Logger,l=this.configs.remux;if(!this._pluginConfig.preloader&&(this._context.registry("FETCH_LOADER",t),this._context.registry("LOADER_BUFFER",n)),this._context.registry("FLV_DEMUXER",i)({onlyVideo:this._pluginConfig.onlyVideo&&!this._pluginConfig.seamlesslyReload,onlyAudio:this._pluginConfig.onlyAudio&&!this._pluginConfig.seamlesslyReload,keyStr:this._pluginConfig.keyStr}),this._context.registry("TRACKS",r),l){var c,f=this._context.registry("MP4_REMUXER",o)(this._player.currentTime).remuxer;Object.keys(l).forEach(function(e){f[e]=l[e]}),null===(c=this._seiOnDemand)||void 0===c||c.updateBaseDts(l._videoDtsBase)}else this._context.registry("MP4_REMUXER",o)();this._context.registry("PRE_SOURCE_BUFFER",a),this._context.registry("COMPATIBILITY",s),this._context.registry("LOGGER",u)}},{key:"initListeners",value:function(){var e=this;this.on(Q.LOADER_DATALOADED,this._handleLoaderDataLoaded.bind(this)),this.on(Q.LOADER_ERROR,this._handleNetworkError.bind(this)),this.on(Q.LOADER_RETRY,this._handleFetchRetry.bind(this)),this.on(Q.LOADER_TTFB,this._handleTTFB.bind(this)),this.once(Q.LOADER_COMPLETE,this._handleLoadComplete.bind(this)),this.on(q.MEDIA_INFO,this._handleMediaInfo.bind(this)),this.on(q.METADATA_PARSED,this._handleMetadataParsed.bind(this)),this.on(q.VIDEO_METADATA_CHANGE,this._handleMetadataChanged),this.on(q.AUDIO_METADATA_CHANGE,this._handleMetadataChanged),this.on(q.DEMUX_COMPLETE,this._handleDemuxComplete.bind(this)),this.on(q.DEMUX_ERROR,this._handleDemuxError.bind(this)),this.on(q.SEI_PARSED,this._handleSEIParsed.bind(this)),this.on(X.INIT_SEGMENT,this._handleAppendInitSegment.bind(this)),this.on(X.MEDIA_SEGMENT,this._handleMediaSegment.bind(this)),this.on(X.RANDOM_ACCESS_POINT,this._handleAddRAP.bind(this)),this.on(X.REMUX_ERROR,this._handleRemuxError.bind(this)),this.on(X.DETECT_LARGE_GAP,this._detectLargeGap.bind(this)),this.on($.SOURCE_UPDATE_END,this._handleSourceUpdateEnd.bind(this)),this.on($.MSE_ERROR,this._handleMseError.bind(this)),this.on(q.ISKEYFRAME,this._handleKeyFrame),!this.configs.remux&&this.once(q.ISKEYFRAME,function(t,n){var i;null===(i=e._seiOnDemand)||void 0===i||i.updateBaseDts(t-n)}),this._player.on("timeupdate",this._handleTimeUpdate)}},{key:"_handleMediaInfo",value:function(){!this._context.mediaInfo&&this.emit(q.DEMUX_ERROR,Error("failed to get mediainfo"))}},{key:"_handleKeyFrame",value:function(e){var t;null===(t=this._player)||void 0===t||t.emit(B.KEYFRAME,e);try{if(!(null!==(n=this._player)&&void 0!==n&&null!==(i=n.video)&&void 0!==i&&i.paused)||"visible"!==document.visibilityState)return;var n,i,r,o,a,s,u,l,c=null===(r=this._player)||void 0===r?void 0:null===(o=r.video)||void 0===o?void 0:o.buffered,f=c&&c.length,d=f&&c.end(f-1);if(d&&d-(null===(a=this._player)||void 0===a?void 0:a.currentTime)>this.configs.disconnectTime){this.pause();return}(null===(s=this.preSourceBufer)||void 0===s?void 0:null===(u=s.video)||void 0===u?void 0:null===(l=u.data)||void 0===l?void 0:l.length)>100&&this.pause()}catch(e){}}},{key:"_handleTTFB",value:function(e){var t,n,i,r;this._ttfbEmit=!0,this._playStartTime=(null===(t=this._player)||void 0===t?void 0:null===(n=t.video)||void 0===n?void 0:n.currentTime)||0,null===(i=this._transCostAnalyse)||void 0===i||i.addTTFB(null==e?void 0:e.elapsed),null===(r=this._player)||void 0===r||r.emit(B.TTFB,e)}},{key:"_handleLoaderDataLoaded",value:function(){var e;if(!this._ttfbEmit){this._ttfbEmit=!0;var t,n,i=this.loader,r=i&&i.ttfbInfo;r&&(null===(t=this._transCostAnalyse)||void 0===t||t.addTTFB(r.elapsed),null===(n=this._player)||void 0===n||n.emit(B.TTFB,r))}null===(e=this._transCostAnalyse)||void 0===e||e.addDemuxStart(),this.emitTo("FLV_DEMUXER",q.DEMUX_START)}},{key:"_handleLoadComplete",value:function(e){var t,n,i,r=this,o=this._player;if(o){this._endedStatus={status:e,readyStateWhenComplete:null===(t=o.video)||void 0===t?void 0:t.readyState,endOfStream:(null===(n=o.video)||void 0===n?void 0:n.readyState)>2},this.pause(),(null===(i=o.video)||void 0===i?void 0:i.readyState)>2&&this._endOfStream();var a=0;!function e(){if(o&&o.video&&!o.ended){if(o.currentTime===a){r._updateEndedStauts(o),o.pause(),o.emit("ended"),o.constructor.STATE_CLASS&&(o.removeClass(o.constructor.STATE_CLASS.ENTER),o.removeClass(o.constructor.STATE_CLASS.LOADING)),o=null;return}a=o.currentTime,setTimeout(e,500)}}()}}},{key:"_updateEndedStauts",value:function(e){this._endedStatus.mock=!0,this._endedStatus.currentTime=e.video.currentTime;var t=e.video.buffered.length;if(t)try{this._endedStatus.bufferEnd=e.video.buffered.end(t-1)}catch(e){}}},{key:"_handleMetadataParsed",value:function(e){var t,n=this.tracks["".concat(e,"Track")].meta,i=!1;if("video"===e)try{i=this._checkChangeCodec(null==n?void 0:n.codec)}catch(e){this.emit($.MSE_CHANGE_CODEC_ERROR,e||Error("change video codec error")),this._mseInChangeCodecError=!0;return}this.emit(X.REMUX_METADATA,e,i),null===(t=this._player)||void 0===t||t.emit(B.METADATA,e,n)}},{key:"_checkChangeCodec",value:function(e){var t,n=(null===(t=this.mse)||void 0===t?void 0:t.videoCodec)&&this.mse.videoCodec.split(".")[0],i=e&&e.split(".")[0];return!!n&&!!i&&n!==i&&(this.mse.changeVideoCodecType(e),u.warn("changeVideoCodecType!! ".concat(n," -> ").concat(i)),!0)}},{key:"_handleSEIParsed",value:function(e){var t,n;if(this._pluginConfig.seiOnDemand){null===(n=this._seiOnDemand)||void 0===n||n.append(e);return}null===(t=this._player)||void 0===t||t.emit(B.SEI,e)}},{key:"_handleDemuxComplete",value:function(){var e,t;!this._mseInChangeCodecError&&(null===(e=this._transCostAnalyse)||void 0===e||e.addDemuxEnd(),null===(t=this._transCostAnalyse)||void 0===t||t.accumulateDemuxCost(),this.emit(X.REMUX_MEDIA))}},{key:"_handleAppendInitSegment",value:function(){var e;this.state.initSegmentArrived=!0,null===(e=this._transCostAnalyse)||void 0===e||e.addBufferAppendStart(),this.mse.addSourceBuffers()}},{key:"_handleMediaSegment",value:function(e){if("audio"===e){var t,n;null===(t=this._transCostAnalyse)||void 0===t||t.accumulateRemuxCost(),null===(n=this._transCostAnalyse)||void 0===n||n.addBufferAppendStart()}this.mse.addSourceBuffers(),this.mse.doAppend()}},{key:"_handleSourceUpdateEnd",value:function(){null===(e=this._transCostAnalyse)||void 0===e||e.accumulateBufferAppendCost();var e,t=this._player.currentTime,n=this._player.video,i=this._player.config.preloadTime||this._pluginConfig.preloadTime,r=n.buffered.length;if(0!==r){try{var o=n.buffered.end(r-1),a=n.buffered.start(r-1);r>1&&o-a>1&&a>this._player.currentTime&&(this._player.currentTime=a+.1),t-this._playStartTime>this._pluginConfig.chaseFrameStart&&o-t>2*i&&!this._player.paused&&(this._player.currentTime=o-i,this._player.emit(B.CHASE_FRAME,{bufferEnd:o,preloadTime:i}))}catch(e){}this.mse.doAppend(),(this._player.paused||this.urlSwitching)&&(this.urlSwitching=!1,this._handleTimeUpdate())}}},{key:"_handleTimeUpdate",value:function(){var e=this;if(this._player&&this._player.video){var t=this._player.currentTime,n=this._player.video,i=n.buffered;if(!i||!i.length)return;var r=[0,0],o=n.currentTime;if(i)for(var a=0,s=i.length;a<s&&(r[0]=i.start(a),r[1]=i.end(a),!(r[0]<=o)||!(o<=r[1]));a++);var u=r[0],l=r[1];if(o<u){n.currentTime=u+.1;return}if(t-u>10||i.length>1){if(this.bufferClearTimer||!this.state.randomAccessPoints.length)return;for(var c=1/0,f=0;f<this.state.randomAccessPoints.length;f++){var d=Math.ceil(this.state.randomAccessPoints[f]/1e3);if(d>t-10)break;c=d}this.mse.remove(Math.max(Math.min(c,t-10,l-10),.1),0),this.bufferClearTimer=setTimeout(function(){e.bufferClearTimer=null},5e3)}}}},{key:"_handleNetworkError",value:function(e,t){var n;!this._inSwitching&&(null===(n=this._player)||void 0===n||n.emit("error",{code:t.code,errorType:"network",type:"network",ex:"[".concat(e,"]: ").concat(t.message),errd:{}}),this._onError(Q.LOADER_ERROR,e,t,!0))}},{key:"_handleFetchRetry",value:function(e,t){var n;null===(n=this._player)||void 0===n||n.emit(B.LOADRETRY,Object.assign({tag:e},t))}},{key:"_detectLargeGap",value:function(e,t){var n,i;u.warn("detectLargeGap",e,t),null===(n=this._player)||void 0===n||n.emit(B.STREAM_DISCONTINUE,e,t),this._streamBreaked[e]=!0,!this._streamBreaked.emited&&!this._streamBreaked.video&&this._streamBreaked.audio&&(null===(i=this._player)||void 0===i||i.emit(B.AUDIO_TIMESTAMP_BREAKED,{gap:t}),this._streamBreaked.emited=!0)}},{key:"_handleDemuxError",value:function(e,t,n){var i;void 0===n&&(n=!1),this.pause(),null===(i=this._player)||void 0===i||i.emit("error",{code:"31",errorType:"parse",type:"parse",ex:"[".concat(e,"]: ").concat(t?t.message:""),errd:{}}),this._onError(q.DEMUX_ERROR,e,t,n)}},{key:"_handleRemuxError",value:function(e,t){var n;this.pause(),null===(n=this._player)||void 0===n||n.emit("error",{code:"31",errorType:"parse",type:"parse",ex:"[".concat(e,"]: ").concat(t?t.message:""),errd:{}}),this._onError(X.Remuxer,e,t)}},{key:"_handleMseError",value:function(e,t,n){var i;void 0===n&&(n=!1),null===(i=this._player)||void 0===i||i.emit("error",{code:"31",errorType:"parse",type:"parse",ex:"[".concat(e,"]: ").concat(t?t.message:""),errd:{}}),this.pause(),this._onError($.MSE_ERROR,e,t,n)}},{key:"_handleAddRAP",value:function(e){this.state.randomAccessPoints&&this.state.randomAccessPoints.push(e)}},{key:"_onError",value:function(e,t,n,i){var r,o={code:n.code,errorType:e,type:e,errorDetails:"[".concat(t,"]: ").concat(n?n.message:""),errorFatal:i||!1};null===(r=this._player)||void 0===r||r.emit("FLV_ERROR",o)}},{key:"_endOfStream",value:function(){var e;null===(e=this.mse)||void 0===e||e.endOfStream()}},{key:"load",value:function(){!this.state.initSegmentArrived&&this.loadData()}},{key:"onceKeyFrame",value:function(e){this.once(q.ISKEYFRAME,e)}},{key:"loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._player.config.url;this._player.preProcessUrl&&(e=this._player.preProcessUrl(e).url),this.loader&&(this.loader.finnalUrl=e);var t=this._player.config.retry||{},n=t.count,i=t.delay,r=void 0===n?this._pluginConfig.retryCount:n,o=void 0===i?this._pluginConfig.retryDelay:i;this.emit(Q.LADER_START,e,{},{retryCount:r,retryDelay:o,loadTimeout:this._pluginConfig.loadTimeout,maxReaderInterval:this._pluginConfig.maxReaderInterval,stream:this._pluginConfig.stream})}},{key:"pause",value:function(){var e,t=this.loader;t&&t.cancel(),null===(e=this._seiOnDemand)||void 0===e||e.destroy(),this._seiOnDemand=null}},{key:"setInSwitching",value:function(e){this._inSwitching=e}},{key:"destroyServices",value:function(){var e,t;null===(e=this._seiOnDemand)||void 0===e||e.destroy(),null===(t=this._stableStats)||void 0===t||t.destroy()}},{key:"destroy",value:function(){var e,t,n;null===(e=this._player)||void 0===e||e.off("timeupdate",this._handleTimeUpdate),this.mse=null,null===(t=this._seiOnDemand)||void 0===t||t.destroy(),null===(n=this._stableStats)||void 0===n||n.destroy(),this._seiOnDemand=null,this._stableStats=null,this.state.randomAccessPoints=[]}}],z(e.prototype,t),i}();function ee(e){return(ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function et(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function en(e,t,n){return(en="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=eo(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function ei(e,t){return(ei=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function er(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function eo(e){return(eo=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ea(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var es=r.Z.FlvAllowedEvents,eu=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ei(e,t)}(c,e);var t,n,a,s,u,l=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=eo(t);return e=n?Reflect.construct(i,arguments,eo(this).constructor):i.apply(this,arguments),function(e,t){return t&&("object"===ee(t)||"function"==typeof t)?t:er(e)}(this,e)});function c(e){var t;return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,c),ea(er(t=l.call(this,e)),"_onMseWrongTrackAddHandler",function(){t._reloadStream()}),ea(er(t),"_playHandler",function(){if(!t.player||!t.player.video||t.config.disconnectTime&&t.loader&&t.loader.loading)return Promise.resolve();if(t.config.seamlesslyReload)return t._reloadStreamSeamless(t.player.config.url,t.player.config.url);var e=t.player.video;return Promise.all([e.readyState>1?e.pause():Promise.resolve(),t._destroyInternal().then(function(){t._bindPlayerEvents(),t.player&&(t.player.hasStart=!1)})])}),ea(er(t),"_pauseHandler",function(){var e;!t.config.disconnectTime&&(null===(e=t.flv)||void 0===e||e.pause())}),ea(er(t),"_definitionChangeHandler",function(e){var n=e.to;t._switchURLInternal(n)}),ea(er(t),"_switchURLHandler",function(e,n){t._switchURLInternal(e,n)}),ea(er(t),"_destroyHandler",function(){return t._destroyInternal()}),ea(er(t),"switchCancel",function(){t.tmpContext&&(t.tmpContext.destroy(),t.tmpContext=null)}),t._bindPlayerEvents(),t.player.config.videoInit&&t._stopStreamWhenNotAutoPlay(),t}return a=c,s=[{key:"version",get:function(){return"3.0.0-alpha.142"}},{key:"beforePlayerInit",value:function(){var e=this;this._initFlvCtr(),this.player.switchURL=this._switchURLHandler,this.player.switchCancel=this.switchCancel;try{i.BasePlugin.defineGetterOrSetter(this.player,{__url:{get:function(){return e.mse.url},configurable:!0}})}catch(e){}}},{key:"_stopStreamWhenNotAutoPlay",value:function(){var e=this;this.playerConfig.url&&(this._stopFlv=function(){var t,n,i;!(null!==(t=e.playerConfig)&&void 0!==t&&t.autoplay)&&null!==(n=e.player)&&void 0!==n&&null!==(i=n.video)&&void 0!==i&&i.paused&&e._pauseHandler()},this.once(i.Events.CANPLAY,this._stopFlv))}},{key:"_initFlvCtr",value:function(){null===(e=this.context)||void 0===e||e.destroy();var e,t,n=this.config.preloader;this.config.preloader=null,n&&(t=n.resetContext(this.player,this.config)),!t&&(n=null,t=new o.Z(this.player,this.config,es));var i=t.registry("FLV_CONTROLLER",J)(null,{disconnectTime:this.config.disconnectTime});this.flv=i,t.init(),this._bindFlvEvents(i),this.context=t,this.mse=i.mse,!n&&this._loadData(),this.emit("core_inited",i)}},{key:"_bindFlvEvents",value:function(){var e=this,t=this.flv;t.on(r.Z.REMUX_EVENTS.DETECT_CHANGE_STREAM_DISCONTINUE,function(t,n){var i;null===(i=e.player)||void 0===i||i.emit(r.Z.REMUX_EVENTS.DETECT_CHANGE_STREAM_DISCONTINUE,t,n)}),t.on(r.Z.MSE_EVENTS.MSE_WRONG_TRACK_ADD,this._onMseWrongTrackAddHandler)}},{key:"_bindPlayerEvents",value:function(){var e,t;null===(e=this.player)||void 0===e||e.useHooks("play",this._playHandler),null===(t=this.player)||void 0===t||t.useHooks("pause",this._pauseHandler),this._stopFlv&&(this.off(i.Events.CANPLAY,this._stopFlv),this._stopFlv=null),this.on(i.Events.DESTROY,this._destroyHandler),this.on(i.Events.URL_CHANGE,this._switchURLHandler),this.on(i.Events.DEFINITION_CHANGE,this._definitionChangeHandler)}},{key:"_loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.player.currentTime;this.player&&this.core&&this.core.load(e)}},{key:"_reloadStream",value:function(){var e=this;if(!this.player||!this.player.video)return Promise.resolve();this._destroyInternal().then(function(){e._bindPlayerEvents(),e.player&&(e.player.hasStart=!1,e.player.videoPlay())})}},{key:"_reloadStreamSeamless",value:function(e,t,n){var i=this;if(this.context){var r=this.player.ended;this.switchCancel();var a=new o.Z(this.player,this.config,es);this.tmpContext=a;var s=this.context.getInstance("MP4_REMUXER").remuxer,u=s._dtsBase,l=s._videoDtsBase,c=s._audioDtsBase,f=s._isDtsBaseInited,d=a.registry("FLV_CONTROLLER",J)(this.mse,{remux:{_dtsBase:u,_videoDtsBase:l,_audioDtsBase:c,_isDtsBaseInited:f},disconnectTime:this.config.disconnectTime});return a.init(),n&&(d.setInSwitching(!0),this.emit("switch_start",{url:e})),this._waitStreamReady(d,e,t,n).then(function(){var e;i.flv=d,i.mse.resetContext(a,!0),i.context.destroy(),i.context=a,i.tmpContext=null,null===(e=i.player)||void 0===e||e.emit("loadstart"),i._bindFlvEvents()}).catch(function(){var e,n;null==d||d.pause(),i.tmpContext=null,null!==(e=i.player)&&void 0!==e&&null!==(n=e.config)&&void 0!==n&&n.url&&(i.player.config.url=t)}),d.onceKeyFrame(function(){setTimeout(function(){null!=i&&i.player&&(i.player.currentTime+=0)},150)}),d.loadData(e),r&&this.player.once("progress",function(){return i.player.video.play().catch(function(){})}),d}}},{key:"_waitStreamReady",value:function(e,t,n,i){var o=this;return new Promise(function(a,s){var u=3;e.once(r.Z.LOADER_EVENTS.LOADER_TTFB,function(t){if(t.ok){var n;e.setInSwitching(!1),null===(n=o.flv)||void 0===n||n.pause()}}),e.once(r.Z.LOADER_EVENTS.LOADER_ERROR,function(n,r){e.setInSwitching(!1);var a={code:r.code,errorType:"network",type:"network",ex:"[".concat(n,"]: ").concat(r.message),errd:{},url:t};i&&o.emit("switch_error",a),s()}),e.once(r.Z.MSE_EVENTS.MSE_CHANGE_CODEC_ERROR,function(){e.setInSwitching(!1),i&&o.emit("switch_error",{url:t}),s(),o._switchURLHandler(n)}),e.off(r.Z.DEMUX_EVENTS.ISKEYFRAME,e._handleKeyFrame),e.on(r.Z.REMUX_EVENTS.MEDIA_SEGMENT,function n(){0==(u-=1)&&o.player&&(e.setInSwitching(!1),o.player.config.url=t,i&&o.emit("switch_completed",{url:t}),e.on(r.Z.DEMUX_EVENTS.ISKEYFRAME,e._handleKeyFrame),e.off(r.Z.REMUX_EVENTS.MEDIA_SEGMENT,n),a(),e.urlSwitching=!0),!o.player&&s()})})}},{key:"_switchURLInternal",value:function(e,t){if(this.player){if(!(t=t&&!!this.context.getInstance("MP4_REMUXER"))){this.player.config.url=e,this.player.currentTime=0,this.tmpContext&&(this.tmpContext.destroy(),this.tmpContext=null,this.emit("switch_error")),this._reloadStream();return}var n=this._reloadStreamSeamless(e,this.player.config.url,!0);n&&this.emit("core_inited",n)}}},{key:"_destroyInternal",value:function(){var e,t=this;if(null!==(e=this.config)&&void 0!==e&&e.preloader&&this.config.preloader.destroy(),!this.context)return Promise.resolve();if(this.flv&&this.context){var n=this.context.getInstance("FETCH_LOADER");n&&n.destroy(),this.flv.destroyServices()}var i=function(){t.context&&(t.context.destroy(),t.flv=null,t.context=null,en(eo(c.prototype),"offAll",t).call(t))};return this.flv&&this.flv.mse?this.flv.mse.destroy().then(i):Promise.resolve(i())}},{key:"switchURL",value:function(e,t){this._switchURLHandler(e,t)}},{key:"destroy",value:function(){return this._destroyInternal()}},{key:"core",get:function(){return this.flv}},{key:"loader",get:function(){var e;return null===(e=this._context)||void 0===e?void 0:e.getInstance("FETCH_LOADER")}},{key:"context",get:function(){return this._context},set:function(e){this._context=e}},{key:"endedStatus",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.endedStatus}},{key:"transferCost",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.transferCost}},{key:"stableStats",get:function(){var e;return null===(e=this.flv)||void 0===e?void 0:e.stableStats}}],u=[{key:"pluginName",get:function(){return"flvLive"}},{key:"defaultConfig",get:function(){return Object.assign({},U,{loadTimeout:1e4,maxReaderInterval:5e3,seiOnDemand:!1,seamlesslyReload:!1,preloader:null,chaseFrameStart:0,preloadTime:5,retryCount:3,retryDelay:1e3,onlyVideo:!1,onlyAudio:!1,disconnectTime:0})}},{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}}],s&&et(a.prototype,s),u&&et(a,u),c}(i.BasePlugin),el=eu},458616:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(){var e,t,n;function r(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),this.TAG="Golomb",this._buffer=e,this._bufferIndex=0,this._totalBytes=e.byteLength,this._totalBits=8*e.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return e=r,t=[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex;var t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(n.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),n=this._currentWord>>>32-t;if(e>32)throw Error("Cannot read more than 32 bits at a time");return(this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft)?n<<t|this.readBits(t):n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e;for(e=0;e<this._currentWordBitsLeft;e++)if((this._currentWord&2147483648>>>e)!=0)return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}},{key:"readSliceType",value:function(){return this.readByte(),this.readUEG(),this.readUEG()}}],i(e.prototype,t),r}();function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=i,t=null,n=[{key:"_ebsp2rbsp",value:function(e){for(var t=e.byteLength,n=new Uint8Array(t),i=0,r=0;r<t;r++){if(!(r>=2)||3!==e[r]||0!==e[r-1]||0!==e[r-2])n[i]=e[r],i++}return new Uint8Array(n.buffer,0,i)}},{key:"parseSPS",value:function(e){var t=new r(i._ebsp2rbsp(e));t.readByte();var n=t.readByte();t.readByte();var o=t.readByte();t.readUEG();var a=i.getProfileString(n),s=i.getLevelString(o),u=1,l=420,c=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(u=t.readUEG())&&t.readBits(1),u<=3&&(l=[0,420,422,444][u]),c=t.readUEG()+8,t.readUEG(),t.readBits(1),t.readBool())){for(var f=3!==u?8:12,d=0;d<f;d++)t.readBool()&&(d<6?i._skipScalingList(t,16):i._skipScalingList(t,64))}t.readUEG();var h=t.readUEG();if(0===h)t.readUEG();else if(1===h){t.readBits(1),t.readSEG(),t.readSEG();for(var p=t.readUEG(),v=0;v<p;v++)t.readSEG()}t.readUEG(),t.readBits(1);var y=t.readUEG(),m=t.readUEG(),g=t.readBits(1);0===g&&t.readBits(1),t.readBits(1);var _=0,b=0,E=0,S=0;t.readBool()&&(_=t.readUEG(),b=t.readUEG(),E=t.readUEG(),S=t.readUEG());var w=1,k=1,T=0,C=!0,O=0,A=0;if(t.readBool()){if(t.readBool()){var R=t.readByte();R>0&&R<16?(w=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][R-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][R-1]):255===R&&(w=t.readByte()<<8|t.readByte(),k=t.readByte()<<8|t.readByte())}if(t.readBool()&&t.readBool(),t.readBool()&&(t.readBits(4),t.readBool()&&t.readBits(24)),t.readBool()&&(t.readUEG(),t.readUEG()),t.readBool()){var P=t.readBits(32),D=t.readBits(32);C=t.readBool(),T=(O=D)/(A=2*P)}}var x=1;(1!==w||1!==k)&&(x=w/k);var L=0,I=0;if(0===u)L=1,I=2-g;else{var M=3===u?1:2,B=1===u?2:1;L=M,I=B*(2-g)}var U=(y+1)*16,N=(m+1)*16*(2-g);U-=(_+b)*L,N-=(E+S)*I;var F=Math.ceil(U*x);return t.destroy(),t=null,{profile_string:a,level_string:s,bit_depth:c,chroma_format:l,chroma_format_string:i.getChromaFormatString(l),frame_rate:{fixed:C,fps:T,fps_den:A,fps_num:O},par_ratio:{width:w,height:k},codec_size:{width:U,height:N},present_size:{width:F,height:N}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0,o=0;o<t;o++)0!==i&&(i=(n+(r=e.readSEG())+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var n=t.frameRate.fps_den,i=t.frameRate.fps_num;return t.refSampleDuration=Math.floor(t.timescale*(n/i)),t}}],n&&o(e,n),i}()},519075:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n("701175");function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=i,t=null,n=[{key:"EBSP2RBSP",value:function(e){return e.filter(function(t,n){return!!(n<2)||!(0===e[n-2]&&0===e[n-1]&&3===t)})}},{key:"EBSP2SODB",value:function(e){var t=e[e.byteLength-1];return t&&128===t?e.slice(0,e.byteLength-1):e}}],n&&r(e,n),i}();function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(e){for(var t="",n=0;n<e.byteLength;n++)t+=String.fromCharCode(e[n]);return t},u=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i)}return e=i,t=null,n=[{key:"_resolveNalu",value:function(e){return e.length>=1?o.EBSP2SODB(o.EBSP2RBSP(e.slice(1))):null}},{key:"parse",value:function(e){var t=i._resolveNalu(e),n=i.switchPayloadType(t),r=n.payloadType,o=n.offset,a=t.slice(o);if(5===r)return i.user_data_unregistered(a);return{code:r,content:a}}},{key:"switchPayloadType",value:function(e){for(var t=new DataView(e.buffer),n=0,i=0;255===t.getUint8(i);)i++,n+=255;return{payloadType:n+=t.getUint8(i++),offset:i}}},{key:"getPayloadLength",value:function(e){for(var t=new DataView(e.buffer),n=0,i=0;255===t.getUint8(i);)i++,n+=255;return{payloadLength:n+=t.getUint8(i++),offset:i}}},{key:"user_data_unregistered",value:function(e){var t=i.getPayloadLength(e),n=t.payloadLength,r=t.offset;if(n<16)return{uuid:"",content:null};var o=e.slice(r);return{code:5,uuid:s(o.slice(0,16)),content:s(o.slice(16,n))}}}],n&&a(e,n),i}();function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var c=function(){var e,t,n;function r(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r)}return e=r,t=null,n=[{key:"getNalunits",value:function(e){if(e.length-e.position<4)return[];var t=e.dataview,n=e.position;return 1===t.getInt32(n)||0===t.getInt16(n)&&1===t.getInt8(n+2)?r.getAnnexbNals(e):r.getHvccNals(e)}},{key:"getAnnexbNals",value:function(e){for(var t=[],n=r.getHeaderPositionAnnexB(e),i=n.pos,o=i;i<e.length-4;){var a=e.buffer.slice(i,i+n.headerLength);n.pos===e.position&&e.skip(n.headerLength),o=(n=r.getHeaderPositionAnnexB(e)).pos;var s=new Uint8Array(e.buffer.slice(i+a.byteLength,o)),u={header:a,body:s};r.analyseNal(u),u.type<=40&&t.push(u),e.skip(o-e.position),i=o}return t}},{key:"getHvccNals",value:function(e){for(var t=[];e.position<e.length-4;){var n=e.dataview.getInt32(e.dataview.position);if(e.length-e.position>=n){var i=e.buffer.slice(e.position,e.position+4);e.skip(4);var o=new Uint8Array(e.buffer.slice(e.position,e.position+n));e.skip(n);var a={header:i,body:o};try{r.analyseNal(a)}catch(e){continue}a.type<=40&&t.push(a)}else break}return t}},{key:"analyseNal",value:function(e){var t=e.body[0]>>>1&63;switch(e.type=t,t){case 0:e.slice_trail_n=!0;break;case 1:e.slice_trail_r=!0;break;case 2:e.slice_tsa_n=!0;break;case 3:e.slice_tsa_r=!0,e.key=!0;break;case 4:e.slice_stsa_n=!0;break;case 5:e.slice_stsa_r=!0,e.key=!0;break;case 6:e.slice_radl_n=!0;break;case 7:e.slice_radl_r=!0,e.key=!0;break;case 8:e.slice_rasl_n=!0;break;case 9:e.slice_rasl_r=!0,e.key=!0;break;case 16:e.slice_bla_w_lp=!0;break;case 17:e.slice_bla_w_radl=!0;break;case 18:e.slice_bla_n_lp=!0;break;case 19:e.slice_idl_w_radl=!0,e.key=!0;break;case 20:e.slice_idr_n_lp=!0,e.key=!0;break;case 21:e.slice_cra_nut=!0,e.key=!0;break;case 32:e.vps=!0;break;case 33:e.sps=i.Z.parseSPS(e.body);break;case 34:e.pps=!0;break;case 35:break;case 36:e.aud=!0;break;case 37:e.eob=!0;break;case 38:e.fd=!0;break;case 39:try{e.sei=u.parse(e.body.slice(1))}catch(e){}break;case 40:e.sei=u.parse(e.body.slice(1))}}},{key:"getHeaderPositionAnnexB",value:function(e){for(var t=e.position,n=0,i=e.length;3!==n&&4!==n&&t<i-4;)0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?n=4:1===e.dataview.getInt8(t+2)?n=3:t++:t++;return t===i-4&&(0===e.dataview.getInt16(t)?1===e.dataview.getInt16(t+2)?n=4:t=i:(t++,0===e.dataview.getInt16(t)&&1===e.dataview.getInt8(t)?n=3:t=i)),{pos:t,headerLength:n}}}],n&&l(e,n),r}()},583135:function(e,t){"use strict";function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){var e,t,i;function r(e){if(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,r),e instanceof ArrayBuffer)this.buffer=e,this.dataview=new DataView(e),this.dataview.position=0;else throw Error("data is invalid")}return e=r,t=[{key:"length",get:function(){return this.buffer.byteLength}},{key:"position",get:function(){return this.dataview.position},set:function(e){this.dataview.position=e}},{key:"back",value:function(e){this.position-=e}},{key:"getUint8",value:function(e){return this.dataview.getUint8(e)}},{key:"skip",value:function(e){for(var t=Math.floor(e/4),n=e%4,i=0;i<t;i++)r.readByte(this.dataview,4);n>0&&r.readByte(this.dataview,n)}},{key:"readUint8",value:function(){return r.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return r.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return r.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return r.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return r.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return r.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return r.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return r.readByte(this.dataview,4,!0)}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}}],i=[{key:"readByte",value:function(e,t,n){var i;switch(t){case 1:i=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw Error("not supported for readByte 3");i=e.getUint8(e.position)<<16|e.getUint8(e.position+1)<<8|e.getUint8(e.position+2);break;case 4:i=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw Error("not supported for readBody 8");i=e.getUint32(e.position)<<32|e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}],t&&n(e.prototype,t),i&&n(e,i),r}();t.Z=i},238519:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=function(e){for(var t in e)if(e.hasOwnProperty(t)&&null===e[t])return!1;return!0},o=function(){var e,t,n;function o(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o),this.mimeType=null,this.duration=null,this.hasVideo=!1,this.video={codec:null,width:null,height:null,profile:null,level:null,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},chromaFormat:null,parRatio:{width:1,height:1}},this.hasAudio=!1,this.audio={codec:null,sampleRate:null,sampleRateIndex:null,channelCount:null}}return e=o,t=[{key:"isComplete",value:function(){return o.isBaseInfoReady(this)&&o.isVideoReady(this)&&o.isAudioReady(this)}}],n=[{key:"isBaseInfoReady",value:function(e){return r(e)}},{key:"isVideoReady",value:function(e){return!e.hasVideo||r(e.video)}},{key:"isAudioReady",value:function(e){return!e.hasAudio||r(e.video)}}],t&&i(e.prototype,t),n&&i(e,n),o}()},53985:function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,{h:function(){return a},l:function(){return s}});var a=function(){function e(t){i(this,e);var n={sampleRate:48e3,channelCount:2,codec:"mp4a.40.2",config:[41,401,136,0],duration:0,id:2,refSampleDuration:21,sampleRateIndex:3,timescale:1e3,type:"audio"};return t?Object.assign({},n,t):n}return o(e,[{key:"destroy",value:function(){this.init=null}}]),e}(),s=function(){function e(t){i(this,e);var n={avcc:null,sps:new Uint8Array(0),pps:new Uint8Array(0),chromaFormat:420,codec:"avc1.640020",codecHeight:720,codecWidth:1280,duration:0,frameRate:{fixed:!0,fps:25,fps_num:25e3,fps_den:1e3},id:1,level:"3.2",presentHeight:720,presentWidth:1280,profile:"High",refSampleDuration:40,parRatio:{height:1,width:1},timescale:1e3,type:"video"};return t?Object.assign({},n,t):n}return o(e,[{key:"destroy",value:function(){this.init=null,this.sps=null,this.pps=null}}]),e}()},967989:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r=s(e);return n=t?Reflect.construct(r,arguments,s(this).constructor):r.apply(this,arguments),function(e,t){return t&&("object"===i(t)||"function"==typeof t)?t:function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,n)}}n.d(t,{WP:function(){return d},ZP:function(){return f},qT:function(){return h}});function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function c(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}var f=function(){function e(){u(this,e),this.id=-1,this.sequenceNumber=0,this.samples=[],this.droppedSamples=[],this.length=0}return c(e,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0}},{key:"destroy",value:function(){this.reset(),this.id=-1}}]),e}(),d=function(e){r(n,e);var t=a(n);function n(){var e;return u(this,n),(e=t.call(this)).TAG="AudioTrack",e.type="audio",e}return n}(f),h=function(e){r(n,e);var t=a(n);function n(){var e;return u(this,n),(e=t.call(this)).TAG="VideoTrack",e.type="video",e.dropped=0,e.sequenceNumber=0,e}return c(n,[{key:"reset",value:function(){this.sequenceNumber=0,this.samples=[],this.length=0,this.dropped=0}}]),n}(f)},771792:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var i=n(848715),r=n(695596);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=i.Z.isLe,s=0,u=1,l=2,c=3,f=8,d=9,h=10,p=11,v=12,y=function(){var e,t,n;function i(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),this.offset=0,this.readOffset=this.offset}return e=i,t=[{key:"resolve",value:function(e,t){if(t<3)throw Error("not enough data for metainfo");var n={};try{var i=this.parseValue(e),r=this.parseValue(e,t-i.bodySize);n[i.data]=r.data}catch(e){}return this.resetStatus(),n}},{key:"resetStatus",value:function(){this.offset=0,this.readOffset=this.offset}},{key:"parseString",value:function(e){var t=new DataView(e,this.readOffset).getUint16(0,!a),n="";n=t>0?r.Z.decode(new Uint8Array(e,this.readOffset+2,t)):"";var i=t+2;return this.readOffset+=i,{data:n,bodySize:t+2}}},{key:"parseDate",value:function(e,t){var n=new DataView(e,this.readOffset,t),i=n.getFloat64(0,!a);return i+=6e4*n.getInt16(8,!a),this.readOffset+=10,{data:new Date(i),bodySize:10}}},{key:"parseObject",value:function(e,t){var n=this.parseString(e,t),i=this.parseValue(e,t-n.bodySize);return{data:{name:n.data,value:i.data},bodySize:n.bodySize+i.bodySize,isObjEnd:i.isObjEnd}}},{key:"parseLongString",value:function(e){var t=new DataView(e,this.readOffset).getUint32(0,!a),n="";return n=t>0?r.Z.decode(new Uint8Array(e,this.readOffset+2,t)):"",this.readOffset+=t+4,{data:n,bodySize:t+4}}},{key:"parseValue",value:function(e,t){var n=new ArrayBuffer;n=e instanceof ArrayBuffer?e:e.buffer;var i=new DataView(n,this.readOffset,t),r=!1,o=i.getUint8(0),y=1;this.readOffset+=1;var m=null;switch(o){case s:m=i.getFloat64(1,!a),this.readOffset+=8,y+=8;break;case u:m=!!i.getUint8(1),this.readOffset+=1,y+=1;break;case l:var g=this.parseString(n);m=g.data,y+=g.bodySize;break;case c:m={};var _=0;for(16777215&i.getUint32(t-4,!a)&&(_=3);y<t-4;){var b=this.parseObject(n,t-y-_);if(b.isObjectEnd)break;m[b.data.name]=b.data.value,y+=b.bodySize}y<=t-3&&9==(16777215&i.getUint32(y-1,!a))&&(this.readOffset+=3,y+=3);break;case f:m={},y+=4,this.readOffset+=4;var E=0;for((16777215&i.getUint32(t-4,!a))==9&&(E=3);y<t-8;){var S=this.parseObject(n,t-y-E);if(S.isObjectEnd)break;m[S.data.name]=S.data.value,y+=S.bodySize}y<=t-3&&9==(16777215&i.getUint32(y-1,!a))&&(y+=3,this.readOffset+=3);break;case d:m=null,r=!0;break;case h:m=[];var w=i.getUint32(1,!a);y+=4,this.readOffset+=4;for(var k=0;k<w;k++){var T=this.parseValue(n,t-y);m.push(T.data),y+=T.bodySize}break;case p:var C=this.parseDate(n,t-1);m=C.data,y+=C.bodySize;break;case v:var O=this.parseLongString(n,t-1);m=O.data,y+=O.bodySize;break;default:y=t}return{data:m,bodySize:y,isObjEnd:r}}}],o(e.prototype,t),i}()},169659:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var i=n(663008);function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function o(e){for(var t=e.byteLength,n=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(!n.length)return e;var r=t-n.length,o=new Uint8Array(r),a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),o[i]=e[a];return o}var a=function(){var e,t,n;function a(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,a)}return e=a,t=null,n=[{key:"parseHEVCDecoderConfigurationRecord",value:function(e){var t,n,i,r,s,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e.length<23)){u=u||{};for(var l=(3&e[21])+1,c=[],f=[],d=[],h=23,p=e[22],v=0;v<p;v++){i=63&e[h],r=e[h+1]<<8|e[h+2],h+=3;for(var y=0;y<r;y++)if(s=e[h]<<8|e[h+1],h+=2,s){switch(i){case 32:var m=e.subarray(h,h+s);!t&&(t=a.parseVPS(o(m),u)),d.push(m);break;case 33:var g=e.subarray(h,h+s);!n&&(n=a.parseSPS(o(g),u)),c.push(g);break;case 34:f.push(e.subarray(h,h+s))}h+=s}}return{hvcC:u,sps:n,spsArr:c,ppsArr:f,vpsArr:d,nalUnitSize:l}}}},{key:"parseVPS",value:function(e,t){t=t||{};var n=new i.Z(e);n.readUByte(),n.readUByte(),n.readBits(12);var r=n.readBits(3);return t.numTemporalLayers=Math.max(t.numTemporalLayers||0,r+1),n.readBits(17),a._parseProfileTierLevel(n,r,t),t}},{key:"parseSPS",value:function(e){var t,n,r,o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s=s||{};var u=new i.Z(e);u.readUByte(),u.readUByte(),u.readBits(4);var l=u.readBits(3);s.numTemporalLayers=Math.max(l+1,s.numTemporalLayers||0),s.temporalIdNested=u.readBits(1),a._parseProfileTierLevel(u,l,s),u.readUEG();var c=s.chromaFormatIdc=u.readUEG(),f=420;c<=3&&(f=[0,420,422,444][c]);var d=0;3===c&&(d=u.readBits(1));var h=u.readUEG(),p=u.readUEG(),v=u.readBits(1);if(1===v&&(t=u.readUEG(),n=u.readUEG(),r=u.readUEG(),o=u.readUEG()),s.bitDepthLumaMinus8=u.readUEG(),s.bitDepthChromaMinus8=u.readUEG(),1===v){var y=(1===c||2===c)&&0===d?2:1,m=1===c&&0===d?2:1;h-=y*(n+t),p-=m*(o+r)}return{codec:"hev1.1.6.L93.B0",width:h,height:p,chromaFormat:f,hvcC:s}}},{key:"_parseProfileTierLevel",value:function(e,t,n){var i=n.generalTierFlag||0;n.generalProfileSpace=e.readBits(2),n.generalTierFlag=Math.max(e.readBits(1),i),n.generalProfileIdc=Math.max(e.readBits(5),n.generalProfileIdc||0),n.generalProfileCompatibilityFlags=e.readBits(32),n.generalConstraintIndicatorFlags=[e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8),e.readBits(8)];var r=e.readBits(8);i<n.generalTierFlag?n.generalLevelIdc=r:n.generalLevelIdc=Math.max(r,n.generalLevelIdc||0);for(var o=[],a=[],s=0;s<t;s++)o[s]=e.readBits(1),a[s]=e.readBits(1);t>0&&e.readBits((8-t)*2);for(var u=0;u<t;u++)0!==o[u]&&(e.readBits(2),e.readBits(1),e.readBits(5),e.readBits(16),e.readBits(16),e.readBits(4),e.readBits(16),e.readBits(16),e.readBits(12)),0!==a[u]&&e.readBits(8)}}],n&&r(e,n),a}()},434670:function(e,t,n){"use strict";n.d(t,{Z:function(){return c}});var i=n(559625),r=n(663008);function o(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var u=i.Z,l=function(){function e(t){o(this,e),this._buffer=t,this._offset=0,this._heldBits=0,this._numHeldBits=0}return s(e,[{key:"readUint8",value:function(){return this._buffer[this._offset++]}},{key:"readUint16",value:function(){return this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint32",value:function(){return this._buffer[this._offset++]<<24|this._buffer[this._offset++]<<16|this._buffer[this._offset++]<<8|this._buffer[this._offset++]}},{key:"readUint8Array",value:function(e){var t=this._buffer.slice(this._offset,this._offset+e);return this._offset+=e,t}},{key:"streamRead1Bytes",value:function(){this._heldBits=this.readUint8(),this._numHeldBits=8}},{key:"streamRead2Bytes",value:function(){this._heldBits=this.readUint16(),this._numHeldBits=16}},{key:"extractBits",value:function(e){var t=this._heldBits>>this._numHeldBits-e&(1<<e)-1;return this._numHeldBits-=e,t}}]),e}(),c=function(){function e(){o(this,e)}return s(e,null,[{key:"parseVVCDecoderConfigurationRecord",value:function(t){var n,i,r,o,a,s,u,c,f=new l(t);f.streamRead1Bytes(),f.extractBits(5);var d=f.extractBits(2)+1,h=f.extractBits(1),p={};h&&(f.streamRead2Bytes(),n=f.extractBits(9),i=f.extractBits(3),r=f.extractBits(2),o=f.extractBits(2),f.streamRead1Bytes(),a=f.extractBits(3),f.extractBits(5),p=e.parseVVCPTLRecord(f,i),s=f.readUint16(),u=f.readUint16(),c=f.readUint16());for(var v=f.readUint8(),y=[],m=[],g=[],_=null,b=0;b<v;b++){f.streamRead1Bytes(),f.extractBits(1),f.extractBits(2);var E=f.extractBits(5),S=1;13!==E&&12!==E&&(S=f.readUint16());for(var w=0;w<S;w++){var k=f.readUint16();switch(E){case 14:y.push(f.readUint8Array(k));break;case 15:var T=f.readUint8Array(k);!_&&(_=e.parseSPS(e.removeEPB(T))),m.push(T);break;case 16:g.push(f.readUint8Array(k))}}}return{vvcC:t,nalUnitSize:d,ptlPresentFlag:h,olsIdx:n,numSublayers:i,constantFrameRate:r,chromaFormatIdc:o,bitDepthLumaMinus8:a,ptlRecord:p,maxPictrueWidth:s,maxPictureHeight:u,avgFrameRate:c,numOfArrays:v,vpsArr:y,spsArr:m,ppsArr:g,spsParsed:_}}},{key:"parseVVCPTLRecord",value:function(e,t){e.streamRead2Bytes(),e.extractBits(2);var n=e.extractBits(6),i=e.extractBits(7),r=e.extractBits(1),o=e.readUint8();e.streamRead1Bytes();var a=e.extractBits(1),s=e.extractBits(1),u=new Uint8Array(n);if(n){for(var l=0;l<n-1;l++){var c=e.extractBits(6);e.streamRead1Bytes();var f=e.extractBits(2);u[l]=c<<2|f}u[n-1]=e.extractBits(6)}else e.extractBits(6);var d=[];if(t>1){e.streamRead1Bytes();for(var h=0,p=t-2;p>=0;--p)h|=e.extractBits(1)<<p;for(var v=t;v<=8&&t>1;++v)e.extractBits(1);for(var y=t-2;y>=0;--y)h&1<<y&&(d[y]=e.readUint8())}var m=e.readUint8(),g=[];if(m)for(var _=0;_<m;_++)g.push(e.readUint32());return{generalProfileIdc:i,generalTierFlag:r,generalLevelIdc:o,ptlFrameOnlyConstraintFlag:a,ptlMultilayerEnabledFlag:s,generalConstraintInfo:u,subLayerLevelIdc:d,generalSubProfileIdc:g,ptlNumSubProfiles:m,numBytesConstraintInfo:n}}},{key:"getAvccNals",value:function(e){for(var t=[];e.position<e.length-4;){var n=e.dataview.getInt32(e.dataview.position);if(e.length-e.position>=n){var i=e.buffer.slice(e.position,e.position+4);e.skip(4);var r=new Uint8Array(e.buffer.slice(e.position,e.position+n));e.skip(n),t.push({header:i,body:r});continue}break}return t}},{key:"analyseNal",value:function(e){var t=(248&e.body[1])>>3;switch(e.type=t,t){case 23:case 24:try{e.sei=u.parse(e.body.slice(1))}catch(e){}break;case 7:case 8:e.key=!0;break;case 14:e.vps=!0;break;case 15:e.sps=!0;break;case 16:e.pps=!0;break;case 17:e.aps=!0}}},{key:"removeEPB",value:function(e){for(var t=e.byteLength,n=[],i=1;i<t-2;)0===e[i]&&0===e[i+1]&&3===e[i+2]?(n.push(i+2),i+=2):i++;if(!n.length)return e;var r=t-n.length,o=new Uint8Array(r),a=0;for(i=0;i<r;a++,i++)a===n[0]&&(a++,n.shift()),o[i]=e[a];return o}},{key:"parseVps",value:function(){}},{key:"parseSPS",value:function(t){var n=new r.Z(t);n.readUByte(),n.readUByte(),n.skipBits(4);var i=n.readBits(4),o=n.readBits(3),a=n.readBits(2),s=420;a<=3&&(s=[0,420,422,444][a]),n.readBits(2),n.readBits(1);var u=e._parseProfileTierLevel(n,1,o);return n.readBits(1),n.readBits(1)&&n.readBits(1),{width:n.readUEG(),height:n.readUEG(),spsMaxSubLayerMinus1:o,spsVideoParameterSetId:i,chromaFormatIdc:a,chromaFormat:s,ptlInfo:u}}},{key:"_parseProfileTierLevel",value:function(t,n,i){var r,o=t.readBits(7),a=t.readBits(1),s=t.readBits(8),u=t.readBits(1),l=t.readBits(1);n&&(r=e._parseGeneralConstraintsInfo(t));for(var c=i-1,f=[],d=[],h=[],p=c;p>=0;--p)f[p]=t.readBits(1);for(;!t.byteAligned();)t.readBits(1);for(var v=c;v>=0;--v)f[v]&&(d[v]=t.readUByte());if(n){for(var y=t.readUByte(),m=0;m<y;m++)h[m]=t.readBits(32)}return{generalProfileIdc:o,generalTierFlag:a,generalLevelIdc:s,ptlFrameOnlyConstraintFlag:u,ptlMultilayerEnabledFlag:l,ptlSublayerLevelPresentFlags:f,ptlSublayerLevelIdcs:d,ptlSubProfileIdcs:h,gciInfo:r}}},{key:"_parseGeneralConstraintsInfo",value:function(e){var t=e.readBits(1);if(t){e.skipBits(71);var n=e.readBits(8);n&&e.skipBits(n)}var i=8-e.bitsPos()%8;return e.skipBits(i),{gciPresentFlag:t}}}]),e}()},829288:function(e,t,n){"use strict";var i=n(174908),r=n.n(i);function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){var e,t,n;function i(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),this.buffer=e||new Uint8Array(0)}return e=i,t=[{key:"write",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach(function(t){e.buffer=r()(Uint8Array,e.buffer,t)})}}],n=[{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}},{key:"readAsInt",value:function(e){var t="";return e.forEach(function(e){t+=e.toString(16).padStart(2,"0")}),parseInt(t,16)}}],t&&o(e.prototype,t),n&&o(e,n),i}();t.Z=a},285563:function(e,t,n){"use strict";var i=n(829288);function r(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}}(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s=function(){var e,t,n;function o(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,o)}return e=o,t=null,n=[{key:"size",value:function(e){return i.Z.writeUint32(e)}},{key:"initBox",value:function(e,t){for(var n=new i.Z,r=arguments.length,a=Array(r>2?r-2:0),s=2;s<r;s++)a[s-2]=arguments[s];return n.write.apply(n,[o.size(e),o.type(t)].concat(a)),n.buffer}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){return o.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]))}},{key:"ftypHEVC",value:function(){return o.initBox(24,"ftyp",new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,100,97,115,104]))}},{key:"moov",value:function(e){var t,n=e.type,i=e.meta,r=8,a=o.mvhd(i.duration,i.timescale);t="video"===n?o.videoTrak(i):o.audioTrak(i);var s=o.mvex(i.duration,i.timescale||1e3,i.id);return[a,t,s].forEach(function(e){r+=e.byteLength}),o.initBox(r,"moov",a,t,s)}},{key:"mvhd",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,e>>>24&255,e>>>16&255,e>>>8&255,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return o.initBox(8+n.length,"mvhd",new Uint8Array(n))}},{key:"videoTrak",value:function(e){var t=8,n=o.tkhd({id:1,duration:e.duration,timescale:e.timescale||1e3,width:e.presentWidth,height:e.presentHeight,type:"video"}),i=o.mdia({type:"video",timescale:e.timescale||1e3,duration:e.duration,avcc:e.avcc,vvcC:e.vvcC,hvcCConfigParsed:e.hvcCConfigParsed,parRatio:e.parRatio,width:e.presentWidth,height:e.presentHeight,streamType:e.streamType});return[n,i].forEach(function(e){t+=e.byteLength}),o.initBox(t,"trak",n,i)}},{key:"audioTrak",value:function(e){var t=8,n=o.tkhd({id:2,duration:e.duration,timescale:e.timescale||1e3,width:0,height:0,type:"audio"}),i=o.mdia({type:"audio",timescale:e.timescale||1e3,duration:e.duration,channelCount:e.channelCount,samplerate:e.sampleRate,config:e.config});return[n,i].forEach(function(e){t+=e.byteLength}),o.initBox(t,"trak",n,i)}},{key:"tkhd",value:function(e){var t=e.id,n=e.duration,i=e.width,r=e.height,a=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>>8&255,255&i,0,0,r>>>8&255,255&r,0,0]);return o.initBox(8+a.byteLength,"tkhd",a)}},{key:"edts",value:function(e){var t=new i.Z,n=e.duration,r=e.mediaTime;return t.write(o.size(36),o.type("edts")),t.write(o.size(28),o.type("elst")),t.write(new Uint8Array([0,0,0,1,n>>24&255,n>>16&255,n>>8&255,255&n,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),t.buffer}},{key:"mdia",value:function(e){var t=8,n=o.mdhd(e.timescale,e.duration),i=o.hdlr(e.type),r=o.minf(e);return[n,i,r].forEach(function(e){t+=e.byteLength}),o.initBox(t,"mdia",n,i,r)}},{key:"mdhd",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3,t=arguments.length>1?arguments[1]:void 0,n=new Uint8Array([0,0,0,0,0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e,t>>>24&255,t>>>16&255,t>>>8&255,255&t,85,196,0,0]);return o.initBox(12+n.byteLength,"mdhd",o.extension(0,0),n)}},{key:"hdlr",value:function(e){var t=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===e&&(t.splice.apply(t,[8,4].concat([115,111,117,110])),t.splice.apply(t,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),o.initBox(8+t.length,"hdlr",new Uint8Array(t))}},{key:"minf",value:function(e){var t=8,n="video"===e.type?o.vmhd():o.smhd(),i=o.dinf(),r=o.stbl(e);return[n,i,r].forEach(function(e){t+=e.byteLength}),o.initBox(t,"minf",n,i,r)}},{key:"vmhd",value:function(){return o.initBox(20,"vmhd",new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]))}},{key:"smhd",value:function(){return o.initBox(16,"smhd",new Uint8Array([0,0,0,0,0,0,0,0]))}},{key:"dinf",value:function(){var e=new i.Z;return e.write(o.size(36),o.type("dinf"),o.size(28),o.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),e.buffer}},{key:"stbl",value:function(e){var t=8,n=o.stsd(e),i=o.stts(),r=o.stsc(),a=o.stsz(),s=o.stco();return[n,i,r,a,s].forEach(function(e){t+=e.byteLength}),o.initBox(t,"stbl",n,i,r,a,s)}},{key:"stsd",value:function(e){var t;return t="audio"===e.type?o.mp4a(e):36===e.streamType||e.vvcC?o.hvc1vvc1(e):o.avc1(e),o.initBox(16+t.byteLength,"stsd",o.extension(0,0),new Uint8Array([0,0,0,1]),t)}},{key:"mp4a",value:function(e){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,e.samplerate>>8&255,255&e.samplerate,0,0]),n=o.esds(e.config);return o.initBox(8+t.byteLength+n.byteLength,"mp4a",t,n)}},{key:"esds",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],t=e.length,n=new i.Z,r=new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e).concat([6,1,2]));return n.write(o.size(8+r.byteLength),o.type("esds"),r),n.buffer}},{key:"avc1",value:function(e){var t=new i.Z,n=e.width,r=e.height,a=e.parRatio.width,s=e.parRatio.height,u=e.avcc,l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,n>>8&255,255&n,r>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),f=new Uint8Array([a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s]);return t.write(o.size(40+l.byteLength+u.byteLength+c.byteLength),o.type("avc1"),l,o.size(8+u.byteLength),o.type("avcC"),u,o.size(20),o.type("btrt"),c,o.size(16),o.type("pasp"),f),t.buffer}},{key:"hvc1vvc1",value:function(e){var t=new i.Z,n=[0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e.width>>8&255,255&e.width,e.height>>8&255,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17],a=!!e.vvcC,s=a?o.vvcC(e):o.hvcC(e),u=[o.type(a?"vvc1":"hvc1"),new Uint8Array(n)].concat(r(s));e.parRatio&&u.push.apply(u,r(o.pasp(e.parRatio)));var l=4+u.reduce(function(e,t){return e+t.byteLength},0);return u.unshift(o.size(l)),t.write.apply(t,r(u)),t.buffer}},{key:"hvcC",value:function(e){var t;if(e.hvcCConfigParsed){var n=e.hvcCConfigParsed,i=n.vpsArr,a=n.spsArr,s=n.ppsArr,u=n.hvcC,l=u.generalProfileCompatibilityFlags,c=u.generalConstraintIndicatorFlags,f=(i.length&&1)+(a.length&&1)+(s.length&&1);t=[1,u.generalProfileSpace<<6|u.generalTierFlag<<5|u.generalProfileIdc,l>>>24,l>>>16,l>>>8,l,c[0],c[1],c[2],c[3],c[4],c[5],u.generalLevelIdc,240,0,252,252|u.chromaFormatIdc,248|u.bitDepthLumaMinus8,248|u.bitDepthChromaMinus8,0,0,u.numTemporalLayers<<3|u.temporalIdNested<<2|3,f];var d=function(e){var n;t.push(e.length>>8,e.length),(n=t).push.apply(n,r(e))};i.length&&(t.push(160,0,i.length),i.forEach(d)),a.length&&(t.push(161,0,a.length),a.forEach(d)),s.length&&(t.push(162,0,s.length),s.forEach(d))}else t=[1,1,96,0,0,0,144,0,0,0,0,0,93,240,0,252,253,248,248,0,0,15,3,160,0,1,0,24,64,1,12,1,255,255,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,153,152,9,161,0,1,0,45,66,1,1,1,96,0,0,3,0,144,0,0,3,0,0,3,0,93,160,2,128,128,45,22,89,153,164,147,43,154,128,128,128,130,0,0,3,0,2,0,0,3,0,50,16,162,0,1,0,7,68,1,193,114,180,98,64];return[o.size(8+t.length),o.type("hvcC"),new Uint8Array(t)]}},{key:"vvcC",value:function(e){var t=e.vvcC;return[o.size(8+t.byteLength),o.type("vvcC"),t]}},{key:"fiel",value:function(){return[o.size(10),o.type("fiel"),new Uint8Array([1,0])]}},{key:"pasp",value:function(e){if(e.width&&e.height){var t=e.width,n=e.height;return[o.size(16),o.type("pasp"),new Uint8Array([t>>24,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n])]}return[]}},{key:"stts",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return o.initBox(16,"stts",e)}},{key:"stsc",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return o.initBox(16,"stsc",e)}},{key:"stco",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0]);return o.initBox(16,"stco",e)}},{key:"stsz",value:function(){var e=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return o.initBox(20,"stsz",e)}},{key:"mvex",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=arguments.length>2?arguments[2]:void 0,n=new i.Z,r=i.Z.writeUint32(e);return n.write(o.size(56),o.type("mvex"),o.size(16),o.type("mehd"),o.extension(0,0),r,o.trex(t)),n.buffer}},{key:"trex",value:function(e){var t=new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return o.initBox(8+t.byteLength,"trex",t)}},{key:"moof",value:function(e){var t=8,n=o.mfhd(),i=o.traf(e);return[n,i].forEach(function(e){t+=e.byteLength}),o.initBox(t,"moof",n,i)}},{key:"mfhd",value:function(){var e=i.Z.writeUint32(o.sequence);return o.sequence+=1,o.initBox(16,"mfhd",o.extension(0,0),e)}},{key:"traf",value:function(e){var t=8,n=o.tfhd(e.id),i=o.tfdt(e.time),r=o.sdtp(e),a=o.trun(e,r.byteLength);return[n,i,a,r].forEach(function(e){t+=e.byteLength}),o.initBox(t,"traf",n,i,a,r)}},{key:"tfhd",value:function(e){var t=i.Z.writeUint32(e);return o.initBox(16,"tfhd",o.extension(0,0),t)}},{key:"tfdt",value:function(e){return o.initBox(16,"tfdt",o.extension(0,0),i.Z.writeUint32(e))}},{key:"trun",value:function(e,t){var n=new i.Z,r=i.Z.writeUint32(e.samples.length),a=i.Z.writeUint32(92+16*e.samples.length+t);return n.write(o.size(20+16*e.samples.length),o.type("trun"),new Uint8Array([0,0,15,1]),r,a),e.samples.forEach(function(e){var t=e.flags;n.write(new Uint8Array([e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,e.size>>>24&255,e.size>>>16&255,e.size>>>8&255,255&e.size,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.isNonSync,0,0,e.cts>>>24&255,e.cts>>>16&255,e.cts>>>8&255,255&e.cts]))}),n.buffer}},{key:"sdtp",value:function(e){var t=new i.Z;return t.write(o.size(12+e.samples.length),o.type("sdtp"),o.extension(0,0)),e.samples.forEach(function(e){var n=e.flags,i=n.isLeading<<6|n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;t.write(new Uint8Array([i]))}),t.buffer}},{key:"mdat",value:function(e){var t=new i.Z,n=8;e.samples.forEach(function(e){n+=e.size}),t.write(o.size(n),o.type("mdat"));var r=new Uint8Array(n),a=0;return r.set(t.buffer,a),a+=8,e.samples.forEach(function(e){e.buffer.forEach(function(e){r.set(e,a),a+=e.byteLength})}),r}}],n&&a(e,n),o}();s.type=function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])},s.sequence=1,t.Z=s},266427:function(e,t,n){"use strict";var i=n(515738),r=n(225629);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var s={DONE:"done",NOBUFFER:"nobuffer",READERROR:"readerror"},u=i.Z.LOADER_EVENTS,l=function(){var e,t,n;function i(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,i),this.configs=Object.assign({},e),this.url=null,this.status=0,this.error=null,this._reader=null,this._canceled=!1,this._destroyed=!1,this.readtype=this.configs.readtype,this.buffer=this.configs.buffer||"LOADER_BUFFER",this._loaderTaskNo=0,this._ttfbInfo=null,this._responseHeader=null,this._completeState="",this._speed=new r.Z,window.AbortController&&(this.abortControllerEnabled=!0)}return e=i,t=[{key:"init",value:function(){this.on(u.LADER_START,this.load.bind(this))}},{key:"fetch",value:function(e){function t(t,n,i,r){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,i){var r=this;if(i)return new Promise(function(t,n){var o,a=new Response(i);Object.defineProperty(a,"url",{value:e}),null===(o=r._speed)||void 0===o||o.recordLoading(a.headers),t(a)});var o=null;this.abortControllerEnabled&&(this.abortController=new window.AbortController),Object.assign(t,{signal:this.abortController?this.abortController.signal:void 0});var a=new Date().getTime();return Promise.race([fetch(e,t),new Promise(function(e,t){o=setTimeout(function(){t({code:999,message:"fetch timeout"}),r.abortController&&r.abortController.abort()},n||1e4)})]).then(function(t){o&&(clearTimeout(o),o=null),null===(n=r._speed)||void 0===n||n.recordLoading(t.headers);var n,i=new Date().getTime();return r._ttfbInfo={url:e,responseUrl:t.url,start:a,end:i,elapsed:i-a,ok:t.ok},r.emit(u.LOADER_TTFB,r._ttfbInfo),t})})},{key:"internalLoad",value:function(e,t,n,i){var r=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,s=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0;if(!this._destroyed)return this.loading=!0,this.fetch(this.url,t,a,l).then(function(l){if(r._destroyed||r.emit(u.LOADER_RESPONSE_HEADERS,r.TAG,l.headers),r._responseHeader=l.headers,l.ok)return r.status=l.status,Promise.resolve().then(function(){r._onFetchResponse(l,s)}),Promise.resolve(l);n-- >0?r._retryTimer=setTimeout(function(){return r.emit(u.LOADER_RETRY,r.TAG,{response:l,reason:"response not ok",retryTime:i-n}),r.internalLoad(e,t,n,i,o,a,s)},o):(r.loading=!1,r.emit(u.LOADER_ERROR,r.TAG,{code:l.status||21,message:"".concat(l.status," (").concat(l.statusText,")")}))}).catch(function(l){if(r._destroyed||l&&"AbortError"===l.name){r.loading=!1;return}if(n-- >0)r._retryTimer=setTimeout(function(){return r.emit(u.LOADER_RETRY,r.TAG,{error:l,reason:"fetch error",retryTime:i-n}),r.internalLoad(e,t,n,i,o,a,s)},o);else{if(r.loading=!1,l&&"AbortError"===l.name)return;r.emit(u.LOADER_ERROR,r.TAG,Object.assign({code:21},l))}})}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.retryCount,r=n.retryDelay,o=n.loadTimeout,a=n.maxReaderInterval,s=n.stream;if(!e){this.emit(u.LOADER_ERROR,this.TAG,{code:0,message:"empty url"});return}i=void 0===i?3:i,this.url=e,this._canceled=!1;var l=this.getParams(t);return this.internalLoad(e,l,i,i,r,o,a,s)}},{key:"_onFetchResponse",value:function(e,t){var n,i=this,r=this,o=this._context.getInstance(this.buffer);this._loaderTaskNo++;var a=this._loaderTaskNo;if(!0===e.ok){switch(this.readtype){case 2:n=e.json();break;case 1:n=e.text();break;case 3:n=e.arrayBuffer();break;default:return this._onReader(e.body.getReader(),a,t)}if(!n)return;n.then(function(e){var t;null===(t=i._speed)||void 0===t||t.recordLoaded(),r.loading=!1,!r._canceled&&!r._destroyed&&(o?(o.push(e instanceof ArrayBuffer?new Uint8Array(e):e),r.emit(u.LOADER_COMPLETE,o)):r.emit(u.LOADER_COMPLETE,e))}).catch(function(){})}}},{key:"_onReader",value:function(e,t,n){var i=this,r=this._context.getInstance(this.buffer);if(!r&&this._reader||this._destroyed)try{this._reader.cancel()}catch(e){}if(this._reader=e,!1!==this.loading)this._noDataTimer=setTimeout(function(){!1!==i.loading&&i.emit(u.LOADER_COMPLETE,i._completeState||s.NOBUFFER)},n||3e3),this._reader&&this._reader.read().then(function(o){var a,l;if(clearTimeout(i._noDataTimer),i._canceled||i._destroyed){if(i._reader)try{i._reader.cancel()}catch(e){}return}if(o.done){i.loading=!1,i.status=0,null===(l=i._speed)||void 0===l||l.destroy(),Promise.resolve().then(function(){i.emit(u.LOADER_COMPLETE,s.DONE)});return}return r.push(o.value),null===(a=i._speed)||void 0===a||a.recordChunk(o.value.byteLength),Promise.resolve().then(function(){i.emit(u.LOADER_DATALOADED,r)}),i._onReader(e,t,n)}).catch(function(e){i._completeState=s.READERROR,(!e||"AbortError"!==e.name&&"network error"!==e.message)&&(i.loading=!1,clearTimeout(i._noDataTimer),i.emit(u.LOADER_ERROR,i.TAG,e))})}},{key:"getParams",value:function(e){var t=Object.assign({},e),n=new Headers,i={method:"GET",headers:n,mode:"cors",cache:"default"};if("object"===o(this.configs.headers)){var r=this.configs.headers;for(var a in r)r.hasOwnProperty(a)&&n.append(a,r[a])}if("object"===o(t.headers)){var s=t.headers;for(var u in s)s.hasOwnProperty(u)&&n.append(u,s[u])}return!1===t.cors&&(i.mode="same-origin"),t.withCredentials&&(i.credentials="include"),i}},{key:"ttfbInfo",get:function(){return this._ttfbInfo}},{key:"avgSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.avgSpeed)||0}},{key:"recentSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.recentSpeed)||0}},{key:"currentSpeed",get:function(){var e;return(null===(e=this._speed)||void 0===e?void 0:e.avgSpeed)/8e3}},{key:"totalByteSize",get:function(){var e;return null===(e=this._speed)||void 0===e?void 0:e.totalByteSize}},{key:"responseHeader",get:function(){return this._responseHeader}},{key:"cancel",value:function(){var e;if(this._reader){try{var t=this._reader.cancel();t.catch&&t.catch(function(e){})}catch(e){}this._reader=null,this.loading=!1}clearTimeout(this._noDataTimer),this._canceled=!0,this.abortController&&this.abortController.abort(),null===(e=this._speed)||void 0===e||e.clean()}},{key:"destroy",value:function(){var e;this._destroyed=!0,this._responseHeader=null,clearTimeout(this._retryTimer),clearTimeout(this._noDataTimer),this.cancel(),null===(e=this._speed)||void 0===e||e.destroy(),this._speed=null}}],n=[{key:"isSupported",value:function(){return!!window.fetch}},{key:"type",get:function(){return"loader"}}],t&&a(e.prototype,t),n&&a(e,n),i}();t.Z=l},385021:function(e,t){"use strict";t.Z={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}}},760608:function(e,t,n){"use strict";var i=n(767449),r=n(928673),o=n(85002),a=n(758454),s=n(862783);function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,p(i.key),i)}}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e,t,n){return(t=p(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){var t=function(e,t){if("object"!==u(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==u(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===u(t)?t:String(t)}var v={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",POSTER:"poster"},y=null,m=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(_,e);var t,n,a,p,m,g=(t=_,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=d(t);return e=n?Reflect.construct(i,arguments,d(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===u(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return f(e)}(this,e)});function _(){var e;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,_);for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];return h(f(e=g.call.apply(g,[this].concat(n))),"onLoadedData",function(t){if(!!e.player)e._frameCount=e.config.startFrameCount,e.stop(),e.renderOnTimeupdate(t),e.off(i.MH,e.renderOnTimeupdate),e.on(i.MH,e.renderOnTimeupdate)}),h(f(e),"onVisibilitychange",function(t){"visible"===document.visibilityState?e._checkIfCanStart()&&e.start():"hidden"===document.visibilityState&&e.stop()}),h(f(e),"renderOnTimeupdate",function(t){if(e._frameCount>0)e.renderOnce(),e._frameCount--;else{e._isLoaded=!0,e.off(i.MH,e.renderOnTimeupdate);var n=e.config.startInterval;!e.player.paused&&e._checkIfCanStart()&&e.start(0,n)}}),h(f(e),"start",function(t,n){var i=e.player.video,o=function(){try{return parseInt(window.performance.now(),10)}catch(e){return new Date().getTime()}}(),a=e.checkVideoIsSupport(i);if(!!a&&!!e.canvasCtx)!n&&(n=e.interval),e.stop(),i.videoWidth&&i.videoHeight&&(e.videoPI=i.videoHeight>0?parseInt(i.videoWidth/i.videoHeight*100,10):0,e.config.mode===v.REAL_TIME?(i&&i.videoWidth&&e.update(a,e.videoPI),e.preTime=o):o-e.preTime>=n&&(i&&i.videoWidth&&e.update(a,e.videoPI),e.preTime=o)),e.frameId="timer"===e._loopType?r.ZP.setTimeout(f(e),e.start,n):r.ZP.requestAnimationFrame(e.start)}),h(f(e),"stop",function(){e.frameId&&("timer"===e._loopType?r.ZP.clearTimeout(f(e),e.frameId):r.ZP.cancelAnimationFrame(e.frameId),e.frameId=null)}),e}return a=_,p=[{key:"afterCreate",value:function(){var e=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),!_.isSupport&&(this.config.disable=!0);var t=this.config,n=t.disable,r=t.mode,o=t.frameRate;if(n)return;this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/o,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this._loopType=this.config.mode!==v.REAL_TIME&&this.interval>=1e3?"timer":"animation";var a=function(){if(!!e.player)e.init(),e.renderByPoster(),!e.player.paused&&e.start()};if(this.player.hasStart?a():this.once(i.ly,a),r!==v.POSTER)r!==v.FIRST_FRAME&&(this.on(i.RG,function(){e.stop()}),this.on(i.NH,function(){var t=e.config.startInterval;e._checkIfCanStart()&&e.start(0,t)}),this.on(i.E7,function(){e.stop()})),this.on(i.c3,this.onLoadedData),this.on(i.HX,function(){e._isLoaded=!1,e.stop()}),document.addEventListener("visibilitychange",this.onVisibilitychange)}},{key:"setConfig",value:function(e){var t=this;Object.keys(e).forEach(function(n){"root"===n&&e[n]!==t.config[n]?t.reRender(e[n]):"frameRate"===n?t.interval=parseInt(1e3/e[n],10):"disable"===n&&e[n]&&t.stop(),t.config[n]=e[n]})}},{key:"init",value:function(e){var t=this.player,n=this.config;this.canvasFilter=_.supportCanvasFilter();try{var i=e||n.root;!i&&(i=n.isInnerRender&&t.innerContainer||t.root),i.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg" data-index="'.concat(n.index,'"><canvas>\n        </canvas><xgmask></xgmask></div>')),this.root=i.children[0],this.canvas=this.find("canvas"),!this.canvasFilter&&(this.canvas.style.filter=n.filter,this.canvas.style.webkitFilter=n.filter),this.mask=this.find("xgmask"),n.addMask&&(this.mask.style.background=n.maskBg),this.canvasCtx=this.canvas.getContext("2d")}catch(e){s.Z.logError("plugin:DynamicBg",e)}}},{key:"reRender",value:function(e){if(!!this.config.disable||!!this.root){this.stop();var t=this.root?this.root.parentElement:null;if(t!==e&&t.removeChild(this.root),!e){this.root=null;return}this.init(e),this.renderOnce();var n=this.config.startInterval;this._checkIfCanStart()&&this.start(0,n)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&!("safari"===o.Z.browser&&r.ZP.isMSE(t)))return t;var n=t?t.tagName.toLowerCase():"";return"canvas"===n||"img"===n?t:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var t="String"===r.ZP.typeOf(e)?e:"String"===r.ZP.typeOf(e.poster)?e.poster:null;this.updateImg(t)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&!this.player.paused&&e!==v.FIRST_FRAME&&e!==v.POSTER}},{key:"renderOnce",value:function(){var e=this.player.video;if(!!e.videoWidth&&!!e.videoHeight){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var t=this.checkVideoIsSupport(e);t&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(e){var t=this;if(!!e){var n=this.canvas.getBoundingClientRect(),i=n.width,r=n.height,o=new window.Image;o.onload=function(){if(!!t.canvas&&!t.frameId&&!t.isStart){t.canvas.height=r,t.canvas.width=i;var e=parseInt(i/r*100,10);t.update(o,e),o=null}},o.src=e}}},{key:"update",value:function(e,t){if(!!this.canvas&&!!this.canvasCtx&&!!t)try{var n=this._pos,i=this.config,r=this.canvas.getBoundingClientRect(),o=r.width,a=r.height;if(o!==n.width||a!==n.height||n.pi!==t){var u=parseInt(o/a*100,10);n.pi=t,n.width!==o&&(n.width=this.canvas.width=o),n.height!==a&&(n.height=this.canvas.height=a);var l=a,c=o;u<t?c=parseInt(a*t/100,10):u>t&&(l=parseInt(100*o/t,10)),n.rwidth=c*i.multiple,n.rheight=l*i.multiple,n.x=(o-n.rwidth)/2,n.y=(a-n.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=i.filter),this.canvasCtx.drawImage(e,n.x,n.y,n.rwidth,n.rheight)}catch(e){s.Z.logError("plugin:DynamicBg",e)}}},{key:"destroy",value:function(){this.stop(),document.removeEventListener("visibilitychange",this.onVisibilitychange),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],m=[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,index:-1,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,startInterval:0,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"==typeof y?y:y=function(){try{if(document.createElement("canvas").getContext)return!0;return!1}catch(e){return!1}}()}},{key:"supportCanvasFilter",value:function(){return!("safari"===o.Z.browser||"firefox"===o.Z.browser)}}],p&&l(a.prototype,p),m&&l(a,m),Object.defineProperty(a,"prototype",{writable:!1}),_}(a.ZP);t.Z=m},393033:function(e,t,n){"use strict";var i=n(928673),r=n(758454);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!==o(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==o(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===o(t)?t:String(t)}(i.key),i)}}function s(e,t){return(s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&s(e,t)}(d,e);var t,n,r,l,c,f=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=u(t);return e=n?Reflect.construct(i,arguments,u(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===o(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d),f.apply(this,arguments)}return r=d,c=[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}],l=[{key:"render",value:function(){var e=this.config.innerHtml,t=i.ZP.createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"==typeof e)t.innerHTML=e;else{for(var n="",r=1;r<=12;r++)n+='<div class="xgplayer-enter-bar'.concat(r,'"></div>');t.innerHTML='<div class="xgplayer-enter-spinner">'.concat(n,"</div>")}return t}}],a(r.prototype,l),c&&a(r,c),Object.defineProperty(r,"prototype",{writable:!1}),d}(r.ZP);t.Z=l},92969:function(e,t,n){"use strict";n.d(t,{Z:function(){return E}});var i=n("928673"),r=n("767449"),o=n("85002"),a=n("55637"),s=n("758454"),u=n("910730");function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==l(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===l(t)?t:String(t)}(i.key),i)}}function f(e,t){return(f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var h=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&f(e,t)}(h,e);var t,n,r,o,a,u=(t=h,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=d(t);return e=n?Reflect.construct(i,arguments,d(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===l(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function h(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,h),u.apply(this,arguments)}return r=h,o=[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(t){t.preventDefault(),t.stopPropagation(),e.config.onClick(t)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:'<svg width="32" height="40" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M11.237 14l6.382-6.381A.875.875 0 1016.38 6.38l-7 7a.875.875 0 000 1.238l7 7a.875.875 0 101.238-1.238L11.237 14z" fill="#FFF" fill-rule="evenodd"/></svg>',class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){i.ZP.addClass(this.root,"show")}},{key:"hide",value:function(){i.ZP.removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],a=[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:s.kd.ROOT_TOP,index:0}}}],o&&c(r.prototype,o),a&&c(r,a),Object.defineProperty(r,"prototype",{writable:!1}),h}(s.ZP);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,b(i.key),i)}}function y(){return(y="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(arguments.length<3?e:n):r.value}}).apply(this,arguments)}function m(e,t){return(m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function g(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e){var t=function(e,t){if("object"!==p(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==p(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===p(t)?t:String(t)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&m(e,t)}(d,e);var t,n,u,l,c,f=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=_(t);return e=n?Reflect.construct(i,arguments,_(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===p(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return g(e)}(this,e)});function d(){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d);for(var e,t,n,i,r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return t=g(e=f.call.apply(f,[this].concat(o))),n="_onOrientationChange",i=function(t){e.player.fullscreen&&e.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?e.setRotateDeg(0):e.setRotateDeg(90))},(n=b(n))in t?Object.defineProperty(t,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[n]=i,e}return u=d,l=[{key:"afterCreate",value:function(){var e=this;y(_(d.prototype),"afterCreate",this).call(this);var t=this.config,n=this.playerConfig;t.target&&(this.playerConfig.fullscreenTarget=this.config.target);var a=i.ZP.getFullScreenEl();n.fullscreenTarget===a&&this.player.getFullscreen().catch(function(){}),this.initIcons(),this.handleFullscreen=this.hook("fullscreen_change",this.changeFullScreen,{pre:function(t){if(!e.config.disable)e.emitUserAction(t,"switch_fullscreen",{fullscreen:e.player.fullscreen})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(r.GS,function(t){e.changeLangTextKey(e.find(".xg-tips"),t?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(t),e.config.needBackIcon&&e.show()}),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:h,options:{config:{onClick:function(t){e.handleFullscreen(t)}}}})),"mobile"===o.Z.device&&window.addEventListener("orientationchange",this._onOrientationChange)}},{key:"registerIcons",value:function(){return{fullscreen:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40"><path fill="#fff" d="M19.173 6.861h6.798v6.798h-2.694V9.555h-4.104V6.86zm4.104 16.416v-4.104h2.694v6.798h-6.798v-2.694h4.104zM6.861 13.66V6.86h6.798v2.694H9.555v4.104H6.86zm2.694 5.514v4.104h4.104v2.694H6.86v-6.798h2.694z"/></svg>',class:"xg-get-fullscreen"},exitFullscreen:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40"><path fill="#fff" d="M21.867 10.965h4.104v2.694h-6.798V6.86h2.694v4.104zm-2.694 15.006v-6.798h6.798v2.694h-4.104v4.104h-2.694zm-8.208-15.006V6.861h2.694v6.798H6.86v-2.694h4.104zM6.861 21.867v-2.694h6.798v6.798h-2.694v-4.104H6.861z"/></svg>',class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){y(_(d.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon","mobile"===o.Z.device?"touchend":"click",this.handleFullscreen),"mobile"===o.Z.device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"setRotateDeg",value:function(e){var t=this.player;90===window.orientation||-90===window.orientation?t.rotateDeg=0:t.rotateDeg=e}},{key:"getRotateFullscreen",value:function(e){var t=this.player;t.isCssfullScreen&&t.exitCssFullscreen(e);var n=e?a.Z.INNER_FULLSCREEN:a.Z.ROTATE_FULLSCREEN;t._fullscreenEl=e||t.root,t.changeFullStyle(t.root,e,n,a.Z.PARENT_ROTATE_FULLSCREEN),t.fullscreen=!0,this.setRotateDeg(90),this.emit(r.GS,!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this.player;t.fullscreen=!1;var n=t._fullscreenEl!==t.root?a.Z.INNER_FULLSCREEN:a.Z.ROTATE_FULLSCREEN;t.recoverFullStyle(t.root,t._fullscreenEl,n,a.Z.PARENT_ROTATE_FULLSCREEN),this.setRotateDeg(0),this.emit(r.GS,!1)}},{key:"changeFullScreen",value:function(e){var t=this.player,n=this.config;if(!n.disable){e&&(e.preventDefault(),e.stopPropagation());var i=!1;if((!0===n.useCssFullscreen||"function"==typeof n.useCssFullscreen&&n.useCssFullscreen())&&(i=!0),i)t.fullscreen?(t.fullscreen=!1,t.exitCssFullscreen(),this.emit(r.GS,!1)):(t.fullscreen=!0,t.getCssFullscreen(),this.emit(r.GS,!0)),this.animate(t.fullscreen);else if(n.rotateFullscreen)t.fullscreen?this.exitRotateFullscreen():this.getRotateFullscreen(),this.animate(t.fullscreen);else{if(n.switchCallback&&"function"==typeof n.switchCallback){n.switchCallback(t.fullscreen);return}t.fullscreen?t.exitFullscreen():t.getFullscreen().catch(function(){})}}}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"show",value:function(){y(_(d.prototype),"show",this).call(this)}},{key:"hide",value:function(){y(_(d.prototype),"hide",this).call(this)}},{key:"render",value:function(){var e="FULLSCREEN_TIPS";return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    <div class="xg-tips" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</div>\n    </xg-icon>")}}],c=[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:s.kd.CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}],l&&v(u.prototype,l),c&&v(u,c),Object.defineProperty(u,"prototype",{writable:!1}),d}(u.Z)},812905:function(e,t,n){"use strict";var i=n(767449),r=n(962190),o=n(928673);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==a(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===a(t)?t:String(t)}function p(e){var t=e.tagName;return"INPUT"===t||"TEXTAREA"===t||!!e.isContentEditable||!1}var v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(m,e);var t,n,r,h,v,y=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=f(t);return e=n?Reflect.construct(i,arguments,f(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===a(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return c(e)}(this,e)});function m(){var e;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,m);for(var t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return d(c(e=y.call.apply(y,[this].concat(n))),"onBodyKeyDown",function(t){if(!!e.player){var n=t||window.event,i=n.target,r=n.keyCode,o=c(e),a=o._keyState,s=o.player,u=e.config,l=u.disable,f=u.disableBodyTrigger,d=u.isIgnoreUserActive,h=i.ownerDocument;if(l||f||!s.isUserActive&&!d||p(i)||!e.checkIsVisible()||n.metaKey||n.altKey||n.ctrlKey){a.isBodyKeyDown=!1;return}!t.repeat&&!a.isKeyDown&&((i===h.body||e.config.isGlobalTrigger&&!p(i))&&e.checkCode(r,!0)&&(a.isBodyKeyDown=!0),h.addEventListener("keyup",e.onBodyKeyUp)),a.isBodyKeyDown&&e.handleKeyDown(n)}}),d(c(e),"onBodyKeyUp",function(t){if(!!e.player)(t||window.event).target.ownerDocument.removeEventListener("keyup",e.onBodyKeyUp),e.handleKeyUp(t)}),d(c(e),"onKeydown",function(t){if(!e.player)return;var n=t||window.event,i=c(e)._keyState;if(!n.repeat){if(e.config.disable||e.config.disableRootTrigger||n.metaKey||n.altKey||n.ctrlKey||!e.player.isUserActive&&!e.config.isIgnoreUserActive)return;n&&(37===n.keyCode||e.checkCode(n.keyCode))&&(n.target===e.player.root||n.target===e.player.video||n.target===e.player.controls.el)&&(i.isKeyDown=!0),e.player.root.addEventListener("keyup",e.onKeyup)}if(!!i.isKeyDown)e.handleKeyDown(n)}),d(c(e),"onKeyup",function(t){if(!!e.player)e.player.root.removeEventListener("keyup",e.onKeyup),e.handleKeyUp(t)}),e}return r=m,v=[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!1,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!1,keyCodeMap:{},disable:!1,playbackRate:2,isIgnoreUserActive:!1}}}],h=[{key:"setConfig",value:function(e,t){var n=this;if(!e)return;var i=Object.keys(e);if(!(i.length<1))i.forEach(function(i){t.deepMerge&&"Object"===o.ZP.typeOf(n.config[i])?o.ZP.deepMerge(n.config[i],e[i]):n.config[i]=e[i]}),this.mergekeyCodeMap()}},{key:"mergekeyCodeMap",value:function(){var e=this,t=this.config.keyCodeMap;t&&Object.keys(t).map(function(n){e.keyCodeMap[n]?["keyCode","action","disable","pressAction","disablePress","isBodyTarget"].map(function(i){t[n][i]&&(e.keyCodeMap[n][i]=t[n][i])}):e.keyCodeMap[n]=t[n]})}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e="function"==typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;!(!e||"number"!=typeof e)&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,disablePress:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,disablePress:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,disablePress:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disablePress:!1,disable:!1},right:{keyCode:39,action:"seek",pressAction:"changePlaybackRate",disablePress:!1,disable:!1},esc:{keyCode:27,action:"exitFullscreen",disablePress:!0,disable:!1}},this.mergekeyCodeMap(),this._keyState={isKeyDown:!1,isBodyKeyDown:!1,isPress:!1,tt:0,playbackRate:0},this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),t=e.height,n=e.top,i=e.bottom,r=window.innerHeight;return(!(n<0)||!(n<0-.9*t))&&(!(i>0)||!(i-r>.9*t))&&!0}},{key:"checkCode",value:function(e,t){var n=this,i=!1;return Object.keys(this.keyCodeMap).map(function(r){n.keyCodeMap[r]&&e===n.keyCodeMap[r].keyCode&&!n.keyCodeMap[r].disable&&(i=!t||t&&!n.keyCodeMap[r].noBodyTarget)}),i}},{key:"downVolume",value:function(e){var t=this.player;if(!(t.volume<=0)){var n=parseFloat((t.volume-.1).toFixed(1)),i={volume:{from:t.volume,to:n}};this.emitUserAction(e,"change_volume",{props:i}),n>=0?t.volume=n:t.volume=0}}},{key:"upVolume",value:function(e){var t=this.player;if(!(t.volume>=1)){var n=parseFloat((t.volume+.1).toFixed(1)),i={volume:{from:t.volume,to:n}};this.emitUserAction(e,"change_volume",{props:i}),n<=1?t.volume=n:t.volume=1}}},{key:"seek",value:function(e){var t=this.player,n=t.currentTime,i=t.duration,r=n,o=e.repeat&&this.seekStep>=4?parseInt(this.seekStep/2,10):this.seekStep;r=n+o<=i?n+o:i;var a={currentTime:{from:n,to:r}};this.emitUserAction(e,"seek",{props:a}),this.player.currentTime=r}},{key:"seekBack",value:function(e){var t=this.player.currentTime,n=e.repeat?parseInt(this.seekStep/2,10):this.seekStep,i=0;t-n>=0&&(i=t-n);var r={currentTime:{from:t,to:i}};this.emitUserAction(e,"seek",{props:r}),this.player.currentTime=i}},{key:"changePlaybackRate",value:function(e){var t=this._keyState,n=this.config,i=this.player;0===t.playbackRate&&(t.playbackRate=i.playbackRate,i.playbackRate=n.playbackRate)}},{key:"playPause",value:function(e){var t=this.player;if(!!t)this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause()}},{key:"exitFullscreen",value:function(e){var t=this.player,n=t.fullscreen,i=t.cssfullscreen;n&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:n,to:!n}),t.exitFullscreen()),i&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:i,to:!i}),t.exitCssFullscreen())}},{key:"handleKeyDown",value:function(e){var t,n=this._keyState;if(e.repeat){n.isPress=!0;var i=Date.now();if(i-n.tt<200)return;n.tt=i}(t=e).preventDefault(),t.returnValue=!1,this.handleKeyCode(e.keyCode,e,n.isPress)}},{key:"handleKeyUp",value:function(e){var t=this._keyState;t.playbackRate>0&&(this.player.playbackRate=t.playbackRate,t.playbackRate=0),t.isKeyDown=!1,t.isPress=!1,t.tt=0}},{key:"handleKeyCode",value:function(e,t,n){for(var r=Object.keys(this.keyCodeMap),o=0;o<r.length;o++){var a=this.keyCodeMap[r[o]];if(!!a){var u=a.action,l=a.keyCode,c=a.disable,f=a.pressAction,h=a.disablePress;if(l===e){if(!c&&!(n&&h)){var p=n&&f||u;"function"==typeof p?u(t,this.player,n):"string"==typeof p&&"function"==typeof this[p]&&this[p](t,this.player,n),this.emit(i.dc,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach(function(t){d(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({key:r[o],target:t.target,isPress:n},this.keyCodeMap[r[o]]))}break}}}}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown),this.player.root.removeEventListener("keyup",this.onKeyup),document.removeEventListener("keyup",this.onBodyKeyUp)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],u(r.prototype,h),v&&u(r,v),Object.defineProperty(r,"prototype",{writable:!1}),m}(r.ZP);t.Z=v},505567:function(e,t,n){"use strict";var i=n(758454);function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==r(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===r(t)?t:String(t)}(i.key),i)}}function a(e,t){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var u=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(d,e);var t,n,u,l,c,f=(t=d,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=s(t);return e=n?Reflect.construct(i,arguments,s(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,e)});function d(){return!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,d),f.apply(this,arguments)}return u=d,l=[{key:"registerIcons",value:function(){return{loadingIcon:'<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110"><path d="M100 50A50 50 0 1150 0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"/></svg>'}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],c=[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:i.kd.ROOT}}}],l&&o(u.prototype,l),c&&o(u,c),Object.defineProperty(u,"prototype",{writable:!1}),d}(i.ZP);t.Z=u},135319:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var i=n("928673"),r=n("767449"),o=n("758454"),a=n("639360"),s=n("879146"),u=n.n(s);function l(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){var t=function(e,t){if("object"!==h(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==h(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===h(t)?t:String(t)}(i.key),i)}}function c(e,t){return(c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function f(e,t){if(t&&("object"===h(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function d(e){return(d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e){var t=parseFloat(e);return -1===e.indexOf("%")&&!Number.isNaN(t)&&t}var v=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],y=v.length;function m(e){if("string"==typeof e&&(e=document.querySelector(e)),!!e&&"object"===h(e)&&!!e.nodeType){var t,n=(t=e,window.getComputedStyle(t));if("none"===n.display)return function(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<y;t++)e[v[t]]=0;return e}();var i={};i.width=e.offsetWidth,i.height=e.offsetHeight;for(var r=i.isBorderBox="border-box"===n.boxSizing,o=0;o<y;o++){var a=v[o],s=parseFloat(n[a]);i[a]=Number.isNaN(s)?0:s}var u=i.paddingLeft+i.paddingRight,l=i.paddingTop+i.paddingBottom,c=i.marginLeft+i.marginRight,f=i.marginTop+i.marginBottom,d=i.borderLeftWidth+i.borderRightWidth,m=i.borderTopWidth+i.borderBottomWidth,g=p(n.width);!1!==g&&(i.width=g+(r?0:u+d));var _=p(n.height);return!1!==_&&(i.height=_+(r?0:l+m)),i.innerWidth=i.width-(u+d),i.innerHeight=i.height-(l+m),i.outerWidth=i.width+c,i.outerHeight=i.height+f,i}}function g(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.identifier===t)return i}}var _={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},b={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&c(e,t)}(s,e);var t,n,i,r,o,a=(t=s,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=d(t);return e=n?Reflect.construct(i,arguments,d(this).constructor):i.apply(this,arguments),f(this,e)});function s(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).isEnabled=!0,t.isDragging=!1,t.isDown=!1,t.position={},t.downPoint={},t.dragPoint={x:0,y:0},t.startPos={x:0,y:0},t._root=e instanceof Element?e:document.querySelector(e),t._handlerDom=n.handle instanceof Element?n.handle:document.querySelector(n.handle),t._root&&t._handlerDom)?(t._bindStartEvent(),t):f(t)}return i=s,r=[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),b[this._startKey].map(function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)})}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(!!e){var n=b[this._startKey];n.map(function(e){window.addEventListener(e,t["on".concat(e)])}),this._boundPointerEvents=n}}},{key:"_unbindPostStartEvents",value:function(){var e=this;if(!!this._boundPointerEvents)this._boundPointerEvents.map(function(t){window.removeEventListener(t,e["on".concat(t)])}),delete this._boundPointerEvents}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;if(!!this.isDragging)this.positionDrag(),window.requestAnimationFrame(function(){e.animate()})}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=g(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=g(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=g(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(!!this._root&&!this.isDown&&!!this.isEnabled){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var n=m(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-n.height,this.startPos.maxX=window.innerWidth-n.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(_.START,this.startPos)}},{key:"dragEnd",value:function(e,t){if(!!this._root)this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(_.ENDED)),this.presetInfo()}},{key:"_dragPointerMove",value:function(e,t){var n={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(n)&&this.dragRealStart(e,t),n}},{key:"dragMove",value:function(e,t){if(e=e||window.event,!!this.isDown){var n=this.startPos,i=n.x,r=n.y,o=this._dragPointerMove(e,t),a=o.x,s=o.y;a=this.checkContain("x",a,i),s=this.checkContain("y",s,r),this.position.x=i+a,this.position.y=r+s,this.dragPoint.x=a,this.dragPoint.y=s,this.emit(_.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,n){return t+n<0?0-n:"x"===e&&t+n>this.startPos.maxX?this.startPos.maxX-n:"y"===e&&t+n>this.startPos.maxY?this.startPos.maxY-n:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),n=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(n)?0:n,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(0===t.indexOf("matrix")){var n=t.split(","),i=0===t.indexOf("matrix3d")?12:4,r=parseInt(n[i],10),o=parseInt(n[i+1],10);this.position.x+=r,this.position.y+=o}}},{key:"_getPositionCoord",value:function(e,t){if(-1!==e.indexOf("%")){var n=m(this._root.parentNode);return n?parseFloat(e)/100*n[t]:0}return parseInt(e,10)}}],l(i.prototype,r),Object.defineProperty(i,"prototype",{writable:!1}),s}(u());function S(e){return(S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,A(i.key),i)}}function k(e,t){return(k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function T(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function C(e){return(C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function O(e,t,n){return(t=A(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e){var t=function(e,t){if("object"!==S(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==S(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===S(t)?t:String(t)}var R=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(c,e);var t,n,o,s,u,l=(t=c,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=C(t);return e=n?Reflect.construct(i,arguments,C(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===S(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return T(e)}(this,e)});function c(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,c),O(T(t=l.call(this,e)),"onCancelClick",function(e){t.exitMini(),t.isClose=!0}),O(T(t),"onCenterClick",function(e){var n=T(t).player;n.paused?n.play():n.pause()}),O(T(t),"onScroll",function(e){if(!(!window.scrollY&&0!==window.scrollY||50>Math.abs(window.scrollY-t.pos.scrollY))){var n=parseInt(i.ZP.getCss(t.player.root,"height"));n+=t.config.scrollTop,t.pos.scrollY=window.scrollY,window.scrollY>n+5?t.isMini||t.isClose||t.getMini():window.scrollY<=n&&(t.isMini&&t.exitMini(),t.isClose=!1)}}),t.isMini=!1,t.isClose=!1;var t,n=T(t).config;return t.pos={left:n.left<0?window.innerWidth-n.width-20:n.left,top:n.top<0?window.innerHeight-n.height-20:n.top,height:t.config.height,width:t.config.width,scrollY:window.scrollY||0},t.lastStyle=null,t}return o=c,u=[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}],s=[{key:"beforeCreate",value:function(e){"boolean"==typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(r.E7,function(){e.setAttr("data-state","pause")}),this.on(r.NH,function(){e.setAttr("data-state","play")})}},{key:"onPluginsReady",value:function(){var e=this,t=this.player;if(!this.config.disable){this.config.isShowIcon&&t.controls.registerPlugin(a.Z,{config:{onClick:function(){e.getMini()}}},a.Z.pluginName);var n=i.ZP.checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",n,this.onCancelClick),this.bind(".play-icon",n,this.onCenterClick),!this.config.disableDrag&&(this._draggabilly=new E(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:'<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40"><path fill="#fff" d="M18.468 11.639l7.503 4.777-7.503 4.777zM10.965 6.86l7.503 4.778v9.554l-7.503 4.778z"/></svg>',class:"xg-icon-play"},pause:{icon:'<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40"><path fill="#fff" d="M19.173 6.861h5.451v19.11h-5.45V6.86zM8.208 25.971V6.86h5.45v19.11h-5.45z"/></svg>',class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,n=this.playerConfig,o=this.config.target||this.player.root;this.lastStyle={},i.ZP.addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map(function(t){e.lastStyle[t]=o.style[t],o.style[t]="".concat(e.pos[t],"px")}),n.fluid&&(o.style["padding-top"]=""),this.emit(r.VF,!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,n=this.playerConfig,o=this.config.target||this.player.root;i.ZP.removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map(function(t){o.style[t]=e.lastStyle[t]}),this.lastStyle=null,n.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(100*n.height/n.width,"%")),this.emit(r.VF,!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=i.ZP.checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      <div lang-key="'.concat(this.i18nKeys.MINI_DRAG,'">').concat(this.i18n.MINI_DRAG,'</div>\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],w(o.prototype,s),u&&w(o,u),Object.defineProperty(o,"prototype",{writable:!1}),c}(o.ZP)},627445:function(e,t,n){"use strict";var i=n(928673),r=n(85002),o=n(767449),a=n(758454);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,h(i.key),i)}}function l(e,t){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){var t=function(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!==s(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===s(t)?t:String(t)}var p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}(m,e);var t,n,h,p,v,y=(t=m,n=function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}(),function(){var e,i=f(t);return e=n?Reflect.construct(i,arguments,f(this).constructor):i.apply(this,arguments),function(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return c(e)}(this,e)});function m(){var e;!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,m);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return d(c(e=y.call.apply(y,[this].concat(n))),"onBarMousedown",function(t){var n=c(e).player,r=e.find(".xgplayer-bar");i.ZP.event(t);var o=r.getBoundingClientRect(),a=i.ZP.getEventPos(t,n.zoom),s=o.height-(a.clientY-o.top);if(a.h=s,a.barH=o.height,e.pos=a,!(s<-2))return e.updateVolumePos(s,t),document.addEventListener("mouseup",e.onBarMouseUp),e._d.isStart=!0,!1}),d(c(e),"onBarMouseMove",function(t){var n=c(e)._d;if(!n.isStart)return;var r=c(e),o=r.pos,a=r.player;t.preventDefault(),t.stopPropagation(),i.ZP.event(t);var s=i.ZP.getEventPos(t,a.zoom);n.isMoving=!0;var u=o.h-s.clientY+o.clientY;if(!(u>o.barH))e.updateVolumePos(u,t)}),d(c(e),"onBarMouseUp",function(t){i.ZP.event(t),document.removeEventListener("mouseup",e.onBarMouseUp);var n=c(e)._d;n.isStart=!1,n.isMoving=!1}),d(c(e),"onMouseenter",function(t){e._d.isActive=!0,e.focus(),e.emit("icon_mouseenter",{pluginName:e.pluginName})}),d(c(e),"onMouseleave",function(t){e._d.isActive=!1,e.unFocus(100,!1,t),e.emit("icon_mouseleave",{pluginName:e.pluginName})}),d(c(e),"onVolumeChange",function(t){if(!!e.player){var n=e.player,i=n.muted,r=n.volume;!e._d.isMoving&&(e.find(".xgplayer-drag").style.height=i||0===r?"4px":"".concat(100*r,"%"),e.config.showValueLabel&&e.updateVolumeValue()),e.animate(i,r)}}),d(c(e),"onIconHandle",function(t){e.changeMutedHandler(t)}),e}return h=m,p=[{key:"registerIcons",value:function(){return{volumeSmall:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40"><path fill="#fff" d="M7.907 7.907H3.39v6.778h4.518l5.648 5.648V2.259L7.907 7.907zM17.554 15.295L15.95 13.69c.612-.613.991-1.46.991-2.395s-.379-1.782-.991-2.395l1.604-1.604c1.03 1.02 1.669 2.435 1.669 3.999s-.638 2.979-1.669 3.998zm0 0L15.95 13.69c.612-.613.991-1.46.991-2.395s-.379-1.782-.991-2.395l1.604-1.604c1.03 1.02 1.669 2.435 1.669 3.999s-.638 2.979-1.669 3.998z"/></svg>',class:"xg-volume-small"},volumeLarge:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40"><path fill="#fff" d="M7.907 7.907H3.39v6.778h4.518l5.648 5.648V2.259L7.907 7.907zM20.753 18.48l-1.593-1.592c1.437-1.429 2.326-3.407 2.326-5.592s-.89-4.163-2.326-5.591l1.593-1.593c1.845 1.835 2.987 4.376 2.987 7.184s-1.142 5.349-2.987 7.184zm-3.199-3.185L15.95 13.69c.612-.613.991-1.46.991-2.395s-.379-1.782-.991-2.395l1.604-1.604c1.03 1.02 1.669 2.435 1.669 3.999s-.638 2.979-1.669 3.998z"/></svg>',class:"xg-volume"},volumeMuted:{icon:'<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40"><path fill="#fff" d="M7.907 7.907H3.39v6.778h4.518l5.648 5.648V2.259L7.907 7.907zM20.306 9.703l-2.394-2.406-1.604 1.604 2.417 2.395-2.406 2.395 1.604 1.604 2.383-2.418 2.395 2.406 1.604-1.604-2.417-2.383 2.406-2.395-1.604-1.604-2.384 2.418z"/></svg>',class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},this.initIcons();var t=this.playerConfig,n=t.commonStyle,a=t.volume;n.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=n.volumeColor),this.changeMutedHandler=this.hook("mutedChange",function(t){e.changeMuted(t)},{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),("mobile"!==r.Z.device&&"mobile"!==this.playerConfig.isMobileSimulateMode||"compatible"===this.domEventType)&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider",["mousedown","touchstart"],this.onBarMousedown),this.bind(".xgplayer-slider",["mousemove","touchmove"],this.onBarMouseMove),this.bind(".xgplayer-slider",["mouseup","touchend"],this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.onIconHandle),this.on(o.Y7,this.onVolumeChange),this.once(o.c3,this.onVolumeChange),("Number"!==i.ZP.typeOf(a)||a<0||a>1)&&(this.player.volume=this.config.default),this.onVolumeChange(),this.config.disable&&this.disable()}},{key:"updateVolumePos",value:function(e,t){var n=this.player,i=this.find(".xgplayer-drag"),r=this.find(".xgplayer-bar");if(!!r&&!!i){var o=Math.max(Math.min(e/r.getBoundingClientRect().height,1),0),a=parseInt(1e3*o,10),s={volume:{from:n.volume,to:a/1e3}};i.style.height="".concat(100*o,"%"),n.muted&&(s.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:n.muted,volume:n.volume,props:s}),n.volume=Math.max(Math.min(a/1e3,1),0),n.muted&&(n.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,t=e.volume,n=e.muted,i=this.find(".xgplayer-value-label"),r=Math.max(Math.min(t,1),0);i.innerText=n?0:Math.round(100*r)}},{key:"focus",value:function(){var e=this.player;if(!this.config.disable)e.focus({autoHide:!1}),this._timerId&&(i.ZP.clearTimeout(this,this._timerId),this._timerId=null),i.ZP.addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,n=!(arguments.length>1)||void 0===arguments[1]||arguments[1],r=arguments.length>2?arguments[2]:void 0,o=this._d,a=this.player;if(!o.isActive)this._timerId&&(i.ZP.clearTimeout(this,this._timerId),this._timerId=null),this._timerId=i.ZP.setTimeout(this,function(){!o.isActive&&(n?a.blur():a.focus(),i.ZP.removeClass(e.root,"slide-show"),o.isStart&&e.onBarMouseUp(r)),e._timerId=null},t)}},{key:"changeMuted",value:function(e){if(!this.config.disable){e&&e.stopPropagation();var t=this.player;this._d.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}}},{key:"animate",value:function(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(i.ZP.clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider",["mousedown","touchstart"],this.onBarMousedown),this.unbind(".xgplayer-slider",["mousemove","touchmove"],this.onBarMouseMove),this.unbind(".xgplayer-slider",["mouseup","touchend"],this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===r.Z.device?"touchend":"click",this.onIconHandle)}},{key:"render",value:function(){var e=this.config.default||this.player.volume,t=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(t?'<div class="xgplayer-value-label">'.concat(100*e,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*e,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}],v=[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:a.kd.CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}],p&&u(h.prototype,p),v&&u(h,v),Object.defineProperty(h,"prototype",{writable:!1}),m}(a.ZP);t.Z=p},342583:function(e,t,n){"use strict";n.d(t,{ZP:function(){return f}});let i=(e,t,n,i)=>{if("length"===n||"prototype"===n||"arguments"===n||"caller"===n)return;let o=Object.getOwnPropertyDescriptor(e,n),a=Object.getOwnPropertyDescriptor(t,n);if(!!r(o,a)||!i)Object.defineProperty(e,n,a)},r=function(e,t){return void 0===e||e.configurable||e.writable===t.writable&&e.enumerable===t.enumerable&&e.configurable===t.configurable&&(e.writable||e.value===t.value)},o=(e,t)=>{let n=Object.getPrototypeOf(t);if(n!==Object.getPrototypeOf(e))Object.setPrototypeOf(e,n)},a=(e,t)=>`/* Wrapped ${e}*/
${t}`,s=Object.getOwnPropertyDescriptor(Function.prototype,"toString"),u=Object.getOwnPropertyDescriptor(Function.prototype.toString,"name"),l=(e,t,n)=>{let i=""===n?"":`with ${n.trim()}() `,r=a.bind(null,i,t.toString());Object.defineProperty(r,"name",u),Object.defineProperty(e,"toString",{...s,value:r})},c=new WeakMap;function f(e,{cacheKey:t=([e])=>e,cache:n=new Map}={}){let r=new Map,a=function(...i){let o=t(i);if(r.has(o))return r.get(o);let a=(async()=>{try{if(n&&await n.has(o))return await n.get(o);let t=e.apply(this,i),r=await t;try{return r}finally{n&&await n.set(o,r)}}finally{r.delete(o)}})();return r.set(o,a),a};return!function(e,t,{ignoreNonConfigurable:n=!1}={}){let{name:r}=e;for(let r of Reflect.ownKeys(t))i(e,t,r,n);o(e,t),l(e,t,r)}(a,e,{ignoreNonConfigurable:!0}),c.set(a,n),a}}}]);